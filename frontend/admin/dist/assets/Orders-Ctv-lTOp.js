import{b as et,a as st,_ as rt,S as at}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-BTE6IYat.js";import{o as s,b as o,B as ot,d as t,c as T,f as U,t as d,n as A,h as j,g as I,a as S,w as L,F as z,i as G,T as nt,r as k,j as Y,k as lt,v as dt,x as Z,q as E,u as m,l as ct}from"./index-geKL4-dO.js";import{u as tt}from"./useClickOutside-DwMLeVnw.js";import{M as it}from"./Modal-37VtdIJ6.js";import{_ as ut}from"./Button.vue_vue_type_script_setup_true_lang-B99J7FL4.js";import{_ as gt}from"./Pagination-CzIoQabA.js";import{A as xt,a as pt,C as yt,b as mt}from"./CalendarDaysIcon-g48xxMBl.js";import{D as ht}from"./DownloadIcon-DVddNHJM.js";import{S as bt}from"./SearchIcon-C5V-iwii.js";const ft={},kt={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-package-check-icon lucide-package-check"};function vt(e,h){return s(),o("svg",kt,h[0]||(h[0]=[ot('<path d="m16 16 2 2 4-4"></path><path d="M21 10V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l2-1.14"></path><path d="m7.5 4.27 9 5.15"></path><polyline points="3.29 7 12 12 20.71 7"></polyline><line x1="12" x2="12" y1="22" y2="12"></line>',5)]))}const wt=et(ft,[["render",vt]]),_t={class:"grid grid-cols-4 gap-4 md:gap-4 mb-4 md:mb-4"},$t={class:"col-span-12 xl:col-span-1"},It={class:"rounded-2xl border border-warning-200 bg-white p-5 dark:border-warning-800 dark:bg-white/[0.03] md:p-6"},Ot={class:"flex items-center justify-center w-12 h-12 bg-warning-100 rounded-xl dark:bg-warning-500/15"},Ct={class:"flex items-end justify-between mt-5"},jt={class:"mt-2 font-bold text-warning-600 text-title-sm dark:text-white/90"},St={class:"col-span-12 xl:col-span-1"},Dt={class:"rounded-2xl border border-blue-light-200 bg-white p-5 dark:border-blue-light-800 dark:bg-white/[0.03] md:p-6"},Tt={class:"flex items-center justify-center w-12 h-12 bg-blue-light-100 rounded-xl dark:bg-blue-light-500/15"},Ut={class:"flex items-end justify-between mt-5"},Pt={class:"mt-2 font-bold text-blue-light-600 text-title-sm dark:text-white/90"},Qt={class:"col-span-12 xl:col-span-1"},Bt={class:"rounded-2xl border border-success-200 bg-white p-5 dark:border-success-800 dark:bg-white/[0.03] md:p-6"},Mt={class:"flex items-start justify-between"},Ft={class:"flex items-center justify-center w-12 h-12 bg-success-100 rounded-xl dark:bg-success-500/15"},qt={class:"flex items-end justify-between mt-5"},Rt={class:"mt-2 font-bold text-success-600 text-title-sm dark:text-white/90"},At={class:"col-span-12 xl:col-span-1"},Vt={class:"rounded-2xl border border-gray-200 bg-white p-5 dark:border-gray-800 dark:bg-white/[0.03] md:p-6"},Et={class:"flex items-start justify-between"},Lt={class:"flex items-center justify-center w-12 h-12 bg-gray-100 rounded-xl dark:bg-gray-800"},Nt={class:"flex items-end justify-between mt-5"},Ht={class:"mt-2 font-bold text-gray-800 text-title-sm dark:text-white/90"},zt={__name:"OrdersStatistics",props:{arrowUpIcon:{type:Object,required:!0},arrowDownIcon:{type:Object,required:!0},shoppingCartIcon:{type:Object,required:!0},calendarClockIcon:{type:Object,required:!0},calendarDaysIcon:{type:Object,required:!0},packageCheckIcon:{type:Object,required:!0},statistics:{type:Object,required:!0}},setup(e){return(h,r)=>(s(),o("div",_t,[t("div",$t,[t("div",It,[t("div",Ot,[(s(),T(U(e.shoppingCartIcon),{class:"text-warning-600 dark:text-warning-400"}))]),t("div",Ct,[t("div",null,[r[0]||(r[0]=t("span",{class:"font-bold text-sm text-gray-500 dark:text-warning-400"},"Новые заказы",-1)),t("h4",jt,d(e.statistics.current.pending),1)]),r[1]||(r[1]=t("span",{class:"flex items-center gap-1 rounded-full bg-gray-50 py-0.5 pl-2 pr-2.5 text-sm font-medium text-gray-600 dark:bg-gray-500/15 dark:text-gray-500"}," Всего ",-1))])])]),t("div",St,[t("div",Dt,[t("div",Tt,[(s(),T(U(e.calendarClockIcon),{class:"text-blue-light-600 dark:text-blue-light-400"}))]),t("div",Ut,[t("div",null,[r[2]||(r[2]=t("span",{class:"font-bold text-sm text-gray-500 dark:text-blue-light-400"},"На выполнении",-1)),t("h4",Pt,d(e.statistics.current.processing),1)]),r[3]||(r[3]=t("span",{class:"flex items-center gap-1 rounded-full bg-gray-50 py-0.5 pl-2 pr-2.5 text-sm font-medium text-gray-600 dark:bg-gray-500/15 dark:text-gray-500"}," Всего ",-1))])])]),t("div",Qt,[t("div",Bt,[t("div",Mt,[t("div",Ft,[(s(),T(U(e.packageCheckIcon),{class:"text-success-600 dark:text-success-400"}))]),r[4]||(r[4]=t("span",{class:"flex items-center gap-1 rounded-full bg-gray-50 py-0.5 pl-2 pr-2.5 text-xs font-medium text-gray-600 dark:bg-gray-500/15 dark:text-gray-500"}," за текущий месяц ",-1))]),t("div",qt,[t("div",null,[r[5]||(r[5]=t("span",{class:"font-bold text-sm text-gray-500 dark:text-success-400"},"Доставлено",-1)),t("h4",Rt,d(e.statistics.current.shipped),1)]),t("span",{class:A(["flex items-center gap-1 rounded-full py-0.5 pl-2 pr-2.5 text-sm font-medium",e.statistics.percentages.shipped>0?"bg-success-50 text-success-600 dark:bg-success-500/15 dark:text-success-500":e.statistics.percentages.shipped<0?"bg-error-50 text-error-600 dark:bg-error-500/15 dark:text-error-500":"bg-gray-50 text-gray-600 dark:bg-gray-500/15 dark:text-gray-500"])},[e.statistics.percentages.shipped!==0?(s(),T(U(e.statistics.percentages.shipped>0?e.arrowUpIcon:e.arrowDownIcon),{key:0})):j("",!0),I(" "+d(Math.abs(e.statistics.percentages.shipped))+"% ",1)],2)])])]),t("div",At,[t("div",Vt,[t("div",Et,[t("div",Lt,[(s(),T(U(e.calendarDaysIcon),{class:"text-gray-800 dark:text-white/90"}))]),r[6]||(r[6]=t("span",{class:"flex items-center gap-1 rounded-full bg-gray-50 py-0.5 pl-2 pr-2.5 text-xs font-medium text-gray-600 dark:bg-gray-500/15 dark:text-gray-500"}," за текущий месяц ",-1))]),t("div",Nt,[t("div",null,[r[7]||(r[7]=t("span",{class:"font-bold text-sm text-gray-500 dark:text-gray-400"},"Сумма выполненых заказов",-1)),t("h4",Ht,d(new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB"}).format(e.statistics.current.total_amount)),1)]),t("span",{class:A(["flex items-center gap-1 rounded-full py-0.5 pl-2 pr-2.5 text-sm font-medium",e.statistics.percentages.total_amount>0?"bg-success-50 text-success-600 dark:bg-success-500/15 dark:text-success-500":e.statistics.percentages.total_amount<0?"bg-error-50 text-error-600 dark:bg-error-500/15 dark:text-error-500":"bg-gray-50 text-gray-600 dark:bg-gray-500/15 dark:text-gray-500"])},[e.statistics.percentages.total_amount!==0?(s(),T(U(e.statistics.percentages.total_amount>0?e.arrowUpIcon:e.arrowDownIcon),{key:0})):j("",!0),I(" "+d(Math.abs(e.statistics.percentages.total_amount))+"% ",1)],2)])])])]))}},Gt={class:"flex flex-col justify-between gap-5 border-b border-gray-200 px-5 py-4 sm:flex-row sm:items-center dark:border-gray-800"},Wt={class:"text-base font-medium text-gray-800 dark:text-white/90 flex flex-row items-center"},Jt={class:"flex flex-col md:flex-row gap-3"},Kt={class:"shadow-theme-xs inline-flex items-center justify-center gap-2 rounded-lg bg-white px-4 py-3 text-sm font-medium text-gray-700 ring-1 ring-gray-300 transition hover:bg-gray-50 dark:bg-gray-800 dark:text-gray-400 dark:ring-gray-700 dark:hover:bg-white/[0.03]"},Xt={__name:"OrdersHeader",props:{totalItems:{type:Number,required:!0},packageIcon:{type:Object,required:!0},downloadIcon:{type:Object,required:!0}},setup(e){return(h,r)=>(s(),o("div",Gt,[t("h3",Wt,[(s(),T(U(e.packageIcon),{class:"menu-item-icon-active mr-2"})),I(" Список заказов ("+d(e.totalItems)+") ",1)]),t("div",Jt,[t("button",Kt,[r[0]||(r[0]=I(" Скачать ")),(s(),T(U(e.downloadIcon)))])])]))}},Yt={class:"relative flex-1 sm:flex-auto sm:w-auto sm:min-w-[490px]"},Zt={class:"absolute top-1/2 left-4 -translate-y-1/2 text-gray-500 dark:text-gray-400"},te=["value"],ee={__name:"OrdersSearch",props:{searchQuery:String,searchIcon:Object},emits:["update:searchQuery"],setup(e,{emit:h}){const r=h,g=()=>{r("update:searchQuery","")};return(x,y)=>(s(),o("div",Yt,[t("span",Zt,[(s(),T(U(e.searchIcon)))]),y[1]||(y[1]=t("label",{for:"searchQuery"},null,-1)),t("input",{id:"searchQuery",type:"text",placeholder:"Поиск по номеру заказа, ФИО, почте или телефону клиента",value:e.searchQuery,onInput:y[0]||(y[0]=w=>r("update:searchQuery",w.target.value)),class:"dark:bg-dark-900 shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800 h-11 w-full rounded-lg border border-gray-300 bg-transparent py-2.5 pr-12 pl-11 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"},null,40,te),e.searchQuery?(s(),o("button",{key:0,onClick:g,class:"absolute top-1/2 right-2 -translate-y-1/2 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 text-xl leading-none cursor-pointer bg-white dark:bg-gray-900 px-1 z-10"}," ✕ ")):j("",!0)]))}},se={key:0,class:"text-gray-400"},re={key:1,class:"text-gray-800 dark:text-white/90"},ae={key:0,class:"absolute z-10 w-full mt-1 bg-white rounded-lg shadow-sm dark:bg-gray-900"},oe={class:"overflow-y-auto divide-y divide-gray-200 custom-scrollbar max-h-60 dark:divide-gray-800",role:"listbox"},ne=["onClick","aria-selected"],le={class:"grow"},de={key:0,class:"w-5 h-5 text-gray-400 dark:text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},ce={__name:"OrdersStatusSelector",props:{statuses:Array,selectedItem:Object,isOpen:Boolean},emits:["toggleDropdown","toggleItem"],setup(e,{emit:h}){const r=e,g=h,x=tt(()=>{r.isOpen&&g("toggleDropdown")}),y=()=>{g("toggleDropdown")},w=b=>{g("toggleItem",b)},a=b=>b.value===null?r.selectedItem===null:r.selectedItem&&r.selectedItem.value===b.value;return(b,n)=>(s(),o("div",{class:"relative sm:min-w-[200px] sm:w-auto",ref_key:"multiSelectRef",ref:x},[t("div",{onClick:y,class:A(["dark:bg-dark-900 h-11 flex items-center w-full appearance-none rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",{"text-gray-800 dark:text-white/90":e.isOpen}])},[e.selectedItem?(s(),o("span",re,d(e.selectedItem.label),1)):(s(),o("span",se," Все статусы ")),(s(),o("svg",{class:A(["ml-auto",{"transform rotate-180":e.isOpen}]),width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n[0]||(n[0]=[t("path",{d:"M4.79175 7.39551L10.0001 12.6038L15.2084 7.39551",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]),2))],2),S(nt,{"enter-active-class":"transition duration-100 ease-out","enter-from-class":"transform scale-95 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-75 ease-in","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-95 opacity-0"},{default:L(()=>[e.isOpen?(s(),o("div",ae,[t("ul",oe,[(s(!0),o(z,null,G(e.statuses,i=>(s(),o("li",{key:i.id,onClick:p=>w(i),class:A(["relative flex items-center w-full px-3 py-2 border-transparent cursor-pointer first:rounded-t-lg last:rounded-b-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-800",{"bg-gray-50 dark:bg-white/[0.03]":a(i)}]),role:"option","aria-selected":a(i)},[t("span",le,d(i.label),1),a(i)?(s(),o("svg",de,n[1]||(n[1]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))):j("",!0)],10,ne))),128))])])):j("",!0)]),_:1})],512))}},ie={class:"border-b border-gray-200 px-5 py-4 dark:border-gray-800"},ue={class:"flex flex-col md:flex-row gap-3 sm:justify-between"},ge={class:"flex flex-col md:flex-row gap-3"},xe={__name:"OrdersFilters",props:{searchQuery:String,statuses:Array,selectedItem:Object,isOpen:Boolean,showFilter:Boolean,searchIcon:Object,settingsIcon:Object},emits:["update:searchQuery","toggleDropdown","toggleItem","update:showFilter"],setup(e,{emit:h}){const r=h;return(g,x)=>(s(),o("div",ie,[t("div",ue,[t("div",ge,[S(ee,{searchQuery:e.searchQuery,searchIcon:e.searchIcon,"onUpdate:searchQuery":x[0]||(x[0]=y=>r("update:searchQuery",y))},null,8,["searchQuery","searchIcon"]),S(ce,{statuses:e.statuses,selectedItem:e.selectedItem,isOpen:e.isOpen,onToggleDropdown:x[1]||(x[1]=y=>r("toggleDropdown")),onToggleItem:x[2]||(x[2]=y=>r("toggleItem",y))},null,8,["statuses","selectedItem","isOpen"])])])]))}},pe={__name:"OrderDropdown",emits:["updateStatus"],setup(e,{emit:h}){const r=k(!1),g=k(null),x=h,y=()=>{r.value=!r.value},w=()=>{r.value=!1},a=b=>{x("updateStatus",b),w()};return tt(g),(b,n)=>(s(),o("div",{class:"relative",ref_key:"filterRef",ref:g,onClick:w},[t("button",{class:"bg-brand-500 shadow-theme-xs hover:bg-brand-600 inline-flex items-center justify-center gap-2 rounded-lg px-4 py-3 text-sm font-medium text-white transition",onClick:Y(y,["stop"]),type:"button"}," Сменить статус "),lt(t("div",{onClick:n[5]||(n[5]=Y(()=>{},["stop"])),class:"absolute right-0 z-10 mt-2 w-35 rounded-lg border border-gray-200 bg-white p-1 shadow-lg dark:border-gray-700 dark:bg-gray-800"},[t("button",{onClick:n[0]||(n[0]=i=>a("pending")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 rounded"}," Новый "),t("button",{onClick:n[1]||(n[1]=i=>a("processing")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 rounded"}," Выполнение "),t("button",{onClick:n[2]||(n[2]=i=>a("shipped")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 rounded"}," Отправлен "),t("button",{onClick:n[3]||(n[3]=i=>a("cancelled")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 rounded"}," Отменён "),t("button",{onClick:n[4]||(n[4]=i=>a("return")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 rounded"}," Возврат ")],512),[[dt,r.value]])],512))}},R="http://test.dennistp.beget.tech";function H(){const e=k([]),h=k(!1),r=k(null),g=k(1),x=k(50),y=k(0),w=Z(()=>Math.ceil(y.value/x.value)),a=k(""),b=k(null),n=k([{id:"all",value:null,label:"Все статусы"},{id:"pending",value:"pending",label:"Новый"},{id:"processing",value:"processing",label:"Выполняется"},{id:"shipped",value:"shipped",label:"Отправлен"},{id:"return",value:"return",label:"Возврат"},{id:"cancelled",value:"cancelled",label:"Отменён"}]),i=k({sale:{true:!0,false:!0},published:{true:!0,false:!0}}),p=Z(()=>{const c=w.value,u=g.value,f=2,C=[],_=[];for(let Q=Math.max(2,u-f);Q<=Math.min(c-1,u+f);Q++)C.push(Q);return u-f>2?_.push(1,"..."):_.push(1),_.push(...C),u+f<c-1?_.push("...",c):c>1&&_.push(c),_}),B=new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB"}),O=async()=>{h.value=!0,r.value=null;const c=new URLSearchParams({page:g.value.toString(),per_page:x.value.toString()});a.value.trim()&&c.append("search",a.value.trim()),b.value&&b.value.value!==null&&c.append("status",b.value.value);const u=`${R}/api/orders?${c.toString()}`;try{const f=await fetch(u);if(!f.ok)throw new Error(`HTTP error! status: ${f.status}`);const C=await f.json();e.value=C.orders.data,y.value=C.orders.total}catch(f){r.value=f.message,console.error("Ошибка загрузки заказов:",f)}finally{h.value=!1}},v=()=>{g.value>1&&(g.value--,O())},l=()=>{g.value<w.value&&(g.value++,O())},$=c=>{g.value=c,O()},V=async c=>{try{const u=await fetch(`${R}/api/orders/${c}`);if(!u.ok)throw new Error(`HTTP error! status: ${u.status}`);return(await u.json()).order}catch(u){throw console.error("Ошибка загрузки заказа:",u),u}},N=async(c,u)=>{try{const f=new FormData;Object.keys(u).forEach(_=>{var Q;typeof u[_]=="boolean"?f.append(_,u[_]?"1":"0"):f.append(_,((Q=u[_])==null?void 0:Q.toString())||"")}),f.append("_method","PUT");const C=await fetch(`${R}/api/orders/${c}`,{method:"POST",headers:{Accept:"application/json"},body:f});if(C.ok)return{success:!0};if(C.status===422)return{success:!1,errors:(await C.json()).errors};throw new Error(`HTTP error! status: ${C.status}`)}catch(f){return console.error("Ошибка обновления заказа:",f),{success:!1}}},M=()=>{g.value=1};let P=null;return E(a,c=>{P&&clearTimeout(P),P=setTimeout(()=>{M(),O()},500)}),E(()=>i.value,()=>{M(),O()},{deep:!0}),E(b,()=>{M(),O()}),{orders:e,loading:h,error:r,page:g,itemsPerPage:x,totalItems:y,totalPages:w,searchQuery:a,selectedStatus:b,statuses:n,filters:i,visiblePages:p,formatter:B,fetchOrders:O,fetchOrderStatistics:async()=>{try{const c=await fetch(`${R}/api/orders/statistics`);if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);return(await c.json()).statistics}catch(c){throw console.error("Ошибка загрузки статистики заказов:",c),c}},fetchOrderById:async c=>{try{const u=await fetch(`${R}/api/orders/${c}`);if(!u.ok)throw new Error(`HTTP error! status: ${u.status}`);return{success:!0,data:(await u.json()).order}}catch(u){return console.error("Ошибка загрузки заказа:",u),{success:!1,errors:u.message}}},handlePrevPage:v,handleNextPage:l,handleGoToPage:$,getOrder:V,updateOrder:N,resetPage:M}}const ye={class:"relative bg-white dark:bg-gray-800 rounded-xl shadow-lg max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto custom-scrollbar"},me={class:"p-6"},he={class:"flex justify-between items-center mb-4"},be={class:"text-lg font-semibold text-gray-900 dark:text-white"},fe={key:0,class:"flex items-center space-x-4"},ke={key:0,class:"px-2.5 py-0.5 rounded-full font-bold text-md bg-warning-50 text-warning-600 dark:bg-warning-500/15 dark:text-orange-400"},ve={key:1,class:"px-2.5 py-0.5 rounded-full font-bold text-md bg-blue-light-50 text-blue-light-500 dark:bg-blue-light-500/15 dark:text-blue-light-500"},we={key:2,class:"px-2.5 py-0.5 rounded-full font-bold text-md bg-success-50 text-success-600 dark:bg-success-500/15 dark:text-success-500"},_e={key:3,class:"px-2.5 py-0.5 rounded-full font-bold text-md bg-error-50 text-error-600 dark:bg-error-500/15 dark:text-error-500"},$e={key:4,class:"px-2.5 py-0.5 rounded-full font-bold text-md bg-gray-100 text-gray-700 dark:bg-white/5 dark:text-white/80"},Ie={key:0,class:"flex justify-center items-center h-64"},Oe={key:1,class:"text-center text-red-500"},Ce={key:2,class:"space-y-6"},je={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Se={class:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg"},De={class:"text-sm text-gray-600 dark:text-gray-400"},Te={class:"font-medium"},Ue={class:"text-sm text-gray-600 dark:text-gray-400"},Pe={class:"font-medium"},Qe={class:"text-sm text-gray-600 dark:text-gray-400"},Be={key:0,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-warning-50 text-warning-600 dark:bg-warning-500/15 dark:text-orange-400"},Me={key:1,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-blue-light-50 text-blue-light-500 dark:bg-blue-light-500/15 dark:text-blue-light-500"},Fe={key:2,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-success-50 text-success-600 dark:bg-success-500/15 dark:text-success-500"},qe={key:3,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-error-50 text-error-600 dark:bg-error-500/15 dark:text-error-500"},Re={key:4,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-gray-100 text-gray-700 dark:bg-white/5 dark:text-white/80"},Ae={class:"text-sm text-gray-600 dark:text-gray-400"},Ve={class:"font-medium text-error-600 dark:text-error-400"},Ee={class:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg"},Le={class:"text-sm text-gray-600 dark:text-gray-400"},Ne={class:"font-medium"},He={class:"text-sm text-gray-600 dark:text-gray-400"},ze={class:"font-medium"},Ge={class:"text-sm text-gray-600 dark:text-gray-400"},We={class:"font-medium"},Je={class:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg"},Ke={class:"space-y-4"},Xe={class:"flex items-center space-x-4"},Ye={class:"font-medium text-gray-900 dark:text-white"},Ze={class:"font-medium text-gray-900 dark:text-white"},ts={class:"text-sm text-gray-600 dark:text-gray-400"},es={key:0},ss={key:1},rs={class:"text-right"},as={class:"font-medium text-gray-900 dark:text-white"},os={class:"text-sm text-gray-600 dark:text-gray-400"},ns={key:0,class:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg"},ls={class:"space-y-4"},ds={class:"text-sm text-gray-600 dark:text-gray-400"},cs={class:"flex justify-end gap-3 pt-4"},is={__name:"OrderModal",props:{isVisible:{type:Boolean,default:!1},orderId:{type:String,default:""}},emits:["close","updateStatus","statusUpdated"],setup(e,{emit:h}){const r=e,g=h,{formatter:x,fetchOrderById:y,updateOrder:w}=H(),a=k(null),b=k(!1),n=k(null),i=v=>new Date(v).toLocaleString("ru-RU"),p=()=>{g("close"),a.value=null,n.value=null},B=async v=>{if(!a.value)return;const l=await w(a.value.id,{status:v});l.success?(a.value.status=v,g("statusUpdated",a.value.id,v)):console.error("Ошибка обновления статуса:",l.errors)},O=async()=>{if(r.orderId)try{b.value=!0;const v=await y(r.orderId);v.success?a.value=v.data:n.value=v.errors||"Ошибка загрузки заказа"}catch(v){n.value="Ошибка загрузки заказа",console.error(v)}finally{b.value=!1}};return E(()=>r.isVisible,async v=>{v&&r.orderId?await O():(a.value=null,n.value=null)}),(v,l)=>e.isVisible?(s(),T(it,{key:0,onClose:p},{body:L(()=>[t("div",ye,[t("div",me,[t("div",he,[t("h3",be," Детали заказа #"+d(a.value?a.value.order:""),1),a.value?(s(),o("div",fe,[a.value.status==="pending"?(s(),o("span",ke," Новый ")):a.value.status==="processing"?(s(),o("span",ve," Выполнение ")):a.value.status==="shipped"?(s(),o("span",we," Отправлен ")):a.value.status==="return"?(s(),o("span",_e," Возврат ")):a.value.status==="cancelled"?(s(),o("span",$e," Отменён ")):j("",!0),S(pe,{onUpdateStatus:B})])):j("",!0)]),b.value?(s(),o("div",Ie,l[0]||(l[0]=[t("div",{class:"animate-spin rounded-full h-16 w-16 border-b-2 border-brand-500"},null,-1)]))):n.value?(s(),o("div",Oe," Ошибка загрузки заказа: "+d(n.value),1)):a.value?(s(),o("div",Ce,[t("div",je,[t("div",Se,[l[5]||(l[5]=t("h3",{class:"font-medium text-gray-900 dark:text-white mb-2"},"Информация о заказе",-1)),t("p",De,[l[1]||(l[1]=I("Номер заказа: ")),t("span",Te,d(a.value.order),1)]),t("p",Ue,[l[2]||(l[2]=I("Дата создания: ")),t("span",Pe,d(i(a.value.created_at)),1)]),t("p",Qe,[l[3]||(l[3]=I("Статус: ")),a.value.status==="pending"?(s(),o("span",Be,"Новый")):a.value.status==="processing"?(s(),o("span",Me,"Выполнение")):a.value.status==="shipped"?(s(),o("span",Fe,"Отправлен")):a.value.status==="return"?(s(),o("span",qe,"Возврат")):a.value.status==="cancelled"?(s(),o("span",Re,"Отменён")):j("",!0)]),t("p",Ae,[l[4]||(l[4]=I("Общая сумма: ")),t("span",Ve,d(m(x).format(a.value.total_amount)),1)])]),t("div",Ee,[l[9]||(l[9]=t("h3",{class:"font-medium text-gray-900 dark:text-white mb-2"},"Информация о клиенте",-1)),t("p",Le,[l[6]||(l[6]=I("Имя: ")),t("span",Ne,d(a.value.name),1)]),t("p",He,[l[7]||(l[7]=I("Email: ")),t("span",ze,d(a.value.email),1)]),t("p",Ge,[l[8]||(l[8]=I("Телефон: ")),t("span",We,d(a.value.phone),1)])])]),t("div",Je,[l[10]||(l[10]=t("h3",{class:"font-medium text-gray-900 dark:text-white mb-4"},"Товары в заказе",-1)),t("div",Ke,[(s(!0),o(z,null,G(a.value.items,$=>(s(),o("div",{key:$.id,class:"flex items-center justify-between border-t border-gray-200 dark:border-gray-700 pt-4"},[t("div",Xe,[t("p",Ye,d($.product.article),1),t("div",null,[t("p",Ze,d($.product.name),1),t("p",ts,[I("Количество: "+d($.quantity)+" ",1),$.product_unit==="кв.м"?(s(),o("span",es,"м²")):(s(),o("span",ss,d($.product_unit),1))])])]),t("div",rs,[t("p",as,d(m(x).format($.price)),1),t("p",os,"Итого: "+d(m(x).format($.price*$.quantity)),1)])]))),128))])]),a.value.comment?(s(),o("div",ns,[l[11]||(l[11]=t("h3",{class:"font-medium text-gray-900 dark:text-white mb-4"},"Комментарий к заказу",-1)),t("div",ls,[t("p",ds,d(a.value.comment),1)])])):j("",!0)])):j("",!0),t("div",cs,[S(ut,{variant:"outline",onClick:p},{default:L(()=>l[12]||(l[12]=[I("Закрыть")])),_:1})])])])]),_:1})):j("",!0)}},us={class:"p-4 border-t border-gray-100 dark:border-gray-800 sm:p-6"},gs={class:"space-y-5"},xs={class:"overflow-hidden rounded-xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]"},ps={class:"max-w-full overflow-x-auto custom-scrollbar"},ys={key:0,class:"flex justify-center items-center h-screen"},ms={key:1,class:"flex flex-col justify-center items-center h-screen font-bold text-error-700 text-theme-xl dark:text-error-500"},hs={key:2,class:"flex flex-col justify-center items-center h-screen menu-item-icon-active text-center font-bold text-theme-xl m-5"},bs={key:3,class:"min-w-full"},fs={class:"divide-y divide-gray-200 dark:divide-gray-700"},ks={class:"px-5 py-4 sm:px-6"},vs=["onClick"],ws={class:"px-5 py-4 sm:px-6"},_s={class:"text-gray-500 text-left text-theme-sm dark:text-gray-400"},$s={class:"text-gray-500 text-left text-theme-sm dark:text-gray-400"},Is={class:"px-5 py-4 sm:px-6"},Os={"data-v-67f048e0":"",class:"block font-medium text-gray-800 text-theme-sm dark:text-white/90"},Cs={"data-v-67f048e0":"",class:"block text-gray-500 text-theme-xs dark:text-gray-400"},js={class:"px-5 py-4 sm:px-6"},Ss={class:"text-gray-500 text-left text-theme-sm dark:text-gray-400"},Ds={class:"px-5 py-4 sm:px-6"},Ts={class:"text-gray-500 text-left text-theme-sm dark:text-gray-400"},Us={class:"px-5 py-4 sm:px-6"},Ps={class:"font-medium text-left text-gray-800 text-theme-sm dark:text-white/90"},Qs={class:"px-5 py-4 sm:px-6 text-center"},Bs={key:0,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-warning-50 text-warning-600 dark:bg-warning-500/15 dark:text-orange-400"},Ms={key:1,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-blue-light-50 text-blue-light-500 dark:bg-blue-light-500/15 dark:text-blue-light-500"},Fs={key:2,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-success-50 text-success-600 dark:bg-success-500/15 dark:text-success-500"},qs={key:3,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-error-50 text-error-600 dark:bg-error-500/15 dark:text-error-500"},Rs={key:4,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-gray-100 text-gray-700 dark:bg-white/5 dark:text-white/80"},As={__name:"OrdersTable",props:{loading:Boolean,error:String,orders:Array,formatter:Object},emits:["fetchOrders","edit","updateStatus"],setup(e,{emit:h}){const r=h,g=k(!1),x=k(""),y=()=>{r("fetchOrders")},w=n=>{x.value=n,g.value=!0},a=()=>{g.value=!1,x.value=""},b=(n,i)=>{r("updateStatus",{id:n},i)};return(n,i)=>(s(),o("div",us,[t("div",gs,[t("div",xs,[t("div",ps,[e.loading?(s(),o("div",ys,i[0]||(i[0]=[t("div",{class:"animate-spin rounded-full h-16 w-16 border-b-2 border-brand-500"},null,-1)]))):e.error?(s(),o("div",ms,[i[1]||(i[1]=I(" Ошибка при загрузке")),i[2]||(i[2]=t("br",null,null,-1)),t("button",{class:"inline-flex items-center justify-center font-medium gap-2 rounded-lg transition px-4 py-3 text-sm bg-brand-500 text-white shadow-theme-xs hover:bg-brand-600 disabled:bg-brand-300 mt-2",onClick:y}," Попробовать снова ")])):e.orders.length===0?(s(),o("div",hs," Заказы не найдены ")):(s(),o("table",bs,[i[3]||(i[3]=t("thead",null,[t("tr",{class:"border-gray-100 border-y bg-gray-50 dark:border-gray-800 dark:bg-gray-900"},[t("th",{class:"cursor-pointer px-5 py-3 text-left w-2/12 sm:px-6"},[t("div",{class:"flex items-center gap-3"},[t("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"№ Заказа")])]),t("th",{class:"cursor-pointer px-5 py-3 text-left w-1/12 sm:px-6"},[t("div",{class:"flex items-left gap-3"},[t("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Дата")])]),t("th",{class:"px-5 py-3 text-left w-3/12 sm:px-6"},[t("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Клиент")]),t("th",{class:"px-5 py-3 text-left w-2/12 sm:px-6"},[t("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Телефон")]),t("th",{class:"px-5 py-3 text-left w-1/12 sm:px-6"},[t("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Товары")]),t("th",{class:"px-5 py-3 text-left w-1/12 sm:px-6"},[t("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Сумма")]),t("th",{class:"px-5 py-3 text-center w-2/12 sm:px-6"},[t("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Статус заказа")])])],-1)),t("tbody",fs,[(s(!0),o(z,null,G(e.orders,p=>(s(),o("tr",{key:p.id,class:"border-t border-gray-100 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800"},[t("td",ks,[t("button",{onClick:B=>w(p.order),class:"font-medium text-left text-gray-800 text-theme-sm dark:text-white/90 hover:text-brand-500 dark:hover:text-brand-400"},d(p.order),9,vs)]),t("td",ws,[t("p",_s,d(new Date(p.created_at).toLocaleDateString("ru-RU")),1),t("p",$s,d(new Date(p.created_at).toLocaleTimeString("ru-RU")),1)]),t("td",Is,[t("span",Os,d(p.name),1),t("span",Cs,d(p.email),1)]),t("td",js,[t("p",Ss,d(p.phone),1)]),t("td",Ds,[t("p",Ts,d(p.items?p.items.length:0)+" товаров ",1)]),t("td",Us,[t("p",Ps,d(e.formatter.format(p.total_amount)),1)]),t("td",Qs,[p.status==="pending"?(s(),o("span",Bs," Новый ")):p.status==="processing"?(s(),o("span",Ms," Выполнение ")):p.status==="shipped"?(s(),o("span",Fs," Отправлен ")):p.status==="return"?(s(),o("span",qs," Возврат ")):p.status==="cancelled"?(s(),o("span",Rs," Отменён ")):j("",!0)])]))),128))])]))])])]),S(is,{"is-visible":g.value,"order-id":x.value,onClose:a,onStatusUpdated:b},null,8,["is-visible","order-id"])]))}},Vs={class:"space-y-5 sm:space-y-6"},Es={class:"rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]"},Ys={__name:"Orders",setup(e){const h=k("Заказы"),r=xt,g=pt,x=yt,y=mt,w=wt,a=at,b=ht,n=bt,{orders:i,loading:p,error:B,page:O,totalItems:v,totalPages:l,searchQuery:$,selectedStatus:V,statuses:N,formatter:M,fetchOrders:P,fetchOrderStatistics:W}=H(),J=k(!1),c=k(!1),u=k({current:{pending:0,processing:0,shipped:0,total_amount:0},previous:{pending:0,processing:0,shipped:0,total_amount:0},percentages:{pending:0,processing:0,shipped:0,total_amount:0}}),f=()=>{c.value=!c.value},C=D=>{V.value=D.value===null?null:D,c.value=!1},_=D=>{O.value=D,P()},Q=async(D,F)=>{const{updateOrder:q}=H(),X=await q(D.id,{status:F});X.success?(P(),K()):console.error("Ошибка обновления статуса:",X.errors)},K=async()=>{try{const D=await W();u.value=D}catch(D){console.error("Ошибка загрузки статистики:",D)}};return ct(()=>{P(),K()}),(D,F)=>(s(),T(st,null,{default:L(()=>[S(rt,{pageTitle:h.value},null,8,["pageTitle"]),t("div",Vs,[S(zt,{arrowDownIcon:m(r),arrowUpIcon:m(g),shoppingCartIcon:m(a),calendarClockIcon:m(x),calendarDaysIcon:m(y),packageCheckIcon:m(w),statistics:u.value},null,8,["arrowDownIcon","arrowUpIcon","shoppingCartIcon","calendarClockIcon","calendarDaysIcon","packageCheckIcon","statistics"]),t("div",Es,[S(Xt,{totalItems:m(v),packageIcon:m(a),downloadIcon:m(b)},null,8,["totalItems","packageIcon","downloadIcon"]),S(xe,{searchQuery:m($),statuses:m(N),selectedItem:m(V),isOpen:c.value,searchIcon:m(n),"onUpdate:searchQuery":F[0]||(F[0]=q=>$.value=q),onToggleDropdown:f,onToggleItem:C,"onUpdate:showFilter":F[1]||(F[1]=q=>J.value=q)},null,8,["searchQuery","statuses","selectedItem","isOpen","searchIcon"]),S(As,{loading:m(p),error:m(B),orders:m(i),formatter:m(M),onFetchOrders:m(P),onUpdateStatus:Q},null,8,["loading","error","orders","formatter","onFetchOrders"]),S(gt,{currentPage:m(O),totalPages:m(l),onPageChange:_,class:"px-6"},null,8,["currentPage","totalPages"])])])]),_:1}))}};export{Ys as default};
