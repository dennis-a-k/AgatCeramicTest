import{r as p,z as O,w as j}from"./index-DRUAnB2R.js";const $="http://test.dennistp.beget.tech";function z(){const v=p([]),w=p(!1),P=p(null),c=p({key:null,asc:!0}),i=p(1),g=p(50),h=p(0),_=O(()=>Math.ceil(h.value/g.value)),y=p(""),S=p(null),b=p({sale:{true:!0,false:!0},published:{true:!0,false:!0}}),H=O(()=>{const t=_.value,a=i.value,r=2,s=[],e=[];for(let o=Math.max(2,a-r);o<=Math.min(t-1,a+r);o++)s.push(o);return a-r>2?e.push(1,"..."):e.push(1),e.push(...s),a+r<t-1?e.push("...",t):t>1&&e.push(t),e}),U=new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB"}),f=async()=>{w.value=!0,P.value=null;const t=new URLSearchParams({page:i.value.toString(),per_page:g.value.toString()});c.value.key&&(t.append("sort_key",c.value.key),t.append("sort_direction",c.value.asc?"asc":"desc")),S.value&&t.append("category_id",S.value.value.toString()),y.value.trim()&&t.append("search",y.value.trim());const a=Object.keys(b.value.sale).filter(e=>b.value.sale[e]);a.length>0&&a.forEach(e=>t.append("is_sale[]",e));const r=Object.keys(b.value.published).filter(e=>b.value.published[e]);r.length>0&&r.forEach(e=>t.append("is_published[]",e));const s=`${$}/api/products?${t.toString()}`;try{const e=await fetch(s);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const o=await e.json();v.value=o.products.data,h.value=o.products.total}catch(e){P.value=e.message,console.error("Ошибка загрузки товаров:",e)}finally{w.value=!1}},R=t=>{c.value.key===t?c.value.asc=!c.value.asc:(c.value.key=t,c.value.asc=!0),f()},B=()=>{i.value>1&&(i.value--,f())},I=()=>{i.value<_.value&&(i.value++,f())},L=t=>{i.value=t,f()},M=async t=>{try{const a=await fetch(`${$}/api/products/${t}`,{method:"DELETE"});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);return!0}catch(a){return console.error("Ошибка удаления товара:",a),!1}},k=async t=>{try{const a=await fetch(`${$}/api/products/${t}`);if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);return(await a.json()).product}catch(a){throw console.error("Ошибка загрузки товара:",a),a}},G=async(t,a,r)=>{try{const s=new FormData;Object.keys(a).forEach(o=>{var n;o==="images"?a.images.forEach((u,l)=>{var d;s.append(`images[${l}][id]`,((d=u.id)==null?void 0:d.toString())||""),s.append(`images[${l}][sort_order]`,u.sort_order.toString())}):o==="attribute_values"?a.attribute_values.forEach((u,l)=>{var d,m,A;s.append(`attribute_values[${l}][attribute_id]`,((d=u.attribute_id)==null?void 0:d.toString())||""),s.append(`attribute_values[${l}][string_value]`,u.string_value||""),s.append(`attribute_values[${l}][number_value]`,((m=u.number_value)==null?void 0:m.toString())||""),s.append(`attribute_values[${l}][text_value]`,u.text_value||""),typeof u.boolean_value=="boolean"?s.append(`attribute_values[${l}][boolean_value]`,u.boolean_value?"1":"0"):s.append(`attribute_values[${l}][boolean_value]`,((A=u.boolean_value)==null?void 0:A.toString())||"")}):typeof a[o]=="boolean"?s.append(o,a[o]?"1":"0"):s.append(o,((n=a[o])==null?void 0:n.toString())||"")}),s.append("_method","PUT"),r&&r.length>0&&r.forEach((o,n)=>{s.append(`new_images[${n}]`,o)});const e=await fetch(`${$}/api/products/${t}`,{method:"POST",headers:{Accept:"application/json"},body:s});if(e.ok)return{success:!0};if(e.status===422)return{success:!1,errors:(await e.json()).errors};throw new Error(`HTTP error! status: ${e.status}`)}catch(s){return console.error("Ошибка обновления товара:",s),{success:!1}}},E=()=>{i.value=1};let T=null;return j(y,t=>{T&&clearTimeout(T),T=setTimeout(()=>{E(),f()},500)}),j(()=>b.value,()=>{E(),f()},{deep:!0}),j(S,()=>{E(),f()}),{products:v,loading:w,error:P,sort:c,page:i,itemsPerPage:g,totalItems:h,totalPages:_,searchQuery:y,selectedCategory:S,filters:b,visiblePages:H,formatter:U,fetchProducts:f,handleSortBy:R,handlePrevPage:B,handleNextPage:I,handleGoToPage:L,deleteProduct:M,getProduct:k,updateProduct:G,createProduct:async(t,a)=>{try{const r=new FormData;Object.keys(t).forEach(e=>{var o;e==="images"?t.images.forEach((n,u)=>{var l;r.append(`images[${u}][id]`,((l=n.id)==null?void 0:l.toString())||""),r.append(`images[${u}][sort_order]`,n.sort_order.toString())}):e==="attribute_values"?t.attribute_values.forEach((n,u)=>{var l,d,m;r.append(`attribute_values[${u}][attribute_id]`,((l=n.attribute_id)==null?void 0:l.toString())||""),r.append(`attribute_values[${u}][string_value]`,n.string_value||""),r.append(`attribute_values[${u}][number_value]`,((d=n.number_value)==null?void 0:d.toString())||""),r.append(`attribute_values[${u}][text_value]`,n.text_value||""),typeof n.boolean_value=="boolean"?r.append(`attribute_values[${u}][boolean_value]`,n.boolean_value?"1":"0"):r.append(`attribute_values[${u}][boolean_value]`,((m=n.boolean_value)==null?void 0:m.toString())||"")}):typeof t[e]=="boolean"?r.append(e,t[e]?"1":"0"):r.append(e,((o=t[e])==null?void 0:o.toString())||"")}),a&&a.length>0&&a.forEach((e,o)=>{r.append(`new_images[${o}]`,e)});const s=await fetch(`${$}/api/products`,{method:"POST",headers:{Accept:"application/json"},body:r});if(s.ok)return{success:!0};if(s.status===422)return{success:!1,errors:(await s.json()).errors};throw new Error(`HTTP error! status: ${s.status}`)}catch(r){return console.error("Ошибка создания товара:",r),{success:!1}}},resetPage:E}}function C(){const v=p([]);return{alerts:v,showAlert:(c,i,g)=>{const h={show:!0,type:c,title:i,message:g};v.value.push(h),setTimeout(()=>{const _=v.value.indexOf(h);_>-1&&v.value.splice(_,1)},3e3)},clearAlerts:()=>{v.value=[]}}}export{z as a,C as u};
