import{b as ae,c as oe,M as ne,a as le,_ as de,S as ce}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-CyeJ9LB2.js";import{_ as ie,A as ue,a as ge,C as xe,b as he}from"./MonthPicker-AMPUhm9y.js";import{o as r,b as o,C as pe,d as e,m as S,k as P,q as D,t as c,n as z,f as j,s as O,F as N,l as E,x as J,T as ye,r as b,g as Z,e as me,y as fe,c as ee,w as R,u as f,i as be}from"./index-of6R3VY6.js";import{u as te}from"./useClickOutside-Bze14szl.js";import{_ as ke}from"./Pagination-fA_HpM-Z.js";import{D as ve}from"./DownloadIcon-BHtUEICg.js";import{S as we}from"./SearchIcon-B2k8_xDo.js";import"./useAuth-BZsEGP_C.js";const _e={},$e={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-package-check-icon lucide-package-check"};function Ie(s,k){return r(),o("svg",$e,k[0]||(k[0]=[pe('<path d="m16 16 2 2 4-4"></path><path d="M21 10V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l2-1.14"></path><path d="m7.5 4.27 9 5.15"></path><polyline points="3.29 7 12 12 20.71 7"></polyline><line x1="12" x2="12" y1="22" y2="12"></line>',5)]))}const Oe=ae(_e,[["render",Ie]]),Ce={class:"mb-6"},Se={class:"flex items-center justify-between mb-4"},je={class:"grid grid-cols-1 grid-rows-[repeat(4,1fr)] xl:grid-cols-4 xl:grid-rows-none gap-4 md:gap-4 mb-4 md:mb-4"},Pe={class:"h-full"},Qe={class:"rounded-2xl border border-warning-200 bg-white p-5 dark:border-warning-800 dark:bg-white/[0.03] md:p-6 h-full flex flex-col"},De={class:"flex items-center justify-center w-12 h-12 bg-warning-100 rounded-xl dark:bg-warning-500/15"},Te={class:"flex items-end justify-between mt-5 flex-1"},Ue={class:"mt-2 font-bold text-warning-600 text-title-sm dark:text-white/90"},Me={class:"h-full"},Be={class:"rounded-2xl border border-blue-light-200 bg-white p-5 dark:border-blue-light-800 dark:bg-white/[0.03] md:p-6 h-full flex flex-col"},Ae={class:"flex items-center justify-center w-12 h-12 bg-blue-light-100 rounded-xl dark:bg-blue-light-500/15"},Fe={class:"flex items-end justify-between mt-5 flex-1"},qe={class:"mt-2 font-bold text-blue-light-600 text-title-sm dark:text-white/90"},Re={class:"h-full"},ze={class:"rounded-2xl border border-success-200 bg-white p-5 dark:border-success-800 dark:bg-white/[0.03] md:p-6 h-full flex flex-col"},Le={class:"flex items-start justify-between"},Ve={class:"flex items-center justify-center w-12 h-12 bg-success-100 rounded-xl dark:bg-success-500/15"},Ee={class:"flex items-end justify-between mt-5 flex-1"},Ne={class:"mt-2 font-bold text-success-600 text-title-sm dark:text-white/90"},He={class:"h-full"},We={class:"rounded-2xl border border-gray-200 bg-white p-5 dark:border-gray-800 dark:bg-white/[0.03] md:p-6 h-full flex flex-col"},Ge={class:"flex items-start justify-between"},Je={class:"flex items-center justify-center w-12 h-12 bg-gray-100 rounded-xl dark:bg-gray-800"},Ke={class:"flex items-end justify-between mt-5 flex-1"},Xe={class:"mt-2 font-bold text-gray-800 text-xl dark:text-white/90"},Ye={__name:"OrdersStatistics",props:{arrowUpIcon:{type:Object,required:!0},arrowDownIcon:{type:Object,required:!0},shoppingCartIcon:{type:Object,required:!0},calendarClockIcon:{type:Object,required:!0},calendarDaysIcon:{type:Object,required:!0},packageCheckIcon:{type:Object,required:!0},statistics:{type:Object,required:!0},onMonthChange:{type:Function,required:!0}},setup(s){return(k,a)=>(r(),o("div",Ce,[e("div",Se,[a[0]||(a[0]=e("h2",{class:"text-lg font-semibold text-gray-800 dark:text-white/90"},"Статистика заказов",-1)),S(ie,{onMonthChange:s.onMonthChange},null,8,["onMonthChange"])]),e("div",je,[e("div",Pe,[e("div",Qe,[e("div",De,[(r(),P(D(s.shoppingCartIcon),{class:"text-warning-600 dark:text-warning-400"}))]),e("div",Te,[e("div",null,[a[1]||(a[1]=e("span",{class:"font-bold text-sm text-gray-500 dark:text-warning-400"}," Новые заказы ",-1)),e("h4",Ue,c(s.statistics.current.pending),1)]),a[2]||(a[2]=e("span",{class:"flex items-center gap-1 rounded-full bg-gray-50 py-0.5 pl-2 pr-2.5 text-sm font-medium text-gray-600 dark:bg-gray-500/15 dark:text-gray-500"}," Всего ",-1))])])]),e("div",Me,[e("div",Be,[e("div",Ae,[(r(),P(D(s.calendarClockIcon),{class:"text-blue-light-600 dark:text-blue-light-400"}))]),e("div",Fe,[e("div",null,[a[3]||(a[3]=e("span",{class:"font-bold text-sm text-gray-500 dark:text-blue-light-400"}," На выполнении ",-1)),e("h4",qe,c(s.statistics.current.processing),1)]),a[4]||(a[4]=e("span",{class:"flex items-center gap-1 rounded-full bg-gray-50 py-0.5 pl-2 pr-2.5 text-sm font-medium text-gray-600 dark:bg-gray-500/15 dark:text-gray-500"}," Всего ",-1))])])]),e("div",Re,[e("div",ze,[e("div",Le,[e("div",Ve,[(r(),P(D(s.packageCheckIcon),{class:"text-success-600 dark:text-success-400"}))]),a[5]||(a[5]=e("span",{class:"flex items-center gap-1 rounded-full bg-gray-50 py-0.5 pl-2 pr-2.5 text-xs font-medium text-gray-600 dark:bg-gray-500/15 dark:text-gray-500"}," за выбранный месяц ",-1))]),e("div",Ee,[e("div",null,[a[6]||(a[6]=e("span",{class:"font-bold text-sm text-gray-500 dark:text-success-400"}," Доставлено ",-1)),e("h4",Ne,c(s.statistics.current.shipped),1)]),e("span",{class:z(["flex items-center gap-1 rounded-full py-0.5 pl-2 pr-2.5 text-xs font-medium",s.statistics.percentages.shipped>0?"bg-success-50 text-success-600 dark:bg-success-500/15 dark:text-success-500":s.statistics.percentages.shipped<0?"bg-error-50 text-error-600 dark:bg-error-500/15 dark:text-error-500":"bg-gray-50 text-gray-600 dark:bg-gray-500/15 dark:text-gray-500"])},[s.statistics.percentages.shipped!==0?(r(),P(D(s.statistics.percentages.shipped>0?s.arrowUpIcon:s.arrowDownIcon),{key:0})):j("",!0),O(" "+c(Math.abs(s.statistics.percentages.shipped))+"% ",1)],2)])])]),e("div",He,[e("div",We,[e("div",Ge,[e("div",Je,[(r(),P(D(s.calendarDaysIcon),{class:"text-gray-800 dark:text-white/90"}))]),a[7]||(a[7]=e("span",{class:"flex items-center gap-1 rounded-full bg-gray-50 py-0.5 pl-2 pr-2.5 text-xs font-medium text-gray-600 dark:bg-gray-500/15 dark:text-gray-500"}," за выбранный месяц ",-1))]),e("div",Ke,[e("div",null,[a[8]||(a[8]=e("span",{class:"font-bold text-sm text-gray-500 dark:text-gray-400"}," Сумма выполненых заказов ",-1)),e("h4",Xe,c(new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB"}).format(s.statistics.current.total_amount)),1)]),e("span",{class:z(["flex items-center gap-1 rounded-full py-0.5 pl-2 pr-2.5 text-xs font-medium",s.statistics.percentages.total_amount>0?"bg-success-50 text-success-600 dark:bg-success-500/15 dark:text-success-500":s.statistics.percentages.total_amount<0?"bg-error-50 text-error-600 dark:bg-error-500/15 dark:text-error-500":"bg-gray-50 text-gray-600 dark:bg-gray-500/15 dark:text-gray-500"])},[s.statistics.percentages.total_amount!==0?(r(),P(D(s.statistics.percentages.total_amount>0?s.arrowUpIcon:s.arrowDownIcon),{key:0})):j("",!0),O(" "+c(Math.abs(s.statistics.percentages.total_amount))+"% ",1)],2)])])])])]))}},Ze={class:"flex flex-col justify-between gap-5 border-b border-gray-200 px-5 py-4 sm:flex-row sm:items-center dark:border-gray-800"},et={class:"text-base font-medium text-gray-800 dark:text-white/90 flex flex-row items-center"},tt={class:"flex flex-col md:flex-row gap-3"},st={class:"shadow-theme-xs inline-flex items-center justify-center gap-2 rounded-lg bg-white px-4 py-3 text-sm font-medium text-gray-700 ring-1 ring-gray-300 transition hover:bg-gray-50 dark:bg-gray-800 dark:text-gray-400 dark:ring-gray-700 dark:hover:bg-white/[0.03]"},rt={__name:"OrdersHeader",props:{totalItems:{type:Number,required:!0},packageIcon:{type:Object,required:!0},downloadIcon:{type:Object,required:!0}},setup(s){return(k,a)=>(r(),o("div",Ze,[e("h3",et,[(r(),P(D(s.packageIcon),{class:"menu-item-icon-active mr-2"})),O(" Список заказов ("+c(s.totalItems)+") ",1)]),e("div",tt,[e("button",st,[a[0]||(a[0]=O(" Скачать ")),(r(),P(D(s.downloadIcon)))])])]))}},at={class:"relative w-full"},ot={class:"absolute top-1/2 left-4 -translate-y-1/2 text-gray-500 dark:text-gray-400"},nt=["value"],lt={class:"relative w-full"},dt={class:"absolute top-1/2 left-4 -translate-y-1/2 text-gray-500 dark:text-gray-400"},ct=["value"],it={__name:"OrdersSearch",props:{searchQuery:String,searchQueryPhone:String,searchIcon:Object},emits:["update:searchQuery","update:searchQueryPhone"],setup(s,{emit:k}){const a=k,u=()=>{a("update:searchQuery","")},g=()=>{a("update:searchQueryPhone","")},v=w=>{let t=w.target.value.replace(/\D/g,"");t.startsWith("7")&&(t=t.substring(1)),t.length>10&&(t=t.substring(0,10));let i="+7";t.length>0&&(i+=" ("+t.substring(0,3)),t.length>=4&&(i+=") "+t.substring(3,6)),t.length>=7&&(i+="-"+t.substring(6,8)),t.length>=9&&(i+="-"+t.substring(8,10)),a("update:searchQueryPhone",i)};return(w,t)=>(r(),o(N,null,[e("div",at,[e("span",ot,[(r(),P(D(s.searchIcon)))]),t[1]||(t[1]=e("label",{for:"searchQuery"},null,-1)),e("input",{id:"searchQuery",type:"text",placeholder:"Поиск по номеру заказа, ФИО или почте клиента",value:s.searchQuery,onInput:t[0]||(t[0]=i=>a("update:searchQuery",i.target.value)),class:"dark:bg-dark-900 shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800 h-11 w-full rounded-lg border border-gray-300 bg-transparent py-2.5 pr-12 pl-11 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"},null,40,nt),s.searchQuery?(r(),o("button",{key:0,onClick:u,class:"absolute top-1/2 right-2 -translate-y-1/2 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 text-xl leading-none cursor-pointer bg-white dark:bg-gray-900 px-1 z-10"}," ✕ ")):j("",!0)]),e("div",lt,[e("span",dt,[(r(),P(D(s.searchIcon)))]),t[2]||(t[2]=e("label",{for:"searchQueryPhone"},null,-1)),e("input",{id:"searchQueryPhone",type:"tel",placeholder:"+7 (___) ___-__-__",value:s.searchQueryPhone,onInput:v,class:"dark:bg-dark-900 shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800 h-11 w-full rounded-lg border border-gray-300 bg-transparent py-2.5 pr-12 pl-11 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"},null,40,ct),s.searchQueryPhone?(r(),o("button",{key:0,onClick:g,class:"absolute top-1/2 right-2 -translate-y-1/2 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 text-xl leading-none cursor-pointer bg-white dark:bg-gray-900 px-1 z-10"}," ✕ ")):j("",!0)])],64))}},ut={key:0,class:"text-gray-400"},gt={key:1,class:"text-gray-800 dark:text-white/90"},xt={key:0,class:"absolute z-10 w-full mt-1 bg-white rounded-lg shadow-sm dark:bg-gray-900"},ht={class:"overflow-y-auto divide-y divide-gray-200 custom-scrollbar max-h-60 dark:divide-gray-800",role:"listbox"},pt=["onClick","aria-selected"],yt={class:"grow"},mt={key:0,class:"w-5 h-5 text-gray-400 dark:text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},ft={__name:"OrdersStatusSelector",props:{statuses:Array,selectedItem:Object,isOpen:Boolean},emits:["toggleDropdown","toggleItem"],setup(s,{emit:k}){const a=s,u=k,g=te(()=>{a.isOpen&&u("toggleDropdown")}),v=()=>{u("toggleDropdown")},w=i=>{u("toggleItem",i)},t=i=>i.value===null?a.selectedItem===null:a.selectedItem&&a.selectedItem.value===i.value;return(i,n)=>(r(),o("div",{class:"relative sm:min-w-[200px] sm:w-auto",ref_key:"multiSelectRef",ref:g},[e("div",{onClick:v,class:z(["dark:bg-dark-900 h-11 flex items-center w-full appearance-none rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",{"text-gray-800 dark:text-white/90":s.isOpen}])},[s.selectedItem?(r(),o("span",gt,c(s.selectedItem.label),1)):(r(),o("span",ut," Все статусы ")),(r(),o("svg",{class:z(["ml-auto",{"transform rotate-180":s.isOpen}]),width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n[0]||(n[0]=[e("path",{d:"M4.79175 7.39551L10.0001 12.6038L15.2084 7.39551",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]),2))],2),S(ye,{"enter-active-class":"transition duration-100 ease-out","enter-from-class":"transform scale-95 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-75 ease-in","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-95 opacity-0"},{default:E(()=>[s.isOpen?(r(),o("div",xt,[e("ul",ht,[(r(!0),o(N,null,J(s.statuses,x=>(r(),o("li",{key:x.id,onClick:p=>w(x),class:z(["relative flex items-center w-full px-3 py-2 border-transparent cursor-pointer first:rounded-t-lg last:rounded-b-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-800",{"bg-gray-50 dark:bg-white/[0.03]":t(x)}]),role:"option","aria-selected":t(x)},[e("span",yt,c(x.label),1),t(x)?(r(),o("svg",mt,n[1]||(n[1]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))):j("",!0)],10,pt))),128))])])):j("",!0)]),_:1})],512))}},bt={class:"border-b border-gray-200 px-5 py-4 dark:border-gray-800"},kt={class:"flex flex-col md:flex-row gap-3 sm:justify-between"},vt={class:"flex flex-col md:flex-row gap-3 w-full"},wt={__name:"OrdersFilters",props:{searchQuery:String,searchQueryPhone:String,statuses:Array,selectedItem:Object,isOpen:Boolean,showFilter:Boolean,searchIcon:Object},emits:["update:searchQuery","update:searchQueryPhone","toggleDropdown","toggleItem","update:showFilter"],setup(s,{emit:k}){const a=k;return(u,g)=>(r(),o("div",bt,[e("div",kt,[e("div",vt,[S(it,{searchQuery:s.searchQuery,searchQueryPhone:s.searchQueryPhone,searchIcon:s.searchIcon,"onUpdate:searchQuery":g[0]||(g[0]=v=>a("update:searchQuery",v)),"onUpdate:searchQueryPhone":g[1]||(g[1]=v=>a("update:searchQueryPhone",v))},null,8,["searchQuery","searchQueryPhone","searchIcon"])]),S(ft,{statuses:s.statuses,selectedItem:s.selectedItem,isOpen:s.isOpen,onToggleDropdown:g[2]||(g[2]=v=>a("toggleDropdown")),onToggleItem:g[3]||(g[3]=v=>a("toggleItem",v))},null,8,["statuses","selectedItem","isOpen"])])]))}},_t={__name:"OrderDropdown",emits:["updateStatus"],setup(s,{emit:k}){const a=b(!1),u=b(null),g=k,v=()=>{a.value=!a.value},w=()=>{a.value=!1},t=i=>{g("updateStatus",i),w()};return te(u),(i,n)=>(r(),o("div",{class:"relative",ref_key:"filterRef",ref:u,onClick:w},[e("button",{class:"bg-brand-500 shadow-theme-xs hover:bg-brand-600 inline-flex items-center justify-center gap-2 rounded-lg px-4 py-3 text-sm font-medium text-white transition",onClick:Z(v,["stop"]),type:"button"}," Сменить статус "),me(e("div",{onClick:n[5]||(n[5]=Z(()=>{},["stop"])),class:"absolute right-0 z-10 mt-2 w-35 rounded-lg border border-gray-200 bg-white p-1 shadow-lg dark:border-gray-700 dark:bg-gray-800"},[e("button",{onClick:n[0]||(n[0]=x=>t("pending")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 rounded"}," Новый "),e("button",{onClick:n[1]||(n[1]=x=>t("processing")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 rounded"}," Выполнение "),e("button",{onClick:n[2]||(n[2]=x=>t("shipped")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 rounded"}," Отправлен "),e("button",{onClick:n[3]||(n[3]=x=>t("cancelled")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 rounded"}," Отменён "),e("button",{onClick:n[4]||(n[4]=x=>t("return")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 rounded"}," Возврат ")],512),[[fe,a.value]])],512))}},q="http://test.dennistp.beget.tech";function G(){const s=b([]),k=b(!1),a=b(null),u=b(1),g=b(50),v=b(0),w=ee(()=>Math.ceil(v.value/g.value)),t=b(""),i=b(""),n=b(null),x=b([{id:"all",value:null,label:"Все статусы"},{id:"pending",value:"pending",label:"Новый"},{id:"processing",value:"processing",label:"Выполняется"},{id:"shipped",value:"shipped",label:"Отправлен"},{id:"return",value:"return",label:"Возврат"},{id:"cancelled",value:"cancelled",label:"Отменён"}]),p=b({sale:{true:!0,false:!0},published:{true:!0,false:!0}}),A=ee(()=>{const h=w.value,l=u.value,m=2,_=[],$=[];for(let T=Math.max(2,l-m);T<=Math.min(h-1,l+m);T++)_.push(T);return l-m>2?$.push(1,"..."):$.push(1),$.push(..._),l+m<h-1?$.push("...",h):h>1&&$.push(h),$}),F=new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB"}),y=async()=>{k.value=!0,a.value=null;const h=new URLSearchParams({page:u.value.toString(),per_page:g.value.toString()});t.value.trim()&&h.append("search",t.value.trim()),i.value.trim()&&h.append("phone",i.value.trim()),n.value&&n.value.value!==null&&h.append("status",n.value.value);const l=`${q}/api/orders?${h.toString()}`;try{const m=await fetch(l,{headers:{Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!m.ok)throw new Error(`HTTP error! status: ${m.status}`);const _=await m.json();s.value=_.orders.data,v.value=_.orders.total}catch(m){a.value=m.message,console.error("Ошибка загрузки заказов:",m)}finally{k.value=!1}},d=()=>{u.value>1&&(u.value--,y())},I=()=>{u.value<w.value&&(u.value++,y())},L=h=>{u.value=h,y()},V=async h=>{try{const l=await fetch(`${q}/api/orders/${h}`,{headers:{Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);return(await l.json()).order}catch(l){throw console.error("Ошибка загрузки заказа:",l),l}},H=async(h,l)=>{try{const m=new FormData;Object.keys(l).forEach($=>{var T;typeof l[$]=="boolean"?m.append($,l[$]?"1":"0"):m.append($,((T=l[$])==null?void 0:T.toString())||"")}),m.append("_method","PUT");const _=await fetch(`${q}/api/orders/${h}`,{method:"POST",headers:{Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:m});if(_.ok)return{success:!0};if(_.status===422)return{success:!1,errors:(await _.json()).errors};throw new Error(`HTTP error! status: ${_.status}`)}catch(m){return console.error("Ошибка обновления заказа:",m),{success:!1}}},M=()=>{u.value=1};let Q=null;return R(t,h=>{Q&&clearTimeout(Q),Q=setTimeout(()=>{M(),y()},500)}),R(i,h=>{Q&&clearTimeout(Q),Q=setTimeout(()=>{M(),y()},500)}),R(()=>p.value,()=>{M(),y()},{deep:!0}),R(n,()=>{M(),y()}),{orders:s,loading:k,error:a,page:u,itemsPerPage:g,totalItems:v,totalPages:w,searchQuery:t,searchQueryPhone:i,selectedStatus:n,statuses:x,filters:p,visiblePages:A,formatter:F,fetchOrders:y,fetchOrderStatistics:async h=>{try{const l=new URLSearchParams;h&&l.append("month",h);const m=`${q}/api/orders/statistics${l.toString()?"?"+l.toString():""}`,_=await fetch(m,{headers:{Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!_.ok)throw new Error(`HTTP error! status: ${_.status}`);return(await _.json()).statistics}catch(l){throw console.error("Ошибка загрузки статистики заказов:",l),l}},fetchOrderById:async h=>{try{const l=await fetch(`${q}/api/orders/${h}`,{headers:{Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);return{success:!0,data:(await l.json()).order}}catch(l){return console.error("Ошибка загрузки заказа:",l),{success:!1,errors:l.message}}},handlePrevPage:d,handleNextPage:I,handleGoToPage:L,getOrder:V,updateOrder:H,resetPage:M}}const $t={class:"relative bg-white dark:bg-gray-800 rounded-xl shadow-lg max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto custom-scrollbar"},It={class:"p-6"},Ot={class:"flex justify-between items-center mb-4"},Ct={class:"text-lg font-semibold text-gray-900 dark:text-white"},St={key:0,class:"flex items-center space-x-4"},jt={key:0,class:"px-2.5 py-0.5 rounded-full font-bold text-md bg-warning-50 text-warning-600 dark:bg-warning-500/15 dark:text-orange-400"},Pt={key:1,class:"px-2.5 py-0.5 rounded-full font-bold text-md bg-blue-light-50 text-blue-light-500 dark:bg-blue-light-500/15 dark:text-blue-light-500"},Qt={key:2,class:"px-2.5 py-0.5 rounded-full font-bold text-md bg-success-50 text-success-600 dark:bg-success-500/15 dark:text-success-500"},Dt={key:3,class:"px-2.5 py-0.5 rounded-full font-bold text-md bg-error-50 text-error-600 dark:bg-error-500/15 dark:text-error-500"},Tt={key:4,class:"px-2.5 py-0.5 rounded-full font-bold text-md bg-gray-100 text-gray-700 dark:bg-white/5 dark:text-white/80"},Ut={key:0,class:"flex justify-center items-center h-64"},Mt={key:1,class:"text-center text-red-500"},Bt={key:2,class:"space-y-6"},At={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Ft={class:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg"},qt={class:"text-sm text-gray-600 dark:text-gray-400"},Rt={class:"font-medium"},zt={class:"text-sm text-gray-600 dark:text-gray-400"},Lt={class:"font-medium"},Vt={class:"text-sm text-gray-600 dark:text-gray-400"},Et={key:0,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-warning-50 text-warning-600 dark:bg-warning-500/15 dark:text-orange-400"},Nt={key:1,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-blue-light-50 text-blue-light-500 dark:bg-blue-light-500/15 dark:text-blue-light-500"},Ht={key:2,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-success-50 text-success-600 dark:bg-success-500/15 dark:text-success-500"},Wt={key:3,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-error-50 text-error-600 dark:bg-error-500/15 dark:text-error-500"},Gt={key:4,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-gray-100 text-gray-700 dark:bg-white/5 dark:text-white/80"},Jt={class:"text-sm text-gray-600 dark:text-gray-400"},Kt={class:"font-medium text-error-600 dark:text-error-400"},Xt={class:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg"},Yt={class:"text-sm text-gray-600 dark:text-gray-400"},Zt={class:"font-medium"},es={class:"text-sm text-gray-600 dark:text-gray-400"},ts={class:"font-medium"},ss={class:"text-sm text-gray-600 dark:text-gray-400"},rs={class:"font-medium"},as={class:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg"},os={class:"space-y-4"},ns={class:"flex items-center space-x-4"},ls={class:"font-medium text-gray-900 dark:text-white"},ds={class:"font-medium text-gray-900 dark:text-white"},cs={class:"text-sm text-gray-600 dark:text-gray-400"},is={key:0},us={key:1},gs={class:"text-right"},xs={class:"font-medium text-gray-900 dark:text-white"},hs={class:"text-sm text-gray-600 dark:text-gray-400"},ps={key:0,class:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg"},ys={class:"space-y-4"},ms={class:"text-sm text-gray-600 dark:text-gray-400"},fs={class:"flex justify-end gap-3 pt-4"},bs={__name:"OrderModal",props:{isVisible:{type:Boolean,default:!1},orderId:{type:String,default:""}},emits:["close","updateStatus","statusUpdated"],setup(s,{emit:k}){const a=s,u=k,{formatter:g,fetchOrderById:v,updateOrder:w}=G(),t=b(null),i=b(!1),n=b(null),x=y=>new Date(y).toLocaleString("ru-RU"),p=()=>{u("close"),t.value=null,n.value=null},A=async y=>{if(!t.value)return;const d=await w(t.value.id,{status:y});d.success?(t.value.status=y,u("statusUpdated",t.value.id,y)):console.error("Ошибка обновления статуса:",d.errors)},F=async()=>{if(a.orderId)try{i.value=!0;const y=await v(a.orderId);y.success?t.value=y.data:n.value=y.errors||"Ошибка загрузки заказа"}catch(y){n.value="Ошибка загрузки заказа",console.error(y)}finally{i.value=!1}};return R(()=>a.isVisible,async y=>{y&&a.orderId?await F():(t.value=null,n.value=null)}),(y,d)=>s.isVisible?(r(),P(ne,{key:0,onClose:p},{body:E(()=>[e("div",$t,[e("div",It,[e("div",Ot,[e("h3",Ct," Детали заказа #"+c(t.value?t.value.order:""),1),t.value?(r(),o("div",St,[t.value.status==="pending"?(r(),o("span",jt," Новый ")):t.value.status==="processing"?(r(),o("span",Pt," Выполнение ")):t.value.status==="shipped"?(r(),o("span",Qt," Отправлен ")):t.value.status==="return"?(r(),o("span",Dt," Возврат ")):t.value.status==="cancelled"?(r(),o("span",Tt," Отменён ")):j("",!0),S(_t,{onUpdateStatus:A})])):j("",!0)]),i.value?(r(),o("div",Ut,d[0]||(d[0]=[e("div",{class:"animate-spin rounded-full h-16 w-16 border-b-2 border-brand-500"},null,-1)]))):n.value?(r(),o("div",Mt," Ошибка загрузки заказа: "+c(n.value),1)):t.value?(r(),o("div",Bt,[e("div",At,[e("div",Ft,[d[5]||(d[5]=e("h3",{class:"font-medium text-gray-900 dark:text-white mb-2"},"Информация о заказе",-1)),e("p",qt,[d[1]||(d[1]=O("Номер заказа: ")),e("span",Rt,c(t.value.order),1)]),e("p",zt,[d[2]||(d[2]=O("Дата создания: ")),e("span",Lt,c(x(t.value.created_at)),1)]),e("p",Vt,[d[3]||(d[3]=O("Статус: ")),t.value.status==="pending"?(r(),o("span",Et,"Новый")):t.value.status==="processing"?(r(),o("span",Nt,"Выполнение")):t.value.status==="shipped"?(r(),o("span",Ht,"Отправлен")):t.value.status==="return"?(r(),o("span",Wt,"Возврат")):t.value.status==="cancelled"?(r(),o("span",Gt,"Отменён")):j("",!0)]),e("p",Jt,[d[4]||(d[4]=O("Общая сумма: ")),e("span",Kt,c(f(g).format(t.value.total_amount)),1)])]),e("div",Xt,[d[9]||(d[9]=e("h3",{class:"font-medium text-gray-900 dark:text-white mb-2"},"Информация о клиенте",-1)),e("p",Yt,[d[6]||(d[6]=O("Имя: ")),e("span",Zt,c(t.value.name),1)]),e("p",es,[d[7]||(d[7]=O("Email: ")),e("span",ts,c(t.value.email),1)]),e("p",ss,[d[8]||(d[8]=O("Телефон: ")),e("span",rs,c(t.value.phone),1)])])]),e("div",as,[d[10]||(d[10]=e("h3",{class:"font-medium text-gray-900 dark:text-white mb-4"},"Товары в заказе",-1)),e("div",os,[(r(!0),o(N,null,J(t.value.items,I=>(r(),o("div",{key:I.id,class:"flex items-center justify-between border-t border-gray-200 dark:border-gray-700 pt-4"},[e("div",ns,[e("p",ls,c(I.product.article),1),e("div",null,[e("p",ds,c(I.product.name),1),e("p",cs,[O("Количество: "+c(I.quantity)+" ",1),I.product_unit==="кв.м"?(r(),o("span",is,"м²")):(r(),o("span",us,c(I.product_unit),1))])])]),e("div",gs,[e("p",xs,c(f(g).format(I.price)),1),e("p",hs,"Итого: "+c(f(g).format(I.price*I.quantity)),1)])]))),128))])]),t.value.comment?(r(),o("div",ps,[d[11]||(d[11]=e("h3",{class:"font-medium text-gray-900 dark:text-white mb-4"},"Комментарий к заказу",-1)),e("div",ys,[e("p",ms,c(t.value.comment),1)])])):j("",!0)])):j("",!0),e("div",fs,[S(oe,{variant:"outline",onClick:p},{default:E(()=>d[12]||(d[12]=[O("Закрыть")])),_:1})])])])]),_:1})):j("",!0)}},ks={class:"p-4 border-t border-gray-100 dark:border-gray-800 sm:p-6"},vs={class:"space-y-5"},ws={class:"overflow-hidden rounded-xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]"},_s={class:"max-w-full overflow-x-auto custom-scrollbar"},$s={key:0,class:"flex justify-center items-center h-screen"},Is={key:1,class:"flex flex-col justify-center items-center h-screen font-bold text-error-700 text-theme-xl dark:text-error-500"},Os={key:2,class:"flex flex-col justify-center items-center h-screen menu-item-icon-active text-center font-bold text-theme-xl m-5"},Cs={key:3,class:"min-w-full"},Ss={class:"divide-y divide-gray-200 dark:divide-gray-700"},js={class:"px-5 py-4 sm:px-6"},Ps=["onClick"],Qs={class:"px-5 py-4 sm:px-6"},Ds={class:"text-gray-500 text-left text-theme-sm dark:text-gray-400"},Ts={class:"text-gray-500 text-left text-theme-sm dark:text-gray-400"},Us={class:"px-5 py-4 sm:px-6"},Ms={"data-v-67f048e0":"",class:"block font-medium text-gray-800 text-theme-sm dark:text-white/90"},Bs={"data-v-67f048e0":"",class:"block text-gray-500 text-theme-xs dark:text-gray-400"},As={class:"px-5 py-4 sm:px-6"},Fs={class:"text-gray-500 text-left text-theme-sm dark:text-gray-400"},qs={class:"px-5 py-4 sm:px-6"},Rs={class:"text-gray-500 text-left text-theme-sm dark:text-gray-400"},zs={class:"px-5 py-4 sm:px-6"},Ls={class:"font-medium text-left text-gray-800 text-theme-sm dark:text-white/90"},Vs={class:"px-5 py-4 sm:px-6 text-center"},Es={key:0,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-warning-50 text-warning-600 dark:bg-warning-500/15 dark:text-orange-400"},Ns={key:1,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-blue-light-50 text-blue-light-500 dark:bg-blue-light-500/15 dark:text-blue-light-500"},Hs={key:2,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-success-50 text-success-600 dark:bg-success-500/15 dark:text-success-500"},Ws={key:3,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-error-50 text-error-600 dark:bg-error-500/15 dark:text-error-500"},Gs={key:4,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-gray-100 text-gray-700 dark:bg-white/5 dark:text-white/80"},Js={__name:"OrdersTable",props:{loading:Boolean,error:String,orders:Array,formatter:Object},emits:["fetchOrders","edit","updateStatus"],setup(s,{emit:k}){const a=k,u=b(!1),g=b(""),v=()=>{a("fetchOrders")},w=n=>{g.value=n,u.value=!0},t=()=>{u.value=!1,g.value=""},i=(n,x)=>{a("updateStatus",{id:n},x)};return(n,x)=>(r(),o("div",ks,[e("div",vs,[e("div",ws,[e("div",_s,[s.loading?(r(),o("div",$s,x[0]||(x[0]=[e("div",{class:"animate-spin rounded-full h-16 w-16 border-b-2 border-brand-500"},null,-1)]))):s.error?(r(),o("div",Is,[x[1]||(x[1]=O(" Ошибка при загрузке")),x[2]||(x[2]=e("br",null,null,-1)),e("button",{class:"inline-flex items-center justify-center font-medium gap-2 rounded-lg transition px-4 py-3 text-sm bg-brand-500 text-white shadow-theme-xs hover:bg-brand-600 disabled:bg-brand-300 mt-2",onClick:v}," Попробовать снова ")])):s.orders.length===0?(r(),o("div",Os," Заказы не найдены ")):(r(),o("table",Cs,[x[3]||(x[3]=e("thead",null,[e("tr",{class:"border-gray-100 border-y bg-gray-50 dark:border-gray-800 dark:bg-gray-900"},[e("th",{class:"cursor-pointer px-5 py-3 text-left w-2/12 sm:px-6"},[e("div",{class:"flex items-center gap-3"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"№ Заказа")])]),e("th",{class:"cursor-pointer px-5 py-3 text-left w-1/12 sm:px-6"},[e("div",{class:"flex items-left gap-3"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Дата")])]),e("th",{class:"px-5 py-3 text-left w-3/12 sm:px-6"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Клиент")]),e("th",{class:"px-5 py-3 text-left w-2/12 sm:px-6"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Телефон")]),e("th",{class:"px-5 py-3 text-left w-1/12 sm:px-6"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Товары")]),e("th",{class:"px-5 py-3 text-left w-1/12 sm:px-6"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Сумма")]),e("th",{class:"px-5 py-3 text-center w-2/12 sm:px-6"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Статус заказа")])])],-1)),e("tbody",Ss,[(r(!0),o(N,null,J(s.orders,p=>(r(),o("tr",{key:p.id,class:"border-t border-gray-100 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800"},[e("td",js,[e("button",{onClick:A=>w(p.order),class:"font-medium text-left text-gray-800 text-theme-sm dark:text-white/90 hover:text-brand-500 dark:hover:text-brand-400"},c(p.order),9,Ps)]),e("td",Qs,[e("p",Ds,c(new Date(p.created_at).toLocaleDateString("ru-RU")),1),e("p",Ts,c(new Date(p.created_at).toLocaleTimeString("ru-RU")),1)]),e("td",Us,[e("span",Ms,c(p.name),1),e("span",Bs,c(p.email),1)]),e("td",As,[e("p",Fs,c(p.phone),1)]),e("td",qs,[e("p",Rs,c(p.items?p.items.length:0)+" товаров ",1)]),e("td",zs,[e("p",Ls,c(s.formatter.format(p.total_amount)),1)]),e("td",Vs,[p.status==="pending"?(r(),o("span",Es," Новый ")):p.status==="processing"?(r(),o("span",Ns," Выполнение ")):p.status==="shipped"?(r(),o("span",Hs," Отправлен ")):p.status==="return"?(r(),o("span",Ws," Возврат ")):p.status==="cancelled"?(r(),o("span",Gs," Отменён ")):j("",!0)])]))),128))])]))])])]),S(bs,{"is-visible":u.value,"order-id":g.value,onClose:t,onStatusUpdated:i},null,8,["is-visible","order-id"])]))}},Ks={class:"space-y-5 sm:space-y-6"},Xs={class:"rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]"},nr={__name:"Orders",setup(s){const k=b("Заказы"),a=ue,u=ge,g=xe,v=he,w=Oe,t=ce,i=ve,n=we,{orders:x,loading:p,error:A,page:F,totalItems:y,totalPages:d,searchQuery:I,searchQueryPhone:L,selectedStatus:V,statuses:H,formatter:M,fetchOrders:Q,fetchOrderStatistics:K}=G(),X=b(!1),h=b(!1),l=b(""),m=b({current:{pending:0,processing:0,shipped:0,total_amount:0},previous:{pending:0,processing:0,shipped:0,total_amount:0},percentages:{pending:0,processing:0,shipped:0,total_amount:0}}),_=()=>{h.value=!h.value},$=C=>{V.value=C.value===null?null:C,h.value=!1},T=C=>{F.value=C,Q()},se=async(C,U)=>{const{updateOrder:B}=G(),Y=await B(C.id,{status:U});Y.success?(Q(),W()):console.error("Ошибка обновления статуса:",Y.errors)},re=C=>{l.value=C,W()},W=async()=>{try{const C=await K(l.value);m.value=C}catch(C){console.error("Ошибка загрузки статистики:",C)}};return be(()=>{Q(),W()}),(C,U)=>(r(),P(le,null,{default:E(()=>[S(de,{pageTitle:k.value},null,8,["pageTitle"]),e("div",Ks,[S(Ye,{arrowDownIcon:f(a),arrowUpIcon:f(u),shoppingCartIcon:f(t),calendarClockIcon:f(g),calendarDaysIcon:f(v),packageCheckIcon:f(w),statistics:m.value,onMonthChange:re},null,8,["arrowDownIcon","arrowUpIcon","shoppingCartIcon","calendarClockIcon","calendarDaysIcon","packageCheckIcon","statistics"]),e("div",Xs,[S(rt,{totalItems:f(y),packageIcon:f(t),downloadIcon:f(i)},null,8,["totalItems","packageIcon","downloadIcon"]),S(wt,{searchQuery:f(I),searchQueryPhone:f(L),statuses:f(H),selectedItem:f(V),isOpen:h.value,searchIcon:f(n),"onUpdate:searchQuery":U[0]||(U[0]=B=>I.value=B),"onUpdate:searchQueryPhone":U[1]||(U[1]=B=>L.value=B),onToggleDropdown:_,onToggleItem:$,"onUpdate:showFilter":U[2]||(U[2]=B=>X.value=B)},null,8,["searchQuery","searchQueryPhone","statuses","selectedItem","isOpen","searchIcon"]),S(Js,{loading:f(p),error:f(A),orders:f(x),formatter:f(M),onFetchOrders:f(Q),onUpdateStatus:se},null,8,["loading","error","orders","formatter","onFetchOrders"]),S(ke,{currentPage:f(F),totalPages:f(d),onPageChange:T,class:"px-6"},null,8,["currentPage","totalPages"])])])]),_:1}))}};export{nr as default};
