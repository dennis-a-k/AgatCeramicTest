import{r as v,a as S,w as T,c as l,b as o,n as j,d as h,v as y,e as w,u as p,t as f,F as C,f as E,g as L,o as d,h as $}from"./index-N1E6rwhZ.js";const m="http://test.dennistp.beget.tech";function A(){const i=v(!1),r=v([]),g=async()=>{try{await fetch(`${m}/sanctum/csrf-cookie`,{method:"GET",credentials:"include"})}catch(e){throw console.error("CSRF token fetch error:",e),e}};return{loading:i,error:r,register:async e=>{i.value=!0,r.value=[];try{await g();const a=await fetch(`${m}/api/register`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify(e)});if(!a.ok){const u=await a.json();throw u.errors?r.value=Object.values(u.errors).flat():r.value=[u.message||"Registration failed"],new Error(u.message||"Registration failed")}return await a.json()}catch(a){throw r.value.length===0&&(r.value=[a.message]),a}finally{i.value=!1}},login:async e=>{i.value=!0,r.value=[];try{await g();const a=await fetch(`${m}/api/login`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify(e)});if(!a.ok){const b=await a.json();throw b.errors?r.value=Object.values(b.errors).flat():r.value=[b.message||"Login failed"],new Error(b.message||"Login failed")}const u=await a.json();return localStorage.setItem("auth_token",u.token),u}catch(a){throw r.value.length===0&&(r.value=[a.message]),a}finally{i.value=!1}},logout:async()=>{i.value=!0,r.value=[];try{await g();const e=await fetch(`${m}/api/logout`,{method:"POST",headers:{Accept:"application/json"},credentials:"include"});if(!e.ok)throw new Error("Logout failed");return await e.json()}catch(e){throw r.value.length===0&&(r.value=[e.message]),e}finally{i.value=!1}},getUser:async()=>{i.value=!0,r.value=[];try{await g();const e=await fetch(`${m}/api/user`,{method:"GET",headers:{Accept:"application/json"},credentials:"include"});if(!e.ok)throw new Error("Failed to fetch user");return await e.json()}catch(e){throw r.value=[e.message],e}finally{i.value=!1}}}}const O={class:"max-w-md mx-auto mt-8 p-4 bg-white rounded-lg shadow-md"},U={class:"flex justify-center mb-6"},R={key:0,class:"mb-4"},V={class:"mb-4"},F={class:"mb-4"},q={key:1,class:"mb-6"},B=["disabled"],D={key:0},N={key:1},P={key:2,class:"mt-4 text-red-500 text-sm text-center"},M={key:0,class:"list-none list-inside"},G={key:1},I={key:3,class:"mt-4 p-3 text-green-500 text-center"},z={__name:"LoginForm",setup(i){const r=$(),{login:g,register:_,loading:x,error:c}=A(),n=v(!0),e=S({name:"",email:"",password:"",password_confirmation:"",remember:!1});T(n,()=>{e.name="",e.email="",e.password="",e.password_confirmation="",c.value=""});const a=v(""),u=async()=>{try{await _(e),e.name="",e.email="",e.password="",e.password_confirmation="",n.value=!0,a.value="Регистрация прошла успешно! Теперь вы можете войти в систему.",setTimeout(()=>{a.value=""},5e3)}catch{}},b=async()=>{try{await g(e)&&r.push("/")}catch{}};return(k,t)=>(d(),l("div",O,[o("div",U,[o("button",{onClick:t[0]||(t[0]=s=>n.value=!0),class:j(["px-4 py-2 font-medium",n.value?"text-brand-500 border-b-2 border-brand-500":"text-gray-500 hover:text-gray-700"])}," Вход ",2),o("button",{onClick:t[1]||(t[1]=s=>n.value=!1),class:j(["px-4 py-2 font-medium",n.value?"text-gray-500 hover:text-gray-700":"text-brand-500 border-b-2 border-brand-500"])}," Регистрация ",2)]),o("form",{onSubmit:t[6]||(t[6]=L(s=>n.value?b():u(),["prevent"]))},[n.value?w("",!0):(d(),l("div",R,[t[7]||(t[7]=o("label",{class:"block text-gray-700 text-sm font-bold mb-2",for:"name"}," ФИО ",-1)),h(o("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>e.name=s),id:"name",type:"text",class:"dark:bg-dark-900 shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 appearance-none",required:""},null,512),[[y,e.name]])])),o("div",V,[t[8]||(t[8]=o("label",{class:"block text-gray-700 text-sm font-bold mb-2",for:"email"}," Почта ",-1)),h(o("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>e.email=s),id:"email",type:"email",class:"dark:bg-dark-900 shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 appearance-none",required:""},null,512),[[y,e.email]])]),o("div",F,[t[9]||(t[9]=o("label",{class:"block text-gray-700 text-sm font-bold mb-2",for:"password"}," Пароль ",-1)),h(o("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>e.password=s),id:"password",type:"password",class:"dark:bg-dark-900 shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 appearance-none",required:""},null,512),[[y,e.password]])]),n.value?w("",!0):(d(),l("div",q,[t[10]||(t[10]=o("label",{class:"block text-gray-700 text-sm font-bold mb-2",for:"password_confirmation"}," Повторить пароль ",-1)),h(o("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>e.password_confirmation=s),id:"password_confirmation",type:"password",class:"dark:bg-dark-900 shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 appearance-none",required:""},null,512),[[y,e.password_confirmation]])])),o("button",{type:"submit",class:"w-full bg-brand-500 text-white py-2 px-4 rounded-lg hover:bg-brand-600 transition duration-200",disabled:p(x)},[p(x)?(d(),l("span",N,f(n.value?"Авторизация...":"Регистрация..."),1)):(d(),l("span",D,f(n.value?"Войти":"Зарегистрироваться"),1))],8,B),p(c)&&p(c).length>0?(d(),l("div",P,[p(c).length>1?(d(),l("ul",M,[(d(!0),l(C,null,E(p(c),s=>(d(),l("li",{key:s},f(s),1))),128))])):(d(),l("span",G,f(p(c)[0]),1))])):w("",!0),a.value?(d(),l("div",I,f(a.value),1)):w("",!0)],32)]))}};export{z as default};
