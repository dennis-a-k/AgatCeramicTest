import{r as g,o as r,d as a,e as t,j as v,k as O,v as S,l as j,c as B,w as D,m as F,a as h,t as d,h as b,g as u,u as f,F as N,i as R}from"./index-LY41SGDx.js";import{a as T,_ as V}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-hzpnDemg.js";import{u as U}from"./useClickOutside-CTEMaHQH.js";import{u as q}from"./useOrders-BrcpuZhA.js";const E={__name:"OrderDropdown",emits:["updateStatus"],setup(w,{emit:k}){const i=g(!1),y=g(null),p=k,_=()=>{i.value=!i.value},m=()=>{i.value=!1},e=c=>{p("updateStatus",c),m()};return U(y),(c,o)=>(r(),a("div",{class:"relative",ref_key:"filterRef",ref:y,onClick:m},[t("button",{class:"bg-brand-500 shadow-theme-xs hover:bg-brand-600 inline-flex items-center justify-center gap-2 rounded-lg px-4 py-3 text-sm font-medium text-white transition",onClick:v(_,["stop"]),type:"button"}," Сменить статус "),O(t("div",{onClick:o[5]||(o[5]=v(()=>{},["stop"])),class:"absolute right-0 z-10 mt-2 w-35 rounded-lg border border-gray-200 bg-white p-1 shadow-lg dark:border-gray-700 dark:bg-gray-800"},[t("button",{onClick:o[0]||(o[0]=x=>e("pending")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 rounded"}," Новый "),t("button",{onClick:o[1]||(o[1]=x=>e("processing")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 rounded"}," Выполнение "),t("button",{onClick:o[2]||(o[2]=x=>e("shipped")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 rounded"}," Отправлен "),t("button",{onClick:o[3]||(o[3]=x=>e("cancelled")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 rounded"}," Отменён "),t("button",{onClick:o[4]||(o[4]=x=>e("return")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 rounded"}," Возврат ")],512),[[S,i.value]])],512))}},I={class:"space-y-5 sm:space-y-6"},L={class:"rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]"},M={class:"p-6"},z={class:"flex justify-between items-center mb-4"},P={class:"text-xl font-semibold text-gray-900 dark:text-white"},A={class:"flex items-center space-x-4"},G={key:0,class:"px-2.5 py-0.5 rounded-full font-bold text-md bg-warning-50 text-warning-600 dark:bg-warning-500/15 dark:text-orange-400"},H={key:1,class:"px-2.5 py-0.5 rounded-full font-bold text-md bg-blue-light-50 text-blue-light-500 dark:bg-blue-light-500/15 dark:text-blue-light-500"},J={key:2,class:"px-2.5 py-0.5 rounded-full font-bold text-md bg-success-50 text-success-600 dark:bg-success-500/15 dark:text-success-500"},K={key:3,class:"px-2.5 py-0.5 rounded-full font-bold text-md bg-error-50 text-error-600 dark:bg-error-500/15 dark:text-error-500"},Q={key:4,class:"px-2.5 py-0.5 rounded-full font-bold text-md bg-gray-100 text-gray-700 dark:bg-white/5 dark:text-white/80"},W={key:0,class:"flex justify-center items-center h-64"},X={key:1,class:"text-center text-red-500"},Y={key:2,class:"space-y-6"},Z={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},tt={class:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg"},et={class:"text-sm text-gray-600 dark:text-gray-400"},st={class:"font-medium"},rt={class:"text-sm text-gray-600 dark:text-gray-400"},at={class:"font-medium"},ot={class:"text-sm text-gray-600 dark:text-gray-400"},dt={key:0,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-warning-50 text-warning-600 dark:bg-warning-500/15 dark:text-orange-400"},nt={key:1,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-blue-light-50 text-blue-light-500 dark:bg-blue-light-500/15 dark:text-blue-light-500"},lt={key:2,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-success-50 text-success-600 dark:bg-success-500/15 dark:text-success-500"},it={key:3,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-error-50 text-error-600 dark:bg-error-500/15 dark:text-error-500"},ut={key:4,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-gray-100 text-gray-700 dark:bg-white/5 dark:text-white/80"},gt={class:"text-sm text-gray-600 dark:text-gray-400"},ct={class:"font-medium text-error-600 dark:text-error-400"},xt={class:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg"},pt={class:"text-sm text-gray-600 dark:text-gray-400"},yt={class:"font-medium"},mt={class:"text-sm text-gray-600 dark:text-gray-400"},bt={class:"font-medium"},kt={class:"text-sm text-gray-600 dark:text-gray-400"},_t={class:"font-medium"},ft={class:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg"},vt={class:"space-y-4"},ht={class:"flex items-center space-x-4"},wt={class:"font-medium text-gray-900 dark:text-white"},Ct={class:"font-medium text-gray-900 dark:text-white"},$t={class:"text-sm text-gray-600 dark:text-gray-400"},Ot={key:0},St={key:1},jt={class:"text-right"},Bt={class:"font-medium text-gray-900 dark:text-white"},Dt={class:"text-sm text-gray-600 dark:text-gray-400"},Ft={key:0,class:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg"},Nt={class:"space-y-4"},Rt={class:"text-sm text-gray-600 dark:text-gray-400"},Et={__name:"Order",setup(w){const k=F(),i=g(k.params.id),y=g(`Заказ #${i.value}`),{formatter:p,fetchOrderById:_,updateOrder:m}=q(),e=g(null),c=g(!0),o=g(null),x=n=>new Date(n).toLocaleString("ru-RU"),C=async n=>{if(!e.value)return;const s=await m(e.value.id,{status:n});s.success?e.value.status=n:console.error("Ошибка обновления статуса:",s.errors)},$=async()=>{try{c.value=!0;const n=await _(i.value);n.success?e.value=n.data:o.value=n.errors||"Ошибка загрузки заказа"}catch(n){o.value="Ошибка загрузки заказа",console.error(n)}finally{c.value=!1}};return j(()=>{$()}),(n,s)=>(r(),B(T,null,{default:D(()=>[h(V,{pageTitle:y.value},null,8,["pageTitle"]),t("div",I,[t("div",L,[t("div",M,[t("div",z,[t("h2",P,"Детали заказа #"+d(i.value),1),t("div",A,[e.value.status==="pending"?(r(),a("span",G," Новый ")):e.value.status==="processing"?(r(),a("span",H," Выполнение ")):e.value.status==="shipped"?(r(),a("span",J," Отправлен ")):e.value.status==="return"?(r(),a("span",K," Возврат ")):e.value.status==="cancelled"?(r(),a("span",Q," Отменён ")):b("",!0),h(E,{onUpdateStatus:C})])]),c.value?(r(),a("div",W,s[0]||(s[0]=[t("div",{class:"animate-spin rounded-full h-16 w-16 border-b-2 border-brand-500"},null,-1)]))):o.value?(r(),a("div",X," Ошибка загрузки заказа: "+d(o.value),1)):e.value?(r(),a("div",Y,[t("div",Z,[t("div",tt,[s[5]||(s[5]=t("h3",{class:"font-medium text-gray-900 dark:text-white mb-2"},"Информация о заказе",-1)),t("p",et,[s[1]||(s[1]=u("Номер заказа: ")),t("span",st,d(e.value.order),1)]),t("p",rt,[s[2]||(s[2]=u("Дата создания: ")),t("span",at,d(x(e.value.created_at)),1)]),t("p",ot,[s[3]||(s[3]=u("Статус: ")),e.value.status==="pending"?(r(),a("span",dt," Новый ")):e.value.status==="processing"?(r(),a("span",nt," Выполнение ")):e.value.status==="shipped"?(r(),a("span",lt," Отправлен ")):e.value.status==="return"?(r(),a("span",it," Возврат ")):e.value.status==="cancelled"?(r(),a("span",ut," Отменён ")):b("",!0)]),t("p",gt,[s[4]||(s[4]=u("Общая сумма: ")),t("span",ct,d(f(p).format(e.value.total_amount)),1)])]),t("div",xt,[s[9]||(s[9]=t("h3",{class:"font-medium text-gray-900 dark:text-white mb-2"},"Информация о клиенте",-1)),t("p",pt,[s[6]||(s[6]=u("Имя: ")),t("span",yt,d(e.value.name),1)]),t("p",mt,[s[7]||(s[7]=u("Email: ")),t("span",bt,d(e.value.email),1)]),t("p",kt,[s[8]||(s[8]=u("Телефон: ")),t("span",_t,d(e.value.phone),1)])])]),t("div",ft,[s[10]||(s[10]=t("h3",{class:"font-medium text-gray-900 dark:text-white mb-4"},"Товары в заказе",-1)),t("div",vt,[(r(!0),a(N,null,R(e.value.items,l=>(r(),a("div",{key:l.id,class:"flex items-center justify-between border-b border-gray-200 dark:border-gray-700 pb-4"},[t("div",ht,[t("p",wt,d(l.product.article),1),t("div",null,[t("p",Ct,d(l.product.name),1),t("p",$t,[u(" Количество: "+d(l.quantity)+" ",1),l.product_unit==="кв.м"?(r(),a("span",Ot,"м²")):(r(),a("span",St,d(l.product_unit),1))])])]),t("div",jt,[t("p",Bt,d(f(p).format(l.price)),1),t("p",Dt,"Итого: "+d(f(p).format(l.price*l.quantity)),1)])]))),128))])]),e.value.comment?(r(),a("div",Ft,[s[11]||(s[11]=t("h3",{class:"font-medium text-gray-900 dark:text-white mb-4"},"Комментарий к заказу",-1)),t("div",Nt,[t("p",Rt,d(e.value.comment),1)])])):b("",!0)])):b("",!0)])])])]),_:1}))}};export{Et as default};
