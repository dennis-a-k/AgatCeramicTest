import{o as a,b as l,d as e,m as j,k as O,q as A,t as b,n as N,l as V,F as Y,x as ee,f as M,T as ge,s as te,r as m,g as W,e as xe,y as he,w as L,h as se,j as ae,c as Z,i as pe,J as K,u as y}from"./index-Da9oFczG.js";import{b as Q,M as me,a as be,_ as fe,d as ye,e as we}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-CPN4HxST.js";import{_ as ke,A as ve,a as _e,C as $e,b as Ie}from"./MonthPicker-LbfS1eYj.js";import{u as re}from"./useClickOutside-B2f9EqMk.js";import{_ as Ce}from"./Pagination-CcDCE8ZT.js";import"./useAuth-zFXYoVBM.js";const Se={},je={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-circle-check-big-icon lucide-circle-check-big"};function Be(t,i){return a(),l("svg",je,i[0]||(i[0]=[e("path",{d:"M21.801 10A10 10 0 1 1 17 3.335"},null,-1),e("path",{d:"m9 11 3 3L22 4"},null,-1)]))}const Me=Q(Se,[["render",Be]]),Te={},De={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-swatch-book-icon lucide-swatch-book"};function Oe(t,i){return a(),l("svg",De,i[0]||(i[0]=[e("path",{d:"M11 17a4 4 0 0 1-8 0V5a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2Z"},null,-1),e("path",{d:"M16.7 13H19a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H7"},null,-1),e("path",{d:"M 7 17h.01"},null,-1),e("path",{d:"m11 8 2.3-2.3a2.4 2.4 0 0 1 3.404.004L18.6 7.6a2.4 2.4 0 0 1 .026 3.434L9.9 19.8"},null,-1)]))}const Pe=Q(Te,[["render",Oe]]),qe={},Re={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-users-round-icon lucide-users-round"};function Ue(t,i){return a(),l("svg",Re,i[0]||(i[0]=[e("path",{d:"M18 21a8 8 0 0 0-16 0"},null,-1),e("circle",{cx:"10",cy:"8",r:"5"},null,-1),e("path",{d:"M22 20c0-3.37-2-6.5-4-8a5 5 0 0 0-.45-8.3"},null,-1)]))}const Ae=Q(qe,[["render",Ue]]),Le={class:"mb-6"},Fe={class:"flex items-center justify-between mb-4"},Ee={class:"grid grid-cols-1 grid-rows-[repeat(4,1fr)] xl:grid-cols-4 xl:grid-rows-none gap-4 md:gap-4"},ze={class:"h-full"},He={class:"flex items-center gap-5 rounded-2xl border border-warning-200 bg-warning-100 p-5 dark:border-warning-800 dark:bg-white/[0.03] md:p-6 h-full"},Ne={class:"inline-flex h-16 w-16 items-center justify-center rounded-xl bg-warning-200 dark:bg-warning-500/15"},Ve={class:"text-2xl font-semibold text-warning-600 dark:text-white/90"},Qe={class:"h-full"},Ge={class:"flex items-center gap-5 rounded-2xl border border-success-200 bg-success-100 p-5 dark:border-success-800 dark:bg-white/[0.03] md:p-6 h-full"},Je={class:"inline-flex h-16 w-16 items-center justify-center rounded-xl bg-success-200 dark:bg-success-500/15"},We={class:"text-2xl font-semibold text-success-600 dark:text-white/90"},Ze={class:"h-full"},Ke={class:"flex items-center gap-5 rounded-2xl border border-brand-200 bg-brand-100 p-5 dark:border-brand-800 dark:bg-white/[0.03] md:p-6 h-full"},Xe={class:"inline-flex h-16 w-16 items-center justify-center rounded-xl bg-brand-200 dark:bg-brand-500/15"},Ye={class:"text-2xl font-semibold text-brand-600 dark:text-white/90"},et={class:"h-full"},tt={class:"flex items-center gap-5 rounded-2xl border border-blue-light-200 bg-blue-light-100 p-5 dark:border-blue-light-800 dark:bg-white/[0.03] md:p-6 h-full"},st={class:"inline-flex h-16 w-16 items-center justify-center rounded-xl bg-blue-light-200 dark:bg-blue-light-500/15"},at={class:"text-2xl font-semibold text-blue-light-600 dark:text-white/90"},rt={__name:"CallsStatistics",props:{phoneOutgoingIcon:{type:Object,required:!0},circleCheckBigIcon:{type:Object,required:!0},usersRoundIcon:{type:Object,required:!0},swatchBookIcon:{type:Object,required:!0},statistics:{type:Object,required:!0},onMonthChange:{type:Function,required:!0}},setup(t){return(i,s)=>{var c,u;return a(),l("div",Le,[e("div",Fe,[s[0]||(s[0]=e("h2",{class:"text-lg font-semibold text-gray-800 dark:text-white/90"},"Статистика звонков",-1)),j(ke,{onMonthChange:t.onMonthChange},null,8,["onMonthChange"])]),e("div",Ee,[e("div",ze,[e("div",He,[e("div",Ne,[(a(),O(A(t.phoneOutgoingIcon),{class:"text-warning-600 dark:text-warning-400"}))]),e("div",null,[e("h3",Ve,b(t.statistics.current.pending||0),1),s[1]||(s[1]=e("p",{class:"flex items-center gap-3 text-sm text-gray-500 dark:text-gray-400"}," Новые заявки перезвонить ",-1))])])]),e("div",Qe,[e("div",Ge,[e("div",Je,[(a(),O(A(t.circleCheckBigIcon),{class:"text-success-600 dark:text-success-400"}))]),e("div",null,[e("h3",We,b(t.statistics.current.processed||0),1),s[2]||(s[2]=e("p",{class:"flex items-center gap-3 text-sm text-gray-500 dark:text-gray-400"}," Завершённые звонки ",-1))])])]),e("div",Ze,[e("div",Ke,[e("div",Xe,[(a(),O(A(t.swatchBookIcon),{class:"text-brand-600 dark:text-brand-400"}))]),e("div",null,[e("h3",Ye,b(((c=t.statistics.sources)==null?void 0:c.current.designer)||0),1),s[3]||(s[3]=e("p",{class:"flex items-center gap-3 text-sm text-gray-500 dark:text-gray-400"}," Заявки от дизайнеров ",-1))])])]),e("div",et,[e("div",tt,[e("div",st,[(a(),O(A(t.usersRoundIcon),{class:"text-blue-light-600 dark:text-blue-light-400"}))]),e("div",null,[e("h3",at,b(((u=t.statistics.sources)==null?void 0:u.current.client)||0),1),s[4]||(s[4]=e("p",{class:"flex items-center gap-3 text-sm text-gray-500 dark:text-gray-400"}," Заявки от клиентов ",-1))])])])])])}}},ot={key:0,class:"text-gray-400"},nt={key:1,class:"text-gray-800 dark:text-white/90"},lt={key:0,class:"absolute z-10 w-full mt-1 bg-white rounded-lg shadow-sm dark:bg-gray-900"},ct={class:"overflow-y-auto divide-y divide-gray-200 custom-scrollbar max-h-60 dark:divide-gray-800",role:"listbox"},dt=["onClick","aria-selected"],it={class:"grow"},ut={key:0,class:"w-5 h-5 text-gray-400 dark:text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},gt={__name:"CallsStatusSelector",props:{statuses:Array,selectedItem:Object,isOpen:Boolean},emits:["toggleDropdown","toggleItem"],setup(t,{emit:i}){const s=t,c=i,u=re(()=>{s.isOpen&&c("toggleDropdown")}),v=()=>{c("toggleDropdown")},_=n=>{c("toggleItem",n)},h=n=>n.value===null?s.selectedItem===null:s.selectedItem&&s.selectedItem.value===n.value;return(n,r)=>(a(),l("div",{class:"relative sm:min-w-[200px] sm:w-auto",ref_key:"multiSelectRef",ref:u},[e("div",{onClick:v,class:N(["dark:bg-dark-900 h-11 flex items-center w-full appearance-none rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",{"text-gray-800 dark:text-white/90":t.isOpen}])},[t.selectedItem?(a(),l("span",nt,b(t.selectedItem.label),1)):(a(),l("span",ot," Все статусы ")),(a(),l("svg",{class:N(["ml-auto",{"transform rotate-180":t.isOpen}]),width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},r[0]||(r[0]=[e("path",{d:"M4.79175 7.39551L10.0001 12.6038L15.2084 7.39551",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]),2))],2),j(ge,{"enter-active-class":"transition duration-100 ease-out","enter-from-class":"transform scale-95 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-75 ease-in","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-95 opacity-0"},{default:V(()=>[t.isOpen?(a(),l("div",lt,[e("ul",ct,[(a(!0),l(Y,null,ee(t.statuses,$=>(a(),l("li",{key:$.id,onClick:T=>_($),class:N(["relative flex items-center w-full px-3 py-2 border-transparent cursor-pointer first:rounded-t-lg last:rounded-b-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-800",{"bg-gray-50 dark:bg-white/[0.03]":h($)}]),role:"option","aria-selected":h($)},[e("span",it,b($.label),1),h($)?(a(),l("svg",ut,r[1]||(r[1]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))):M("",!0)],10,dt))),128))])])):M("",!0)]),_:1})],512))}},xt={class:"flex flex-col justify-between gap-5 border-gray-200 px-5 py-4 sm:flex-row sm:items-center dark:border-gray-800"},ht={class:"text-base font-medium text-gray-800 dark:text-white/90 flex flex-row items-center"},pt={class:"flex flex-col md:flex-row gap-3"},mt={__name:"CallsHeader",props:{totalItems:{type:Number,required:!0},packageIcon:{type:Object,required:!0},statuses:{type:Array,required:!0},selectedItem:{type:[Object,null],required:!0},isOpen:{type:Boolean,required:!0}},emits:["update:searchQuery","toggleDropdown","toggleItem","update:showFilter"],setup(t,{emit:i}){const s=i;return(c,u)=>(a(),l("div",xt,[e("h3",ht,[(a(),O(A(t.packageIcon),{class:"menu-item-icon-active mr-2"})),te(" Список заявок ("+b(t.totalItems)+") ",1)]),e("div",pt,[j(gt,{statuses:t.statuses,selectedItem:t.selectedItem,isOpen:t.isOpen,onToggleDropdown:u[0]||(u[0]=v=>s("toggleDropdown")),onToggleItem:u[1]||(u[1]=v=>s("toggleItem",v))},null,8,["statuses","selectedItem","isOpen"])])]))}},bt={__name:"CallDropdown",emits:["updateStatus"],setup(t,{emit:i}){const s=m(!1),c=m(null),u=i,v=()=>{s.value=!s.value},_=()=>{s.value=!1},h=n=>{u("updateStatus",n),_()};return re(c),(n,r)=>(a(),l("div",{class:"relative",ref_key:"filterRef",ref:c,onClick:_},[e("button",{class:"bg-brand-500 shadow-theme-xs hover:bg-brand-600 inline-flex items-center justify-center gap-2 rounded-lg px-4 py-3 text-sm font-medium text-white transition",onClick:W(v,["stop"]),type:"button"}," Сменить статус "),xe(e("div",{onClick:r[2]||(r[2]=W(()=>{},["stop"])),class:"absolute right-0 z-10 mt-2 w-33 rounded-lg border border-gray-200 bg-white p-1 shadow-lg dark:border-gray-700 dark:bg-gray-800"},[e("button",{onClick:r[0]||(r[0]=$=>h("pending")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 rounded"}," Новый "),e("button",{onClick:r[1]||(r[1]=$=>h("processed")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 rounded"}," Обработан ")],512),[[he,s.value]])],512))}},ft={class:"relative bg-white dark:bg-gray-800 rounded-xl shadow-lg max-w-md w-full mx-4"},yt={class:"p-6"},wt={class:"flex justify-between items-center mb-4"},kt={key:0,class:"space-y-4"},vt={class:"mt-1 text-sm text-gray-900 dark:text-white"},_t={class:"mt-1 text-sm text-gray-900 dark:text-white"},$t={class:"mt-1 text-sm text-gray-900 dark:text-white"},It={class:"mt-1 text-sm text-gray-900 dark:text-white"},Ct={class:"mt-1 text-sm text-gray-900 dark:text-white"},St={class:"mt-1 text-sm text-gray-900 dark:text-white"},jt={key:0,class:"px-2.5 py-0.5 rounded-full font-bold text-md bg-warning-50 text-warning-600 dark:bg-warning-500/15 dark:text-orange-400"},Bt={key:1,class:"px-2.5 py-0.5 rounded-full font-bold text-md bg-success-50 text-success-600 dark:bg-success-500/15 dark:text-success-500"},Mt={__name:"CallModal",props:{isVisible:{type:Boolean,default:!1},call:{type:Object,default:null}},emits:["close","updateStatus"],setup(t,{emit:i}){var h;const s=t,c=i,u=m(((h=s.call)==null?void 0:h.status)||"pending");L(()=>{var n;return(n=s.call)==null?void 0:n.status},n=>{n&&(u.value=n)});const v=()=>{c("close")},_=n=>{u.value=n,c("updateStatus",s.call,n)};return(n,r)=>t.isVisible?(a(),O(me,{key:0,onClose:v},{body:V(()=>[e("div",ft,[e("div",yt,[e("div",wt,[r[0]||(r[0]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white"}," Информация о заявке ",-1)),j(bt,{onUpdateStatus:_})]),t.call?(a(),l("div",kt,[e("div",null,[r[1]||(r[1]=e("label",{class:"block text-sm font-medium text-brand-700 dark:text-brand-300"},"Имя клиента",-1)),e("p",vt,b(t.call.name),1)]),e("div",null,[r[2]||(r[2]=e("label",{class:"block text-sm font-medium text-brand-700 dark:text-brand-300"},"Email",-1)),e("p",_t,b(t.call.email||"Не указан"),1)]),e("div",null,[r[3]||(r[3]=e("label",{class:"block text-sm font-medium text-brand-700 dark:text-brand-300"},"Телефон",-1)),e("p",$t,b(t.call.phone),1)]),e("div",null,[r[4]||(r[4]=e("label",{class:"block text-sm font-medium text-brand-700 dark:text-brand-300"},"Источник",-1)),e("p",It,b(t.call.source==="client"?"Клиент":"Дизанер"),1)]),e("div",null,[r[5]||(r[5]=e("label",{class:"block text-sm font-medium text-brand-700 dark:text-brand-300"},"Комментарий",-1)),e("p",Ct,b(t.call.comment||"Нет комментария"),1)]),e("div",null,[r[6]||(r[6]=e("label",{class:"block text-sm font-medium text-brand-700 dark:text-brand-300"},"Дата создания",-1)),e("p",St,b(new Date(t.call.created_at).toLocaleDateString("ru-RU"))+" "+b(new Date(t.call.created_at).toLocaleTimeString("ru-RU")),1)]),e("div",null,[r[7]||(r[7]=e("label",{class:"block text-sm font-medium text-brand-700 dark:text-brand-300 mb-2"},"Статус",-1)),u.value==="pending"?(a(),l("span",jt," Новый ")):u.value==="processed"?(a(),l("span",Bt," Обработан ")):M("",!0)])])):M("",!0)])])]),_:1})):M("",!0)}},Tt={class:"p-4 border-t border-gray-100 dark:border-gray-800 sm:p-6"},Dt={class:"space-y-5"},Ot={class:"overflow-hidden rounded-xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]"},Pt={class:"max-w-full overflow-x-auto custom-scrollbar"},qt={key:0,class:"flex justify-center items-center h-screen"},Rt={key:1,class:"flex flex-col justify-center items-center h-screen font-bold text-error-700 text-theme-xl dark:text-error-500"},Ut={key:2,class:"flex flex-col justify-center items-center h-screen menu-item-icon-active text-center font-bold text-theme-xl m-5"},At={key:3,class:"min-w-full"},Lt={class:"divide-y divide-gray-200 dark:divide-gray-700"},Ft={class:"px-5 py-4 sm:px-6"},Et={class:"text-gray-500 text-left text-theme-sm dark:text-gray-400"},zt={class:"text-gray-500 text-left text-theme-sm dark:text-gray-400"},Ht=["onClick"],Nt={class:"block font-medium text-gray-800 text-theme-sm dark:text-white/90"},Vt={key:0,class:"block text-gray-500 text-theme-xs dark:text-gray-400"},Qt={class:"px-5 py-4 sm:px-6"},Gt={class:"text-gray-500 text-left text-theme-sm dark:text-gray-400"},Jt={class:"px-5 py-4 sm:px-6"},Wt={key:0,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-blue-light-50 text-blue-light-500 dark:bg-blue-light-500/15 dark:text-blue-light-500"},Zt={key:1,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-brand-50 text-brand-500 dark:bg-brand-500/15 dark:text-brand-500"},Kt={class:"px-5 py-4 sm:px-6"},Xt={class:"text-gray-500 text-left text-theme-sm dark:text-gray-400"},Yt={class:"px-5 py-4 sm:px-6 text-center"},es={key:0,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-warning-50 text-warning-600 dark:bg-warning-500/15 dark:text-orange-400"},ts={key:1,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-success-50 text-success-600 dark:bg-success-500/15 dark:text-success-500"},ss={__name:"CallsTable",props:{loading:Boolean,error:String,calls:Array,formatter:Object},emits:["fetchCalls","edit","updateStatus"],setup(t,{expose:i,emit:s}){const c=t,u=se(),v=ae(),_=s,h=m(!1),n=m(null),r=()=>{_("fetchCalls")},$=(I,w)=>{_("updateStatus",I,w)},T=I=>{n.value=I,h.value=!0},P=()=>{h.value=!1,n.value=null;const I={...v.query};delete I.openModal,u.replace({query:I})};return i({openModalById:I=>{const w=c.calls.find(p=>p.id==I);w&&T(w)}}),(I,w)=>(a(),l("div",Tt,[e("div",Dt,[e("div",Ot,[e("div",Pt,[t.loading?(a(),l("div",qt,w[0]||(w[0]=[e("div",{class:"animate-spin rounded-full h-16 w-16 border-b-2 border-brand-500"},null,-1)]))):t.error?(a(),l("div",Rt,[w[1]||(w[1]=te(" Ошибка при загрузке")),w[2]||(w[2]=e("br",null,null,-1)),e("button",{class:"inline-flex items-center justify-center font-medium gap-2 rounded-lg transition px-4 py-3 text-sm bg-brand-500 text-white shadow-theme-xs hover:bg-brand-600 disabled:bg-brand-300 mt-2",onClick:r}," Попробовать снова ")])):t.calls.length===0?(a(),l("div",Ut," Заявок на звонок не найдено ")):(a(),l("table",At,[w[3]||(w[3]=e("thead",null,[e("tr",{class:"border-gray-100 border-y bg-gray-50 dark:border-gray-800 dark:bg-gray-900"},[e("th",{class:"cursor-pointer px-5 py-3 text-left w-1/12 sm:px-6"},[e("div",{class:"flex items-left gap-3"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Дата")])]),e("th",{class:"px-5 py-3 text-left w-3/12 sm:px-6"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Клиент")]),e("th",{class:"px-5 py-3 text-left w-2/12 sm:px-6"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Телефон")]),e("th",{class:"px-5 py-3 text-left w-1/12 sm:px-6"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Источник")]),e("th",{class:"px-5 py-3 text-left w-3/12 sm:px-6"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Комментарий")]),e("th",{class:"px-5 py-3 text-center w-2/12 sm:px-6",colspan:"2"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Статус")])])],-1)),e("tbody",Lt,[(a(!0),l(Y,null,ee(t.calls,p=>(a(),l("tr",{key:p.id,class:"border-t border-gray-100 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800"},[e("td",Ft,[e("p",Et,b(new Date(p.created_at).toLocaleDateString("ru-RU")),1),e("p",zt,b(new Date(p.created_at).toLocaleTimeString("ru-RU")),1)]),e("td",{class:"px-5 py-4 sm:px-6 cursor-pointer hover:text-brand-500",onClick:F=>T(p)},[e("span",Nt,b(p.name),1),p.email?(a(),l("span",Vt,b(p.email),1)):M("",!0)],8,Ht),e("td",Qt,[e("p",Gt,b(p.phone),1)]),e("td",Jt,[p.source==="client"?(a(),l("span",Wt," Клиент ")):p.source==="designer"?(a(),l("span",Zt," Дизанер ")):M("",!0)]),e("td",Kt,[e("p",Xt,b(p.comment||"Нет комментария"),1)]),e("td",Yt,[p.status==="pending"?(a(),l("span",es," Новый ")):p.status==="processed"?(a(),l("span",ts," Обработан ")):M("",!0)])]))),128))])]))])])]),j(Mt,{"is-visible":h.value,call:n.value,onClose:P,onUpdateStatus:$},null,8,["is-visible","call"])]))}},U="http://test.dennistp.beget.tech";function X(){const t=m([]),i=m(!1),s=m(null),c=m(1),u=m(50),v=m(0),_=Z(()=>Math.ceil(v.value/u.value)),h=m(""),n=m(null),r=m([{id:"all",value:null,label:"Все статусы"},{id:"pending",value:"pending",label:"Новый"},{id:"processed",value:"processed",label:"Обработан"}]),$=m({sale:{true:!0,false:!0},published:{true:!0,false:!0}}),T=Z(()=>{const g=_.value,o=c.value,d=2,f=[],k=[];for(let B=Math.max(2,o-d);B<=Math.min(g-1,o+d);B++)f.push(B);return o-d>2?k.push(1,"..."):k.push(1),k.push(...f),o+d<g-1?k.push("...",g):g>1&&k.push(g),k}),P=new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB"}),S=async()=>{i.value=!0,s.value=null;const g=new URLSearchParams({page:c.value.toString(),per_page:u.value.toString()});h.value.trim()&&g.append("search",h.value.trim()),n.value&&n.value.value!==null&&g.append("status",n.value.value);const o=`${U}/api/call-requests?${g.toString()}`;try{const d=await fetch(o,{headers:{Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!d.ok)throw new Error(`HTTP error! status: ${d.status}`);const f=await d.json();t.value=f.call_requests.data,v.value=f.call_requests.total}catch(d){s.value=d.message,console.error("Ошибка загрузки заявок на звонок:",d)}finally{i.value=!1}},I=()=>{c.value>1&&(c.value--,S())},w=()=>{c.value<_.value&&(c.value++,S())},p=g=>{c.value=g,S()},F=async g=>{try{const o=await fetch(`${U}/api/call-requests/${g}`,{headers:{Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return(await o.json()).call_request}catch(o){throw console.error("Ошибка загрузки заявки на звонок:",o),o}},E=async(g,o)=>{try{const d=new FormData;Object.keys(o).forEach(k=>{var B;typeof o[k]=="boolean"?d.append(k,o[k]?"1":"0"):d.append(k,((B=o[k])==null?void 0:B.toString())||"")}),d.append("_method","PUT");const f=await fetch(`${U}/api/call-requests/${g}`,{method:"POST",headers:{Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:d});if(f.ok)return{success:!0};if(f.status===422)return{success:!1,errors:(await f.json()).errors};throw new Error(`HTTP error! status: ${f.status}`)}catch(d){return console.error("Ошибка обновления заявки на звонок:",d),{success:!1}}},D=()=>{c.value=1};let q=null;return L(h,g=>{q&&clearTimeout(q),q=setTimeout(()=>{D(),S()},500)}),L(()=>$.value,()=>{D(),S()},{deep:!0}),L(n,()=>{D(),S()}),{calls:t,loading:i,error:s,page:c,itemsPerPage:u,totalItems:v,totalPages:_,searchQuery:h,selectedStatus:n,statuses:r,filters:$,visiblePages:T,formatter:P,fetchCalls:S,fetchCallStatistics:async g=>{try{const o=new URLSearchParams;g&&o.append("month",g);const d=`${U}/api/call-requests/statistics${o.toString()?"?"+o.toString():""}`,f=await fetch(d,{headers:{Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!f.ok)throw new Error(`HTTP error! status: ${f.status}`);return(await f.json()).statistics}catch(o){throw console.error("Ошибка загрузки статистики заявок на звонок:",o),o}},fetchCallById:async g=>{try{const o=await fetch(`${U}/api/call-requests/${g}`,{headers:{Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return{success:!0,data:(await o.json()).call_request}}catch(o){return console.error("Ошибка загрузки заявки на звонок:",o),{success:!1,errors:o.message}}},handlePrevPage:I,handleNextPage:w,handleGoToPage:p,getCall:F,updateCall:E,resetPage:D}}const as={class:"space-y-5 sm:space-y-6"},rs={class:"rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]"},us={__name:"Calls",setup(t){const i=se(),s=ae(),c=m("Обратные звонки"),u=ve,v=_e,_=$e,h=Ie,n=Me,r=ye,$=we,T=Ae,P=Pe,{calls:S,loading:I,error:w,page:p,totalItems:F,totalPages:E,selectedStatus:D,statuses:q,formatter:G,fetchCalls:R,fetchCallStatistics:g,deleteCall:o}=X(),d=m(null),f=m(!1),k=m({current:{pending:0,processed:0,completed:0,cancelled:0},previous:{pending:0,processed:0,completed:0,cancelled:0},percentages:{pending:0,processed:0,completed:0,cancelled:0}}),B=()=>{f.value=!f.value},oe=x=>{D.value=x.value===null?null:x,f.value=!1},ne=x=>{i.push(`/calls/edit/${x.id}`)},le=async(x,C)=>{const H=await o(x.id);C(H)},ce=x=>{p.value=x,R()},de=async(x,C)=>{const{updateCall:H}=X(),J=await H(x.id,{status:C});J.success?(R(),z()):console.error("Ошибка обновления статуса:",J.errors)},ie=m(new Date().toISOString().slice(0,7)),z=async x=>{try{const C=await g(x);k.value=C}catch(C){console.error("Ошибка загрузки статистики:",C)}},ue=x=>{ie.value=x,z(x)};return pe(async()=>{var x;await R(),z(),await K(),s.query.openModal&&((x=d.value)==null||x.openModalById(s.query.openModal))}),L(()=>s.query.openModal,async x=>{var C;x&&(await K(),(C=d.value)==null||C.openModalById(x))}),(x,C)=>(a(),O(be,null,{default:V(()=>[j(fe,{pageTitle:c.value},null,8,["pageTitle"]),e("div",as,[j(rt,{arrowDownIcon:y(u),arrowUpIcon:y(v),phoneOutgoingIcon:y($),calendarClockIcon:y(_),calendarDaysIcon:y(h),circleCheckBigIcon:y(n),swatchBookIcon:y(P),usersRoundIcon:y(T),statistics:k.value,onMonthChange:ue},null,8,["arrowDownIcon","arrowUpIcon","phoneOutgoingIcon","calendarClockIcon","calendarDaysIcon","circleCheckBigIcon","swatchBookIcon","usersRoundIcon","statistics"]),e("div",rs,[j(mt,{totalItems:y(F),packageIcon:y(r),statuses:y(q),selectedItem:y(D),isOpen:f.value,onToggleDropdown:B,onToggleItem:oe},null,8,["totalItems","packageIcon","statuses","selectedItem","isOpen"]),j(ss,{ref_key:"callsTable",ref:d,loading:y(I),error:y(w),calls:y(S),formatter:y(G),onFetchCalls:y(R),onEdit:ne,onDelete:le,onUpdateStatus:de},null,8,["loading","error","calls","formatter","onFetchCalls"]),j(Ce,{currentPage:y(p),totalPages:y(E),onPageChange:ce,class:"px-6"},null,8,["currentPage","totalPages"])])])]),_:1}))}};export{us as default};
