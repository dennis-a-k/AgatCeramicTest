import{o as a,c,b as e,i as P,m as V,t as f,n as N,k as I,j as H,F as X,f as Y,e as D,T as ae,p as Z,r as h,g as W,d as re,q as oe,w as M,z as J,s as le,u as b,h as ne}from"./index-N1E6rwhZ.js";import{b as ee,a as ce,_ as de,c as ie}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-D6R8omur.js";import{u as te}from"./useClickOutside-CyWb3k6I.js";import{M as ue}from"./Modal-BNm2JGe5.js";import{_ as ge}from"./Pagination-hkikCS1A.js";import{A as xe,a as pe,C as me,b as he}from"./CalendarDaysIcon-0z2BoQP7.js";const fe={},be={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-circle-check-big-icon lucide-circle-check-big"};function ye(t,g){return a(),c("svg",be,g[0]||(g[0]=[e("path",{d:"M21.801 10A10 10 0 1 1 17 3.335"},null,-1),e("path",{d:"m9 11 3 3L22 4"},null,-1)]))}const we=ee(fe,[["render",ye]]),ke={},ve={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-phone-outgoing-icon lucide-phone-outgoing"};function _e(t,g){return a(),c("svg",ve,g[0]||(g[0]=[e("path",{d:"m16 8 6-6"},null,-1),e("path",{d:"M22 8V2h-6"},null,-1),e("path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384"},null,-1)]))}const $e=ee(ke,[["render",_e]]),Ce={class:"grid grid-cols-4 gap-4 md:gap-4 mb-4 md:mb-4"},Ie={class:"col-span-12 xl:col-span-1"},Se={class:"flex items-center gap-5 rounded-2xl border border-warning-200 bg-white p-5 dark:border-warning-800 dark:bg-white/[0.03] md:p-6"},De={class:"inline-flex h-16 w-16 items-center justify-center rounded-xl bg-warning-100 rounded-xl dark:bg-warning-500/15"},Te={class:"text-2xl font-semibold text-gray-800 dark:text-white/90"},je={class:"col-span-12 xl:col-span-1"},Oe={class:"flex items-center gap-5 rounded-2xl border border-success-200 bg-white p-5 dark:border-success-800 dark:bg-white/[0.03] md:p-6"},Pe={class:"inline-flex h-16 w-16 items-center justify-center rounded-xl bg-success-100 rounded-xl dark:bg-success-500/15"},Be={class:"text-2xl font-semibold text-gray-800 dark:text-white/90"},Ue={__name:"CallsStatistics",props:{phoneOutgoingIcon:{type:Object,required:!0},circleCheckBigIcon:{type:Object,required:!0},statistics:{type:Object,required:!0}},setup(t){return(g,r)=>(a(),c("div",Ce,[e("div",Ie,[e("div",Se,[e("div",De,[(a(),P(V(t.phoneOutgoingIcon),{class:"text-warning-600 dark:text-warning-400"}))]),e("div",null,[e("h3",Te,f(t.statistics.current.pending||0),1),r[0]||(r[0]=e("p",{class:"flex items-center gap-3 text-sm text-gray-500 dark:text-gray-400"}," Новые заявки перезвонить ",-1))])])]),e("div",je,[e("div",Oe,[e("div",Pe,[(a(),P(V(t.circleCheckBigIcon),{class:"text-success-600 dark:text-success-400"}))]),e("div",null,[e("h3",Be,f(t.statistics.current.processed||0),1),r[1]||(r[1]=e("p",{class:"flex items-center gap-3 text-sm text-gray-500 dark:text-gray-400"}," Завершённые звонки ",-1))])])])]))}},qe={key:0,class:"text-gray-400"},Me={key:1,class:"text-gray-800 dark:text-white/90"},Re={key:0,class:"absolute z-10 w-full mt-1 bg-white rounded-lg shadow-sm dark:bg-gray-900"},Ae={class:"overflow-y-auto divide-y divide-gray-200 custom-scrollbar max-h-60 dark:divide-gray-800",role:"listbox"},Ee=["onClick","aria-selected"],Fe={class:"grow"},Le={key:0,class:"w-5 h-5 text-gray-400 dark:text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},Ne={__name:"CallsStatusSelector",props:{statuses:Array,selectedItem:Object,isOpen:Boolean},emits:["toggleDropdown","toggleItem"],setup(t,{emit:g}){const r=t,d=g,u=te(()=>{r.isOpen&&d("toggleDropdown")}),y=()=>{d("toggleDropdown")},v=o=>{d("toggleItem",o)},p=o=>o.value===null?r.selectedItem===null:r.selectedItem&&r.selectedItem.value===o.value;return(o,s)=>(a(),c("div",{class:"relative sm:min-w-[200px] sm:w-auto",ref_key:"multiSelectRef",ref:u},[e("div",{onClick:y,class:N(["dark:bg-dark-900 h-11 flex items-center w-full appearance-none rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",{"text-gray-800 dark:text-white/90":t.isOpen}])},[t.selectedItem?(a(),c("span",Me,f(t.selectedItem.label),1)):(a(),c("span",qe," Все статусы ")),(a(),c("svg",{class:N(["ml-auto",{"transform rotate-180":t.isOpen}]),width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},s[0]||(s[0]=[e("path",{d:"M4.79175 7.39551L10.0001 12.6038L15.2084 7.39551",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]),2))],2),I(ae,{"enter-active-class":"transition duration-100 ease-out","enter-from-class":"transform scale-95 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-75 ease-in","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-95 opacity-0"},{default:H(()=>[t.isOpen?(a(),c("div",Re,[e("ul",Ae,[(a(!0),c(X,null,Y(t.statuses,i=>(a(),c("li",{key:i.id,onClick:m=>v(i),class:N(["relative flex items-center w-full px-3 py-2 border-transparent cursor-pointer first:rounded-t-lg last:rounded-b-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-800",{"bg-gray-50 dark:bg-white/[0.03]":p(i)}]),role:"option","aria-selected":p(i)},[e("span",Fe,f(i.label),1),p(i)?(a(),c("svg",Le,s[1]||(s[1]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))):D("",!0)],10,Ee))),128))])])):D("",!0)]),_:1})],512))}},Ve={class:"flex flex-col justify-between gap-5 border-gray-200 px-5 py-4 sm:flex-row sm:items-center dark:border-gray-800"},He={class:"text-base font-medium text-gray-800 dark:text-white/90 flex flex-row items-center"},ze={class:"flex flex-col md:flex-row gap-3"},Qe={__name:"CallsHeader",props:{totalItems:{type:Number,required:!0},packageIcon:{type:Object,required:!0},statuses:{type:Array,required:!0},selectedItem:{type:[Object,null],required:!0},isOpen:{type:Boolean,required:!0}},emits:["update:searchQuery","toggleDropdown","toggleItem","update:showFilter"],setup(t,{emit:g}){const r=g;return(d,u)=>(a(),c("div",Ve,[e("h3",He,[(a(),P(V(t.packageIcon),{class:"menu-item-icon-active mr-2"})),Z(" Список заявок ("+f(t.totalItems)+") ",1)]),e("div",ze,[I(Ne,{statuses:t.statuses,selectedItem:t.selectedItem,isOpen:t.isOpen,onToggleDropdown:u[0]||(u[0]=y=>r("toggleDropdown")),onToggleItem:u[1]||(u[1]=y=>r("toggleItem",y))},null,8,["statuses","selectedItem","isOpen"])])]))}},Ge={__name:"CallDropdown",emits:["updateStatus"],setup(t,{emit:g}){const r=h(!1),d=h(null),u=g,y=()=>{r.value=!r.value},v=()=>{r.value=!1},p=o=>{u("updateStatus",o),v()};return te(d),(o,s)=>(a(),c("div",{class:"relative",ref_key:"filterRef",ref:d,onClick:v},[e("button",{class:"bg-brand-500 shadow-theme-xs hover:bg-brand-600 inline-flex items-center justify-center gap-2 rounded-lg px-4 py-3 text-sm font-medium text-white transition",onClick:W(y,["stop"]),type:"button"}," Сменить статус "),re(e("div",{onClick:s[2]||(s[2]=W(()=>{},["stop"])),class:"absolute right-0 z-10 mt-2 w-33 rounded-lg border border-gray-200 bg-white p-1 shadow-lg dark:border-gray-700 dark:bg-gray-800"},[e("button",{onClick:s[0]||(s[0]=i=>p("pending")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 rounded"}," Новый "),e("button",{onClick:s[1]||(s[1]=i=>p("processed")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 rounded"}," Обработан ")],512),[[oe,r.value]])],512))}},We={class:"relative bg-white dark:bg-gray-800 rounded-xl shadow-lg max-w-md w-full mx-4"},Je={class:"p-6"},Ke={class:"flex justify-between items-center mb-4"},Xe={key:0,class:"space-y-4"},Ye={class:"mt-1 text-sm text-gray-900 dark:text-white"},Ze={class:"mt-1 text-sm text-gray-900 dark:text-white"},et={class:"mt-1 text-sm text-gray-900 dark:text-white"},tt={class:"mt-1 text-sm text-gray-900 dark:text-white"},st={class:"mt-1 text-sm text-gray-900 dark:text-white"},at={class:"mt-1 text-sm text-gray-900 dark:text-white"},rt={key:0,class:"px-2.5 py-0.5 rounded-full font-bold text-md bg-warning-50 text-warning-600 dark:bg-warning-500/15 dark:text-orange-400"},ot={key:1,class:"px-2.5 py-0.5 rounded-full font-bold text-md bg-success-50 text-success-600 dark:bg-success-500/15 dark:text-success-500"},lt={__name:"CallModal",props:{isVisible:{type:Boolean,default:!1},call:{type:Object,default:null}},emits:["close","updateStatus"],setup(t,{emit:g}){var p;const r=t,d=g,u=h(((p=r.call)==null?void 0:p.status)||"pending");M(()=>{var o;return(o=r.call)==null?void 0:o.status},o=>{o&&(u.value=o)});const y=()=>{d("close")},v=o=>{u.value=o,d("updateStatus",r.call,o)};return(o,s)=>t.isVisible?(a(),P(ue,{key:0,onClose:y},{body:H(()=>[e("div",We,[e("div",Je,[e("div",Ke,[s[0]||(s[0]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white"}," Информация о заявке ",-1)),I(Ge,{onUpdateStatus:v})]),t.call?(a(),c("div",Xe,[e("div",null,[s[1]||(s[1]=e("label",{class:"block text-sm font-medium text-brand-700 dark:text-brand-300"},"Имя клиента",-1)),e("p",Ye,f(t.call.name),1)]),e("div",null,[s[2]||(s[2]=e("label",{class:"block text-sm font-medium text-brand-700 dark:text-brand-300"},"Email",-1)),e("p",Ze,f(t.call.email||"Не указан"),1)]),e("div",null,[s[3]||(s[3]=e("label",{class:"block text-sm font-medium text-brand-700 dark:text-brand-300"},"Телефон",-1)),e("p",et,f(t.call.phone),1)]),e("div",null,[s[4]||(s[4]=e("label",{class:"block text-sm font-medium text-brand-700 dark:text-brand-300"},"Источник",-1)),e("p",tt,f(t.call.source==="client"?"Клиент":"Дизанер"),1)]),e("div",null,[s[5]||(s[5]=e("label",{class:"block text-sm font-medium text-brand-700 dark:text-brand-300"},"Комментарий",-1)),e("p",st,f(t.call.comment||"Нет комментария"),1)]),e("div",null,[s[6]||(s[6]=e("label",{class:"block text-sm font-medium text-brand-700 dark:text-brand-300"},"Дата создания",-1)),e("p",at,f(new Date(t.call.created_at).toLocaleDateString("ru-RU"))+" "+f(new Date(t.call.created_at).toLocaleTimeString("ru-RU")),1)]),e("div",null,[s[7]||(s[7]=e("label",{class:"block text-sm font-medium text-brand-700 dark:text-brand-300 mb-2"},"Статус",-1)),u.value==="pending"?(a(),c("span",rt," Новый ")):u.value==="processed"?(a(),c("span",ot," Обработан ")):D("",!0)])])):D("",!0)])])]),_:1})):D("",!0)}},nt={class:"p-4 border-t border-gray-100 dark:border-gray-800 sm:p-6"},ct={class:"space-y-5"},dt={class:"overflow-hidden rounded-xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]"},it={class:"max-w-full overflow-x-auto custom-scrollbar"},ut={key:0,class:"flex justify-center items-center h-screen"},gt={key:1,class:"flex flex-col justify-center items-center h-screen font-bold text-error-700 text-theme-xl dark:text-error-500"},xt={key:2,class:"flex flex-col justify-center items-center h-screen menu-item-icon-active text-center font-bold text-theme-xl m-5"},pt={key:3,class:"min-w-full"},mt={class:"divide-y divide-gray-200 dark:divide-gray-700"},ht={class:"px-5 py-4 sm:px-6"},ft={class:"text-gray-500 text-left text-theme-sm dark:text-gray-400"},bt={class:"text-gray-500 text-left text-theme-sm dark:text-gray-400"},yt=["onClick"],wt={class:"block font-medium text-gray-800 text-theme-sm dark:text-white/90"},kt={key:0,class:"block text-gray-500 text-theme-xs dark:text-gray-400"},vt={class:"px-5 py-4 sm:px-6"},_t={class:"text-gray-500 text-left text-theme-sm dark:text-gray-400"},$t={class:"px-5 py-4 sm:px-6"},Ct={key:0,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-blue-light-50 text-blue-light-500 dark:bg-blue-light-500/15 dark:text-blue-light-500"},It={key:1,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-brand-50 text-brand-500 dark:bg-brand-500/15 dark:text-brand-500"},St={class:"px-5 py-4 sm:px-6"},Dt={class:"text-gray-500 text-left text-theme-sm dark:text-gray-400"},Tt={class:"px-5 py-4 sm:px-6 text-center"},jt={key:0,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-warning-50 text-warning-600 dark:bg-warning-500/15 dark:text-orange-400"},Ot={key:1,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-success-50 text-success-600 dark:bg-success-500/15 dark:text-success-500"},Pt={__name:"CallsTable",props:{loading:Boolean,error:String,calls:Array,formatter:Object},emits:["fetchCalls","edit","updateStatus"],setup(t,{emit:g}){const r=g,d=h(!1),u=h(null),y=()=>{r("fetchCalls")},v=(s,i)=>{r("updateStatus",s,i)},p=s=>{u.value=s,d.value=!0},o=()=>{d.value=!1,u.value=null};return(s,i)=>(a(),c("div",nt,[e("div",ct,[e("div",dt,[e("div",it,[t.loading?(a(),c("div",ut,i[0]||(i[0]=[e("div",{class:"animate-spin rounded-full h-16 w-16 border-b-2 border-brand-500"},null,-1)]))):t.error?(a(),c("div",gt,[i[1]||(i[1]=Z(" Ошибка при загрузке")),i[2]||(i[2]=e("br",null,null,-1)),e("button",{class:"inline-flex items-center justify-center font-medium gap-2 rounded-lg transition px-4 py-3 text-sm bg-brand-500 text-white shadow-theme-xs hover:bg-brand-600 disabled:bg-brand-300 mt-2",onClick:y}," Попробовать снова ")])):t.calls.length===0?(a(),c("div",xt," Заявок на звонок не найдено ")):(a(),c("table",pt,[i[3]||(i[3]=e("thead",null,[e("tr",{class:"border-gray-100 border-y bg-gray-50 dark:border-gray-800 dark:bg-gray-900"},[e("th",{class:"cursor-pointer px-5 py-3 text-left w-1/12 sm:px-6"},[e("div",{class:"flex items-left gap-3"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Дата")])]),e("th",{class:"px-5 py-3 text-left w-3/12 sm:px-6"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Клиент")]),e("th",{class:"px-5 py-3 text-left w-2/12 sm:px-6"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Телефон")]),e("th",{class:"px-5 py-3 text-left w-1/12 sm:px-6"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Источник")]),e("th",{class:"px-5 py-3 text-left w-3/12 sm:px-6"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Комментарий")]),e("th",{class:"px-5 py-3 text-center w-2/12 sm:px-6",colspan:"2"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Статус")])])],-1)),e("tbody",mt,[(a(!0),c(X,null,Y(t.calls,m=>(a(),c("tr",{key:m.id,class:"border-t border-gray-100 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800"},[e("td",ht,[e("p",ft,f(new Date(m.created_at).toLocaleDateString("ru-RU")),1),e("p",bt,f(new Date(m.created_at).toLocaleTimeString("ru-RU")),1)]),e("td",{class:"px-5 py-4 sm:px-6 cursor-pointer hover:text-brand-500",onClick:B=>p(m)},[e("span",wt,f(m.name),1),m.email?(a(),c("span",kt,f(m.email),1)):D("",!0)],8,yt),e("td",vt,[e("p",_t,f(m.phone),1)]),e("td",$t,[m.source==="client"?(a(),c("span",Ct," Клиент ")):m.source==="designer"?(a(),c("span",It," Дизанер ")):D("",!0)]),e("td",St,[e("p",Dt,f(m.comment||"Нет комментария"),1)]),e("td",Tt,[m.status==="pending"?(a(),c("span",jt," Новый ")):m.status==="processed"?(a(),c("span",Ot," Обработан ")):D("",!0)])]))),128))])]))])])]),I(lt,{"is-visible":d.value,call:u.value,onClose:o,onUpdateStatus:v},null,8,["is-visible","call"])]))}},O="http://test.dennistp.beget.tech";function K(){const t=h([]),g=h(!1),r=h(null),d=h(1),u=h(50),y=h(0),v=J(()=>Math.ceil(y.value/u.value)),p=h(""),o=h(null),s=h([{id:"all",value:null,label:"Все статусы"},{id:"pending",value:"pending",label:"Новый"},{id:"processed",value:"processed",label:"Обработан"}]),i=h({sale:{true:!0,false:!0},published:{true:!0,false:!0}}),m=J(()=>{const l=v.value,n=d.value,x=2,_=[],w=[];for(let S=Math.max(2,n-x);S<=Math.min(l-1,n+x);S++)_.push(S);return n-x>2?w.push(1,"..."):w.push(1),w.push(..._),n+x<l-1?w.push("...",l):l>1&&w.push(l),w}),B=new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB"}),$=async()=>{g.value=!0,r.value=null;const l=new URLSearchParams({page:d.value.toString(),per_page:u.value.toString()});p.value.trim()&&l.append("search",p.value.trim()),o.value&&o.value.value!==null&&l.append("status",o.value.value);const n=`${O}/api/call-requests?${l.toString()}`;try{const x=await fetch(n);if(!x.ok)throw new Error(`HTTP error! status: ${x.status}`);const _=await x.json();t.value=_.call_requests.data,y.value=_.call_requests.total}catch(x){r.value=x.message,console.error("Ошибка загрузки заявок на звонок:",x)}finally{g.value=!1}},R=()=>{d.value>1&&(d.value--,$())},A=()=>{d.value<v.value&&(d.value++,$())},U=l=>{d.value=l,$()},E=async l=>{try{const n=await fetch(`${O}/api/call-requests/${l}`);if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);return(await n.json()).call_request}catch(n){throw console.error("Ошибка загрузки заявки на звонок:",n),n}},F=async(l,n)=>{try{const x=new FormData;Object.keys(n).forEach(w=>{var S;typeof n[w]=="boolean"?x.append(w,n[w]?"1":"0"):x.append(w,((S=n[w])==null?void 0:S.toString())||"")}),x.append("_method","PUT");const _=await fetch(`${O}/api/call-requests/${l}`,{method:"POST",headers:{Accept:"application/json"},body:x});if(_.ok)return{success:!0};if(_.status===422)return{success:!1,errors:(await _.json()).errors};throw new Error(`HTTP error! status: ${_.status}`)}catch(x){return console.error("Ошибка обновления заявки на звонок:",x),{success:!1}}},C=()=>{d.value=1};let T=null;return M(p,l=>{T&&clearTimeout(T),T=setTimeout(()=>{C(),$()},500)}),M(()=>i.value,()=>{C(),$()},{deep:!0}),M(o,()=>{C(),$()}),{calls:t,loading:g,error:r,page:d,itemsPerPage:u,totalItems:y,totalPages:v,searchQuery:p,selectedStatus:o,statuses:s,filters:i,visiblePages:m,formatter:B,fetchCalls:$,fetchCallStatistics:async()=>{try{const l=await fetch(`${O}/api/call-requests/statistics`);if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);return(await l.json()).statistics}catch(l){throw console.error("Ошибка загрузки статистики заявок на звонок:",l),l}},fetchCallById:async l=>{try{const n=await fetch(`${O}/api/call-requests/${l}`);if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);return{success:!0,data:(await n.json()).call_request}}catch(n){return console.error("Ошибка загрузки заявки на звонок:",n),{success:!1,errors:n.message}}},handlePrevPage:R,handleNextPage:A,handleGoToPage:U,getCall:E,updateCall:F,resetPage:C}}const Bt={class:"space-y-5 sm:space-y-6"},Ut={class:"rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]"},Lt={__name:"Calls",setup(t){const g=ne(),r=h("Обратные звонки"),d=xe,u=pe,y=me,v=he,p=we,o=ie,s=$e,{calls:i,loading:m,error:B,page:$,totalItems:R,totalPages:A,selectedStatus:U,statuses:E,formatter:F,fetchCalls:C,fetchCallStatistics:T,deleteCall:z}=K(),j=h(!1),l=h({current:{pending:0,processed:0,completed:0,cancelled:0},previous:{pending:0,processed:0,completed:0,cancelled:0},percentages:{pending:0,processed:0,completed:0,cancelled:0}}),n=()=>{j.value=!j.value},x=k=>{U.value=k.value===null?null:k,j.value=!1},_=k=>{g.push(`/calls/edit/${k.id}`)},w=async(k,q)=>{const L=await z(k.id);q(L)},S=k=>{$.value=k,C()},se=async(k,q)=>{const{updateCall:L}=K(),G=await L(k.id,{status:q});G.success?(C(),Q()):console.error("Ошибка обновления статуса:",G.errors)},Q=async()=>{try{const k=await T();l.value=k}catch(k){console.error("Ошибка загрузки статистики:",k)}};return le(()=>{C(),Q()}),(k,q)=>(a(),P(ce,null,{default:H(()=>[I(de,{pageTitle:r.value},null,8,["pageTitle"]),e("div",Bt,[I(Ue,{arrowDownIcon:b(d),arrowUpIcon:b(u),phoneOutgoingIcon:b(s),calendarClockIcon:b(y),calendarDaysIcon:b(v),circleCheckBigIcon:b(p),statistics:l.value},null,8,["arrowDownIcon","arrowUpIcon","phoneOutgoingIcon","calendarClockIcon","calendarDaysIcon","circleCheckBigIcon","statistics"]),e("div",Ut,[I(Qe,{totalItems:b(R),packageIcon:b(o),statuses:b(E),selectedItem:b(U),isOpen:j.value,onToggleDropdown:n,onToggleItem:x},null,8,["totalItems","packageIcon","statuses","selectedItem","isOpen"]),I(Pt,{loading:b(m),error:b(B),calls:b(i),formatter:b(F),onFetchCalls:b(C),onEdit:_,onDelete:w,onUpdateStatus:se},null,8,["loading","error","calls","formatter","onFetchCalls"]),I(ge,{currentPage:b($),totalPages:b(A),onPageChange:S,class:"px-6"},null,8,["currentPage","totalPages"])])])]),_:1}))}};export{Lt as default};
