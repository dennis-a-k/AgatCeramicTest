import{r as v,a as S,w as T,c as i,b as s,n as j,d as f,v as g,e as w,u as b,t as y,f as C,o as u,g as E}from"./index-DRUAnB2R.js";const p="http://test.dennistp.beget.tech";function $(){const n=v(!1),r=v(null),d=async()=>{try{await fetch(`${p}/sanctum/csrf-cookie`,{method:"GET",credentials:"include"})}catch(e){throw console.error("CSRF token fetch error:",e),e}};return{loading:n,error:r,register:async e=>{n.value=!0,r.value=null;try{await d();const o=await fetch(`${p}/api/register`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify(e)});if(!o.ok){const c=await o.json();throw new Error(c.message||"Registration failed")}return await o.json()}catch(o){throw r.value=o.message,o}finally{n.value=!1}},login:async e=>{n.value=!0,r.value=null;try{await d();const o=await fetch(`${p}/api/login`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify(e)});if(!o.ok){const x=await o.json();throw new Error(x.message||"Login failed")}const c=await o.json();return localStorage.setItem("auth_token",c.token),c}catch(o){throw r.value=o.message,o}finally{n.value=!1}},logout:async()=>{n.value=!0,r.value=null;try{await d();const e=await fetch(`${p}/api/logout`,{method:"POST",headers:{Accept:"application/json"},credentials:"include"});if(!e.ok)throw new Error("Logout failed");return await e.json()}catch(e){throw r.value=e.message,e}finally{n.value=!1}},getUser:async()=>{n.value=!0,r.value=null;try{await d();const e=await fetch(`${p}/api/user`,{method:"GET",headers:{Accept:"application/json"},credentials:"include"});if(!e.ok)throw new Error("Failed to fetch user");return await e.json()}catch(e){throw r.value=e.message,e}finally{n.value=!1}}}}const A={class:"max-w-md mx-auto mt-8 p-6 bg-white rounded-lg shadow-md"},U={class:"flex justify-center mb-6"},L={key:0,class:"mb-4"},V={class:"mb-4"},O={class:"mb-4"},R={key:1,class:"mb-6"},q=["disabled"],B={key:0},D={key:1},N={key:2,class:"mt-4 text-red-500 text-sm"},P={key:3,class:"mt-4 p-3 bg-green-100 text-green-700 rounded-lg"},M={__name:"LoginForm",setup(n){const r=E(),{login:d,register:_,loading:h,error:m}=$(),a=v(!0),e=S({name:"",email:"",password:"",password_confirmation:"",remember:!1});T(a,()=>{e.name="",e.email="",e.password="",e.password_confirmation="",m.value=""});const o=v(""),c=async()=>{try{await _(e),e.name="",e.email="",e.password="",e.password_confirmation="",a.value=!0,o.value="Регистрация прошла успешно! Теперь вы можете войти в систему.",setTimeout(()=>{o.value=""},5e3)}catch{}},x=async()=>{try{await d(e)&&r.push("/")}catch{}};return(k,t)=>(u(),i("div",A,[s("div",U,[s("button",{onClick:t[0]||(t[0]=l=>a.value=!0),class:j(["px-4 py-2 font-medium",a.value?"text-blue-500 border-b-2 border-blue-500":"text-gray-500 hover:text-gray-700"])}," Вход ",2),s("button",{onClick:t[1]||(t[1]=l=>a.value=!1),class:j(["px-4 py-2 font-medium",a.value?"text-gray-500 hover:text-gray-700":"text-blue-500 border-b-2 border-blue-500"])}," Регистрация ",2)]),s("form",{onSubmit:t[6]||(t[6]=C(l=>a.value?x():c(),["prevent"]))},[a.value?w("",!0):(u(),i("div",L,[t[7]||(t[7]=s("label",{class:"block text-gray-700 text-sm font-bold mb-2",for:"name"}," ФИО ",-1)),f(s("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>e.name=l),id:"name",type:"text",class:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:""},null,512),[[g,e.name]])])),s("div",V,[t[8]||(t[8]=s("label",{class:"block text-gray-700 text-sm font-bold mb-2",for:"email"}," Почта ",-1)),f(s("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>e.email=l),id:"email",type:"email",class:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:""},null,512),[[g,e.email]])]),s("div",O,[t[9]||(t[9]=s("label",{class:"block text-gray-700 text-sm font-bold mb-2",for:"password"}," Пароль ",-1)),f(s("input",{"onUpdate:modelValue":t[4]||(t[4]=l=>e.password=l),id:"password",type:"password",class:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:""},null,512),[[g,e.password]])]),a.value?w("",!0):(u(),i("div",R,[t[10]||(t[10]=s("label",{class:"block text-gray-700 text-sm font-bold mb-2",for:"password_confirmation"}," Повторить пароль ",-1)),f(s("input",{"onUpdate:modelValue":t[5]||(t[5]=l=>e.password_confirmation=l),id:"password_confirmation",type:"password",class:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:""},null,512),[[g,e.password_confirmation]])])),s("button",{type:"submit",class:"w-full bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600 transition duration-200",disabled:b(h)},[b(h)?(u(),i("span",D,y(a.value?"Авторизация...":"Регистрация..."),1)):(u(),i("span",B,y(a.value?"Войти":"Зарегистрироваться"),1))],8,q),b(m)?(u(),i("div",N,y(b(m)),1)):w("",!0),o.value?(u(),i("div",P,y(o.value),1)):w("",!0)],32)]))}};export{M as default};
