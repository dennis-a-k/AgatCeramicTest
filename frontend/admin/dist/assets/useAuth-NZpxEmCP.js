import{r as l}from"./index-aP64LZ8f.js";const n="http://test.dennistp.beget.tech";function p(){const r=l(!1),e=l({}),i=async()=>{try{await fetch(`${n}/sanctum/csrf-cookie`,{method:"GET",credentials:"include"})}catch(t){throw console.error("CSRF token fetch error:",t),t}};return{loading:r,error:e,register:async t=>{r.value=!0,e.value={};try{await i();const a=await fetch(`${n}/api/register`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify(t)});if(!a.ok){const o=await a.json();throw o.errors?e.value=o.errors:e.value={general:[o.message||"Registration failed"]},new Error(o.message||"Registration failed")}return await a.json()}catch(a){throw Object.keys(e.value).length===0&&(e.value={general:[a.message]}),a}finally{r.value=!1}},login:async t=>{r.value=!0,e.value={};try{await i();const a=await fetch(`${n}/api/login`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify(t)});if(!a.ok){const s=await a.json();throw s.errors?e.value=s.errors:e.value={general:[s.message||"Login failed"]},new Error(s.message||"Login failed")}const o=await a.json();return localStorage.setItem("auth_token",o.token),localStorage.setItem("auth_user",JSON.stringify(o.user)),o}catch(a){throw Object.keys(e.value).length===0&&(e.value={general:[a.message]}),a}finally{r.value=!1}},logout:async()=>{r.value=!0,e.value={};try{await i();const t=await fetch(`${n}/api/logout`,{method:"POST",headers:{Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},credentials:"include"});if(!t.ok)throw new Error("Logout failed");return await t.json()}catch(t){throw Object.keys(e.value).length===0&&(e.value={general:[t.message]}),t}finally{r.value=!1}},getUser:async()=>{r.value=!0,e.value={};try{await i();const t=await fetch(`${n}/api/user`,{method:"GET",headers:{Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},credentials:"include"});if(!t.ok)throw new Error("Failed to fetch user");return await t.json()}catch(t){throw e.value={general:[t.message]},t}finally{r.value=!1}},updateUser:async t=>{r.value=!0,e.value={};try{await i();const a=await fetch(`${n}/api/user`,{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},credentials:"include",body:JSON.stringify(t)});if(!a.ok){const s=await a.json();throw s.errors?e.value=s.errors:e.value={general:[s.message||"Update failed"]},new Error(s.message||"Update failed")}const o=await a.json();return localStorage.setItem("auth_user",JSON.stringify(o.user)),o}catch(a){throw Object.keys(e.value).length===0&&(e.value={general:[a.message]}),a}finally{r.value=!1}}}}export{p as u};
