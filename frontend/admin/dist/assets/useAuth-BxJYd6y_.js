import{r as l}from"./index-DF0FL0Im.js";const s="http://test.dennistp.beget.tech";function d(){const r=l(!1),t=l([]),n=async()=>{try{await fetch(`${s}/sanctum/csrf-cookie`,{method:"GET",credentials:"include"})}catch(e){throw console.error("CSRF token fetch error:",e),e}};return{loading:r,error:t,register:async e=>{r.value=!0,t.value=[];try{await n();const a=await fetch(`${s}/api/register`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify(e)});if(!a.ok){const o=await a.json();throw o.errors?t.value=Object.values(o.errors).flat():t.value=[o.message||"Registration failed"],new Error(o.message||"Registration failed")}return await a.json()}catch(a){throw t.value.length===0&&(t.value=[a.message]),a}finally{r.value=!1}},login:async e=>{r.value=!0,t.value=[];try{await n();const a=await fetch(`${s}/api/login`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify(e)});if(!a.ok){const i=await a.json();throw i.errors?t.value=Object.values(i.errors).flat():t.value=[i.message||"Login failed"],new Error(i.message||"Login failed")}const o=await a.json();return localStorage.setItem("auth_token",o.token),o}catch(a){throw t.value.length===0&&(t.value=[a.message]),a}finally{r.value=!1}},logout:async()=>{r.value=!0,t.value=[];try{await n();const e=await fetch(`${s}/api/logout`,{method:"POST",headers:{Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},credentials:"include"});if(!e.ok)throw new Error("Logout failed");return await e.json()}catch(e){throw t.value.length===0&&(t.value=[e.message]),e}finally{r.value=!1}},getUser:async()=>{r.value=!0,t.value=[];try{await n();const e=await fetch(`${s}/api/user`,{method:"GET",headers:{Accept:"application/json"},credentials:"include"});if(!e.ok)throw new Error("Failed to fetch user");return await e.json()}catch(e){throw t.value=[e.message],e}finally{r.value=!1}}}}export{d as u};
