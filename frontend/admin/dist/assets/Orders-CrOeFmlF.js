import{b as ie,c as ue,M as ge,a as xe,_ as he,S as pe}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-CnjVehh9.js";import{_ as ye,A as me,a as fe,C as be,b as ke}from"./MonthPicker-CsesJHMB.js";import{o as r,b as o,D as ve,d as e,m as j,k as Q,q as M,t as i,n as E,f as P,s as O,F as G,l as W,x as X,T as we,r as b,g as te,e as _e,y as $e,c as se,w as L,u as f,h as Ie,j as ae,i as Oe,J as re}from"./index-IE8B9kuR.js";import{u as oe}from"./useClickOutside-DnBanB14.js";import{_ as Se}from"./Pagination-wKBeHXfM.js";import{D as Ce}from"./DownloadIcon-D20Zvwml.js";import{S as je}from"./SearchIcon-PspH9ReE.js";import"./useAuth-EM9OFv_d.js";const Pe={},Qe={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-package-check-icon lucide-package-check"};function De(s,m){return r(),o("svg",Qe,m[0]||(m[0]=[ve('<path d="m16 16 2 2 4-4"></path><path d="M21 10V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l2-1.14"></path><path d="m7.5 4.27 9 5.15"></path><polyline points="3.29 7 12 12 20.71 7"></polyline><line x1="12" x2="12" y1="22" y2="12"></line>',5)]))}const Te=ie(Pe,[["render",De]]),Ue={class:"mb-6"},Me={class:"flex items-center justify-between mb-4"},Be={class:"grid grid-cols-1 grid-rows-[repeat(4,1fr)] xl:grid-cols-4 xl:grid-rows-none gap-4 md:gap-4 mb-4 md:mb-4"},Re={class:"h-full"},qe={class:"rounded-2xl border border-warning-200 bg-white p-5 dark:border-warning-800 dark:bg-white/[0.03] md:p-6 h-full flex flex-col"},Ae={class:"flex items-center justify-center w-12 h-12 bg-warning-100 rounded-xl dark:bg-warning-500/15"},Fe={class:"flex items-end justify-between mt-5 flex-1"},Le={class:"mt-2 font-bold text-warning-600 text-title-sm dark:text-white/90"},ze={class:"h-full"},Ee={class:"rounded-2xl border border-blue-light-200 bg-white p-5 dark:border-blue-light-800 dark:bg-white/[0.03] md:p-6 h-full flex flex-col"},Ne={class:"flex items-center justify-center w-12 h-12 bg-blue-light-100 rounded-xl dark:bg-blue-light-500/15"},Ve={class:"flex items-end justify-between mt-5 flex-1"},He={class:"mt-2 font-bold text-blue-light-600 text-title-sm dark:text-white/90"},We={class:"h-full"},Ge={class:"rounded-2xl border border-success-200 bg-white p-5 dark:border-success-800 dark:bg-white/[0.03] md:p-6 h-full flex flex-col"},Je={class:"flex items-start justify-between"},Ke={class:"flex items-center justify-center w-12 h-12 bg-success-100 rounded-xl dark:bg-success-500/15"},Xe={class:"flex items-end justify-between mt-5 flex-1"},Ye={class:"mt-2 font-bold text-success-600 text-title-sm dark:text-white/90"},Ze={class:"h-full"},et={class:"rounded-2xl border border-gray-200 bg-white p-5 dark:border-gray-800 dark:bg-white/[0.03] md:p-6 h-full flex flex-col"},tt={class:"flex items-start justify-between"},st={class:"flex items-center justify-center w-12 h-12 bg-gray-100 rounded-xl dark:bg-gray-800"},rt={class:"flex items-end justify-between mt-5 flex-1"},at={class:"mt-2 font-bold text-gray-800 text-xl dark:text-white/90"},ot={__name:"OrdersStatistics",props:{arrowUpIcon:{type:Object,required:!0},arrowDownIcon:{type:Object,required:!0},shoppingCartIcon:{type:Object,required:!0},calendarClockIcon:{type:Object,required:!0},calendarDaysIcon:{type:Object,required:!0},packageCheckIcon:{type:Object,required:!0},statistics:{type:Object,required:!0},onMonthChange:{type:Function,required:!0},selectedMonth:{type:String,required:!0}},setup(s){return(m,a)=>(r(),o("div",Ue,[e("div",Me,[a[0]||(a[0]=e("h2",{class:"text-lg font-semibold text-gray-800 dark:text-white/90"},"Статистика заказов",-1)),j(ye,{onMonthChange:s.onMonthChange,value:s.selectedMonth},null,8,["onMonthChange","value"])]),e("div",Be,[e("div",Re,[e("div",qe,[e("div",Ae,[(r(),Q(M(s.shoppingCartIcon),{class:"text-warning-600 dark:text-warning-400"}))]),e("div",Fe,[e("div",null,[a[1]||(a[1]=e("span",{class:"font-bold text-sm text-gray-500 dark:text-warning-400"}," Новые заказы ",-1)),e("h4",Le,i(s.statistics.current.pending),1)]),a[2]||(a[2]=e("span",{class:"flex items-center gap-1 rounded-full bg-gray-50 py-0.5 pl-2 pr-2.5 text-sm font-medium text-gray-600 dark:bg-gray-500/15 dark:text-gray-500"}," Всего ",-1))])])]),e("div",ze,[e("div",Ee,[e("div",Ne,[(r(),Q(M(s.calendarClockIcon),{class:"text-blue-light-600 dark:text-blue-light-400"}))]),e("div",Ve,[e("div",null,[a[3]||(a[3]=e("span",{class:"font-bold text-sm text-gray-500 dark:text-blue-light-400"}," На выполнении ",-1)),e("h4",He,i(s.statistics.current.processing),1)]),a[4]||(a[4]=e("span",{class:"flex items-center gap-1 rounded-full bg-gray-50 py-0.5 pl-2 pr-2.5 text-sm font-medium text-gray-600 dark:bg-gray-500/15 dark:text-gray-500"}," Всего ",-1))])])]),e("div",We,[e("div",Ge,[e("div",Je,[e("div",Ke,[(r(),Q(M(s.packageCheckIcon),{class:"text-success-600 dark:text-success-400"}))]),a[5]||(a[5]=e("span",{class:"flex items-center gap-1 rounded-full bg-gray-50 py-0.5 pl-2 pr-2.5 text-xs font-medium text-gray-600 dark:bg-gray-500/15 dark:text-gray-500"}," за выбранный месяц ",-1))]),e("div",Xe,[e("div",null,[a[6]||(a[6]=e("span",{class:"font-bold text-sm text-gray-500 dark:text-success-400"}," Доставлено ",-1)),e("h4",Ye,i(s.statistics.current.shipped),1)]),e("span",{class:E(["flex items-center gap-1 rounded-full py-0.5 pl-2 pr-2.5 text-xs font-medium",s.statistics.percentages.shipped>0?"bg-success-50 text-success-600 dark:bg-success-500/15 dark:text-success-500":s.statistics.percentages.shipped<0?"bg-error-50 text-error-600 dark:bg-error-500/15 dark:text-error-500":"bg-gray-50 text-gray-600 dark:bg-gray-500/15 dark:text-gray-500"])},[s.statistics.percentages.shipped!==0?(r(),Q(M(s.statistics.percentages.shipped>0?s.arrowUpIcon:s.arrowDownIcon),{key:0})):P("",!0),O(" "+i(Math.abs(s.statistics.percentages.shipped))+"% ",1)],2)])])]),e("div",Ze,[e("div",et,[e("div",tt,[e("div",st,[(r(),Q(M(s.calendarDaysIcon),{class:"text-gray-800 dark:text-white/90"}))]),a[7]||(a[7]=e("span",{class:"flex items-center gap-1 rounded-full bg-gray-50 py-0.5 pl-2 pr-2.5 text-xs font-medium text-gray-600 dark:bg-gray-500/15 dark:text-gray-500"}," за выбранный месяц ",-1))]),e("div",rt,[e("div",null,[a[8]||(a[8]=e("span",{class:"font-bold text-sm text-gray-500 dark:text-gray-400"}," Сумма выполненых заказов ",-1)),e("h4",at,i(new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB"}).format(s.statistics.current.total_amount)),1)]),e("span",{class:E(["flex items-center gap-1 rounded-full py-0.5 pl-2 pr-2.5 text-xs font-medium",s.statistics.percentages.total_amount>0?"bg-success-50 text-success-600 dark:bg-success-500/15 dark:text-success-500":s.statistics.percentages.total_amount<0?"bg-error-50 text-error-600 dark:bg-error-500/15 dark:text-error-500":"bg-gray-50 text-gray-600 dark:bg-gray-500/15 dark:text-gray-500"])},[s.statistics.percentages.total_amount!==0?(r(),Q(M(s.statistics.percentages.total_amount>0?s.arrowUpIcon:s.arrowDownIcon),{key:0})):P("",!0),O(" "+i(Math.abs(s.statistics.percentages.total_amount))+"% ",1)],2)])])])])]))}},nt={class:"flex flex-col justify-between gap-5 border-b border-gray-200 px-5 py-4 sm:flex-row sm:items-center dark:border-gray-800"},lt={class:"text-base font-medium text-gray-800 dark:text-white/90 flex flex-row items-center"},dt={class:"flex flex-col md:flex-row gap-3"},ct={__name:"OrdersHeader",props:{totalItems:{type:Number,required:!0},packageIcon:{type:Object,required:!0},downloadIcon:{type:Object,required:!0}},emits:["download"],setup(s,{emit:m}){const a=m,h=()=>{a("download")};return(p,y)=>(r(),o("div",nt,[e("h3",lt,[(r(),Q(M(s.packageIcon),{class:"menu-item-icon-active mr-2"})),O(" Список заказов ("+i(s.totalItems)+") ",1)]),e("div",dt,[e("button",{onClick:h,class:"shadow-theme-xs inline-flex items-center justify-center gap-2 rounded-lg bg-white px-4 py-3 text-sm font-medium text-gray-700 ring-1 ring-gray-300 transition hover:bg-gray-50 dark:bg-gray-800 dark:text-gray-400 dark:ring-gray-700 dark:hover:bg-white/[0.03]"},[y[0]||(y[0]=O(" Скачать ")),(r(),Q(M(s.downloadIcon)))])])]))}},it={class:"relative w-full"},ut={class:"absolute top-1/2 left-4 -translate-y-1/2 text-gray-500 dark:text-gray-400"},gt=["value"],xt={class:"relative w-full"},ht={class:"absolute top-1/2 left-4 -translate-y-1/2 text-gray-500 dark:text-gray-400"},pt=["value"],yt={__name:"OrdersSearch",props:{searchQuery:String,searchQueryPhone:String,searchIcon:Object},emits:["update:searchQuery","update:searchQueryPhone"],setup(s,{emit:m}){const a=m,h=()=>{a("update:searchQuery","")},p=()=>{a("update:searchQueryPhone","")},y=w=>{let t=w.target.value.replace(/\D/g,"");t.startsWith("7")&&(t=t.substring(1)),t.length>10&&(t=t.substring(0,10));let u="+7";t.length>0&&(u+=" ("+t.substring(0,3)),t.length>=4&&(u+=") "+t.substring(3,6)),t.length>=7&&(u+="-"+t.substring(6,8)),t.length>=9&&(u+="-"+t.substring(8,10)),a("update:searchQueryPhone",u)};return(w,t)=>(r(),o(G,null,[e("div",it,[e("span",ut,[(r(),Q(M(s.searchIcon)))]),t[1]||(t[1]=e("label",{for:"searchQuery"},null,-1)),e("input",{id:"searchQuery",type:"text",placeholder:"Поиск по номеру заказа, ФИО или почте клиента",value:s.searchQuery,onInput:t[0]||(t[0]=u=>a("update:searchQuery",u.target.value)),class:"dark:bg-dark-900 shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800 h-11 w-full rounded-lg border border-gray-300 bg-transparent py-2.5 pr-12 pl-11 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"},null,40,gt),s.searchQuery?(r(),o("button",{key:0,onClick:h,class:"absolute top-1/2 right-2 -translate-y-1/2 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 text-xl leading-none cursor-pointer bg-white dark:bg-gray-900 px-1 z-10"}," ✕ ")):P("",!0)]),e("div",xt,[e("span",ht,[(r(),Q(M(s.searchIcon)))]),t[2]||(t[2]=e("label",{for:"searchQueryPhone"},null,-1)),e("input",{id:"searchQueryPhone",type:"tel",placeholder:"+7 (___) ___-__-__",value:s.searchQueryPhone,onInput:y,class:"dark:bg-dark-900 shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800 h-11 w-full rounded-lg border border-gray-300 bg-transparent py-2.5 pr-12 pl-11 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"},null,40,pt),s.searchQueryPhone?(r(),o("button",{key:0,onClick:p,class:"absolute top-1/2 right-2 -translate-y-1/2 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 text-xl leading-none cursor-pointer bg-white dark:bg-gray-900 px-1 z-10"}," ✕ ")):P("",!0)])],64))}},mt={key:0,class:"text-gray-400"},ft={key:1,class:"text-gray-800 dark:text-white/90"},bt={key:0,class:"absolute z-10 w-full mt-1 bg-white rounded-lg shadow-sm dark:bg-gray-900"},kt={class:"overflow-y-auto divide-y divide-gray-200 custom-scrollbar max-h-60 dark:divide-gray-800",role:"listbox"},vt=["onClick","aria-selected"],wt={class:"grow"},_t={key:0,class:"w-5 h-5 text-gray-400 dark:text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},$t={__name:"OrdersStatusSelector",props:{statuses:Array,selectedItem:Object,isOpen:Boolean},emits:["toggleDropdown","toggleItem"],setup(s,{emit:m}){const a=s,h=m,p=oe(()=>{a.isOpen&&h("toggleDropdown")}),y=()=>{h("toggleDropdown")},w=u=>{h("toggleItem",u)},t=u=>u.value===null?a.selectedItem===null:a.selectedItem&&a.selectedItem.value===u.value;return(u,d)=>(r(),o("div",{class:"relative sm:min-w-[200px] sm:w-auto",ref_key:"multiSelectRef",ref:p},[e("div",{onClick:y,class:E(["dark:bg-dark-900 h-11 flex items-center w-full appearance-none rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",{"text-gray-800 dark:text-white/90":s.isOpen}])},[s.selectedItem?(r(),o("span",ft,i(s.selectedItem.label),1)):(r(),o("span",mt," Все статусы ")),(r(),o("svg",{class:E(["ml-auto",{"transform rotate-180":s.isOpen}]),width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},d[0]||(d[0]=[e("path",{d:"M4.79175 7.39551L10.0001 12.6038L15.2084 7.39551",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]),2))],2),j(we,{"enter-active-class":"transition duration-100 ease-out","enter-from-class":"transform scale-95 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-75 ease-in","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-95 opacity-0"},{default:W(()=>[s.isOpen?(r(),o("div",bt,[e("ul",kt,[(r(!0),o(G,null,X(s.statuses,_=>(r(),o("li",{key:_.id,onClick:U=>w(_),class:E(["relative flex items-center w-full px-3 py-2 border-transparent cursor-pointer first:rounded-t-lg last:rounded-b-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-800",{"bg-gray-50 dark:bg-white/[0.03]":t(_)}]),role:"option","aria-selected":t(_)},[e("span",wt,i(_.label),1),t(_)?(r(),o("svg",_t,d[1]||(d[1]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))):P("",!0)],10,vt))),128))])])):P("",!0)]),_:1})],512))}},It={class:"border-b border-gray-200 px-5 py-4 dark:border-gray-800"},Ot={class:"flex flex-col md:flex-row gap-3 sm:justify-between"},St={class:"flex flex-col md:flex-row gap-3 w-full"},Ct={__name:"OrdersFilters",props:{searchQuery:String,searchQueryPhone:String,statuses:Array,selectedItem:Object,isOpen:Boolean,showFilter:Boolean,searchIcon:Object},emits:["update:searchQuery","update:searchQueryPhone","toggleDropdown","toggleItem","update:showFilter"],setup(s,{emit:m}){const a=m;return(h,p)=>(r(),o("div",It,[e("div",Ot,[e("div",St,[j(yt,{searchQuery:s.searchQuery,searchQueryPhone:s.searchQueryPhone,searchIcon:s.searchIcon,"onUpdate:searchQuery":p[0]||(p[0]=y=>a("update:searchQuery",y)),"onUpdate:searchQueryPhone":p[1]||(p[1]=y=>a("update:searchQueryPhone",y))},null,8,["searchQuery","searchQueryPhone","searchIcon"])]),j($t,{statuses:s.statuses,selectedItem:s.selectedItem,isOpen:s.isOpen,onToggleDropdown:p[2]||(p[2]=y=>a("toggleDropdown")),onToggleItem:p[3]||(p[3]=y=>a("toggleItem",y))},null,8,["statuses","selectedItem","isOpen"])])]))}},jt={__name:"OrderDropdown",emits:["updateStatus"],setup(s,{emit:m}){const a=b(!1),h=b(null),p=m,y=()=>{a.value=!a.value},w=()=>{a.value=!1},t=u=>{p("updateStatus",u),w()};return oe(h),(u,d)=>(r(),o("div",{class:"relative",ref_key:"filterRef",ref:h,onClick:w},[e("button",{class:"bg-brand-500 shadow-theme-xs hover:bg-brand-600 inline-flex items-center justify-center gap-2 rounded-lg px-4 py-3 text-sm font-medium text-white transition",onClick:te(y,["stop"]),type:"button"}," Сменить статус "),_e(e("div",{onClick:d[5]||(d[5]=te(()=>{},["stop"])),class:"absolute right-0 z-10 mt-2 w-35 rounded-lg border border-gray-200 bg-white p-1 shadow-lg dark:border-gray-700 dark:bg-gray-800"},[e("button",{onClick:d[0]||(d[0]=_=>t("pending")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 rounded"}," Новый "),e("button",{onClick:d[1]||(d[1]=_=>t("processing")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 rounded"}," Выполнение "),e("button",{onClick:d[2]||(d[2]=_=>t("shipped")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 rounded"}," Отправлен "),e("button",{onClick:d[3]||(d[3]=_=>t("cancelled")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 rounded"}," Отменён "),e("button",{onClick:d[4]||(d[4]=_=>t("return")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 rounded"}," Возврат ")],512),[[$e,a.value]])],512))}},F="http://test.dennistp.beget.tech";function K(){const s=b([]),m=b(!1),a=b(null),h=b(1),p=b(50),y=b(0),w=se(()=>Math.ceil(y.value/p.value)),t=b(""),u=b(""),d=b(null),_=b([{id:"all",value:null,label:"Все статусы"},{id:"pending",value:"pending",label:"Новый"},{id:"processing",value:"processing",label:"Выполняется"},{id:"shipped",value:"shipped",label:"Отправлен"},{id:"return",value:"return",label:"Возврат"},{id:"cancelled",value:"cancelled",label:"Отменён"}]),U=b({sale:{true:!0,false:!0},published:{true:!0,false:!0}}),S=se(()=>{const g=w.value,l=h.value,x=2,k=[],$=[];for(let D=Math.max(2,l-x);D<=Math.min(g-1,l+x);D++)k.push(D);return l-x>2?$.push(1,"..."):$.push(1),$.push(...k),l+x<g-1?$.push("...",g):g>1&&$.push(g),$}),I=new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB"}),n=async()=>{m.value=!0,a.value=null;const g=new URLSearchParams({page:h.value.toString(),per_page:p.value.toString()});t.value.trim()&&g.append("search",t.value.trim()),u.value.trim()&&g.append("phone",u.value.trim()),d.value&&d.value.value!==null&&g.append("status",d.value.value);const l=`${F}/api/orders?${g.toString()}`;try{const x=await fetch(l,{headers:{Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!x.ok)throw new Error(`HTTP error! status: ${x.status}`);const k=await x.json();s.value=k.orders.data,y.value=k.orders.total}catch(x){a.value=x.message,console.error("Ошибка загрузки заказов:",x)}finally{m.value=!1}},c=()=>{h.value>1&&(h.value--,n())},C=()=>{h.value<w.value&&(h.value++,n())},N=g=>{h.value=g,n()},V=async g=>{try{const l=await fetch(`${F}/api/orders/${g}`,{headers:{Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);return(await l.json()).order}catch(l){throw console.error("Ошибка загрузки заказа:",l),l}},H=async(g,l)=>{try{const x=new FormData;Object.keys(l).forEach($=>{var D;typeof l[$]=="boolean"?x.append($,l[$]?"1":"0"):x.append($,((D=l[$])==null?void 0:D.toString())||"")}),x.append("_method","PUT");const k=await fetch(`${F}/api/orders/${g}`,{method:"POST",headers:{Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:x});if(k.ok)return{success:!0};if(k.status===422)return{success:!1,errors:(await k.json()).errors};throw new Error(`HTTP error! status: ${k.status}`)}catch(x){return console.error("Ошибка обновления заказа:",x),{success:!1}}},R=()=>{h.value=1};let B=null;return L(t,g=>{B&&clearTimeout(B),B=setTimeout(()=>{R(),n()},500)}),L(u,g=>{B&&clearTimeout(B),B=setTimeout(()=>{R(),n()},500)}),L(()=>U.value,()=>{R(),n()},{deep:!0}),L(d,()=>{R(),n()}),{orders:s,loading:m,error:a,page:h,itemsPerPage:p,totalItems:y,totalPages:w,searchQuery:t,searchQueryPhone:u,selectedStatus:d,statuses:_,filters:U,visiblePages:S,formatter:I,fetchOrders:n,fetchOrderStatistics:async g=>{try{const l=new URLSearchParams;g&&l.append("month",g);const x=`${F}/api/orders/statistics${l.toString()?"?"+l.toString():""}`,k=await fetch(x,{headers:{Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!k.ok)throw new Error(`HTTP error! status: ${k.status}`);return(await k.json()).statistics}catch(l){throw console.error("Ошибка загрузки статистики заказов:",l),l}},fetchOrderById:async g=>{try{const l=await fetch(`${F}/api/orders/${g}`,{headers:{Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);return{success:!0,data:(await l.json()).order}}catch(l){return console.error("Ошибка загрузки заказа:",l),{success:!1,errors:l.message}}},exportOrders:async g=>{try{const l=new URLSearchParams;g&&l.append("month",g);const x=`${F}/api/orders/export${l.toString()?"?"+l.toString():""}`,k=await fetch(x,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!k.ok)throw new Error(`HTTP error! status: ${k.status}`);const $=await k.blob(),D=window.URL.createObjectURL($),q=document.createElement("a");q.href=D,q.download="orders_export.xlsx",document.body.appendChild(q),q.click(),window.URL.revokeObjectURL(D),document.body.removeChild(q)}catch(l){throw console.error("Ошибка экспорта заказов:",l),l}},handlePrevPage:c,handleNextPage:C,handleGoToPage:N,getOrder:V,updateOrder:H,resetPage:R}}const Pt={class:"relative bg-white dark:bg-gray-800 rounded-xl shadow-lg max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto custom-scrollbar"},Qt={class:"p-6"},Dt={class:"flex justify-between items-center mb-4"},Tt={class:"text-lg font-semibold text-gray-900 dark:text-white"},Ut={key:0,class:"flex items-center space-x-4"},Mt={key:0,class:"px-2.5 py-0.5 rounded-full font-bold text-md bg-warning-50 text-warning-600 dark:bg-warning-500/15 dark:text-orange-400"},Bt={key:1,class:"px-2.5 py-0.5 rounded-full font-bold text-md bg-blue-light-50 text-blue-light-500 dark:bg-blue-light-500/15 dark:text-blue-light-500"},Rt={key:2,class:"px-2.5 py-0.5 rounded-full font-bold text-md bg-success-50 text-success-600 dark:bg-success-500/15 dark:text-success-500"},qt={key:3,class:"px-2.5 py-0.5 rounded-full font-bold text-md bg-error-50 text-error-600 dark:bg-error-500/15 dark:text-error-500"},At={key:4,class:"px-2.5 py-0.5 rounded-full font-bold text-md bg-gray-100 text-gray-700 dark:bg-white/5 dark:text-white/80"},Ft={key:0,class:"flex justify-center items-center h-64"},Lt={key:1,class:"text-center text-red-500"},zt={key:2,class:"space-y-6"},Et={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Nt={class:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg"},Vt={class:"text-sm text-gray-600 dark:text-gray-400"},Ht={class:"font-medium"},Wt={class:"text-sm text-gray-600 dark:text-gray-400"},Gt={class:"font-medium"},Jt={class:"text-sm text-gray-600 dark:text-gray-400"},Kt={key:0,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-warning-50 text-warning-600 dark:bg-warning-500/15 dark:text-orange-400"},Xt={key:1,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-blue-light-50 text-blue-light-500 dark:bg-blue-light-500/15 dark:text-blue-light-500"},Yt={key:2,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-success-50 text-success-600 dark:bg-success-500/15 dark:text-success-500"},Zt={key:3,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-error-50 text-error-600 dark:bg-error-500/15 dark:text-error-500"},es={key:4,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-gray-100 text-gray-700 dark:bg-white/5 dark:text-white/80"},ts={class:"text-sm text-gray-600 dark:text-gray-400"},ss={class:"font-medium text-error-600 dark:text-error-400"},rs={class:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg"},as={class:"text-sm text-gray-600 dark:text-gray-400"},os={class:"font-medium"},ns={class:"text-sm text-gray-600 dark:text-gray-400"},ls={class:"font-medium"},ds={class:"text-sm text-gray-600 dark:text-gray-400"},cs={class:"font-medium"},is={class:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg"},us={class:"space-y-4"},gs={class:"flex items-center space-x-4"},xs={class:"font-medium text-gray-900 dark:text-white"},hs={class:"font-medium text-gray-900 dark:text-white"},ps={class:"text-sm text-gray-600 dark:text-gray-400"},ys={key:0},ms={key:1},fs={class:"text-right"},bs={class:"font-medium text-gray-900 dark:text-white"},ks={class:"text-sm text-gray-600 dark:text-gray-400"},vs={key:0,class:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg"},ws={class:"space-y-4"},_s={class:"text-sm text-gray-600 dark:text-gray-400"},$s={class:"flex justify-end gap-3 pt-4"},Is={__name:"OrderModal",props:{isVisible:{type:Boolean,default:!1},orderId:{type:String,default:""}},emits:["close","updateStatus","statusUpdated"],setup(s,{emit:m}){const a=s,h=m,{formatter:p,fetchOrderById:y,updateOrder:w}=K(),t=b(null),u=b(!1),d=b(null),_=n=>new Date(n).toLocaleString("ru-RU"),U=()=>{h("close"),t.value=null,d.value=null},S=async n=>{if(!t.value)return;const c=await w(t.value.id,{status:n});c.success?(t.value.status=n,h("statusUpdated",t.value.id,n)):console.error("Ошибка обновления статуса:",c.errors)},I=async()=>{if(a.orderId)try{u.value=!0;const n=await y(a.orderId);n.success?t.value=n.data:d.value=n.errors||"Ошибка загрузки заказа"}catch(n){d.value="Ошибка загрузки заказа",console.error(n)}finally{u.value=!1}};return L(()=>a.isVisible,async n=>{n&&a.orderId?await I():(t.value=null,d.value=null)}),(n,c)=>s.isVisible?(r(),Q(ge,{key:0,onClose:U},{body:W(()=>[e("div",Pt,[e("div",Qt,[e("div",Dt,[e("h3",Tt," Детали заказа #"+i(t.value?t.value.order:""),1),t.value?(r(),o("div",Ut,[t.value.status==="pending"?(r(),o("span",Mt," Новый ")):t.value.status==="processing"?(r(),o("span",Bt," Выполнение ")):t.value.status==="shipped"?(r(),o("span",Rt," Отправлен ")):t.value.status==="return"?(r(),o("span",qt," Возврат ")):t.value.status==="cancelled"?(r(),o("span",At," Отменён ")):P("",!0),j(jt,{onUpdateStatus:S})])):P("",!0)]),u.value?(r(),o("div",Ft,c[0]||(c[0]=[e("div",{class:"animate-spin rounded-full h-16 w-16 border-b-2 border-brand-500"},null,-1)]))):d.value?(r(),o("div",Lt," Ошибка загрузки заказа: "+i(d.value),1)):t.value?(r(),o("div",zt,[e("div",Et,[e("div",Nt,[c[5]||(c[5]=e("h3",{class:"font-medium text-gray-900 dark:text-white mb-2"},"Информация о заказе",-1)),e("p",Vt,[c[1]||(c[1]=O("Номер заказа: ")),e("span",Ht,i(t.value.order),1)]),e("p",Wt,[c[2]||(c[2]=O("Дата создания: ")),e("span",Gt,i(_(t.value.created_at)),1)]),e("p",Jt,[c[3]||(c[3]=O("Статус: ")),t.value.status==="pending"?(r(),o("span",Kt,"Новый")):t.value.status==="processing"?(r(),o("span",Xt,"Выполнение")):t.value.status==="shipped"?(r(),o("span",Yt,"Отправлен")):t.value.status==="return"?(r(),o("span",Zt,"Возврат")):t.value.status==="cancelled"?(r(),o("span",es,"Отменён")):P("",!0)]),e("p",ts,[c[4]||(c[4]=O("Общая сумма: ")),e("span",ss,i(f(p).format(t.value.total_amount)),1)])]),e("div",rs,[c[9]||(c[9]=e("h3",{class:"font-medium text-gray-900 dark:text-white mb-2"},"Информация о клиенте",-1)),e("p",as,[c[6]||(c[6]=O("Имя: ")),e("span",os,i(t.value.name),1)]),e("p",ns,[c[7]||(c[7]=O("Email: ")),e("span",ls,i(t.value.email),1)]),e("p",ds,[c[8]||(c[8]=O("Телефон: ")),e("span",cs,i(t.value.phone),1)])])]),e("div",is,[c[10]||(c[10]=e("h3",{class:"font-medium text-gray-900 dark:text-white mb-4"},"Товары в заказе",-1)),e("div",us,[(r(!0),o(G,null,X(t.value.items,C=>(r(),o("div",{key:C.id,class:"flex items-center justify-between border-t border-gray-200 dark:border-gray-700 pt-4"},[e("div",gs,[e("p",xs,i(C.product.article),1),e("div",null,[e("p",hs,i(C.product.name),1),e("p",ps,[O("Количество: "+i(C.quantity)+" ",1),C.product_unit==="кв.м"?(r(),o("span",ys,"м²")):(r(),o("span",ms,i(C.product_unit),1))])])]),e("div",fs,[e("p",bs,i(f(p).format(C.price)),1),e("p",ks,"Итого: "+i(f(p).format(C.price*C.quantity)),1)])]))),128))])]),t.value.comment?(r(),o("div",vs,[c[11]||(c[11]=e("h3",{class:"font-medium text-gray-900 dark:text-white mb-4"},"Комментарий к заказу",-1)),e("div",ws,[e("p",_s,i(t.value.comment),1)])])):P("",!0)])):P("",!0),e("div",$s,[j(ue,{variant:"outline",onClick:U},{default:W(()=>c[12]||(c[12]=[O("Закрыть")])),_:1})])])])]),_:1})):P("",!0)}},Os={class:"p-4 border-t border-gray-100 dark:border-gray-800 sm:p-6"},Ss={class:"space-y-5"},Cs={class:"overflow-hidden rounded-xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]"},js={class:"max-w-full overflow-x-auto custom-scrollbar"},Ps={key:0,class:"flex justify-center items-center h-screen"},Qs={key:1,class:"flex flex-col justify-center items-center h-screen font-bold text-error-700 text-theme-xl dark:text-error-500"},Ds={key:2,class:"flex flex-col justify-center items-center h-screen menu-item-icon-active text-center font-bold text-theme-xl m-5"},Ts={key:3,class:"min-w-full"},Us={class:"divide-y divide-gray-200 dark:divide-gray-700"},Ms={class:"px-5 py-4 sm:px-6"},Bs=["onClick"],Rs={class:"px-5 py-4 sm:px-6"},qs={class:"text-gray-500 text-left text-theme-sm dark:text-gray-400"},As={class:"text-gray-500 text-left text-theme-sm dark:text-gray-400"},Fs={class:"px-5 py-4 sm:px-6"},Ls={"data-v-67f048e0":"",class:"block font-medium text-gray-800 text-theme-sm dark:text-white/90"},zs={"data-v-67f048e0":"",class:"block text-gray-500 text-theme-xs dark:text-gray-400"},Es={class:"px-5 py-4 sm:px-6"},Ns={class:"text-gray-500 text-left text-theme-sm dark:text-gray-400"},Vs={class:"px-5 py-4 sm:px-6"},Hs={class:"text-gray-500 text-left text-theme-sm dark:text-gray-400"},Ws={class:"px-5 py-4 sm:px-6"},Gs={class:"font-medium text-right text-gray-800 text-theme-sm dark:text-white/90"},Js={class:"px-5 py-4 sm:px-6 text-center"},Ks={key:0,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-warning-50 text-warning-600 dark:bg-warning-500/15 dark:text-orange-400"},Xs={key:1,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-blue-light-50 text-blue-light-500 dark:bg-blue-light-500/15 dark:text-blue-light-500"},Ys={key:2,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-success-50 text-success-600 dark:bg-success-500/15 dark:text-success-500"},Zs={key:3,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-error-50 text-error-600 dark:bg-error-500/15 dark:text-error-500"},er={key:4,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-gray-100 text-gray-700 dark:bg-white/5 dark:text-white/80"},tr={__name:"OrdersTable",props:{loading:Boolean,error:String,orders:Array,formatter:Object},emits:["fetchOrders","edit","updateStatus"],setup(s,{expose:m,emit:a}){const h=Ie(),p=ae(),y=a,w=b(!1),t=b(""),u=()=>{y("fetchOrders")},d=S=>{t.value=S,w.value=!0},_=()=>{w.value=!1,t.value="";const S={...p.query};delete S.openModal,h.replace({query:S})},U=(S,I)=>{y("updateStatus",{id:S},I)};return m({openOrderModal:d}),(S,I)=>(r(),o("div",Os,[e("div",Ss,[e("div",Cs,[e("div",js,[s.loading?(r(),o("div",Ps,I[0]||(I[0]=[e("div",{class:"animate-spin rounded-full h-16 w-16 border-b-2 border-brand-500"},null,-1)]))):s.error?(r(),o("div",Qs,[I[1]||(I[1]=O(" Ошибка при загрузке")),I[2]||(I[2]=e("br",null,null,-1)),e("button",{class:"inline-flex items-center justify-center font-medium gap-2 rounded-lg transition px-4 py-3 text-sm bg-brand-500 text-white shadow-theme-xs hover:bg-brand-600 disabled:bg-brand-300 mt-2",onClick:u}," Попробовать снова ")])):s.orders.length===0?(r(),o("div",Ds," Заказы не найдены ")):(r(),o("table",Ts,[I[3]||(I[3]=e("thead",null,[e("tr",{class:"border-gray-100 border-y bg-gray-50 dark:border-gray-800 dark:bg-gray-900"},[e("th",{class:"cursor-pointer px-5 py-3 text-left w-2/12 sm:px-6"},[e("div",{class:"flex items-center gap-3"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"№ Заказа")])]),e("th",{class:"cursor-pointer px-5 py-3 text-left w-1/12 sm:px-6"},[e("div",{class:"flex items-left gap-3"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Дата")])]),e("th",{class:"px-5 py-3 text-left w-3/12 sm:px-6"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Клиент")]),e("th",{class:"px-5 py-3 text-left w-2/12 sm:px-6"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Телефон")]),e("th",{class:"px-5 py-3 text-left w-1/12 sm:px-6"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Товары")]),e("th",{class:"px-5 py-3 text-right w-1/12 sm:px-6"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Сумма")]),e("th",{class:"px-5 py-3 text-center w-2/12 sm:px-6"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Статус заказа")])])],-1)),e("tbody",Us,[(r(!0),o(G,null,X(s.orders,n=>(r(),o("tr",{key:n.id,class:"border-t border-gray-100 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800"},[e("td",Ms,[e("button",{onClick:c=>d(n.order),class:"font-medium text-left text-gray-800 text-theme-sm dark:text-white/90 hover:text-brand-500 dark:hover:text-brand-400"},i(n.order),9,Bs)]),e("td",Rs,[e("p",qs,i(new Date(n.created_at).toLocaleDateString("ru-RU")),1),e("p",As,i(new Date(n.created_at).toLocaleTimeString("ru-RU")),1)]),e("td",Fs,[e("span",Ls,i(n.name),1),e("span",zs,i(n.email),1)]),e("td",Es,[e("p",Ns,i(n.phone),1)]),e("td",Vs,[e("p",Hs,i(n.items?n.items.length:0)+" товаров ",1)]),e("td",Ws,[e("p",Gs,i(s.formatter.format(n.total_amount)),1)]),e("td",Js,[n.status==="pending"?(r(),o("span",Ks," Новый ")):n.status==="processing"?(r(),o("span",Xs," Выполнение ")):n.status==="shipped"?(r(),o("span",Ys," Отправлен ")):n.status==="return"?(r(),o("span",Zs," Возврат ")):n.status==="cancelled"?(r(),o("span",er," Отменён ")):P("",!0)])]))),128))])]))])])]),j(Is,{"is-visible":w.value,"order-id":t.value,onClose:_,onStatusUpdated:U},null,8,["is-visible","order-id"])]))}},sr={class:"space-y-5 sm:space-y-6"},rr={class:"rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]"},gr={__name:"Orders",setup(s){const m=ae(),a=b("Заказы"),h=me,p=fe,y=be,w=ke,t=Te,u=pe,d=Ce,_=je,{orders:U,loading:S,error:I,page:n,totalItems:c,totalPages:C,searchQuery:N,searchQueryPhone:V,selectedStatus:H,statuses:R,formatter:B,fetchOrders:z,fetchOrderStatistics:Y,exportOrders:Z}=K(),g=b(null),l=b(!1),x=b(!1),k=b(new Date().toISOString().slice(0,7)),$=b({current:{pending:0,processing:0,shipped:0,total_amount:0},previous:{pending:0,processing:0,shipped:0,total_amount:0},percentages:{pending:0,processing:0,shipped:0,total_amount:0}}),D=()=>{x.value=!x.value},q=v=>{H.value=v.value===null?null:v,x.value=!1},ne=v=>{n.value=v,z()},le=async(v,T)=>{const{updateOrder:A}=K(),ee=await A(v.id,{status:T});ee.success?(z(),J()):console.error("Ошибка обновления статуса:",ee.errors)},de=async()=>{try{await Z(k.value)}catch(v){console.error("Ошибка экспорта:",v)}},ce=v=>{k.value=v,J()},J=async()=>{try{const v=await Y(k.value);$.value=v}catch(v){console.error("Ошибка загрузки статистики:",v)}};return Oe(async()=>{var v;await z(),J(),await re(),m.query.openModal&&((v=g.value)==null||v.openOrderModal(m.query.openModal))}),L(()=>m.query.openModal,async v=>{var T;v&&(await re(),(T=g.value)==null||T.openOrderModal(v))}),(v,T)=>(r(),Q(xe,null,{default:W(()=>[j(he,{pageTitle:a.value},null,8,["pageTitle"]),e("div",sr,[j(ot,{arrowDownIcon:f(h),arrowUpIcon:f(p),shoppingCartIcon:f(u),calendarClockIcon:f(y),calendarDaysIcon:f(w),packageCheckIcon:f(t),statistics:$.value,onMonthChange:ce,selectedMonth:k.value},null,8,["arrowDownIcon","arrowUpIcon","shoppingCartIcon","calendarClockIcon","calendarDaysIcon","packageCheckIcon","statistics","selectedMonth"]),e("div",rr,[j(ct,{totalItems:f(c),packageIcon:f(u),downloadIcon:f(d),onDownload:de},null,8,["totalItems","packageIcon","downloadIcon"]),j(Ct,{searchQuery:f(N),searchQueryPhone:f(V),statuses:f(R),selectedItem:f(H),isOpen:x.value,searchIcon:f(_),"onUpdate:searchQuery":T[0]||(T[0]=A=>N.value=A),"onUpdate:searchQueryPhone":T[1]||(T[1]=A=>V.value=A),onToggleDropdown:D,onToggleItem:q,"onUpdate:showFilter":T[2]||(T[2]=A=>l.value=A)},null,8,["searchQuery","searchQueryPhone","statuses","selectedItem","isOpen","searchIcon"]),j(tr,{ref_key:"ordersTable",ref:g,loading:f(S),error:f(I),orders:f(U),formatter:f(B),onFetchOrders:f(z),onUpdateStatus:le},null,8,["loading","error","orders","formatter","onFetchOrders"]),j(Se,{currentPage:f(n),totalPages:f(C),onPageChange:ne,class:"px-6"},null,8,["currentPage","totalPages"])])])]),_:1}))}};export{gr as default};
