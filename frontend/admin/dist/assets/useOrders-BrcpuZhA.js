import{r as o,x as $,q as P}from"./index-LY41SGDx.js";const i="http://test.dennistp.beget.tech";function _(){const y=o([]),h=o(!1),f=o(null),n=o(1),v=o(50),w=o(0),g=$(()=>Math.ceil(w.value/v.value)),d=o(""),u=o(null),b=o([{id:"all",value:null,label:"Все статусы"},{id:"pending",value:"pending",label:"Новый"},{id:"processing",value:"processing",label:"В обработке"},{id:"shipped",value:"shipped",label:"Отправлен"},{id:"return",value:"return",label:"Возврат"},{id:"cancelled",value:"cancelled",label:"Отменён"}]),T=o({sale:{true:!0,false:!0},published:{true:!0,false:!0}}),O=$(()=>{const t=g.value,e=n.value,r=2,a=[],s=[];for(let l=Math.max(2,e-r);l<=Math.min(t-1,e+r);l++)a.push(l);return e-r>2?s.push(1,"..."):s.push(1),s.push(...a),e+r<t-1?s.push("...",t):t>1&&s.push(t),s}),S=new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB"}),c=async()=>{h.value=!0,f.value=null;const t=new URLSearchParams({page:n.value.toString(),per_page:v.value.toString()});d.value.trim()&&t.append("search",d.value.trim()),u.value&&u.value.value!==null&&t.append("status",u.value.value);const e=`${i}/api/orders?${t.toString()}`;try{const r=await fetch(e);if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const a=await r.json();y.value=a.orders.data,w.value=a.orders.total}catch(r){f.value=r.message,console.error("Ошибка загрузки заказов:",r)}finally{h.value=!1}},j=()=>{n.value>1&&(n.value--,c())},E=()=>{n.value<g.value&&(n.value++,c())},H=t=>{n.value=t,c()},I=async t=>{try{const e=await fetch(`${i}/api/orders/${t}`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return(await e.json()).order}catch(e){throw console.error("Ошибка загрузки заказа:",e),e}},U=async(t,e)=>{try{const r=new FormData;Object.keys(e).forEach(s=>{var l;typeof e[s]=="boolean"?r.append(s,e[s]?"1":"0"):r.append(s,((l=e[s])==null?void 0:l.toString())||"")}),r.append("_method","PUT");const a=await fetch(`${i}/api/orders/${t}`,{method:"POST",headers:{Accept:"application/json"},body:r});if(a.ok)return{success:!0};if(a.status===422)return{success:!1,errors:(await a.json()).errors};throw new Error(`HTTP error! status: ${a.status}`)}catch(r){return console.error("Ошибка обновления заказа:",r),{success:!1}}},p=()=>{n.value=1};let m=null;return P(d,t=>{m&&clearTimeout(m),m=setTimeout(()=>{p(),c()},500)}),P(()=>T.value,()=>{p(),c()},{deep:!0}),P(u,()=>{p(),c()}),{orders:y,loading:h,error:f,page:n,itemsPerPage:v,totalItems:w,totalPages:g,searchQuery:d,selectedStatus:u,statuses:b,filters:T,visiblePages:O,formatter:S,fetchOrders:c,fetchOrderStatistics:async()=>{try{const t=await fetch(`${i}/api/orders/statistics`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return(await t.json()).statistics}catch(t){throw console.error("Ошибка загрузки статистики заказов:",t),t}},fetchOrderById:async t=>{try{const e=await fetch(`${i}/api/orders/${t}`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return{success:!0,data:(await e.json()).order}}catch(e){return console.error("Ошибка загрузки заказа:",e),{success:!1,errors:e.message}}},handlePrevPage:j,handleNextPage:E,handleGoToPage:H,getOrder:I,updateOrder:U,resetPage:p}}export{_ as u};
