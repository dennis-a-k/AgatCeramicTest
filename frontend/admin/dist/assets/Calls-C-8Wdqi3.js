import{o as r,b as n,d as e,m as $,k as B,q as P,t as h,n as N,l as Q,F as X,x as Y,f as j,T as le,s as ee,r as m,g as Z,e as ce,y as de,w as R,c as J,i as ie,u as p,h as ue}from"./index-BShJ9dlB.js";import{b as L,M as ge,a as xe,_ as he,d as pe}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-B96TFoyt.js";import{_ as me,A as be,a as fe,C as ye,b as we}from"./MonthPicker-DVWdwBbj.js";import{u as te}from"./useClickOutside-B15V2aEc.js";import{_ as ke}from"./Pagination-CIYzWLHS.js";import"./useAuth-DtldnbWj.js";const ve={},_e={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-circle-check-big-icon lucide-circle-check-big"};function $e(t,c){return r(),n("svg",_e,c[0]||(c[0]=[e("path",{d:"M21.801 10A10 10 0 1 1 17 3.335"},null,-1),e("path",{d:"m9 11 3 3L22 4"},null,-1)]))}const Ie=L(ve,[["render",$e]]),Ce={},Se={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-phone-outgoing-icon lucide-phone-outgoing"};function je(t,c){return r(),n("svg",Se,c[0]||(c[0]=[e("path",{d:"m16 8 6-6"},null,-1),e("path",{d:"M22 8V2h-6"},null,-1),e("path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384"},null,-1)]))}const Be=L(Ce,[["render",je]]),De={},Oe={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-swatch-book-icon lucide-swatch-book"};function Te(t,c){return r(),n("svg",Oe,c[0]||(c[0]=[e("path",{d:"M11 17a4 4 0 0 1-8 0V5a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2Z"},null,-1),e("path",{d:"M16.7 13H19a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H7"},null,-1),e("path",{d:"M 7 17h.01"},null,-1),e("path",{d:"m11 8 2.3-2.3a2.4 2.4 0 0 1 3.404.004L18.6 7.6a2.4 2.4 0 0 1 .026 3.434L9.9 19.8"},null,-1)]))}const Me=L(De,[["render",Te]]),Pe={},qe={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-users-round-icon lucide-users-round"};function Ae(t,c){return r(),n("svg",qe,c[0]||(c[0]=[e("path",{d:"M18 21a8 8 0 0 0-16 0"},null,-1),e("circle",{cx:"10",cy:"8",r:"5"},null,-1),e("path",{d:"M22 20c0-3.37-2-6.5-4-8a5 5 0 0 0-.45-8.3"},null,-1)]))}const Ue=L(Pe,[["render",Ae]]),Re={class:"mb-6"},Le={class:"flex items-center justify-between mb-4"},Fe={class:"grid grid-cols-4 gap-4 md:gap-4"},Ee={class:"col-span-12 xl:col-span-1"},ze={class:"flex items-center gap-5 rounded-2xl border border-warning-200 bg-warning-100 p-5 dark:border-warning-800 dark:bg-white/[0.03] md:p-6"},He={class:"inline-flex h-16 w-16 items-center justify-center rounded-xl bg-warning-200 rounded-xl dark:bg-warning-500/15"},Ve={class:"text-2xl font-semibold text-warning-600 dark:text-white/90"},Ne={class:"col-span-12 xl:col-span-1"},Qe={class:"flex items-center gap-5 rounded-2xl border border-success-200 bg-success-100 p-5 dark:border-success-800 dark:bg-white/[0.03] md:p-6"},Ge={class:"inline-flex h-16 w-16 items-center justify-center rounded-xl bg-success-200 rounded-xl dark:bg-success-500/15"},We={class:"text-2xl font-semibold text-success-600 dark:text-white/90"},Ze={class:"col-span-12 xl:col-span-1"},Je={class:"flex items-center gap-5 rounded-2xl border border-brand-200 bg-brand-100 p-5 dark:border-brand-800 dark:bg-white/[0.03] md:p-6"},Ke={class:"inline-flex h-16 w-16 items-center justify-center rounded-xl bg-brand-200 rounded-xl dark:bg-brand-500/15"},Xe={class:"text-2xl font-semibold text-brand-600 dark:text-white/90"},Ye={class:"col-span-12 xl:col-span-1"},et={class:"flex items-center gap-5 rounded-2xl border border-blue-light-200 bg-blue-light-100 p-5 dark:border-blue-light-800 dark:bg-white/[0.03] md:p-6"},tt={class:"inline-flex h-16 w-16 items-center justify-center rounded-xl bg-blue-light-200 rounded-xl dark:bg-blue-light-500/15"},st={class:"text-2xl font-semibold text-blue-light-600 dark:text-white/90"},at={__name:"CallsStatistics",props:{phoneOutgoingIcon:{type:Object,required:!0},circleCheckBigIcon:{type:Object,required:!0},usersRoundIcon:{type:Object,required:!0},swatchBookIcon:{type:Object,required:!0},statistics:{type:Object,required:!0},onMonthChange:{type:Function,required:!0}},setup(t){return(c,o)=>{var l,i;return r(),n("div",Re,[e("div",Le,[o[0]||(o[0]=e("h2",{class:"text-lg font-semibold text-gray-800 dark:text-white/90"},"Статистика звонков",-1)),$(me,{onMonthChange:t.onMonthChange},null,8,["onMonthChange"])]),e("div",Fe,[e("div",Ee,[e("div",ze,[e("div",He,[(r(),B(P(t.phoneOutgoingIcon),{class:"text-warning-600 dark:text-warning-400"}))]),e("div",null,[e("h3",Ve,h(t.statistics.current.pending||0),1),o[1]||(o[1]=e("p",{class:"flex items-center gap-3 text-sm text-gray-500 dark:text-gray-400"}," Новые заявки перезвонить ",-1))])])]),e("div",Ne,[e("div",Qe,[e("div",Ge,[(r(),B(P(t.circleCheckBigIcon),{class:"text-success-600 dark:text-success-400"}))]),e("div",null,[e("h3",We,h(t.statistics.current.processed||0),1),o[2]||(o[2]=e("p",{class:"flex items-center gap-3 text-sm text-gray-500 dark:text-gray-400"}," Завершённые звонки ",-1))])])]),e("div",Ze,[e("div",Je,[e("div",Ke,[(r(),B(P(t.swatchBookIcon),{class:"text-brand-600 dark:text-brand-400"}))]),e("div",null,[e("h3",Xe,h(((l=t.statistics.sources)==null?void 0:l.current.designer)||0),1),o[3]||(o[3]=e("p",{class:"flex items-center gap-3 text-sm text-gray-500 dark:text-gray-400"}," Дизайнеры ",-1))])])]),e("div",Ye,[e("div",et,[e("div",tt,[(r(),B(P(t.usersRoundIcon),{class:"text-blue-light-600 dark:text-blue-light-400"}))]),e("div",null,[e("h3",st,h(((i=t.statistics.sources)==null?void 0:i.current.client)||0),1),o[4]||(o[4]=e("p",{class:"flex items-center gap-3 text-sm text-gray-500 dark:text-gray-400"}," Клиенты ",-1))])])])])])}}},rt={key:0,class:"text-gray-400"},ot={key:1,class:"text-gray-800 dark:text-white/90"},nt={key:0,class:"absolute z-10 w-full mt-1 bg-white rounded-lg shadow-sm dark:bg-gray-900"},lt={class:"overflow-y-auto divide-y divide-gray-200 custom-scrollbar max-h-60 dark:divide-gray-800",role:"listbox"},ct=["onClick","aria-selected"],dt={class:"grow"},it={key:0,class:"w-5 h-5 text-gray-400 dark:text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},ut={__name:"CallsStatusSelector",props:{statuses:Array,selectedItem:Object,isOpen:Boolean},emits:["toggleDropdown","toggleItem"],setup(t,{emit:c}){const o=t,l=c,i=te(()=>{o.isOpen&&l("toggleDropdown")}),y=()=>{l("toggleDropdown")},_=d=>{l("toggleItem",d)},b=d=>d.value===null?o.selectedItem===null:o.selectedItem&&o.selectedItem.value===d.value;return(d,s)=>(r(),n("div",{class:"relative sm:min-w-[200px] sm:w-auto",ref_key:"multiSelectRef",ref:i},[e("div",{onClick:y,class:N(["dark:bg-dark-900 h-11 flex items-center w-full appearance-none rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",{"text-gray-800 dark:text-white/90":t.isOpen}])},[t.selectedItem?(r(),n("span",ot,h(t.selectedItem.label),1)):(r(),n("span",rt," Все статусы ")),(r(),n("svg",{class:N(["ml-auto",{"transform rotate-180":t.isOpen}]),width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},s[0]||(s[0]=[e("path",{d:"M4.79175 7.39551L10.0001 12.6038L15.2084 7.39551",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]),2))],2),$(le,{"enter-active-class":"transition duration-100 ease-out","enter-from-class":"transform scale-95 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-75 ease-in","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-95 opacity-0"},{default:Q(()=>[t.isOpen?(r(),n("div",nt,[e("ul",lt,[(r(!0),n(X,null,Y(t.statuses,g=>(r(),n("li",{key:g.id,onClick:f=>_(g),class:N(["relative flex items-center w-full px-3 py-2 border-transparent cursor-pointer first:rounded-t-lg last:rounded-b-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-800",{"bg-gray-50 dark:bg-white/[0.03]":b(g)}]),role:"option","aria-selected":b(g)},[e("span",dt,h(g.label),1),b(g)?(r(),n("svg",it,s[1]||(s[1]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))):j("",!0)],10,ct))),128))])])):j("",!0)]),_:1})],512))}},gt={class:"flex flex-col justify-between gap-5 border-gray-200 px-5 py-4 sm:flex-row sm:items-center dark:border-gray-800"},xt={class:"text-base font-medium text-gray-800 dark:text-white/90 flex flex-row items-center"},ht={class:"flex flex-col md:flex-row gap-3"},pt={__name:"CallsHeader",props:{totalItems:{type:Number,required:!0},packageIcon:{type:Object,required:!0},statuses:{type:Array,required:!0},selectedItem:{type:[Object,null],required:!0},isOpen:{type:Boolean,required:!0}},emits:["update:searchQuery","toggleDropdown","toggleItem","update:showFilter"],setup(t,{emit:c}){const o=c;return(l,i)=>(r(),n("div",gt,[e("h3",xt,[(r(),B(P(t.packageIcon),{class:"menu-item-icon-active mr-2"})),ee(" Список заявок ("+h(t.totalItems)+") ",1)]),e("div",ht,[$(ut,{statuses:t.statuses,selectedItem:t.selectedItem,isOpen:t.isOpen,onToggleDropdown:i[0]||(i[0]=y=>o("toggleDropdown")),onToggleItem:i[1]||(i[1]=y=>o("toggleItem",y))},null,8,["statuses","selectedItem","isOpen"])])]))}},mt={__name:"CallDropdown",emits:["updateStatus"],setup(t,{emit:c}){const o=m(!1),l=m(null),i=c,y=()=>{o.value=!o.value},_=()=>{o.value=!1},b=d=>{i("updateStatus",d),_()};return te(l),(d,s)=>(r(),n("div",{class:"relative",ref_key:"filterRef",ref:l,onClick:_},[e("button",{class:"bg-brand-500 shadow-theme-xs hover:bg-brand-600 inline-flex items-center justify-center gap-2 rounded-lg px-4 py-3 text-sm font-medium text-white transition",onClick:Z(y,["stop"]),type:"button"}," Сменить статус "),ce(e("div",{onClick:s[2]||(s[2]=Z(()=>{},["stop"])),class:"absolute right-0 z-10 mt-2 w-33 rounded-lg border border-gray-200 bg-white p-1 shadow-lg dark:border-gray-700 dark:bg-gray-800"},[e("button",{onClick:s[0]||(s[0]=g=>b("pending")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 rounded"}," Новый "),e("button",{onClick:s[1]||(s[1]=g=>b("processed")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 rounded"}," Обработан ")],512),[[de,o.value]])],512))}},bt={class:"relative bg-white dark:bg-gray-800 rounded-xl shadow-lg max-w-md w-full mx-4"},ft={class:"p-6"},yt={class:"flex justify-between items-center mb-4"},wt={key:0,class:"space-y-4"},kt={class:"mt-1 text-sm text-gray-900 dark:text-white"},vt={class:"mt-1 text-sm text-gray-900 dark:text-white"},_t={class:"mt-1 text-sm text-gray-900 dark:text-white"},$t={class:"mt-1 text-sm text-gray-900 dark:text-white"},It={class:"mt-1 text-sm text-gray-900 dark:text-white"},Ct={class:"mt-1 text-sm text-gray-900 dark:text-white"},St={key:0,class:"px-2.5 py-0.5 rounded-full font-bold text-md bg-warning-50 text-warning-600 dark:bg-warning-500/15 dark:text-orange-400"},jt={key:1,class:"px-2.5 py-0.5 rounded-full font-bold text-md bg-success-50 text-success-600 dark:bg-success-500/15 dark:text-success-500"},Bt={__name:"CallModal",props:{isVisible:{type:Boolean,default:!1},call:{type:Object,default:null}},emits:["close","updateStatus"],setup(t,{emit:c}){var b;const o=t,l=c,i=m(((b=o.call)==null?void 0:b.status)||"pending");R(()=>{var d;return(d=o.call)==null?void 0:d.status},d=>{d&&(i.value=d)});const y=()=>{l("close")},_=d=>{i.value=d,l("updateStatus",o.call,d)};return(d,s)=>t.isVisible?(r(),B(ge,{key:0,onClose:y},{body:Q(()=>[e("div",bt,[e("div",ft,[e("div",yt,[s[0]||(s[0]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white"}," Информация о заявке ",-1)),$(mt,{onUpdateStatus:_})]),t.call?(r(),n("div",wt,[e("div",null,[s[1]||(s[1]=e("label",{class:"block text-sm font-medium text-brand-700 dark:text-brand-300"},"Имя клиента",-1)),e("p",kt,h(t.call.name),1)]),e("div",null,[s[2]||(s[2]=e("label",{class:"block text-sm font-medium text-brand-700 dark:text-brand-300"},"Email",-1)),e("p",vt,h(t.call.email||"Не указан"),1)]),e("div",null,[s[3]||(s[3]=e("label",{class:"block text-sm font-medium text-brand-700 dark:text-brand-300"},"Телефон",-1)),e("p",_t,h(t.call.phone),1)]),e("div",null,[s[4]||(s[4]=e("label",{class:"block text-sm font-medium text-brand-700 dark:text-brand-300"},"Источник",-1)),e("p",$t,h(t.call.source==="client"?"Клиент":"Дизанер"),1)]),e("div",null,[s[5]||(s[5]=e("label",{class:"block text-sm font-medium text-brand-700 dark:text-brand-300"},"Комментарий",-1)),e("p",It,h(t.call.comment||"Нет комментария"),1)]),e("div",null,[s[6]||(s[6]=e("label",{class:"block text-sm font-medium text-brand-700 dark:text-brand-300"},"Дата создания",-1)),e("p",Ct,h(new Date(t.call.created_at).toLocaleDateString("ru-RU"))+" "+h(new Date(t.call.created_at).toLocaleTimeString("ru-RU")),1)]),e("div",null,[s[7]||(s[7]=e("label",{class:"block text-sm font-medium text-brand-700 dark:text-brand-300 mb-2"},"Статус",-1)),i.value==="pending"?(r(),n("span",St," Новый ")):i.value==="processed"?(r(),n("span",jt," Обработан ")):j("",!0)])])):j("",!0)])])]),_:1})):j("",!0)}},Dt={class:"p-4 border-t border-gray-100 dark:border-gray-800 sm:p-6"},Ot={class:"space-y-5"},Tt={class:"overflow-hidden rounded-xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]"},Mt={class:"max-w-full overflow-x-auto custom-scrollbar"},Pt={key:0,class:"flex justify-center items-center h-screen"},qt={key:1,class:"flex flex-col justify-center items-center h-screen font-bold text-error-700 text-theme-xl dark:text-error-500"},At={key:2,class:"flex flex-col justify-center items-center h-screen menu-item-icon-active text-center font-bold text-theme-xl m-5"},Ut={key:3,class:"min-w-full"},Rt={class:"divide-y divide-gray-200 dark:divide-gray-700"},Lt={class:"px-5 py-4 sm:px-6"},Ft={class:"text-gray-500 text-left text-theme-sm dark:text-gray-400"},Et={class:"text-gray-500 text-left text-theme-sm dark:text-gray-400"},zt=["onClick"],Ht={class:"block font-medium text-gray-800 text-theme-sm dark:text-white/90"},Vt={key:0,class:"block text-gray-500 text-theme-xs dark:text-gray-400"},Nt={class:"px-5 py-4 sm:px-6"},Qt={class:"text-gray-500 text-left text-theme-sm dark:text-gray-400"},Gt={class:"px-5 py-4 sm:px-6"},Wt={key:0,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-blue-light-50 text-blue-light-500 dark:bg-blue-light-500/15 dark:text-blue-light-500"},Zt={key:1,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-brand-50 text-brand-500 dark:bg-brand-500/15 dark:text-brand-500"},Jt={class:"px-5 py-4 sm:px-6"},Kt={class:"text-gray-500 text-left text-theme-sm dark:text-gray-400"},Xt={class:"px-5 py-4 sm:px-6 text-center"},Yt={key:0,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-warning-50 text-warning-600 dark:bg-warning-500/15 dark:text-orange-400"},es={key:1,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-success-50 text-success-600 dark:bg-success-500/15 dark:text-success-500"},ts={__name:"CallsTable",props:{loading:Boolean,error:String,calls:Array,formatter:Object},emits:["fetchCalls","edit","updateStatus"],setup(t,{emit:c}){const o=c,l=m(!1),i=m(null),y=()=>{o("fetchCalls")},_=(s,g)=>{o("updateStatus",s,g)},b=s=>{i.value=s,l.value=!0},d=()=>{l.value=!1,i.value=null};return(s,g)=>(r(),n("div",Dt,[e("div",Ot,[e("div",Tt,[e("div",Mt,[t.loading?(r(),n("div",Pt,g[0]||(g[0]=[e("div",{class:"animate-spin rounded-full h-16 w-16 border-b-2 border-brand-500"},null,-1)]))):t.error?(r(),n("div",qt,[g[1]||(g[1]=ee(" Ошибка при загрузке")),g[2]||(g[2]=e("br",null,null,-1)),e("button",{class:"inline-flex items-center justify-center font-medium gap-2 rounded-lg transition px-4 py-3 text-sm bg-brand-500 text-white shadow-theme-xs hover:bg-brand-600 disabled:bg-brand-300 mt-2",onClick:y}," Попробовать снова ")])):t.calls.length===0?(r(),n("div",At," Заявок на звонок не найдено ")):(r(),n("table",Ut,[g[3]||(g[3]=e("thead",null,[e("tr",{class:"border-gray-100 border-y bg-gray-50 dark:border-gray-800 dark:bg-gray-900"},[e("th",{class:"cursor-pointer px-5 py-3 text-left w-1/12 sm:px-6"},[e("div",{class:"flex items-left gap-3"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Дата")])]),e("th",{class:"px-5 py-3 text-left w-3/12 sm:px-6"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Клиент")]),e("th",{class:"px-5 py-3 text-left w-2/12 sm:px-6"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Телефон")]),e("th",{class:"px-5 py-3 text-left w-1/12 sm:px-6"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Источник")]),e("th",{class:"px-5 py-3 text-left w-3/12 sm:px-6"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Комментарий")]),e("th",{class:"px-5 py-3 text-center w-2/12 sm:px-6",colspan:"2"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Статус")])])],-1)),e("tbody",Rt,[(r(!0),n(X,null,Y(t.calls,f=>(r(),n("tr",{key:f.id,class:"border-t border-gray-100 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800"},[e("td",Lt,[e("p",Ft,h(new Date(f.created_at).toLocaleDateString("ru-RU")),1),e("p",Et,h(new Date(f.created_at).toLocaleTimeString("ru-RU")),1)]),e("td",{class:"px-5 py-4 sm:px-6 cursor-pointer hover:text-brand-500",onClick:q=>b(f)},[e("span",Ht,h(f.name),1),f.email?(r(),n("span",Vt,h(f.email),1)):j("",!0)],8,zt),e("td",Nt,[e("p",Qt,h(f.phone),1)]),e("td",Gt,[f.source==="client"?(r(),n("span",Wt," Клиент ")):f.source==="designer"?(r(),n("span",Zt," Дизанер ")):j("",!0)]),e("td",Jt,[e("p",Kt,h(f.comment||"Нет комментария"),1)]),e("td",Xt,[f.status==="pending"?(r(),n("span",Yt," Новый ")):f.status==="processed"?(r(),n("span",es," Обработан ")):j("",!0)])]))),128))])]))])])]),$(Bt,{"is-visible":l.value,call:i.value,onClose:d,onUpdateStatus:_},null,8,["is-visible","call"])]))}},M="http://test.dennistp.beget.tech";function K(){const t=m([]),c=m(!1),o=m(null),l=m(1),i=m(50),y=m(0),_=J(()=>Math.ceil(y.value/i.value)),b=m(""),d=m(null),s=m([{id:"all",value:null,label:"Все статусы"},{id:"pending",value:"pending",label:"Новый"},{id:"processed",value:"processed",label:"Обработан"}]),g=m({sale:{true:!0,false:!0},published:{true:!0,false:!0}}),f=J(()=>{const x=_.value,a=l.value,u=2,w=[],k=[];for(let C=Math.max(2,a-u);C<=Math.min(x-1,a+u);C++)w.push(C);return a-u>2?k.push(1,"..."):k.push(1),k.push(...w),a+u<x-1?k.push("...",x):x>1&&k.push(x),k}),q=new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB"}),I=async()=>{c.value=!0,o.value=null;const x=new URLSearchParams({page:l.value.toString(),per_page:i.value.toString()});b.value.trim()&&x.append("search",b.value.trim()),d.value&&d.value.value!==null&&x.append("status",d.value.value);const a=`${M}/api/call-requests?${x.toString()}`;try{const u=await fetch(a,{headers:{Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!u.ok)throw new Error(`HTTP error! status: ${u.status}`);const w=await u.json();t.value=w.call_requests.data,y.value=w.call_requests.total}catch(u){o.value=u.message,console.error("Ошибка загрузки заявок на звонок:",u)}finally{c.value=!1}},F=()=>{l.value>1&&(l.value--,I())},A=()=>{l.value<_.value&&(l.value++,I())},E=x=>{l.value=x,I()},z=async x=>{try{const a=await fetch(`${M}/api/call-requests/${x}`,{headers:{Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);return(await a.json()).call_request}catch(a){throw console.error("Ошибка загрузки заявки на звонок:",a),a}},U=async(x,a)=>{try{const u=new FormData;Object.keys(a).forEach(k=>{var C;typeof a[k]=="boolean"?u.append(k,a[k]?"1":"0"):u.append(k,((C=a[k])==null?void 0:C.toString())||"")}),u.append("_method","PUT");const w=await fetch(`${M}/api/call-requests/${x}`,{method:"POST",headers:{Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:u});if(w.ok)return{success:!0};if(w.status===422)return{success:!1,errors:(await w.json()).errors};throw new Error(`HTTP error! status: ${w.status}`)}catch(u){return console.error("Ошибка обновления заявки на звонок:",u),{success:!1}}},D=()=>{l.value=1};let O=null;return R(b,x=>{O&&clearTimeout(O),O=setTimeout(()=>{D(),I()},500)}),R(()=>g.value,()=>{D(),I()},{deep:!0}),R(d,()=>{D(),I()}),{calls:t,loading:c,error:o,page:l,itemsPerPage:i,totalItems:y,totalPages:_,searchQuery:b,selectedStatus:d,statuses:s,filters:g,visiblePages:f,formatter:q,fetchCalls:I,fetchCallStatistics:async x=>{try{const a=new URLSearchParams;x&&a.append("month",x);const u=`${M}/api/call-requests/statistics${a.toString()?"?"+a.toString():""}`,w=await fetch(u,{headers:{Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!w.ok)throw new Error(`HTTP error! status: ${w.status}`);return(await w.json()).statistics}catch(a){throw console.error("Ошибка загрузки статистики заявок на звонок:",a),a}},fetchCallById:async x=>{try{const a=await fetch(`${M}/api/call-requests/${x}`,{headers:{Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);return{success:!0,data:(await a.json()).call_request}}catch(a){return console.error("Ошибка загрузки заявки на звонок:",a),{success:!1,errors:a.message}}},handlePrevPage:F,handleNextPage:A,handleGoToPage:E,getCall:z,updateCall:U,resetPage:D}}const ss={class:"space-y-5 sm:space-y-6"},as={class:"rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]"},is={__name:"Calls",setup(t){const c=ue(),o=m("Обратные звонки"),l=be,i=fe,y=ye,_=we,b=Ie,d=pe,s=Be,g=Ue,f=Me,{calls:q,loading:I,error:F,page:A,totalItems:E,totalPages:z,selectedStatus:U,statuses:D,formatter:O,fetchCalls:T,fetchCallStatistics:G,deleteCall:x}=K(),a=m(!1),u=m({current:{pending:0,processed:0,completed:0,cancelled:0},previous:{pending:0,processed:0,completed:0,cancelled:0},percentages:{pending:0,processed:0,completed:0,cancelled:0}}),w=()=>{a.value=!a.value},k=v=>{U.value=v.value===null?null:v,a.value=!1},C=v=>{c.push(`/calls/edit/${v.id}`)},se=async(v,S)=>{const V=await x(v.id);S(V)},ae=v=>{A.value=v,T()},re=async(v,S)=>{const{updateCall:V}=K(),W=await V(v.id,{status:S});W.success?(T(),H()):console.error("Ошибка обновления статуса:",W.errors)},oe=m(new Date().toISOString().slice(0,7)),H=async v=>{try{const S=await G(v);u.value=S}catch(S){console.error("Ошибка загрузки статистики:",S)}},ne=v=>{oe.value=v,H(v)};return ie(()=>{T(),H()}),(v,S)=>(r(),B(xe,null,{default:Q(()=>[$(he,{pageTitle:o.value},null,8,["pageTitle"]),e("div",ss,[$(at,{arrowDownIcon:p(l),arrowUpIcon:p(i),phoneOutgoingIcon:p(s),calendarClockIcon:p(y),calendarDaysIcon:p(_),circleCheckBigIcon:p(b),swatchBookIcon:p(f),usersRoundIcon:p(g),statistics:u.value,onMonthChange:ne},null,8,["arrowDownIcon","arrowUpIcon","phoneOutgoingIcon","calendarClockIcon","calendarDaysIcon","circleCheckBigIcon","swatchBookIcon","usersRoundIcon","statistics"]),e("div",as,[$(pt,{totalItems:p(E),packageIcon:p(d),statuses:p(D),selectedItem:p(U),isOpen:a.value,onToggleDropdown:w,onToggleItem:k},null,8,["totalItems","packageIcon","statuses","selectedItem","isOpen"]),$(ts,{loading:p(I),error:p(F),calls:p(q),formatter:p(O),onFetchCalls:p(T),onEdit:C,onDelete:se,onUpdateStatus:re},null,8,["loading","error","calls","formatter","onFetchCalls"]),$(ke,{currentPage:p(A),totalPages:p(z),onPageChange:ae,class:"px-6"},null,8,["currentPage","totalPages"])])])]),_:1}))}};export{is as default};
