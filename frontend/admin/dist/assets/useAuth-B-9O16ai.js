import{r as i}from"./index-CHjVjrhW.js";const n="http://test.dennistp.beget.tech";function y(){const s=i(!1),a=i({}),l=async()=>{try{await fetch(`${n}/sanctum/csrf-cookie`,{method:"GET",credentials:"include"})}catch(t){throw console.error("CSRF token fetch error:",t),t}};return{loading:s,error:a,register:async t=>{s.value=!0,a.value={};try{await l();const e=await fetch(`${n}/api/register`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify(t)});if(!e.ok){const r=await e.json();throw r.errors?a.value=r.errors:a.value={general:[r.message||"Registration failed"]},new Error(r.message||"Registration failed")}return await e.json()}catch(e){throw Object.keys(a.value).length===0&&(a.value={general:[e.message]}),e}finally{s.value=!1}},login:async t=>{s.value=!0,a.value={};try{await l();const e=await fetch(`${n}/api/login`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify(t)});if(!e.ok){const o=await e.json();throw o.errors?a.value=o.errors:a.value={general:[o.message||"Login failed"]},new Error(o.message||"Login failed")}const r=await e.json();return localStorage.setItem("auth_token",r.token),localStorage.setItem("auth_user",JSON.stringify(r.user)),r}catch(e){throw Object.keys(a.value).length===0&&(a.value={general:[e.message]}),e}finally{s.value=!1}},logout:async()=>{s.value=!0,a.value={};try{await l();const t=await fetch(`${n}/api/logout`,{method:"POST",headers:{Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},credentials:"include"});if(!t.ok)throw new Error("Logout failed");return await t.json()}catch(t){throw Object.keys(a.value).length===0&&(a.value={general:[t.message]}),t}finally{s.value=!1}},getUser:async()=>{s.value=!0,a.value={};try{await l();const t=await fetch(`${n}/api/user`,{method:"GET",headers:{Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},credentials:"include"});if(!t.ok)throw new Error("Failed to fetch user");return await t.json()}catch(t){throw a.value={general:[t.message]},t}finally{s.value=!1}},updateUser:async t=>{s.value=!0,a.value={};try{await l();const e=await fetch(`${n}/api/user`,{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},credentials:"include",body:JSON.stringify(t)});if(!e.ok){const o=await e.json();throw o.errors?a.value=o.errors:a.value={general:[o.message||"Update failed"]},new Error(o.message||"Update failed")}const r=await e.json();return localStorage.setItem("auth_user",JSON.stringify(r.user)),r}catch(e){throw Object.keys(a.value).length===0&&(a.value={general:[e.message]}),e}finally{s.value=!1}},forgotPassword:async t=>{s.value=!0,a.value={};try{await l();const e=await fetch(`${n}/api/forgot-password`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify({email:t})});if(!e.ok){const r=await e.json();throw r.errors?a.value=r.errors:a.value={general:[r.message||"Failed to send reset email"]},new Error(r.message||"Failed to send reset email")}return await e.json()}catch(e){throw Object.keys(a.value).length===0&&(a.value={general:[e.message]}),e}finally{s.value=!1}},resetPassword:async t=>{s.value=!0,a.value={};try{await l();const e=await fetch(`${n}/api/reset-password`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify(t)});if(!e.ok){const r=await e.json();throw r.errors?a.value=r.errors:a.value={general:[r.message||"Failed to reset password"]},new Error(r.message||"Failed to reset password")}return await e.json()}catch(e){throw Object.keys(a.value).length===0&&(a.value={general:[e.message]}),e}finally{s.value=!1}}}}export{y as u};
