import{o as s,b as l,d as e,r as m,c as Q,x as te,p as G,t as p,e as se,A as de,F,q as A,u as f,n as H,f as S,k as I,i as O,m as V,j as W,T as ie,g as X,s as ue,w as L,h as ge}from"./index-aP64LZ8f.js";import{b as E,M as he,a as xe,_ as pe,d as me}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-CbEAsTxe.js";import{u as re}from"./useClickOutside-CNet2m2a.js";import{_ as be}from"./Pagination-DSpoK4vX.js";import{A as fe,a as ye,C as ke,b as we}from"./CalendarDaysIcon-DnmvPY-l.js";import"./useAuth-NZpxEmCP.js";const ve={},_e={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-circle-check-big-icon lucide-circle-check-big"};function $e(t,d){return s(),l("svg",_e,d[0]||(d[0]=[e("path",{d:"M21.801 10A10 10 0 1 1 17 3.335"},null,-1),e("path",{d:"m9 11 3 3L22 4"},null,-1)]))}const Ce=E(ve,[["render",$e]]),Ie={},Se={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-phone-outgoing-icon lucide-phone-outgoing"};function Me(t,d){return s(),l("svg",Se,d[0]||(d[0]=[e("path",{d:"m16 8 6-6"},null,-1),e("path",{d:"M22 8V2h-6"},null,-1),e("path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384"},null,-1)]))}const je=E(Ie,[["render",Me]]),De={},Oe={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-swatch-book-icon lucide-swatch-book"};function Pe(t,d){return s(),l("svg",Oe,d[0]||(d[0]=[e("path",{d:"M11 17a4 4 0 0 1-8 0V5a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2Z"},null,-1),e("path",{d:"M16.7 13H19a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H7"},null,-1),e("path",{d:"M 7 17h.01"},null,-1),e("path",{d:"m11 8 2.3-2.3a2.4 2.4 0 0 1 3.404.004L18.6 7.6a2.4 2.4 0 0 1 .026 3.434L9.9 19.8"},null,-1)]))}const Te=E(De,[["render",Pe]]),Be={},qe={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-users-round-icon lucide-users-round"};function Ue(t,d){return s(),l("svg",qe,d[0]||(d[0]=[e("path",{d:"M18 21a8 8 0 0 0-16 0"},null,-1),e("circle",{cx:"10",cy:"8",r:"5"},null,-1),e("path",{d:"M22 20c0-3.37-2-6.5-4-8a5 5 0 0 0-.45-8.3"},null,-1)]))}const Ve=E(Be,[["render",Ue]]),Re={class:"relative"},He={key:0,class:"absolute z-10 mt-1 right-0 w-80 bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-700 rounded-lg shadow-lg p-4"},Le={class:"mb-4"},Fe=["value"],Ae={class:"grid grid-cols-3 gap-2"},Ee=["onClick"],Ne={__name:"MonthPicker",props:{onMonthChange:{type:Function,required:!0}},setup(t){const d=t,r=m(!1),n=m(new Date().getMonth()),c=m(new Date().getFullYear()),y=["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],w=Array.from({length:6},(u,C)=>new Date().getFullYear()-2+C),b=Q(()=>`${y[n.value]} ${c.value}`),i=()=>{r.value=!r.value},a=u=>{n.value=u,r.value=!1;const C=String(u+1).padStart(2,"0");d.onMonthChange(`${c.value}-${C}`)},g=()=>{const u=String(n.value+1).padStart(2,"0");d.onMonthChange(`${c.value}-${u}`)};return te(()=>{const u=new Date().getMonth();n.value=u}),(u,C)=>(s(),l("div",Re,[e("button",{onClick:i,class:"dark:bg-dark-900 h-11 w-full appearance-none rounded-lg border border-gray-300 bg-transparent bg-none px-4 pl-4 pr-4 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800 flex items-center justify-between"},[G(p(b.value)+" ",1),C[1]||(C[1]=e("span",{class:"text-gray-500 dark:text-gray-400 ml-2"},[e("svg",{class:"fill-current",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M6.66659 1.5415C7.0808 1.5415 7.41658 1.87729 7.41658 2.2915V2.99984H12.5833V2.2915C12.5833 1.87729 12.919 1.5415 13.3333 1.5415C13.7475 1.5415 14.0833 1.87729 14.0833 2.2915V2.99984L15.4166 2.99984C16.5212 2.99984 17.4166 3.89527 17.4166 4.99984V7.49984V15.8332C17.4166 16.9377 16.5212 17.8332 15.4166 17.8332H4.58325C3.47868 17.8332 2.58325 16.9377 2.58325 15.8332V7.49984V4.99984C2.58325 3.89527 3.47868 2.99984 4.58325 2.99984L5.91659 2.99984V2.2915C5.91659 1.87729 6.25237 1.5415 6.66659 1.5415ZM6.66659 4.49984H4.58325C4.30711 4.49984 4.08325 4.7237 4.08325 4.99984V6.74984H15.9166V4.99984C15.9166 4.7237 15.6927 4.49984 15.4166 4.49984H13.3333H6.66659ZM15.9166 8.24984H4.08325V15.8332C4.08325 16.1093 4.30711 16.3332 4.58325 16.3332H15.4166C15.6927 16.3332 15.9166 16.1093 15.9166 15.8332V8.24984Z",fill:""})])],-1))]),r.value?(s(),l("div",He,[e("div",Le,[C[2]||(C[2]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",for:"selectedYear"},"Год",-1)),se(e("select",{id:"selectedYear","onUpdate:modelValue":C[0]||(C[0]=k=>c.value=k),onChange:g,class:"dark:bg-dark-900 h-11 flex items-center w-full appearance-none rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},[(s(!0),l(F,null,A(f(w),k=>(s(),l("option",{key:k,value:k},p(k),9,Fe))),128))],544),[[de,c.value]])]),e("div",Ae,[(s(),l(F,null,A(y,(k,D)=>e("button",{key:D,onClick:T=>a(D),class:H(["p-2 text-sm rounded hover:bg-gray-100 dark:hover:bg-gray-800",n.value===D?"bg-brand-100 dark:bg-brand-800 text-brand-600 dark:text-brand-400":"text-gray-700 dark:text-gray-300"])},p(k),11,Ee)),64))])])):S("",!0)]))}},Ye={class:"mb-6"},ze={class:"flex items-center justify-between mb-4"},Ze={class:"grid grid-cols-4 gap-4 md:gap-4"},Qe={class:"col-span-12 xl:col-span-1"},Ge={class:"flex items-center gap-5 rounded-2xl border border-warning-200 bg-warning-100 p-5 dark:border-warning-800 dark:bg-white/[0.03] md:p-6"},We={class:"inline-flex h-16 w-16 items-center justify-center rounded-xl bg-warning-200 rounded-xl dark:bg-warning-500/15"},Je={class:"text-2xl font-semibold text-warning-600 dark:text-white/90"},Ke={class:"col-span-12 xl:col-span-1"},Xe={class:"flex items-center gap-5 rounded-2xl border border-success-200 bg-success-100 p-5 dark:border-success-800 dark:bg-white/[0.03] md:p-6"},et={class:"inline-flex h-16 w-16 items-center justify-center rounded-xl bg-success-200 rounded-xl dark:bg-success-500/15"},tt={class:"text-2xl font-semibold text-success-600 dark:text-white/90"},st={class:"col-span-12 xl:col-span-1"},rt={class:"flex items-center gap-5 rounded-2xl border border-brand-200 bg-brand-100 p-5 dark:border-brand-800 dark:bg-white/[0.03] md:p-6"},at={class:"inline-flex h-16 w-16 items-center justify-center rounded-xl bg-brand-200 rounded-xl dark:bg-brand-500/15"},ot={class:"text-2xl font-semibold text-brand-600 dark:text-white/90"},nt={class:"col-span-12 xl:col-span-1"},lt={class:"flex items-center gap-5 rounded-2xl border border-blue-light-200 bg-blue-light-100 p-5 dark:border-blue-light-800 dark:bg-white/[0.03] md:p-6"},ct={class:"inline-flex h-16 w-16 items-center justify-center rounded-xl bg-blue-light-200 rounded-xl dark:bg-blue-light-500/15"},dt={class:"text-2xl font-semibold text-blue-light-600 dark:text-white/90"},it={__name:"CallsStatistics",props:{phoneOutgoingIcon:{type:Object,required:!0},circleCheckBigIcon:{type:Object,required:!0},usersRoundIcon:{type:Object,required:!0},swatchBookIcon:{type:Object,required:!0},statistics:{type:Object,required:!0},onMonthChange:{type:Function,required:!0}},setup(t){return(d,r)=>{var n,c;return s(),l("div",Ye,[e("div",ze,[r[0]||(r[0]=e("h2",{class:"text-lg font-semibold text-gray-800 dark:text-white/90"},"Статистика звонков",-1)),I(Ne,{onMonthChange:t.onMonthChange},null,8,["onMonthChange"])]),e("div",Ze,[e("div",Qe,[e("div",Ge,[e("div",We,[(s(),O(V(t.phoneOutgoingIcon),{class:"text-warning-600 dark:text-warning-400"}))]),e("div",null,[e("h3",Je,p(t.statistics.current.pending||0),1),r[1]||(r[1]=e("p",{class:"flex items-center gap-3 text-sm text-gray-500 dark:text-gray-400"}," Новые заявки перезвонить ",-1))])])]),e("div",Ke,[e("div",Xe,[e("div",et,[(s(),O(V(t.circleCheckBigIcon),{class:"text-success-600 dark:text-success-400"}))]),e("div",null,[e("h3",tt,p(t.statistics.current.processed||0),1),r[2]||(r[2]=e("p",{class:"flex items-center gap-3 text-sm text-gray-500 dark:text-gray-400"}," Завершённые звонки ",-1))])])]),e("div",st,[e("div",rt,[e("div",at,[(s(),O(V(t.swatchBookIcon),{class:"text-brand-600 dark:text-brand-400"}))]),e("div",null,[e("h3",ot,p(((n=t.statistics.sources)==null?void 0:n.current.designer)||0),1),r[3]||(r[3]=e("p",{class:"flex items-center gap-3 text-sm text-gray-500 dark:text-gray-400"}," Дизайнеры ",-1))])])]),e("div",nt,[e("div",lt,[e("div",ct,[(s(),O(V(t.usersRoundIcon),{class:"text-blue-light-600 dark:text-blue-light-400"}))]),e("div",null,[e("h3",dt,p(((c=t.statistics.sources)==null?void 0:c.current.client)||0),1),r[4]||(r[4]=e("p",{class:"flex items-center gap-3 text-sm text-gray-500 dark:text-gray-400"}," Клиенты ",-1))])])])])])}}},ut={key:0,class:"text-gray-400"},gt={key:1,class:"text-gray-800 dark:text-white/90"},ht={key:0,class:"absolute z-10 w-full mt-1 bg-white rounded-lg shadow-sm dark:bg-gray-900"},xt={class:"overflow-y-auto divide-y divide-gray-200 custom-scrollbar max-h-60 dark:divide-gray-800",role:"listbox"},pt=["onClick","aria-selected"],mt={class:"grow"},bt={key:0,class:"w-5 h-5 text-gray-400 dark:text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},ft={__name:"CallsStatusSelector",props:{statuses:Array,selectedItem:Object,isOpen:Boolean},emits:["toggleDropdown","toggleItem"],setup(t,{emit:d}){const r=t,n=d,c=re(()=>{r.isOpen&&n("toggleDropdown")}),y=()=>{n("toggleDropdown")},w=i=>{n("toggleItem",i)},b=i=>i.value===null?r.selectedItem===null:r.selectedItem&&r.selectedItem.value===i.value;return(i,a)=>(s(),l("div",{class:"relative sm:min-w-[200px] sm:w-auto",ref_key:"multiSelectRef",ref:c},[e("div",{onClick:y,class:H(["dark:bg-dark-900 h-11 flex items-center w-full appearance-none rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",{"text-gray-800 dark:text-white/90":t.isOpen}])},[t.selectedItem?(s(),l("span",gt,p(t.selectedItem.label),1)):(s(),l("span",ut," Все статусы ")),(s(),l("svg",{class:H(["ml-auto",{"transform rotate-180":t.isOpen}]),width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},a[0]||(a[0]=[e("path",{d:"M4.79175 7.39551L10.0001 12.6038L15.2084 7.39551",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]),2))],2),I(ie,{"enter-active-class":"transition duration-100 ease-out","enter-from-class":"transform scale-95 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-75 ease-in","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-95 opacity-0"},{default:W(()=>[t.isOpen?(s(),l("div",ht,[e("ul",xt,[(s(!0),l(F,null,A(t.statuses,g=>(s(),l("li",{key:g.id,onClick:u=>w(g),class:H(["relative flex items-center w-full px-3 py-2 border-transparent cursor-pointer first:rounded-t-lg last:rounded-b-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-800",{"bg-gray-50 dark:bg-white/[0.03]":b(g)}]),role:"option","aria-selected":b(g)},[e("span",mt,p(g.label),1),b(g)?(s(),l("svg",bt,a[1]||(a[1]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))):S("",!0)],10,pt))),128))])])):S("",!0)]),_:1})],512))}},yt={class:"flex flex-col justify-between gap-5 border-gray-200 px-5 py-4 sm:flex-row sm:items-center dark:border-gray-800"},kt={class:"text-base font-medium text-gray-800 dark:text-white/90 flex flex-row items-center"},wt={class:"flex flex-col md:flex-row gap-3"},vt={__name:"CallsHeader",props:{totalItems:{type:Number,required:!0},packageIcon:{type:Object,required:!0},statuses:{type:Array,required:!0},selectedItem:{type:[Object,null],required:!0},isOpen:{type:Boolean,required:!0}},emits:["update:searchQuery","toggleDropdown","toggleItem","update:showFilter"],setup(t,{emit:d}){const r=d;return(n,c)=>(s(),l("div",yt,[e("h3",kt,[(s(),O(V(t.packageIcon),{class:"menu-item-icon-active mr-2"})),G(" Список заявок ("+p(t.totalItems)+") ",1)]),e("div",wt,[I(ft,{statuses:t.statuses,selectedItem:t.selectedItem,isOpen:t.isOpen,onToggleDropdown:c[0]||(c[0]=y=>r("toggleDropdown")),onToggleItem:c[1]||(c[1]=y=>r("toggleItem",y))},null,8,["statuses","selectedItem","isOpen"])])]))}},_t={__name:"CallDropdown",emits:["updateStatus"],setup(t,{emit:d}){const r=m(!1),n=m(null),c=d,y=()=>{r.value=!r.value},w=()=>{r.value=!1},b=i=>{c("updateStatus",i),w()};return re(n),(i,a)=>(s(),l("div",{class:"relative",ref_key:"filterRef",ref:n,onClick:w},[e("button",{class:"bg-brand-500 shadow-theme-xs hover:bg-brand-600 inline-flex items-center justify-center gap-2 rounded-lg px-4 py-3 text-sm font-medium text-white transition",onClick:X(y,["stop"]),type:"button"}," Сменить статус "),se(e("div",{onClick:a[2]||(a[2]=X(()=>{},["stop"])),class:"absolute right-0 z-10 mt-2 w-33 rounded-lg border border-gray-200 bg-white p-1 shadow-lg dark:border-gray-700 dark:bg-gray-800"},[e("button",{onClick:a[0]||(a[0]=g=>b("pending")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 rounded"}," Новый "),e("button",{onClick:a[1]||(a[1]=g=>b("processed")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 rounded"}," Обработан ")],512),[[ue,r.value]])],512))}},$t={class:"relative bg-white dark:bg-gray-800 rounded-xl shadow-lg max-w-md w-full mx-4"},Ct={class:"p-6"},It={class:"flex justify-between items-center mb-4"},St={key:0,class:"space-y-4"},Mt={class:"mt-1 text-sm text-gray-900 dark:text-white"},jt={class:"mt-1 text-sm text-gray-900 dark:text-white"},Dt={class:"mt-1 text-sm text-gray-900 dark:text-white"},Ot={class:"mt-1 text-sm text-gray-900 dark:text-white"},Pt={class:"mt-1 text-sm text-gray-900 dark:text-white"},Tt={class:"mt-1 text-sm text-gray-900 dark:text-white"},Bt={key:0,class:"px-2.5 py-0.5 rounded-full font-bold text-md bg-warning-50 text-warning-600 dark:bg-warning-500/15 dark:text-orange-400"},qt={key:1,class:"px-2.5 py-0.5 rounded-full font-bold text-md bg-success-50 text-success-600 dark:bg-success-500/15 dark:text-success-500"},Ut={__name:"CallModal",props:{isVisible:{type:Boolean,default:!1},call:{type:Object,default:null}},emits:["close","updateStatus"],setup(t,{emit:d}){var b;const r=t,n=d,c=m(((b=r.call)==null?void 0:b.status)||"pending");L(()=>{var i;return(i=r.call)==null?void 0:i.status},i=>{i&&(c.value=i)});const y=()=>{n("close")},w=i=>{c.value=i,n("updateStatus",r.call,i)};return(i,a)=>t.isVisible?(s(),O(he,{key:0,onClose:y},{body:W(()=>[e("div",$t,[e("div",Ct,[e("div",It,[a[0]||(a[0]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white"}," Информация о заявке ",-1)),I(_t,{onUpdateStatus:w})]),t.call?(s(),l("div",St,[e("div",null,[a[1]||(a[1]=e("label",{class:"block text-sm font-medium text-brand-700 dark:text-brand-300"},"Имя клиента",-1)),e("p",Mt,p(t.call.name),1)]),e("div",null,[a[2]||(a[2]=e("label",{class:"block text-sm font-medium text-brand-700 dark:text-brand-300"},"Email",-1)),e("p",jt,p(t.call.email||"Не указан"),1)]),e("div",null,[a[3]||(a[3]=e("label",{class:"block text-sm font-medium text-brand-700 dark:text-brand-300"},"Телефон",-1)),e("p",Dt,p(t.call.phone),1)]),e("div",null,[a[4]||(a[4]=e("label",{class:"block text-sm font-medium text-brand-700 dark:text-brand-300"},"Источник",-1)),e("p",Ot,p(t.call.source==="client"?"Клиент":"Дизанер"),1)]),e("div",null,[a[5]||(a[5]=e("label",{class:"block text-sm font-medium text-brand-700 dark:text-brand-300"},"Комментарий",-1)),e("p",Pt,p(t.call.comment||"Нет комментария"),1)]),e("div",null,[a[6]||(a[6]=e("label",{class:"block text-sm font-medium text-brand-700 dark:text-brand-300"},"Дата создания",-1)),e("p",Tt,p(new Date(t.call.created_at).toLocaleDateString("ru-RU"))+" "+p(new Date(t.call.created_at).toLocaleTimeString("ru-RU")),1)]),e("div",null,[a[7]||(a[7]=e("label",{class:"block text-sm font-medium text-brand-700 dark:text-brand-300 mb-2"},"Статус",-1)),c.value==="pending"?(s(),l("span",Bt," Новый ")):c.value==="processed"?(s(),l("span",qt," Обработан ")):S("",!0)])])):S("",!0)])])]),_:1})):S("",!0)}},Vt={class:"p-4 border-t border-gray-100 dark:border-gray-800 sm:p-6"},Rt={class:"space-y-5"},Ht={class:"overflow-hidden rounded-xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]"},Lt={class:"max-w-full overflow-x-auto custom-scrollbar"},Ft={key:0,class:"flex justify-center items-center h-screen"},At={key:1,class:"flex flex-col justify-center items-center h-screen font-bold text-error-700 text-theme-xl dark:text-error-500"},Et={key:2,class:"flex flex-col justify-center items-center h-screen menu-item-icon-active text-center font-bold text-theme-xl m-5"},Nt={key:3,class:"min-w-full"},Yt={class:"divide-y divide-gray-200 dark:divide-gray-700"},zt={class:"px-5 py-4 sm:px-6"},Zt={class:"text-gray-500 text-left text-theme-sm dark:text-gray-400"},Qt={class:"text-gray-500 text-left text-theme-sm dark:text-gray-400"},Gt=["onClick"],Wt={class:"block font-medium text-gray-800 text-theme-sm dark:text-white/90"},Jt={key:0,class:"block text-gray-500 text-theme-xs dark:text-gray-400"},Kt={class:"px-5 py-4 sm:px-6"},Xt={class:"text-gray-500 text-left text-theme-sm dark:text-gray-400"},es={class:"px-5 py-4 sm:px-6"},ts={key:0,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-blue-light-50 text-blue-light-500 dark:bg-blue-light-500/15 dark:text-blue-light-500"},ss={key:1,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-brand-50 text-brand-500 dark:bg-brand-500/15 dark:text-brand-500"},rs={class:"px-5 py-4 sm:px-6"},as={class:"text-gray-500 text-left text-theme-sm dark:text-gray-400"},os={class:"px-5 py-4 sm:px-6 text-center"},ns={key:0,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-warning-50 text-warning-600 dark:bg-warning-500/15 dark:text-orange-400"},ls={key:1,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-success-50 text-success-600 dark:bg-success-500/15 dark:text-success-500"},cs={__name:"CallsTable",props:{loading:Boolean,error:String,calls:Array,formatter:Object},emits:["fetchCalls","edit","updateStatus"],setup(t,{emit:d}){const r=d,n=m(!1),c=m(null),y=()=>{r("fetchCalls")},w=(a,g)=>{r("updateStatus",a,g)},b=a=>{c.value=a,n.value=!0},i=()=>{n.value=!1,c.value=null};return(a,g)=>(s(),l("div",Vt,[e("div",Rt,[e("div",Ht,[e("div",Lt,[t.loading?(s(),l("div",Ft,g[0]||(g[0]=[e("div",{class:"animate-spin rounded-full h-16 w-16 border-b-2 border-brand-500"},null,-1)]))):t.error?(s(),l("div",At,[g[1]||(g[1]=G(" Ошибка при загрузке")),g[2]||(g[2]=e("br",null,null,-1)),e("button",{class:"inline-flex items-center justify-center font-medium gap-2 rounded-lg transition px-4 py-3 text-sm bg-brand-500 text-white shadow-theme-xs hover:bg-brand-600 disabled:bg-brand-300 mt-2",onClick:y}," Попробовать снова ")])):t.calls.length===0?(s(),l("div",Et," Заявок на звонок не найдено ")):(s(),l("table",Nt,[g[3]||(g[3]=e("thead",null,[e("tr",{class:"border-gray-100 border-y bg-gray-50 dark:border-gray-800 dark:bg-gray-900"},[e("th",{class:"cursor-pointer px-5 py-3 text-left w-1/12 sm:px-6"},[e("div",{class:"flex items-left gap-3"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Дата")])]),e("th",{class:"px-5 py-3 text-left w-3/12 sm:px-6"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Клиент")]),e("th",{class:"px-5 py-3 text-left w-2/12 sm:px-6"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Телефон")]),e("th",{class:"px-5 py-3 text-left w-1/12 sm:px-6"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Источник")]),e("th",{class:"px-5 py-3 text-left w-3/12 sm:px-6"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Комментарий")]),e("th",{class:"px-5 py-3 text-center w-2/12 sm:px-6",colspan:"2"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Статус")])])],-1)),e("tbody",Yt,[(s(!0),l(F,null,A(t.calls,u=>(s(),l("tr",{key:u.id,class:"border-t border-gray-100 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800"},[e("td",zt,[e("p",Zt,p(new Date(u.created_at).toLocaleDateString("ru-RU")),1),e("p",Qt,p(new Date(u.created_at).toLocaleTimeString("ru-RU")),1)]),e("td",{class:"px-5 py-4 sm:px-6 cursor-pointer hover:text-brand-500",onClick:C=>b(u)},[e("span",Wt,p(u.name),1),u.email?(s(),l("span",Jt,p(u.email),1)):S("",!0)],8,Gt),e("td",Kt,[e("p",Xt,p(u.phone),1)]),e("td",es,[u.source==="client"?(s(),l("span",ts," Клиент ")):u.source==="designer"?(s(),l("span",ss," Дизанер ")):S("",!0)]),e("td",rs,[e("p",as,p(u.comment||"Нет комментария"),1)]),e("td",os,[u.status==="pending"?(s(),l("span",ns," Новый ")):u.status==="processed"?(s(),l("span",ls," Обработан ")):S("",!0)])]))),128))])]))])])]),I(Ut,{"is-visible":n.value,call:c.value,onClose:i,onUpdateStatus:w},null,8,["is-visible","call"])]))}},U="http://test.dennistp.beget.tech";function ee(){const t=m([]),d=m(!1),r=m(null),n=m(1),c=m(50),y=m(0),w=Q(()=>Math.ceil(y.value/c.value)),b=m(""),i=m(null),a=m([{id:"all",value:null,label:"Все статусы"},{id:"pending",value:"pending",label:"Новый"},{id:"processed",value:"processed",label:"Обработан"}]),g=m({sale:{true:!0,false:!0},published:{true:!0,false:!0}}),u=Q(()=>{const x=w.value,o=n.value,h=2,v=[],_=[];for(let M=Math.max(2,o-h);M<=Math.min(x-1,o+h);M++)v.push(M);return o-h>2?_.push(1,"..."):_.push(1),_.push(...v),o+h<x-1?_.push("...",x):x>1&&_.push(x),_}),C=new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB"}),k=async()=>{d.value=!0,r.value=null;const x=new URLSearchParams({page:n.value.toString(),per_page:c.value.toString()});b.value.trim()&&x.append("search",b.value.trim()),i.value&&i.value.value!==null&&x.append("status",i.value.value);const o=`${U}/api/call-requests?${x.toString()}`;try{const h=await fetch(o);if(!h.ok)throw new Error(`HTTP error! status: ${h.status}`);const v=await h.json();t.value=v.call_requests.data,y.value=v.call_requests.total}catch(h){r.value=h.message,console.error("Ошибка загрузки заявок на звонок:",h)}finally{d.value=!1}},D=()=>{n.value>1&&(n.value--,k())},T=()=>{n.value<w.value&&(n.value++,k())},N=x=>{n.value=x,k()},Y=async x=>{try{const o=await fetch(`${U}/api/call-requests/${x}`);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return(await o.json()).call_request}catch(o){throw console.error("Ошибка загрузки заявки на звонок:",o),o}},R=async(x,o)=>{try{const h=new FormData;Object.keys(o).forEach(_=>{var M;typeof o[_]=="boolean"?h.append(_,o[_]?"1":"0"):h.append(_,((M=o[_])==null?void 0:M.toString())||"")}),h.append("_method","PUT");const v=await fetch(`${U}/api/call-requests/${x}`,{method:"POST",headers:{Accept:"application/json"},body:h});if(v.ok)return{success:!0};if(v.status===422)return{success:!1,errors:(await v.json()).errors};throw new Error(`HTTP error! status: ${v.status}`)}catch(h){return console.error("Ошибка обновления заявки на звонок:",h),{success:!1}}},P=()=>{n.value=1};let B=null;return L(b,x=>{B&&clearTimeout(B),B=setTimeout(()=>{P(),k()},500)}),L(()=>g.value,()=>{P(),k()},{deep:!0}),L(i,()=>{P(),k()}),{calls:t,loading:d,error:r,page:n,itemsPerPage:c,totalItems:y,totalPages:w,searchQuery:b,selectedStatus:i,statuses:a,filters:g,visiblePages:u,formatter:C,fetchCalls:k,fetchCallStatistics:async x=>{try{const o=new URLSearchParams;x&&o.append("month",x);const h=`${U}/api/call-requests/statistics${o.toString()?"?"+o.toString():""}`,v=await fetch(h);if(!v.ok)throw new Error(`HTTP error! status: ${v.status}`);return(await v.json()).statistics}catch(o){throw console.error("Ошибка загрузки статистики заявок на звонок:",o),o}},fetchCallById:async x=>{try{const o=await fetch(`${U}/api/call-requests/${x}`);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return{success:!0,data:(await o.json()).call_request}}catch(o){return console.error("Ошибка загрузки заявки на звонок:",o),{success:!1,errors:o.message}}},handlePrevPage:D,handleNextPage:T,handleGoToPage:N,getCall:Y,updateCall:R,resetPage:P}}const ds={class:"space-y-5 sm:space-y-6"},is={class:"rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]"},bs={__name:"Calls",setup(t){const d=ge(),r=m("Обратные звонки"),n=fe,c=ye,y=ke,w=we,b=Ce,i=me,a=je,g=Ve,u=Te,{calls:C,loading:k,error:D,page:T,totalItems:N,totalPages:Y,selectedStatus:R,statuses:P,formatter:B,fetchCalls:q,fetchCallStatistics:J,deleteCall:x}=ee(),o=m(!1),h=m({current:{pending:0,processed:0,completed:0,cancelled:0},previous:{pending:0,processed:0,completed:0,cancelled:0},percentages:{pending:0,processed:0,completed:0,cancelled:0}}),v=()=>{o.value=!o.value},_=$=>{R.value=$.value===null?null:$,o.value=!1},M=$=>{d.push(`/calls/edit/${$.id}`)},ae=async($,j)=>{const Z=await x($.id);j(Z)},oe=$=>{T.value=$,q()},ne=async($,j)=>{const{updateCall:Z}=ee(),K=await Z($.id,{status:j});K.success?(q(),z()):console.error("Ошибка обновления статуса:",K.errors)},le=m(new Date().toISOString().slice(0,7)),z=async $=>{try{const j=await J($);h.value=j}catch(j){console.error("Ошибка загрузки статистики:",j)}},ce=$=>{le.value=$,z($)};return te(()=>{q(),z()}),($,j)=>(s(),O(xe,null,{default:W(()=>[I(pe,{pageTitle:r.value},null,8,["pageTitle"]),e("div",ds,[I(it,{arrowDownIcon:f(n),arrowUpIcon:f(c),phoneOutgoingIcon:f(a),calendarClockIcon:f(y),calendarDaysIcon:f(w),circleCheckBigIcon:f(b),swatchBookIcon:f(u),usersRoundIcon:f(g),statistics:h.value,onMonthChange:ce},null,8,["arrowDownIcon","arrowUpIcon","phoneOutgoingIcon","calendarClockIcon","calendarDaysIcon","circleCheckBigIcon","swatchBookIcon","usersRoundIcon","statistics"]),e("div",is,[I(vt,{totalItems:f(N),packageIcon:f(i),statuses:f(P),selectedItem:f(R),isOpen:o.value,onToggleDropdown:v,onToggleItem:_},null,8,["totalItems","packageIcon","statuses","selectedItem","isOpen"]),I(cs,{loading:f(k),error:f(D),calls:f(C),formatter:f(B),onFetchCalls:f(q),onEdit:M,onDelete:ae,onUpdateStatus:ne},null,8,["loading","error","calls","formatter","onFetchCalls"]),I(be,{currentPage:f(T),totalPages:f(Y),onPageChange:oe,class:"px-6"},null,8,["currentPage","totalPages"])])])]),_:1}))}};export{bs as default};
