import{b as Ie,c as ae,M as be,a as Ve,_ as Oe}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-CPN4HxST.js";import{o as y,b as E,d as e,r as f,a as xe,w as V,t as S,A as Se,m as A,u as x,k as H,l as q,g as me,e as N,n as z,v as G,f as U,s as R,E as fe,q as ue,G as je,F as Z,x as de,B as Ue,D as ze,c as W,i as Me,H as Le,C as Ee,z as De,I as he}from"./index-Da9oFczG.js";import{E as we,_ as ke,P as $e}from"./DeleteConfirmationModal-CcWznfMN.js";import{S as Te}from"./SearchIcon-CshmGfwo.js";import{D as _e}from"./DeleteIcon-CT6xYBxQ.js";import{_ as Ce}from"./Pagination-CcDCE8ZT.js";import{a as ve,C as Be,E as Pe,_ as Ne,u as Re}from"./useCategories-CE_mE6Mx.js";import"./useAuth-zFXYoVBM.js";const He={},Fe={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-image-icon lucide-image"};function Qe(t,r){return y(),E("svg",Fe,r[0]||(r[0]=[e("rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2"},null,-1),e("circle",{cx:"9",cy:"9",r:"2"},null,-1),e("path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"},null,-1)]))}const qe=Ie(He,[["render",Qe]]);function Ge(){const t=f(!1),r=f(!1),a=f(null);return{showModal:t,isEditing:r,currentColor:a,openCreateModal:()=>{r.value=!1,a.value=null,t.value=!0},openEditModal:s=>{r.value=!0,a.value=s,t.value=!0},closeModal:()=>{t.value=!1,r.value=!1,a.value=null}}}function Je(t={name:"",hex:"#000000"}){const r=f({...t});return{form:r,resetForm:()=>{r.value={name:"",hex:"#000000"}},setForm:n=>{r.value={...n}}}}function Xe(){const t=f([]);return{alerts:t,showAlert:(p,n,l)=>{const s={show:!0,type:p,title:n,message:l};t.value.push(s),setTimeout(()=>{const m=t.value.indexOf(s);m>-1&&t.value.splice(m,1)},3e3)},clearAlerts:()=>{t.value=[]}}}function We(t){const r=xe({}),a=()=>{if(n()){r.name="";return}!t.value||!t.value.name||typeof t.value.name!="string"||!t.value.name.trim()?r.name="Название цвета обязательно.":t.value.name.length>255?r.name="Название цвета не должно превышать 255 символов.":r.name=""},p=()=>{if(n()){r.hex="";return}!t.value||!t.value.hex||typeof t.value.hex!="string"||!t.value.hex.trim()?r.hex="HEX код обязателен.":/^#[a-fA-F0-9]{6}$/.test(t.value.hex)?r.hex="":r.hex="HEX код должен быть в формате #RRGGBB."},n=()=>{var g,o;return!t.value||!((g=t.value.name)!=null&&g.trim())&&(t.value.hex==="#000000"||!((o=t.value.hex)!=null&&o.trim()))},l=()=>{$(),v=!1},s=()=>{n()||(a(),p())},m=()=>Object.values(r).some(d=>d);let v=!1;V(()=>{var d;return(d=t.value)==null?void 0:d.name},(d,g)=>{if(!v){v=!0;return}d!==g&&g!==void 0&&a()}),V(()=>{var d;return(d=t.value)==null?void 0:d.hex},(d,g)=>{v&&d!==g&&g!==void 0&&p()});const $=()=>{Object.keys(r).forEach(d=>{r[d]=""})};return{errors:r,validateAll:s,hasErrors:m,resetErrors:$,initializeValidation:l}}const Ze={class:"border-t border-gray-100 dark:border-gray-800"},Ke={class:"py-3 whitespace-nowrap"},Ye={class:"flex items-center gap-3"},et={class:"font-medium text-gray-800 text-theme-sm dark:text-white/90"},tt={class:"py-3 whitespace-nowrap"},rt={class:"text-gray-500 text-theme-sm dark:text-gray-400"},at={class:"py-3 whitespace-nowrap flex justify-center items-center"},st=["aria-label"],ot={class:"py-3 whitespace-nowrap text-center"},nt=["aria-label"],lt=["aria-label"],it={__name:"ColorRow",props:{color:{type:Object,required:!0}},emits:["edit","delete"],setup(t,{emit:r}){const a=r,p=l=>{a("edit",l)},n=l=>{a("delete",l)};return(l,s)=>(y(),E("tr",Ze,[e("td",Ke,[e("div",Ye,[e("div",null,[e("p",et,S(t.color.name),1)])])]),e("td",tt,[e("p",rt,S(t.color.hex),1)]),e("td",at,[e("div",{class:"w-8 h-8 rounded-full border border-gray-300 dark:border-gray-600",style:Se({backgroundColor:t.color.hex}),"aria-label":`Цвет ${t.color.name} с кодом ${t.color.hex}`},null,12,st)]),e("td",ot,[e("button",{class:"inline-flex items-center justify-center gap-2 rounded-lg transition shadow-theme-xs bg-white text-gray-700 ring-1 ring-gray-300 hover:bg-success-50 hover:ring-success-300 hover:text-success-700 dark:bg-gray-800 dark:text-gray-400 dark:ring-gray-700 dark:hover:bg-success-500/15 dark:hover:ring-success-500/50 dark:hover:text-success-500 cursor-pointer p-1 mr-3",onClick:s[0]||(s[0]=m=>p(t.color)),"aria-label":`Редактировать цвет ${t.color.name}`},[A(x(we))],8,nt),e("button",{class:"inline-flex items-center justify-center gap-2 rounded-lg transition shadow-theme-xs bg-white text-gray-700 ring-1 ring-gray-300 hover:bg-error-50 hover:ring-error-300 hover:text-error-700 dark:bg-gray-800 dark:text-gray-400 dark:ring-gray-700 dark:hover:bg-error-500/15 dark:hover:ring-error-500/50 dark:hover:text-error-500 cursor-pointer p-1",onClick:s[1]||(s[1]=m=>n(t.color.id)),"aria-label":`Удалить цвет ${t.color.name}`},[A(x(_e))],8,lt)])]))}},ut={class:"relative bg-white dark:bg-gray-800 rounded-xl shadow-lg max-w-md w-full mx-4"},dt={class:"p-6"},ct={class:"text-lg font-semibold text-gray-900 dark:text-white text-center mb-4"},gt={key:0,class:"mt-1.5 text-theme-xs text-error-500"},pt={class:"relative flex"},mt={key:0,class:"mt-1.5 text-theme-xs text-error-500"},ft={class:"flex justify-end gap-3 pt-4"},vt={__name:"ColorModal",props:{isVisible:{type:Boolean,default:!1},isEditing:{type:Boolean,default:!1},color:{type:Object,default:()=>({name:"",hex:"#000000"})},errors:{type:Object,default:()=>({})}},emits:["close","save","update:errors"],setup(t,{emit:r}){const a=t,p=r,n=f({name:"",hex:"#000000"}),l=f({}),s=$=>$?"dark:bg-dark-900 shadow-theme-xs focus:border-error-300 focus:ring-error-500/10 dark:focus:border-error-800 h-11 w-full rounded-lg border border-error-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-error-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 appearance-none":"dark:bg-dark-900 shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 appearance-none";V(()=>a.isVisible,$=>{$?(a.isEditing&&a.color?n.value={...a.color}:n.value={name:"",hex:"#000000"},l.value={...a.errors}):(n.value={name:"",hex:"#000000"},l.value={})}),V(()=>a.errors,$=>{l.value={...$}},{deep:!0});const m=()=>{p("close")},v=()=>{p("save",n.value)};return($,d)=>t.isVisible?(y(),H(be,{key:0,onClose:m},{body:q(()=>[e("div",ut,[e("div",dt,[e("h3",ct,S(t.isEditing?"Редактировать цвет":"Создать цвет"),1),e("form",{onSubmit:me(v,["prevent"]),class:"space-y-4"},[e("div",null,[d[2]||(d[2]=e("label",{for:"nameColor",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Название ",-1)),N(e("input",{type:"text",id:"nameColor","onUpdate:modelValue":d[0]||(d[0]=g=>n.value.name=g),required:"",class:z(s(l.value.name))},null,2),[[G,n.value.name]]),l.value.name?(y(),E("p",gt,S(l.value.name),1)):U("",!0)]),e("div",null,[d[3]||(d[3]=e("label",{for:"hex",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," HEX код ",-1)),e("div",pt,[N(e("input",{type:"text",id:"hex","onUpdate:modelValue":d[1]||(d[1]=g=>n.value.hex=g),placeholder:"#000000",pattern:"^#[a-fA-F0-9]{6}$",required:"",class:z(s(l.value.hex))},null,2),[[G,n.value.hex]]),e("div",{class:"absolute right-2 top-1/2 -translate-y-1/2 w-8 h-8 rounded-full border border-gray-300 dark:border-gray-600",style:Se({backgroundColor:n.value.hex})},null,4)]),l.value.hex?(y(),E("p",mt,S(l.value.hex),1)):U("",!0),d[4]||(d[4]=e("p",{class:"text-sm text-gray-500 dark:text-gray-400 mt-1"}," Введите HEX код цвета в формате #RRGGBB ",-1))]),e("div",ft,[A(ae,{variant:"outline",onClick:m},{default:q(()=>d[5]||(d[5]=[R("Отмена")])),_:1}),A(ae,{variant:"primary",type:"submit"},{default:q(()=>[R(S(t.isEditing?"Сохранить":"Создать"),1)]),_:1})])],32)])])]),_:1})):U("",!0)}},ht={class:"overflow-hidden rounded-2xl border border-gray-200 bg-white px-4 pb-3 pt-4 dark:border-gray-800 dark:bg-white/[0.03] sm:px-6 h-full flex flex-col"},yt={class:"flex flex-col md:gap-1 gap-3 mb-4 sm:flex-row sm:items-center sm:justify-between"},bt={class:"relative sm:w-auto sm:min-w-[240px]"},xt={class:"absolute top-1/2 left-4 -translate-y-1/2 text-gray-500 dark:text-gray-400"},wt={class:"max-w-full overflow-x-auto overflow-y-auto custom-scrollbar flex-grow"},kt={class:"min-w-full"},$t={__name:"ColorsTable",emits:["update:searchQuery"],setup(t,{emit:r}){const a=$e,p=Te,n=fe("colorsData"),{colors:l,searchQuery:s,currentPage:m,totalPages:v,fetchColors:$,createColor:d,updateColor:g,deleteColor:o}=n,{showModal:c,isEditing:w,currentColor:u,openCreateModal:i,openEditModal:h,closeModal:k}=Ge(),B=T=>{J.value={},h(T)},{form:L}=Je(),{alerts:O,showAlert:P}=Xe(),{validateAll:K,hasErrors:Y,resetErrors:ee}=We(L),J=f({}),F=f(!1),D=f(null),X=()=>{s.value=""},re=T=>{T>=1&&T<=v.value&&$(T)},se=T=>{D.value=T,F.value=!0},oe=async T=>{var _,b;try{if(K(),Y())return;let C;if(w.value?C=await g(u.value.id,T):C=await d(T),C.success)P("success","Успешно",w.value?"Цвет успешно обновлён":"Цвет успешно создан"),await $(),k(),ee();else{const j={};if(C.errors)for(const[I,Q]of Object.entries(C.errors))Array.isArray(Q)?j[I]=Q[0]:j[I]=Q;J.value=j;const M=Object.values(j);M.length>0?M.forEach(I=>{P("error","Ошибка валидации",I)}):P("error","Ошибка валидации",C.message||"Ошибка валидации")}}catch(C){const j=((b=(_=C.response)==null?void 0:_.data)==null?void 0:b.message)||"Не удалось сохранить цвет";P("error","Ошибка",j)}},ne=async T=>{const _=l.value.find(b=>b.id===T);_&&se(_)},le=async()=>{F.value=!1;try{await o(D.value.id),await $(),P("success","Успешно","Цвет успешно удалён")}catch(T){console.error("Error deleting color:",T),P("error","Ошибка","Не удалось удалить цвет")}};return(T,_)=>{var b,C;return y(),E(Z,null,[e("div",ht,[e("div",yt,[e("div",bt,[e("span",xt,[(y(),H(ue(x(p))))]),_[3]||(_[3]=e("label",{for:"searchQuery"},null,-1)),N(e("input",{id:"searchQuery",type:"text",placeholder:"Поиск цвета...","onUpdate:modelValue":_[0]||(_[0]=j=>je(s)?s.value=j:null),class:"dark:bg-dark-900 shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800 h-11 w-full rounded-lg border border-gray-300 bg-transparent py-2.5 pr-10 pl-10 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"},null,512),[[G,x(s)]]),x(s)?(y(),E("button",{key:0,onClick:X,class:"absolute top-1/2 right-2 -translate-y-1/2 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 text-xl leading-none cursor-pointer bg-white dark:bg-gray-900 px-1 z-10"}," ✕ ")):U("",!0)]),e("button",{type:"button",class:"bg-brand-500 shadow-theme-xs hover:bg-brand-600 inline-flex items-center justify-center gap-1 rounded-lg px-3 py-3 text-sm font-medium text-white transition",onClick:_[1]||(_[1]=(...j)=>x(i)&&x(i)(...j)),"aria-label":"Добавить новый цвет"},[(y(),H(ue(x(a)),{width:"20",height:"20"})),_[4]||(_[4]=R(" Добавить цвет "))])]),e("div",wt,[e("table",kt,[_[5]||(_[5]=e("thead",null,[e("tr",{class:"border-t border-gray-100 dark:border-gray-800"},[e("th",{class:"py-3 text-left"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Цвет")]),e("th",{class:"py-3 text-left"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"HEX код ")]),e("th",{class:"py-3 text-center"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Предпросмотр")]),e("th",{class:"py-3 text-center"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Действие")])])],-1)),e("tbody",null,[(y(!0),E(Z,null,de(x(l),j=>(y(),H(it,{key:j.id,color:j,onEdit:B,onDelete:ne},null,8,["color"]))),128))])])]),A(Ce,{"current-page":x(m),"total-pages":x(v),onPageChange:re},null,8,["current-page","total-pages"])]),A(vt,{"is-visible":x(c),"is-editing":x(w),color:x(u),errors:J.value,onClose:x(k),onSave:oe},null,8,["is-visible","is-editing","color","errors","onClose"]),A(ve,{alerts:x(O)},null,8,["alerts"]),A(ke,{isVisible:F.value,productName:(b=D.value)==null?void 0:b.name,productArticle:(C=D.value)==null?void 0:C.hex,onClose:_[2]||(_[2]=j=>F.value=!1),onConfirm:le},null,8,["isVisible","productName","productArticle"])],64)}}};function _t(){const t=f(!1),r=f(!1),a=f({id:null,name:"",country:"",description:"",is_active:!0,image:""});return{showModal:t,isEditing:r,currentBrand:a,openCreateModal:()=>{r.value=!1,a.value={id:null,name:"",country:"",description:"",is_active:!0,image:""},t.value=!0},openEditModal:s=>{r.value=!0,a.value={...s},t.value=!0},closeModal:()=>{t.value=!1,r.value=!1,a.value={id:null,name:"",country:"",description:"",is_active:!0,image:""}}}}function Ct(){const t=f({name:"",country:"",description:"",is_active:!0,image:""});return{form:t,resetForm:()=>{t.value={name:"",country:"",description:"",is_active:!0,image:""}},setForm:p=>{t.value={...p}}}}function Et(){const t=f([]);return{alerts:t,showAlert:(p,n,l)=>{const s={show:!0,type:p,title:n,message:l};t.value.push(s),setTimeout(()=>{const m=t.value.indexOf(s);m>-1&&t.value.splice(m,1)},3e3)},clearAlerts:()=>{t.value=[]}}}function At(t){const r=xe({}),a=()=>{if(s()){r.name="";return}!t.value||!t.value.name||typeof t.value.name!="string"||!t.value.name.trim()?r.name="Название бренда обязательно.":t.value.name.length>255?r.name="Название бренда не должно превышать 255 символов.":r.name=""},p=()=>{if(s()){r.country="";return}t.value&&t.value.country&&t.value.country.length>255?r.country="Страна не должна превышать 255 символов.":r.country=""},n=()=>{if(s()){r.description="";return}t.value&&t.value.description&&t.value.description.length>1e3?r.description="Описание не должно превышать 1000 символов.":r.description=""},l=()=>{if(s()){r.image="";return}t.value&&t.value.image&&!/^https?:\/\/.+/.test(t.value.image)?r.image="Ссылка на изображение должна быть валидным URL.":r.image=""},s=()=>{var c,w,u,i;return!t.value||!((c=t.value.name)!=null&&c.trim())&&!((w=t.value.country)!=null&&w.trim())&&!((u=t.value.description)!=null&&u.trim())&&!((i=t.value.image)!=null&&i.trim())},m=()=>{g(),d=!1},v=()=>{s()||(a(),p(),n(),l())},$=()=>Object.values(r).some(o=>o);let d=!1;V(()=>{var o;return(o=t.value)==null?void 0:o.name},(o,c)=>{if(!d){d=!0;return}o!==c&&c!==void 0&&a()}),V(()=>{var o;return(o=t.value)==null?void 0:o.country},(o,c)=>{d&&o!==c&&c!==void 0&&p()}),V(()=>{var o;return(o=t.value)==null?void 0:o.description},(o,c)=>{d&&o!==c&&c!==void 0&&n()}),V(()=>{var o;return(o=t.value)==null?void 0:o.image},(o,c)=>{d&&o!==c&&c!==void 0&&l()});const g=()=>{Object.keys(r).forEach(o=>{r[o]=""})};return{errors:r,validateAll:v,hasErrors:$,resetErrors:g,initializeValidation:m}}const jt={class:"border-t border-gray-100 dark:border-gray-800"},Mt={class:"py-3 whitespace-nowrap"},Tt={class:"flex items-center gap-3"},St={class:"h-[32px] w-auto overflow-hidden rounded-md"},Bt=["src","alt"],Pt={key:1,class:"w-full h-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center"},It={class:"font-medium text-gray-800 text-theme-sm dark:text-white/90"},Vt={class:"py-3 whitespace-nowrap"},Ot={class:"text-gray-500 text-theme-sm dark:text-gray-400"},Ut={class:"py-3 whitespace-nowrap"},zt={key:0,class:"flex items-center justify-center w-6 h-6 bg-success-50 dark:bg-success-500/15 rounded-full"},Lt={key:1,class:"flex items-center justify-center w-6 h-6 bg-error-50 dark:bg-error-500/15 rounded-full"},Dt={class:"py-3 whitespace-nowrap"},Nt={class:"py-3 whitespace-nowrap text-center"},Rt=["aria-label"],Ht=["aria-label"],Ft={__name:"BrandRow",props:{brand:{type:Object,required:!0}},emits:["edit","delete"],setup(t,{emit:r}){const a="http://test.dennistp.beget.tech",p=r,n=m=>m.startsWith("http")?m:`${a}/storage/${m}`,l=m=>{p("edit",m)},s=m=>{p("delete",m)};return(m,v)=>(y(),E("tr",jt,[e("td",Mt,[e("div",Tt,[e("div",St,[t.brand.image?(y(),E("img",{key:0,src:n(t.brand.image),alt:t.brand.name,class:"w-[70px] h-full object-contain dark:bg-white"},null,8,Bt)):(y(),E("div",Pt,[A(x(qe),{class:"w-[70px] text-gray-500 dark:text-gray-400 text-sm"})]))]),e("div",null,[e("p",It,S(t.brand.name),1)])])]),e("td",Vt,[e("p",Ot,S(t.brand.country||"Не указано"),1)]),e("td",Ut,[t.brand.description?(y(),E("div",zt,[A(x(Be),{class:"w-4 h-4 text-success-600 dark:text-success-500"})])):(y(),E("div",Lt,[A(x(Pe),{class:"w-4 h-4 text-error-600 dark:text-error-500"})]))]),e("td",Dt,[e("span",{class:z({"rounded-full px-2 py-0.5 text-theme-xs font-medium":!0,"bg-success-50 text-success-600 dark:bg-success-500/15 dark:text-success-500":t.brand.is_active,"bg-error-50 text-error-600 dark:bg-error-500/15 dark:text-error-500":!t.brand.is_active})},S(t.brand.is_active?"Активен":"Неактивен"),3)]),e("td",Nt,[e("button",{class:"inline-flex items-center justify-center gap-2 rounded-lg transition shadow-theme-xs bg-white text-gray-700 ring-1 ring-gray-300 hover:bg-success-50 hover:ring-success-300 hover:text-success-700 dark:bg-gray-800 dark:text-gray-400 dark:ring-gray-700 dark:hover:bg-success-500/15 dark:hover:ring-success-500/50 dark:hover:text-success-500 cursor-pointer p-1 mr-3",onClick:v[0]||(v[0]=$=>l(t.brand)),"aria-label":`Редактировать бренд ${t.brand.name}`},[A(x(we))],8,Rt),e("button",{class:"inline-flex items-center justify-center gap-2 rounded-lg transition shadow-theme-xs bg-white text-gray-700 ring-1 ring-gray-300 hover:bg-error-50 hover:ring-error-300 hover:text-error-700 dark:bg-gray-800 dark:text-gray-400 dark:ring-gray-700 dark:hover:bg-error-500/15 dark:hover:ring-error-500/50 dark:hover:text-error-500 cursor-pointer p-1",onClick:v[1]||(v[1]=$=>s(t.brand.id)),"aria-label":`Удалить бренд ${t.brand.name}`},[A(x(_e))],8,Ht)])]))}},Qt={class:"rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]"},qt={class:"p-4 sm:p-6"},Gt={key:0,class:"mb-4"},Jt={class:"relative group w-fit"},Xt=["src"],Wt={key:1},Zt={for:"brand-image",class:"shadow-theme-xs group hover:border-brand-500 block cursor-pointer rounded-lg border-2 border-dashed border-gray-300 transition dark:border-gray-800"},Kt={key:2,class:"mt-4"},Yt={class:"relative group w-fit"},er=["src"],tr=Ue({__name:"BrandImageUpload",props:{modelValue:{}},emits:["update:modelValue"],setup(t,{expose:r,emit:a}){const p=t,n=a,l=f(p.modelValue),s=f(null),m=f(null),v="http://test.dennistp.beget.tech";V(()=>p.modelValue,u=>{l.value=u}),V(l,u=>{n("update:modelValue",u)});const $=u=>u.startsWith("http")?u:`${v}/storage/${u}`,d=u=>window.URL.createObjectURL(u),g=(u,i,h)=>{m.value={show:!0,type:u,title:i,message:h},setTimeout(()=>{m.value=null},5e3)},o=u=>{const i=u.target,h=i.files;if(!h||h.length===0)return;const k=h[0],B=["image/png","image/jpeg","image/jpg","image/webp"],L=1*1024*1024;if(!B.includes(k.type)){g("error","Неподдерживаемый формат","Файл имеет неподдерживаемый формат. Разрешены только PNG, JPG, JPEG, WEBP.");return}if(k.size>L){g("error","Файл слишком большой","Файл слишком большой. Максимальный размер 1MB.");return}const O=new Image;O.onload=()=>{if(O.width>300||O.height>300){g("error","Изображение слишком большое","Максимальный размер изображения 300x300 пикселей.");return}s.value=k},O.src=window.URL.createObjectURL(k),i.value=""},c=()=>{l.value=""},w=()=>{s.value=null};return r({newFile:s}),(u,i)=>(y(),E("div",Qt,[A(ve,{alert:m.value},null,8,["alert"]),i[3]||(i[3]=e("div",{class:"border-b border-gray-200 px-6 py-4 dark:border-gray-800"},[e("h2",{class:"text-lg font-medium text-gray-800 dark:text-white"}," Фото бренда (макс. 1 изображение) ")],-1)),e("div",qt,[l.value?(y(),E("div",Gt,[i[0]||(i[0]=e("h3",{class:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"Текущее фото:",-1)),e("div",Jt,[e("img",{src:$(l.value),alt:"Фото бренда",class:"w-auto h-24 object-cover rounded-lg border border-gray-200"},null,8,Xt),e("button",{onClick:c,class:"absolute top-1 right-1 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",type:"button"}," × ")])])):U("",!0),l.value?U("",!0):(y(),E("div",Wt,[e("label",Zt,[i[1]||(i[1]=ze('<div class="flex justify-center p-10"><div class="flex max-w-[260px] flex-col items-center gap-4"><div class="inline-flex h-13 w-13 items-center justify-center rounded-full border border-gray-200 text-gray-700 transition dark:border-gray-800 dark:text-gray-400"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M20.0004 16V18.5C20.0004 19.3284 19.3288 20 18.5004 20H5.49951C4.67108 20 3.99951 19.3284 3.99951 18.5V16M12.0015 4L12.0015 16M7.37454 8.6246L11.9994 4.00269L16.6245 8.6246" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></div><p class="text-center text-sm text-gray-500 dark:text-gray-400"><span class="font-medium text-gray-800 dark:text-white/90">Щелкните, чтобы загрузить,</span> или перетащите PNG, JPG, JPEG или WEBP (макс. 300x300 пикселей) </p></div></div>',1)),e("input",{type:"file",id:"brand-image",class:"hidden",accept:".png,.jpg,.jpeg,.webp",onChange:o},null,32)])])),s.value?(y(),E("div",Kt,[i[2]||(i[2]=e("h3",{class:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Новое фото для загрузки: ",-1)),e("div",Yt,[e("img",{src:d(s.value),alt:"Новое фото бренда",class:"w-24 h-24 object-cover rounded-lg border border-gray-200"},null,8,er),e("button",{onClick:w,class:"absolute top-1 right-1 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",type:"button"}," × ")])])):U("",!0)])]))}}),rr={class:"relative bg-white dark:bg-gray-800 rounded-xl shadow-lg max-w-md w-full mx-4"},ar={class:"p-6"},sr={class:"text-lg font-semibold text-gray-900 dark:text-white text-center mb-4"},or={key:0,class:"mt-1.5 text-theme-xs text-error-500"},nr={key:0,class:"mt-1.5 text-theme-xs text-error-500"},lr={key:0,class:"mt-1.5 text-theme-xs text-error-500"},ir={class:"flex justify-end gap-3 pt-4"},ur={__name:"BrandModal",props:{isVisible:{type:Boolean,default:!1},isEditing:{type:Boolean,default:!1},brand:{type:Object,default:()=>({name:"",country:"",description:"",is_active:!0,image:""})},errors:{type:Object,default:()=>({})}},emits:["close","save","update:errors"],setup(t,{emit:r}){const a=t,p=r,n=f(),l=f({name:"",country:"",description:"",is_active:!0,image:""}),s=f({}),m=g=>g?"dark:bg-dark-900 shadow-theme-xs focus:border-error-300 focus:ring-error-500/10 dark:focus:border-error-800 h-11 w-full rounded-lg border border-error-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-error-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 appearance-none":"dark:bg-dark-900 shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 appearance-none",v=W(()=>"dark:bg-dark-900 shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800 w-full resize-none rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30");V(()=>a.isVisible,g=>{g?(a.isEditing&&a.brand?l.value={...a.brand}:l.value={name:"",country:"",description:"",is_active:!0,image:""},s.value={...a.errors}):(l.value={name:"",country:"",description:"",is_active:!0,image:""},s.value={})}),V(()=>a.errors,g=>{s.value={...g}},{deep:!0});const $=()=>{p("close")},d=()=>{var g;p("save",l.value,(g=n.value)==null?void 0:g.newFile)};return(g,o)=>t.isVisible?(y(),H(be,{key:0,onClose:$},{body:q(()=>[e("div",rr,[e("div",ar,[e("h3",sr,S(t.isEditing?"Редактировать бренд":"Создать бренд"),1),e("form",{onSubmit:me(d,["prevent"]),class:"space-y-4"},[e("div",null,[o[5]||(o[5]=e("label",{for:"nameBrand",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Название ",-1)),N(e("input",{type:"text",id:"nameBrand","onUpdate:modelValue":o[0]||(o[0]=c=>l.value.name=c),required:"",class:z(m(s.value.name))},null,2),[[G,l.value.name]]),s.value.name?(y(),E("p",or,S(s.value.name),1)):U("",!0)]),e("div",null,[o[6]||(o[6]=e("label",{for:"country",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Страна ",-1)),N(e("input",{type:"text",id:"country","onUpdate:modelValue":o[1]||(o[1]=c=>l.value.country=c),class:z(m(s.value.country))},null,2),[[G,l.value.country]]),s.value.country?(y(),E("p",nr,S(s.value.country),1)):U("",!0)]),e("div",null,[o[7]||(o[7]=e("label",{for:"description",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Описание ",-1)),N(e("textarea",{id:"description","onUpdate:modelValue":o[2]||(o[2]=c=>l.value.description=c),rows:"3",class:z(v.value)},null,2),[[G,l.value.description]]),s.value.description?(y(),E("p",lr,S(s.value.description),1)):U("",!0)]),A(tr,{ref_key:"imageUploadRef",ref:n,modelValue:l.value.image,"onUpdate:modelValue":o[3]||(o[3]=c=>l.value.image=c)},null,8,["modelValue"]),A(Ne,{id:"is_active",label:"Активен",checked:l.value.is_active,"onUpdate:checked":o[4]||(o[4]=c=>l.value.is_active=c)},null,8,["checked"]),e("div",ir,[A(ae,{variant:"outline",onClick:$},{default:q(()=>o[8]||(o[8]=[R("Отмена")])),_:1}),A(ae,{variant:"primary",type:"submit"},{default:q(()=>[R(S(t.isEditing?"Сохранить":"Создать"),1)]),_:1})])],32)])])]),_:1})):U("",!0)}},dr={class:"overflow-hidden rounded-2xl border border-gray-200 bg-white px-4 pb-3 pt-4 dark:border-gray-800 dark:bg-white/[0.03] sm:px-6 h-full flex flex-col"},cr={class:"flex flex-col md:gap-1 gap-3 mb-4 sm:flex-row sm:items-center sm:justify-between"},gr={class:"relative sm:w-auto sm:min-w-[240px]"},pr={class:"absolute top-1/2 left-4 -translate-y-1/2 text-gray-500 dark:text-gray-400"},mr={class:"max-w-full overflow-x-auto overflow-y-auto custom-scrollbar flex-grow"},fr={class:"min-w-full"},vr={__name:"BrandsTable",emits:["update:searchQuery"],setup(t,{emit:r}){const a=$e,p=Te,n=fe("brandsData"),{brands:l,searchQuery:s,currentPage:m,totalPages:v,fetchBrands:$,createBrand:d,updateBrand:g,deleteBrand:o}=n,{showModal:c,isEditing:w,currentBrand:u,openCreateModal:i,openEditModal:h,closeModal:k}=_t(),B=_=>{F.value={},J(),h(_)},{form:L}=Ct(),{alerts:O,showAlert:P}=Et(),{validateAll:K,hasErrors:Y,resetErrors:ee,initializeValidation:J}=At(L),F=f({}),D=f(!1),X=f(null),re=()=>{s.value=""},se=_=>{_>=1&&_<=v.value&&$(_)},oe=_=>{X.value=_,D.value=!0},ne=async(_,b)=>{var C,j;try{if(K(),Y())return;let M;if(w.value?M=await g(u.value.id,_,b):M=await d(_,b),M.success)P("success","Успешно",w.value?"Бренд успешно обновлён":"Бренд успешно создан"),await $(),k(),ee();else{const I={};if(M.errors)for(const[te,ie]of Object.entries(M.errors))Array.isArray(ie)?I[te]=ie[0]:I[te]=ie;F.value=I;const Q=Object.values(I);Q.length>0?Q.forEach(te=>{P("error","Ошибка валидации",te)}):P("error","Ошибка валидации",M.message||"Ошибка валидации")}}catch(M){console.error("Error saving brand:",M);const I=((j=(C=M.response)==null?void 0:C.data)==null?void 0:j.message)||"Не удалось сохранить бренд";P("error","Ошибка",I)}},le=async _=>{const b=l.value.find(C=>C.id===_);b&&oe(b)},T=async()=>{D.value=!1;try{await o(X.value.id),await $(),P("success","Успешно","Бренд успешно удалён")}catch(_){console.error("Error deleting brand:",_),P("error","Ошибка","Не удалось удалить бренд")}};return(_,b)=>{var C,j;return y(),E(Z,null,[e("div",dr,[e("div",cr,[e("div",gr,[e("span",pr,[(y(),H(ue(x(p))))]),b[3]||(b[3]=e("label",{for:"searchBrand"},null,-1)),N(e("input",{id:"searchBrand",type:"text",placeholder:"Поиск бренда...","onUpdate:modelValue":b[0]||(b[0]=M=>je(s)?s.value=M:null),class:"dark:bg-dark-900 shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800 h-11 w-full rounded-lg border border-gray-300 bg-transparent py-2.5 pr-10 pl-10 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"},null,512),[[G,x(s)]]),x(s)?(y(),E("button",{key:0,onClick:re,class:"absolute top-1/2 right-2 -translate-y-1/2 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 text-xl leading-none cursor-pointer bg-white dark:bg-gray-900 px-1 z-10"}," ✕ ")):U("",!0)]),e("button",{type:"button",class:"bg-brand-500 shadow-theme-xs hover:bg-brand-600 inline-flex items-center justify-center gap-1 rounded-lg px-3 py-3 text-sm font-medium text-white transition",onClick:b[1]||(b[1]=(...M)=>x(i)&&x(i)(...M)),"aria-label":"Добавить новый бренд"},[(y(),H(ue(x(a)),{width:"20",height:"20"})),b[4]||(b[4]=R(" Добавить бренд "))])]),e("div",mr,[e("table",fr,[b[5]||(b[5]=e("thead",null,[e("tr",{class:"border-t border-gray-100 dark:border-gray-800"},[e("th",{class:"py-3 text-left"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Бренд")]),e("th",{class:"py-3 text-left"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Страна")]),e("th",{class:"py-3 text-left"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Описание")]),e("th",{class:"py-3 text-left"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Статус")]),e("th",{class:"py-3 text-center"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Действие")])])],-1)),e("tbody",null,[(y(!0),E(Z,null,de(x(l),M=>(y(),H(Ft,{key:M.id,brand:M,onEdit:B,onDelete:le},null,8,["brand"]))),128))])])]),A(Ce,{"current-page":x(m),"total-pages":x(v),onPageChange:se},null,8,["current-page","total-pages"])]),A(ur,{"is-visible":x(c),"is-editing":x(w),brand:x(u),errors:F.value,onClose:x(k),onSave:ne},null,8,["is-visible","is-editing","brand","errors","onClose"]),A(ve,{alerts:x(O)},null,8,["alerts"]),A(ke,{isVisible:D.value,productName:(C=X.value)==null?void 0:C.name,productArticle:(j=X.value)==null?void 0:j.slug,onClose:b[2]||(b[2]=M=>D.value=!1),onConfirm:T},null,8,["isVisible","productName","productArticle"])],64)}}};function hr(){const t=f(!1),r=f(!1),a=f(null);return{showModal:t,isEditing:r,currentAttribute:a,openCreateModal:()=>{r.value=!1,a.value=null,t.value=!0},openEditModal:s=>{r.value=!0,a.value=s,t.value=!0},closeModal:()=>{t.value=!1,r.value=!1,a.value=null}}}function yr(t={name:"",type:""}){const r=f({...t});return{form:r,resetForm:()=>{r.value={name:"",type:""}},setForm:n=>{r.value={...n}}}}function br(){const t=f([]);return{alerts:t,showAlert:(p,n,l)=>{const s={show:!0,type:p,title:n,message:l};t.value.push(s),setTimeout(()=>{const m=t.value.indexOf(s);m>-1&&t.value.splice(m,1)},3e3)},clearAlerts:()=>{t.value=[]}}}function xr(t){const r=xe({}),a=()=>{if(n()){r.name="";return}!t.value||!t.value.name||typeof t.value.name!="string"||!t.value.name.trim()?r.name="Название атрибута обязательно.":t.value.name.length>255?r.name="Название атрибута не должно превышать 255 символов.":r.name=""},p=()=>{if(n()){r.type="";return}!t.value||!t.value.type||typeof t.value.type!="string"||!t.value.type.trim()?r.type="Тип атрибута обязателен.":r.type=""},n=()=>{var g,o;return!t.value||!((g=t.value.name)!=null&&g.trim())&&!((o=t.value.type)!=null&&o.trim())},l=()=>{$(),v=!1},s=()=>{n()||(a(),p())},m=()=>Object.values(r).some(d=>d);let v=!1;V(()=>{var d;return(d=t.value)==null?void 0:d.name},(d,g)=>{if(!v){v=!0;return}d!==g&&g!==void 0&&a()}),V(()=>{var d;return(d=t.value)==null?void 0:d.type},(d,g)=>{v&&d!==g&&g!==void 0&&p()});const $=()=>{Object.keys(r).forEach(d=>{r[d]=""})};return{errors:r,validateAll:s,hasErrors:m,resetErrors:$,initializeValidation:l}}const wr={class:"border-t border-gray-100 dark:border-gray-800"},kr={class:"py-3 whitespace-nowrap"},$r={class:"flex items-center gap-3"},_r={class:"font-medium text-gray-800 text-theme-sm dark:text-white/90"},Cr={class:"py-3 whitespace-nowrap"},Er={class:"py-3 whitespace-nowrap text-center"},Ar={class:"text-sm text-gray-700 dark:text-gray-300"},jr={class:"py-3 whitespace-nowrap"},Mr={class:"flex flex-wrap gap-1"},Tr={class:"py-3 whitespace-nowrap text-center"},Sr=["aria-label"],Br=["aria-label"],Pr={__name:"AttributeRow",props:{attribute:{type:Object,required:!0}},emits:["edit","delete"],setup(t,{emit:r}){const a=t,p=W(()=>({text:"Текст",string:"Строка",number:"Число",boolean:"Да/Нет",select:"Выбор"})[a.attribute.type]||a.attribute.type),n=W(()=>({text:"inline-flex items-center px-2.5 py-0.5 justify-center gap-1 rounded-full capitalize bg-blue-light-50 text-blue-light-500 dark:bg-blue-light-500/15 dark:text-blue-light-500",boolean:"inline-flex items-center px-2.5 py-0.5 justify-center gap-1 rounded-full capitalize bg-brand-50 text-brand-500 dark:bg-brand-500/15 dark:text-brand-400",number:"inline-flex items-center px-2.5 py-0.5 justify-center gap-1 rounded-full capitalize bg-success-50 text-success-600 dark:bg-success-500/15 dark:text-success-500",string:"inline-flex items-center px-2.5 py-0.5 justify-center gap-1 rounded-full capitalize bg-warning-50 text-warning-600 dark:bg-warning-500/15 dark:text-orange-400",select:"inline-flex items-center px-2.5 py-0.5 justify-center gap-1 rounded-full capitalize bg-gray-100 text-gray-700 dark:bg-white/5 dark:text-white/80"})[a.attribute.type]||"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200"),l=r,s=v=>{l("edit",v)},m=v=>{l("delete",v)};return(v,$)=>(y(),E("tr",wr,[e("td",kr,[e("div",$r,[e("div",null,[e("p",_r,S(t.attribute.name),1)])])]),e("td",Cr,[e("span",{class:z([n.value,"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium"])},S(p.value),3)]),e("td",Er,[e("span",Ar,S(t.attribute.unit||"—"),1)]),e("td",jr,[e("div",Mr,[(y(!0),E(Z,null,de(t.attribute.categories,d=>(y(),E("span",{key:d.id,class:"inline-flex items-center px-2.5 py-0.5 justify-center gap-1 rounded-full font-medium capitalize text-xs bg-blue-light-50 text-blue-light-500 dark:bg-blue-light-500/15 dark:text-blue-light-500"},S(d.name),1))),128))])]),e("td",Tr,[e("button",{class:"inline-flex items-center justify-center gap-2 rounded-lg transition shadow-theme-xs bg-white text-gray-700 ring-1 ring-gray-300 hover:bg-success-50 hover:ring-success-300 hover:text-success-700 dark:bg-gray-800 dark:text-gray-400 dark:ring-gray-700 dark:hover:bg-success-500/15 dark:hover:ring-success-500/50 dark:hover:text-success-500 cursor-pointer p-1 mr-3",onClick:$[0]||($[0]=d=>s(t.attribute)),"aria-label":`Редактировать атрибут ${t.attribute.name}`},[A(x(we))],8,Sr),e("button",{class:"inline-flex items-center justify-center gap-2 rounded-lg transition shadow-theme-xs bg-white text-gray-700 ring-1 ring-gray-300 hover:bg-error-50 hover:ring-error-300 hover:text-error-700 dark:bg-gray-800 dark:text-gray-400 dark:ring-gray-700 dark:hover:bg-error-500/15 dark:hover:ring-error-500/50 dark:hover:text-error-500 cursor-pointer p-1",onClick:$[1]||($[1]=d=>m(t.attribute.id)),"aria-label":`Удалить атрибут ${t.attribute.name}`},[A(x(_e))],8,Br)])]))}},Ir={class:"relative w-full"},Vr={key:0,class:"text-gray-400 dark:text-gray-500"},Or={key:1,class:"flex flex-wrap items-center flex-auto gap-2"},Ur=["onClick"],zr={key:0,class:"absolute z-10 mt-1 w-full bg-white border border-gray-300 rounded-lg shadow-lg dark:bg-gray-800 dark:border-gray-600 max-h-60 overflow-y-auto"},Lr=["onClick"],Dr={__name:"MultiSelect",props:{modelValue:{type:Array,default:()=>[]},options:{type:Array,default:()=>[]},placeholder:{type:String,default:"Выберите элементы..."}},emits:["update:modelValue"],setup(t,{emit:r}){const a=t,p=r,n=f(!1),l=f([...a.modelValue]),s=W(()=>a.options.filter(g=>!l.value.some(o=>o.id===g.id)));V(()=>a.modelValue,g=>{l.value=[...g]},{immediate:!0});const m=()=>{n.value=!n.value},v=g=>{l.value.push(g),p("update:modelValue",l.value),n.value=!1},$=g=>{l.value=l.value.filter(o=>o.id!==g),p("update:modelValue",l.value)},d=g=>{g.target.closest(".relative")||(n.value=!1)};return Me(()=>{document.addEventListener("click",d)}),Le(()=>{document.removeEventListener("click",d)}),(g,o)=>(y(),E("div",Ir,[e("div",{class:z(["dark:bg-dark-900 min-h-11 flex items-center w-full appearance-none rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",{"flex-wrap":l.value.length>0}]),onClick:m},[l.value.length===0?(y(),E("div",Vr,S(t.placeholder),1)):(y(),E("div",Or,[(y(!0),E(Z,null,de(l.value,c=>(y(),E("div",{key:c.id,class:"group flex items-center justify-center h-[30px] rounded-full border-[0.7px] border-transparent bg-gray-100 py-1 pl-2.5 pr-2 text-sm text-gray-800 hover:border-gray-200 dark:bg-gray-800 dark:text-white/90 dark:hover:border-gray-800"},[e("span",null,S(c.name),1),e("button",{class:"pl-2 text-gray-500 cursor-pointer group-hover:text-gray-400 dark:text-gray-400",onClick:me(w=>$(c.id),["stop"]),"aria-label":"Remove item"},o[0]||(o[0]=[e("svg",{role:"button",width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M3.40717 4.46881C3.11428 4.17591 3.11428 3.70104 3.40717 3.40815C3.70006 3.11525 4.17494 3.11525 4.46783 3.40815L6.99943 5.93975L9.53095 3.40822C9.82385 3.11533 10.2987 3.11533 10.5916 3.40822C10.8845 3.70112 10.8845 4.17599 10.5916 4.46888L8.06009 7.00041L10.5916 9.53193C10.8845 9.82482 10.8845 10.2997 10.5916 10.5926C10.2987 10.8855 9.82385 10.8855 9.53095 10.5926L6.99943 8.06107L4.46783 10.5927C4.17494 10.8856 3.70006 10.8856 3.40717 10.5927C3.11428 10.2998 3.11428 9.8249 3.40717 9.53201L5.93877 7.00041L3.40717 4.46881Z",fill:"currentColor"})],-1)]),8,Ur)]))),128))])),o[1]||(o[1]=e("svg",{class:"ml-auto",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M4.79175 7.39551L10.0001 12.6038L15.2084 7.39551",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})],-1))],2),n.value?(y(),E("div",zr,[(y(!0),E(Z,null,de(s.value,c=>(y(),E("div",{key:c.id,class:"px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer",onClick:w=>v(c)},S(c.name),9,Lr))),128))])):U("",!0)]))}},Nr={class:"relative bg-white dark:bg-gray-800 rounded-xl shadow-lg max-w-md w-full mx-4"},Rr={class:"p-6"},Hr={class:"text-lg font-semibold text-gray-900 dark:text-white text-center mb-4"},Fr={key:0,class:"mt-1.5 text-theme-xs text-error-500"},Qr={class:"flex space-x-6"},qr={for:"form-unit1",class:"flex cursor-pointer items-center text-sm font-medium text-gray-700 select-none dark:text-gray-400"},Gr={for:"form-unit2",class:"flex cursor-pointer items-center text-sm font-medium text-gray-700 select-none dark:text-gray-400"},Jr={for:"form-unit3",class:"flex cursor-pointer items-center text-sm font-medium text-gray-700 select-none dark:text-gray-400"},Xr={key:0,class:"mt-1.5 text-theme-xs text-error-500"},Wr={key:0,class:"mt-1.5 text-theme-xs text-error-500"},Zr={class:"flex justify-end gap-3 pt-4"},Kr={__name:"AttributeModal",props:{isVisible:{type:Boolean,default:!1},isEditing:{type:Boolean,default:!1},attribute:{type:Object,default:()=>({name:"",type:""})},errors:{type:Object,default:()=>({})}},emits:["close","save","update:errors"],setup(t,{emit:r}){const a=t,p=r,{flatCategories:n,fetchCategories:l}=Re(),s=f({name:"",type:"",categories:[],unit:""}),m=f({}),v=g=>g?"dark:bg-dark-900 shadow-theme-xs focus:border-error-300 focus:ring-error-500/10 dark:focus:border-error-800 h-11 w-full rounded-lg border border-error-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-error-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 appearance-none":"dark:bg-dark-900 shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 appearance-none";V(()=>a.isVisible,async g=>{g?(await l(),a.isEditing&&a.attribute?s.value={...a.attribute,categories:a.attribute.categories||[],unit:a.attribute.unit||""}:s.value={name:"",type:"",categories:[],unit:""},m.value={...a.errors}):(s.value={name:"",type:"",categories:[],unit:""},m.value={})}),Me(async()=>{await l()}),V(()=>a.errors,g=>{m.value={...g}},{deep:!0});const $=()=>{p("close")},d=()=>{const g={...s.value,categories:s.value.categories.map(o=>o.id)};p("save",g)};return(g,o)=>t.isVisible?(y(),H(be,{key:0,onClose:$},{body:q(()=>[e("div",Nr,[e("div",Rr,[e("h3",Hr,S(t.isEditing?"Редактировать атрибут":"Создать атрибут"),1),e("form",{onSubmit:me(d,["prevent"]),class:"space-y-4"},[e("div",null,[o[6]||(o[6]=e("label",{for:"nameAttribute",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Название ",-1)),N(e("input",{type:"text",id:"nameAttribute","onUpdate:modelValue":o[0]||(o[0]=c=>s.value.name=c),required:"",class:z(v(m.value.name))},null,2),[[G,s.value.name]]),m.value.name?(y(),E("p",Fr,S(m.value.name),1)):U("",!0)]),e("div",null,[o[10]||(o[10]=e("div",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"Единица измерения",-1)),e("div",Qr,[e("label",qr,[N(e("input",{id:"form-unit1",type:"radio","onUpdate:modelValue":o[1]||(o[1]=c=>s.value.unit=c),value:"кг",class:"sr-only"},null,512),[[Ee,s.value.unit]]),e("div",{class:z([s.value.unit==="кг"?"border-brand-500 bg-brand-500":"bg-transparent border-gray-300 dark:border-gray-700","hover:border-brand-500 dark:hover:border-brand-500 mr-3 flex h-5 w-5 items-center justify-center rounded-full border-[1.25px]"])},[e("span",{class:z([s.value.unit==="кг"?"":"opacity-0","h-2 w-2 rounded-full bg-white"])},null,2)],2),o[7]||(o[7]=R(" кг "))]),e("label",Gr,[N(e("input",{id:"form-unit2",type:"radio","onUpdate:modelValue":o[2]||(o[2]=c=>s.value.unit=c),value:"мм",class:"sr-only"},null,512),[[Ee,s.value.unit]]),e("div",{class:z([s.value.unit==="мм"?"border-brand-500 bg-brand-500":"bg-transparent border-gray-300 dark:border-gray-700","hover:border-brand-500 dark:hover:border-brand-500 mr-3 flex h-5 w-5 items-center justify-center rounded-full border-[1.25px]"])},[e("span",{class:z([s.value.unit==="мм"?"":"opacity-0","h-2 w-2 rounded-full bg-white"])},null,2)],2),o[8]||(o[8]=R(" мм "))]),e("label",Jr,[N(e("input",{id:"form-unit3",type:"radio","onUpdate:modelValue":o[3]||(o[3]=c=>s.value.unit=c),value:"",class:"sr-only"},null,512),[[Ee,s.value.unit]]),e("div",{class:z([s.value.unit===""?"border-brand-500 bg-brand-500":"bg-transparent border-gray-300 dark:border-gray-700","hover:border-brand-500 dark:hover:border-brand-500 mr-3 flex h-5 w-5 items-center justify-center rounded-full border-[1.25px]"])},[e("span",{class:z([s.value.unit===""?"":"opacity-0","h-2 w-2 rounded-full bg-white"])},null,2)],2),o[9]||(o[9]=R(" нет "))])])]),e("div",null,[o[12]||(o[12]=e("label",{for:"type",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Тип ",-1)),N(e("select",{id:"type","onUpdate:modelValue":o[4]||(o[4]=c=>s.value.type=c),required:"",class:z(v(m.value.type))},o[11]||(o[11]=[e("option",{value:""},"Выберите тип",-1),e("option",{value:"string"},"Текст",-1),e("option",{value:"number"},"Число",-1),e("option",{value:"boolean"},"Да/Нет",-1),e("option",{value:"select"},"Выбор",-1)]),2),[[De,s.value.type]]),m.value.type?(y(),E("p",Xr,S(m.value.type),1)):U("",!0)]),e("div",null,[o[13]||(o[13]=e("p",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Категории ",-1)),A(Dr,{modelValue:s.value.categories,"onUpdate:modelValue":o[5]||(o[5]=c=>s.value.categories=c),options:x(n),placeholder:"Выберите категории..."},null,8,["modelValue","options"]),m.value.categories?(y(),E("p",Wr,S(m.value.categories),1)):U("",!0)]),e("div",Zr,[A(ae,{variant:"outline",onClick:$},{default:q(()=>o[14]||(o[14]=[R("Отмена")])),_:1}),A(ae,{variant:"primary",type:"submit"},{default:q(()=>[R(S(t.isEditing?"Сохранить":"Создать"),1)]),_:1})])],32)])])]),_:1})):U("",!0)}},Yr={class:"overflow-hidden rounded-2xl border border-gray-200 bg-white px-4 pb-3 pt-4 dark:border-gray-800 dark:bg-white/[0.03] sm:px-6 h-full flex flex-col"},ea={class:"flex flex-col md:gap-1 gap-3 mb-4 sm:flex-row sm:items-center sm:justify-between"},ta={class:"relative sm:w-auto sm:min-w-[240px]"},ra={class:"absolute top-1/2 left-4 -translate-y-1/2 text-gray-500 dark:text-gray-400"},aa={class:"max-w-full overflow-x-auto overflow-y-auto custom-scrollbar flex-grow"},sa={class:"min-w-full"},oa={__name:"AttributesTable",emits:["update:searchQuery"],setup(t,{emit:r}){const a=$e,p=Te,n=fe("attributesData"),{attributes:l,searchQuery:s,currentPage:m,totalPages:v,fetchAttributes:$,createAttribute:d,updateAttribute:g,deleteAttribute:o}=n,{showModal:c,isEditing:w,currentAttribute:u,openCreateModal:i,openEditModal:h,closeModal:k}=hr(),B=T=>{J.value={},h(T)},{form:L}=yr(),{alerts:O,showAlert:P}=br(),{validateAll:K,hasErrors:Y,resetErrors:ee}=xr(L),J=f({}),F=f(!1),D=f(null),X=()=>{s.value=""},re=T=>{T>=1&&T<=v.value&&$(T)},se=T=>{D.value=T,F.value=!0},oe=async T=>{var _,b;try{if(K(),Y())return;let C;if(w.value?C=await g(u.value.id,T):C=await d(T),C.success)P("success","Успешно",w.value?"Атрибут успешно обновлён":"Атрибут успешно создан"),await $(),k(),ee();else{const j={};if(C.errors)for(const[I,Q]of Object.entries(C.errors))Array.isArray(Q)?j[I]=Q[0]:j[I]=Q;J.value=j;const M=Object.values(j);M.length>0?M.forEach(I=>{P("error","Ошибка валидации",I)}):P("error","Ошибка валидации",C.message||"Ошибка валидации")}}catch(C){console.error("Error saving attribute:",C);const j=((b=(_=C.response)==null?void 0:_.data)==null?void 0:b.message)||"Не удалось сохранить атрибут";P("error","Ошибка",j)}},ne=async T=>{const _=l.value.find(b=>b.id===T);_&&se(_)},le=async()=>{F.value=!1;try{await o(D.value.id),await $(),P("success","Успешно","Атрибут успешно удалён")}catch(T){console.error("Error deleting attribute:",T),P("error","Ошибка","Не удалось удалить атрибут")}};return(T,_)=>{var b,C;return y(),E(Z,null,[e("div",Yr,[e("div",ea,[e("div",ta,[e("span",ra,[(y(),H(ue(x(p))))]),_[3]||(_[3]=e("label",{for:"searchAttribute"},null,-1)),N(e("input",{id:"searchAttribute",type:"text",placeholder:"Поиск атрибута...","onUpdate:modelValue":_[0]||(_[0]=j=>je(s)?s.value=j:null),class:"dark:bg-dark-900 shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800 h-11 w-full rounded-lg border border-gray-300 bg-transparent py-2.5 pr-10 pl-10 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"},null,512),[[G,x(s)]]),x(s)?(y(),E("button",{key:0,onClick:X,class:"absolute top-1/2 right-2 -translate-y-1/2 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 text-xl leading-none cursor-pointer bg-white dark:bg-gray-900 px-1 z-10"}," ✕ ")):U("",!0)]),e("button",{type:"button",class:"bg-brand-500 shadow-theme-xs hover:bg-brand-600 inline-flex items-center justify-center gap-1 rounded-lg px-3 py-3 text-sm font-medium text-white transition",onClick:_[1]||(_[1]=(...j)=>x(i)&&x(i)(...j)),"aria-label":"Добавить новый атрибут"},[(y(),H(ue(x(a)),{width:"20",height:"20"})),_[4]||(_[4]=R(" Добавить атрибут "))])]),e("div",aa,[e("table",sa,[_[5]||(_[5]=e("thead",null,[e("tr",{class:"border-t border-gray-100 dark:border-gray-800"},[e("th",{class:"py-3 text-left w-1/12"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Атрибут")]),e("th",{class:"py-3 text-left w-1/12"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Тип")]),e("th",{class:"py-3 text-center w-1/12"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Единица")]),e("th",{class:"py-3 text-center w-3/12"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Категории")]),e("th",{class:"py-3 text-center w-1/12"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Действие")])])],-1)),e("tbody",null,[(y(!0),E(Z,null,de(x(l),j=>(y(),H(Pr,{key:j.id,attribute:j,onEdit:B,onDelete:ne},null,8,["attribute"]))),128))])])]),A(Ce,{"current-page":x(m),"total-pages":x(v),onPageChange:re},null,8,["current-page","total-pages"])]),A(Kr,{"is-visible":x(c),"is-editing":x(w),attribute:x(u),errors:J.value,onClose:x(k),onSave:oe},null,8,["is-visible","is-editing","attribute","errors","onClose"]),A(ve,{alerts:x(O)},null,8,["alerts"]),A(ke,{isVisible:F.value,productName:(b=D.value)==null?void 0:b.name,productArticle:(C=D.value)==null?void 0:C.type,onClose:_[2]||(_[2]=j=>F.value=!1),onConfirm:le},null,8,["isVisible","productName","productArticle"])],64)}}};function na(){const t=f(!1),r=f(!1),a=f(null);return{showModal:t,isEditing:r,currentCategory:a,openCreateModal:()=>{r.value=!1,a.value=null,t.value=!0},openEditModal:s=>{r.value=!0,a.value=s,t.value=!0},closeModal:()=>{t.value=!1,r.value=!1,a.value=null}}}function la(t={}){const r=f({name:"",description:"",order:null,parent_id:null,is_plumbing:!1,...t});return{form:r,resetForm:()=>{r.value={name:"",description:"",order:null,parent_id:null,is_plumbing:!1}},setForm:n=>{r.value={...r.value,...n}}}}function ia(){const t=f([]);return{alerts:t,showAlert:(p,n,l)=>{const s={show:!0,type:p,title:n,message:l};t.value.push(s),setTimeout(()=>{const m=t.value.indexOf(s);m>-1&&t.value.splice(m,1)},3e3)},clearAlerts:()=>{t.value=[]}}}function ua(t){const r=xe({}),a=()=>{!t.value||!t.value.name||typeof t.value.name!="string"||!t.value.name.trim()?r.name="Название категории обязательно.":t.value.name.length>255?r.name="Название категории не должно превышать 255 символов.":r.name=""},p=()=>{t.value&&t.value.description&&t.value.description.length>1e3?r.description="Описание не должно превышать 1000 символов.":r.description=""},n=()=>{t.value&&t.value.order!==null&&(isNaN(t.value.order)||t.value.order<0)?r.order="Порядок должен быть положительным числом.":r.order=""},l=()=>{t.value&&t.value.parent_id!==null&&(isNaN(t.value.parent_id)||t.value.parent_id<=0)?r.parent_id="Неверный ID родительской категории.":r.parent_id=""},s=()=>{a(),p(),n(),l()},m=()=>Object.values(r).some(d=>d);let v=!1;return V(()=>{var d;return(d=t.value)==null?void 0:d.name},(d,g)=>{if(!v){v=!0;return}d!==g&&g!==void 0&&a()}),V(()=>{var d;return(d=t.value)==null?void 0:d.description},(d,g)=>{v&&d!==g&&g!==void 0&&p()}),V(()=>{var d;return(d=t.value)==null?void 0:d.order},(d,g)=>{v&&d!==g&&g!==void 0&&n()}),V(()=>{var d;return(d=t.value)==null?void 0:d.parent_id},(d,g)=>{v&&d!==g&&g!==void 0&&l()}),{errors:r,validateAll:s,hasErrors:m,resetErrors:()=>{Object.keys(r).forEach(d=>{r[d]=""})}}}const da={class:"border-t border-gray-100 dark:border-gray-800"},ca={class:"py-3 whitespace-nowrap"},ga={class:"flex items-center gap-3"},pa={class:"font-medium text-gray-800 text-theme-sm dark:text-white/90"},ma={class:"py-3 whitespace-nowrap"},fa={key:0,class:"flex items-center justify-center w-6 h-6 bg-success-50 dark:bg-success-500/15 rounded-full"},va={key:1,class:"flex items-center justify-center w-6 h-6 bg-error-50 dark:bg-error-500/15 rounded-full"},ha={class:"py-3 whitespace-nowrap"},ya={class:"text-gray-500 text-theme-sm dark:text-gray-400"},ba={class:"py-3 whitespace-nowrap text-center"},xa=["aria-label"],wa=["aria-label"],ka={__name:"CategoryRow",props:{category:{type:Object,required:!0}},emits:["edit","delete"],setup(t,{emit:r}){const a=r,p=l=>{a("edit",l)},n=l=>{a("delete",l)};return(l,s)=>(y(),E("tr",da,[e("td",ca,[e("div",ga,[e("div",null,[e("p",pa,S(t.category.name),1)])])]),e("td",ma,[t.category.description?(y(),E("div",fa,[A(x(Be),{class:"w-4 h-4 text-success-600 dark:text-success-500"})])):(y(),E("div",va,[A(x(Pe),{class:"w-4 h-4 text-error-600 dark:text-error-500"})]))]),e("td",ha,[e("p",ya,S(t.category.order||"Не указан"),1)]),e("td",ba,[e("button",{class:"inline-flex items-center justify-center gap-2 rounded-lg transition shadow-theme-xs bg-white text-gray-700 ring-1 ring-gray-300 hover:bg-success-50 hover:ring-success-300 hover:text-success-700 dark:bg-gray-800 dark:text-gray-400 dark:ring-gray-700 dark:hover:bg-success-500/15 dark:hover:ring-success-500/50 dark:hover:text-success-500 cursor-pointer p-1 mr-3",onClick:s[0]||(s[0]=m=>p(t.category)),"aria-label":`Редактировать категорию ${t.category.name}`},[A(x(we))],8,xa),e("button",{class:"inline-flex items-center justify-center gap-2 rounded-lg transition shadow-theme-xs bg-white text-gray-700 ring-1 ring-gray-300 hover:bg-error-50 hover:ring-error-300 hover:text-error-700 dark:bg-gray-800 dark:text-gray-400 dark:ring-gray-700 dark:hover:bg-error-500/15 dark:hover:ring-error-500/50 dark:hover:text-error-500 cursor-pointer p-1",onClick:s[1]||(s[1]=m=>n(t.category.id)),"aria-label":`Удалить категорию ${t.category.name}`},[A(x(_e))],8,wa)])]))}},$a={class:"relative bg-white dark:bg-gray-800 rounded-xl shadow-lg max-w-md w-full mx-4"},_a={class:"p-6"},Ca={class:"text-lg font-semibold text-gray-900 dark:text-white text-center mb-4"},Ea={key:0,class:"mt-1.5 text-theme-xs text-error-500"},Aa={key:0,class:"mt-1.5 text-theme-xs text-error-500"},ja={key:0,class:"mt-1.5 text-theme-xs text-error-500"},Ma={class:"flex justify-end gap-3 pt-4"},Ta={__name:"CategoryModal",props:{isVisible:{type:Boolean,default:!1},isEditing:{type:Boolean,default:!1},category:{type:Object,default:()=>({name:"",description:"",order:null,parent_id:null,is_plumbing:!1})},errors:{type:Object,default:()=>({})}},emits:["close","save"],setup(t,{emit:r}){var g;const a=t,p=r;fe("categoriesData");const n=f({name:"",description:"",order:null,parent_id:null,is_plumbing:!1}),l=f([]),s=async()=>{try{const o=await fetch("http://test.dennistp.beget.tech/api/categories?per_page=1000",{headers:{Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(o.ok){const c=await o.json();l.value=c.data||[]}}catch(o){console.error("Error fetching all categories:",o)}},m=W(()=>l.value.find(o=>o.slug==="santexnika")),v=o=>o?"dark:bg-dark-900 shadow-theme-xs focus:border-error-300 focus:ring-error-500/10 dark:focus:border-error-800 h-11 w-full rounded-lg border border-error-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-error-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 appearance-none":"dark:bg-dark-900 shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 appearance-none";V(()=>a.isVisible,async o=>{var c,w,u;o?(l.value.length===0&&await s(),a.isEditing&&a.category?n.value={...a.category,is_plumbing:a.category.parent_id===((c=m.value)==null?void 0:c.id)}:n.value={name:"",description:"",order:null,parent_id:(w=m.value)==null?void 0:w.id,is_plumbing:!0},n.value.parent_id=(u=m.value)==null?void 0:u.id):n.value={name:"",description:"",order:null,parent_id:null,is_plumbing:!1}}),n.value.parent_id=(g=m.value)==null?void 0:g.id;const $=()=>{p("close")},d=()=>{p("save",{...n.value,is_plumbing:n.value.is_plumbing?"1":"0"})};return(o,c)=>t.isVisible?(y(),H(be,{key:0,onClose:$},{body:q(()=>[e("div",$a,[e("div",_a,[e("h3",Ca,S(t.isEditing?"Редактировать категорию":"Создать категорию"),1),e("form",{onSubmit:me(d,["prevent"]),class:"space-y-4"},[e("div",null,[c[3]||(c[3]=e("label",{for:"nameCategory",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Название ",-1)),N(e("input",{type:"text",id:"nameCategory","onUpdate:modelValue":c[0]||(c[0]=w=>n.value.name=w),required:"",class:z(v(t.errors.name))},null,2),[[G,n.value.name]]),t.errors.name?(y(),E("p",Ea,S(t.errors.name),1)):U("",!0)]),e("div",null,[c[4]||(c[4]=e("label",{for:"description",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Описание ",-1)),N(e("textarea",{id:"description","onUpdate:modelValue":c[1]||(c[1]=w=>n.value.description=w),rows:"3",class:z(v(t.errors.description))},null,2),[[G,n.value.description]]),t.errors.description?(y(),E("p",Aa,S(t.errors.description),1)):U("",!0)]),e("div",null,[c[5]||(c[5]=e("label",{for:"order",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Порядок ",-1)),N(e("input",{type:"number",id:"order","onUpdate:modelValue":c[2]||(c[2]=w=>n.value.order=w),min:"0",class:z(v(t.errors.order))},null,2),[[G,n.value.order,void 0,{number:!0}]]),t.errors.order?(y(),E("p",ja,S(t.errors.order),1)):U("",!0)]),e("div",Ma,[A(ae,{variant:"outline",onClick:$},{default:q(()=>c[6]||(c[6]=[R("Отмена")])),_:1}),A(ae,{variant:"primary",type:"submit"},{default:q(()=>[R(S(t.isEditing?"Сохранить":"Создать"),1)]),_:1})])],32)])])]),_:1})):U("",!0)}},Sa={class:"overflow-hidden rounded-2xl border border-gray-200 bg-white px-4 pb-3 pt-4 dark:border-gray-800 dark:bg-white/[0.03] sm:px-6 h-full flex flex-col"},Ba={class:"flex flex-col md:gap-1 gap-3 mb-4 sm:flex-row sm:items-center sm:justify-end"},Pa={class:"max-w-full overflow-x-auto overflow-y-auto custom-scrollbar flex-grow"},Ia={class:"min-w-full"},Ae=5,Va={__name:"CategoriesTable",emits:["update:searchQuery"],setup(t,{emit:r}){const a=$e,p=fe("categoriesData"),{categories:n,searchQuery:l,fetchCategories:s,createCategory:m,updateCategory:v,deleteCategory:$}=p,{showModal:d,isEditing:g,currentCategory:o,openCreateModal:c,openEditModal:w,closeModal:u}=na(),i=b=>{P.value={},w(b)};la();const{alerts:h,showAlert:k}=ia(),{errors:B,hasErrors:L,resetErrors:O}=ua({name:"",description:"",order:null,parent_id:null}),P=f({}),K=f(!1),Y=f(null),ee=f(1),J=W(()=>n.value.find(b=>b.slug==="santexnika")),F=W(()=>{var b;return(b=J.value)==null?void 0:b.id}),D=W(()=>n.value.filter(b=>b.parent_id===F.value)),X=W(()=>{const b=l.value.toLowerCase();return D.value.filter(C=>C.name.toLowerCase().includes(b)||C.slug.toLowerCase().includes(b)||C.description&&C.description.toLowerCase().includes(b))}),re=W(()=>Math.ceil(X.value.length/Ae)),se=W(()=>{const b=(ee.value-1)*Ae;return X.value.slice(b,b+Ae)}),oe=b=>{b>=1&&b<=re.value&&(ee.value=b)},ne=b=>{Y.value=b,K.value=!0},le=async b=>{var C,j;try{if(Object.assign(B,{name:"",description:"",order:"",parent_id:""}),(!b.name||!b.name.trim())&&(B.name="Название категории обязательно."),L()){console.log("Validation errors:",B);return}let M;if(g.value?M=await v(o.value.id,b):M=await m(b),M.success)k("success","Успешно",g.value?"Категория успешно обновлена":"Категория успешно создана"),await s(),u(),O();else{const I={};if(M.errors)for(const[te,ie]of Object.entries(M.errors))Array.isArray(ie)?I[te]=ie[0]:I[te]=ie;P.value=I;const Q=Object.values(I);Q.length>0?Q.forEach(te=>{k("error","Ошибка валидации",te)}):k("error","Ошибка валидации",M.message||"Ошибка валидации")}}catch(M){console.error("Error saving category:",M);const I=((j=(C=M.response)==null?void 0:C.data)==null?void 0:j.message)||"Не удалось сохранить категорию";k("error","Ошибка",I)}},T=async b=>{const C=n.value.find(j=>j.id===b);C&&ne(C)},_=async()=>{K.value=!1;try{await $(Y.value.id),await s(),k("success","Успешно","Категория успешно удалена")}catch(b){console.error("Error deleting category:",b),k("error","Ошибка","Не удалось удалить категорию")}};return V(l,()=>{ee.value=1}),(b,C)=>{var j,M;return y(),E(Z,null,[e("div",Sa,[e("div",Ba,[e("button",{type:"button",class:"bg-brand-500 shadow-theme-xs hover:bg-brand-600 inline-flex items-center justify-center gap-1 rounded-lg px-3 py-3 text-sm font-medium text-white transition",onClick:C[0]||(C[0]=(...I)=>x(c)&&x(c)(...I)),"aria-label":"Добавить новую категорию"},[(y(),H(ue(x(a)),{width:"20",height:"20"})),C[2]||(C[2]=R(" Добавить категорию сантехники "))])]),e("div",Pa,[e("table",Ia,[C[3]||(C[3]=e("thead",null,[e("tr",{class:"border-t border-gray-100 dark:border-gray-800"},[e("th",{class:"py-3 text-left"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Название")]),e("th",{class:"py-3 text-left"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Описание")]),e("th",{class:"py-3 text-left"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Порядок")]),e("th",{class:"py-3 text-center"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Действие")])])],-1)),e("tbody",null,[(y(!0),E(Z,null,de(se.value,I=>(y(),H(ka,{key:I.id,category:I,onEdit:i,onDelete:T},null,8,["category"]))),128))])])]),A(Ce,{"current-page":ee.value,"total-pages":re.value,onPageChange:oe},null,8,["current-page","total-pages"])]),A(Ta,{"is-visible":x(d),"is-editing":x(g),category:x(o),errors:P.value,onClose:x(u),onSave:le},null,8,["is-visible","is-editing","category","errors","onClose"]),A(ve,{alerts:x(h)},null,8,["alerts"]),A(ke,{isVisible:K.value,productName:(j=Y.value)==null?void 0:j.name,productArticle:(M=Y.value)==null?void 0:M.slug,onClose:C[1]||(C[1]=I=>K.value=!1),onConfirm:_},null,8,["isVisible","productName","productArticle"])],64)}}},ce="http://test.dennistp.beget.tech";function Oa(){const t=f([]),r=f(!1),a=f(null),p=f(""),n=f(1),l=f(5),s=f(1),m=f(0),v=async(u=1)=>{r.value=!0,a.value=null;const i=new URLSearchParams;p.value.trim()&&i.append("search",p.value.trim()),i.append("page",u.toString()),i.append("per_page",l.value.toString());const h=`${ce}/api/colors${i.toString()?"?"+i.toString():""}`;try{const k=await fetch(h,{headers:{Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!k.ok)throw new Error(`HTTP error! status: ${k.status}`);const B=await k.json();t.value=B.data||[],s.value=B.last_page||1,m.value=B.total||0,n.value=B.current_page||1}catch(k){a.value=k.message,console.error("Error fetching colors:",k)}finally{r.value=!1}},$=async()=>{r.value=!0,a.value=null;const u=new URLSearchParams;p.value.trim()&&u.append("search",p.value.trim()),u.append("per_page","all");const i=`${ce}/api/colors${u.toString()?"?"+u.toString():""}`;try{const h=await fetch(i,{headers:{Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!h.ok)throw new Error(`HTTP error! status: ${h.status}`);const k=await h.json();t.value=k.data||[],s.value=1,m.value=t.value.length,n.value=1}catch(h){a.value=h.message,console.error("Error fetching all colors:",h)}finally{r.value=!1}},d=async u=>{r.value=!0,a.value=null;try{const i=await fetch(`${ce}/api/colors`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify(u)}),h=await i.json();if(!i.ok){if(i.status===422)return{success:!1,errors:h.errors,message:h.message};throw new Error(`HTTP error! status: ${i.status}`)}return await v(n.value),{success:!0,data:h}}catch(i){throw a.value=i.message,console.error("Error creating color:",i),i}finally{r.value=!1}},g=async(u,i)=>{r.value=!0,a.value=null;try{const h=await fetch(`${ce}/api/colors/${u}`,{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify(i)}),k=await h.json();if(!h.ok){if(h.status===422)return{success:!1,errors:k.errors,message:k.message};throw new Error(`HTTP error! status: ${h.status}`)}return await v(n.value),{success:!0,data:k}}catch(h){throw a.value=h.message,console.error("Error updating color:",h),h}finally{r.value=!1}},o=async u=>{r.value=!0,a.value=null;try{const i=await fetch(`${ce}/api/colors/${u}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);await v(n.value)}catch(i){throw a.value=i.message,console.error("Error deleting color:",i),i}finally{r.value=!1}},c=async u=>{r.value=!0,a.value=null;try{const i=await fetch(`${ce}/api/colors/${u}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);const h=await i.json();return h.color||h}catch(i){throw a.value=i.message,console.error("Error fetching color:",i),i}finally{r.value=!1}};let w=null;return V(p,u=>{w&&clearTimeout(w),w=setTimeout(()=>{v()},500)}),{colors:t,loading:r,error:a,searchQuery:p,currentPage:n,perPage:l,totalPages:s,totalItems:m,fetchColors:v,fetchAllColors:$,createColor:d,updateColor:g,deleteColor:o,getColorById:c}}const ge="http://test.dennistp.beget.tech";function Ua(){const t=f([]),r=f(!1),a=f(null),p=f(""),n=f(1),l=f(5),s=f(1),m=f(0),v=async(u=1)=>{r.value=!0,a.value=null;const i=new URLSearchParams;p.value.trim()&&i.append("search",p.value.trim()),i.append("page",u.toString()),i.append("per_page",l.value.toString());const h=`${ge}/api/brands${i.toString()?"?"+i.toString():""}`;try{const k=await fetch(h,{headers:{Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!k.ok)throw new Error(`HTTP error! status: ${k.status}`);const B=await k.json();t.value=B.data||[],s.value=B.last_page||1,m.value=B.total||0,n.value=B.current_page||1}catch(k){a.value=k.message,console.error("Error fetching brands:",k)}finally{r.value=!1}},$=async()=>{r.value=!0,a.value=null;const u=new URLSearchParams;p.value.trim()&&u.append("search",p.value.trim()),u.append("per_page","all");const i=`${ge}/api/brands${u.toString()?"?"+u.toString():""}`;try{const h=await fetch(i,{headers:{Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!h.ok)throw new Error(`HTTP error! status: ${h.status}`);const k=await h.json();t.value=k.data||[],s.value=1,m.value=t.value.length,n.value=1}catch(h){a.value=h.message,console.error("Error fetching all brands:",h)}finally{r.value=!1}},d=async(u,i)=>{r.value=!0,a.value=null;try{const h=new FormData;Object.keys(u).forEach(L=>{const O=u[L];typeof O=="boolean"?h.append(L,O?"1":"0"):h.append(L,(O==null?void 0:O.toString())||"")}),i&&h.append("image",i);const k=await fetch(`${ge}/api/brands`,{method:"POST",headers:{Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:h}),B=await k.json();if(!k.ok){if(k.status===422)return{success:!1,errors:B.errors,message:B.message};throw new Error(`HTTP error! status: ${k.status}`)}return await v(n.value),{success:!0,data:B}}catch(h){throw a.value=h.message,console.error("Error creating brand:",h),h}finally{r.value=!1}},g=async(u,i,h)=>{r.value=!0,a.value=null;try{const k=new FormData;Object.keys(i).forEach(O=>{if(O==="image"&&!h)return;const P=i[O];typeof P=="boolean"?k.append(O,P?"1":"0"):k.append(O,(P==null?void 0:P.toString())||"")}),h&&k.append("image",h),k.append("_method","PUT");const B=await fetch(`${ge}/api/brands/${u}`,{method:"POST",headers:{Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:k}),L=await B.json();if(!B.ok){if(B.status===422)return{success:!1,errors:L.errors,message:L.message};throw new Error(`HTTP error! status: ${B.status}`)}return await v(n.value),{success:!0,data:L}}catch(k){throw a.value=k.message,console.error("Error updating brand:",k),k}finally{r.value=!1}},o=async u=>{r.value=!0,a.value=null;try{const i=await fetch(`${ge}/api/brands/${u}`,{method:"DELETE",headers:{Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);await v(n.value)}catch(i){throw a.value=i.message,console.error("Error deleting brand:",i),i}finally{r.value=!1}},c=async u=>{r.value=!0,a.value=null;try{const i=await fetch(`${ge}/api/brands/${u}`,{headers:{Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);const h=await i.json();return h.brand||h}catch(i){throw a.value=i.message,console.error("Error fetching brand:",i),i}finally{r.value=!1}};let w=null;return V(p,u=>{w&&clearTimeout(w),w=setTimeout(()=>{v()},500)}),{brands:t,loading:r,error:a,searchQuery:p,currentPage:n,perPage:l,totalPages:s,totalItems:m,fetchBrands:v,fetchAllBrands:$,createBrand:d,updateBrand:g,deleteBrand:o,getBrandById:c}}const pe="http://test.dennistp.beget.tech";function za(){const t=f([]),r=f(!1),a=f(null),p=f(""),n=f(1),l=f(5),s=f(1),m=f(0),v=async(w=1)=>{r.value=!0,a.value=null;const u=new URLSearchParams;p.value.trim()&&u.append("search",p.value.trim()),u.append("page",w.toString()),u.append("per_page",l.value.toString());const i=`${pe}/api/attributes${u.toString()?"?"+u.toString():""}`;try{const h=await fetch(i,{headers:{Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!h.ok)throw new Error(`HTTP error! status: ${h.status}`);const k=await h.json();t.value=k.data||[],s.value=k.last_page||1,m.value=k.total||0,n.value=k.current_page||1}catch(h){a.value=h.message,console.error("Error fetching attributes:",h)}finally{r.value=!1}},$=async w=>{r.value=!0,a.value=null;try{const u=await fetch(`${pe}/api/attributes`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify(w)}),i=await u.json();if(!u.ok){if(u.status===422)return{success:!1,errors:i.errors,message:i.message};throw new Error(`HTTP error! status: ${u.status}`)}return await v(n.value),{success:!0,data:i}}catch(u){throw a.value=u.message,console.error("Error creating attribute:",u),u}finally{r.value=!1}},d=async(w,u)=>{r.value=!0,a.value=null;try{const i=await fetch(`${pe}/api/attributes/${w}`,{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify(u)}),h=await i.json();if(!i.ok){if(i.status===422)return{success:!1,errors:h.errors,message:h.message};throw new Error(`HTTP error! status: ${i.status}`)}return await v(n.value),{success:!0,data:h}}catch(i){throw a.value=i.message,console.error("Error updating attribute:",i),i}finally{r.value=!1}},g=async w=>{r.value=!0,a.value=null;try{const u=await fetch(`${pe}/api/attributes/${w}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!u.ok)throw new Error(`HTTP error! status: ${u.status}`);await v(n.value)}catch(u){throw a.value=u.message,console.error("Error deleting attribute:",u),u}finally{r.value=!1}},o=async w=>{r.value=!0,a.value=null;try{const u=await fetch(`${pe}/api/attributes/${w}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!u.ok)throw new Error(`HTTP error! status: ${u.status}`);const i=await u.json();return i.attribute||i}catch(u){throw a.value=u.message,console.error("Error fetching attribute:",u),u}finally{r.value=!1}};let c=null;return V(p,w=>{c&&clearTimeout(c),c=setTimeout(()=>{v()},500)}),{attributes:t,loading:r,error:a,searchQuery:p,currentPage:n,perPage:l,totalPages:s,totalItems:m,fetchAttributes:v,createAttribute:$,updateAttribute:d,deleteAttribute:g,getAttributeById:o}}const ye="http://test.dennistp.beget.tech";function La(){const t=f([]),r=f(!1),a=f(null),p=f(""),n=f(1),l=f("all"),s=f(1),m=f(0),v=async(o=1)=>{r.value=!0,a.value=null;const c=new URLSearchParams;c.append("page",o.toString()),c.append("per_page",l.value.toString());const w=`${ye}/api/categories${c.toString()?"?"+c.toString():""}`;try{const u=await fetch(w,{headers:{Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!u.ok)throw new Error(`HTTP error! status: ${u.status}`);const i=await u.json();t.value=i.data||[],s.value=i.last_page||1,m.value=i.total||0,n.value=i.current_page||1}catch(u){a.value=u.message,console.error("Error fetching categories:",u)}finally{r.value=!1}};return{categories:t,loading:r,error:a,searchQuery:p,currentPage:n,perPage:l,totalPages:s,totalItems:m,fetchCategories:v,createCategory:async o=>{r.value=!0,a.value=null;try{const c=await fetch(`${ye}/api/categories`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify(o)}),w=await c.json();if(!c.ok){if(c.status===422)return{success:!1,errors:w.errors,message:w.message};throw new Error(`HTTP error! status: ${c.status}`)}return await v(n.value),{success:!0,data:w}}catch(c){throw a.value=c.message,console.error("Error creating category:",c),c}finally{r.value=!1}},updateCategory:async(o,c)=>{r.value=!0,a.value=null;try{const w=await fetch(`${ye}/api/categories/${o}`,{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:JSON.stringify(c)}),u=await w.json();if(!w.ok){if(w.status===422)return{success:!1,errors:u.errors,message:u.message};throw new Error(`HTTP error! status: ${w.status}`)}return await v(n.value),{success:!0,data:u}}catch(w){throw a.value=w.message,console.error("Error updating category:",w),w}finally{r.value=!1}},deleteCategory:async o=>{r.value=!0,a.value=null;try{const c=await fetch(`${ye}/api/categories/${o}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);await v(n.value)}catch(c){throw a.value=c.message,console.error("Error deleting category:",c),c}finally{r.value=!1}}}}const Da={key:0,class:"flex justify-center items-center h-screen"},Na={key:1,class:"flex flex-col justify-center items-center h-screen font-bold text-error-700 text-theme-xl dark:text-error-500"},Ra={key:2,class:"flex flex-col justify-center items-center h-screen menu-item-icon-active text-center font-bold text-theme-xl m-5"},Ha={key:3},Fa={class:"grid grid-cols-12 gap-4 md:gap-6 mb-4 md:mb-6"},Qa={class:"col-span-12 xl:col-span-6 h-[500px] overflow-hidden"},qa={class:"col-span-12 xl:col-span-6 h-[500px] overflow-hidden"},Ga={class:"col-span-12 xl:col-span-8 h-[500px] overflow-hidden"},Ja={class:"col-span-12 xl:col-span-4 h-[500px] overflow-hidden"},as={__name:"Characteristics",setup(t){const r=f("Характеричтики"),a=f(!0),p=f(null),n=f({}),l=Oa(),s=Ua(),m=za(),v=La();he("colorsData",l),he("brandsData",s),he("attributesData",m),he("categoriesData",v);const $=async()=>{a.value=!0,p.value=null;try{await Promise.all([l.fetchColors(),s.fetchBrands(),m.fetchAttributes(),v.fetchCategories()]),n.value={id:1}}catch(d){p.value=d.message||"Ошибка при загрузке данных"}finally{a.value=!1}};return Me(()=>{$()}),(d,g)=>(y(),H(Ve,null,{default:q(()=>[A(Oe,{pageTitle:r.value},null,8,["pageTitle"]),a.value?(y(),E("div",Da,g[0]||(g[0]=[e("div",{class:"animate-spin rounded-full h-16 w-16 border-b-2 border-brand-500"},null,-1)]))):p.value?(y(),E("div",Na,[g[1]||(g[1]=R(" Ошибка при загрузке")),g[2]||(g[2]=e("br",null,null,-1)),e("button",{class:"inline-flex items-center justify-center font-medium gap-2 rounded-lg transition px-4 py-3 text-sm bg-brand-500 text-white shadow-theme-xs hover:bg-brand-600 disabled:bg-brand-300 mt-2",onClick:$}," Попробовать снова ")])):n.value.id?(y(),E("div",Ha,[e("div",Fa,[e("div",Qa,[A($t)]),e("div",qa,[A(vr)]),e("div",Ga,[A(oa)]),e("div",Ja,[A(Va)])])])):(y(),E("div",Ra," Характеристики не найден "))]),_:1}))}};export{as as default};
