import{b as rt,c as at,M as ot,a as nt,_ as lt,S as dt}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-9JeftgBm.js";import{_ as ct,A as it,a as ut,C as gt,b as xt}from"./MonthPicker-DbCucgBW.js";import{o as s,b as o,C as pt,d as t,m as S,k as T,q as U,t as c,n as R,f as D,s as O,l as z,F as G,x as W,T as ht,r as k,g as Y,e as yt,y as mt,c as Z,w as V,u as m,i as bt}from"./index-h7ySXm7Y.js";import{u as tt}from"./useClickOutside-D5B9N97B.js";import{_ as ft}from"./Pagination-DxkaYT-L.js";import{D as kt}from"./DownloadIcon-x0BuzNnQ.js";import{S as vt}from"./SearchIcon-BPO7n_qb.js";import"./useAuth-B_BghTna.js";const wt={},_t={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-package-check-icon lucide-package-check"};function $t(e,b){return s(),o("svg",_t,b[0]||(b[0]=[pt('<path d="m16 16 2 2 4-4"></path><path d="M21 10V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l2-1.14"></path><path d="m7.5 4.27 9 5.15"></path><polyline points="3.29 7 12 12 20.71 7"></polyline><line x1="12" x2="12" y1="22" y2="12"></line>',5)]))}const It=rt(wt,[["render",$t]]),Ot={class:"mb-6"},Ct={class:"flex items-center justify-between mb-4"},St={class:"grid grid-cols-4 gap-4 md:gap-4 mb-4 md:mb-4"},jt={class:"col-span-12 xl:col-span-1"},Dt={class:"rounded-2xl border border-warning-200 bg-white p-5 dark:border-warning-800 dark:bg-white/[0.03] md:p-6"},Tt={class:"flex items-center justify-center w-12 h-12 bg-warning-100 rounded-xl dark:bg-warning-500/15"},Ut={class:"flex items-end justify-between mt-5"},Pt={class:"mt-2 font-bold text-warning-600 text-title-sm dark:text-white/90"},Mt={class:"col-span-12 xl:col-span-1"},Bt={class:"rounded-2xl border border-blue-light-200 bg-white p-5 dark:border-blue-light-800 dark:bg-white/[0.03] md:p-6"},Qt={class:"flex items-center justify-center w-12 h-12 bg-blue-light-100 rounded-xl dark:bg-blue-light-500/15"},At={class:"flex items-end justify-between mt-5"},Ft={class:"mt-2 font-bold text-blue-light-600 text-title-sm dark:text-white/90"},qt={class:"col-span-12 xl:col-span-1"},Rt={class:"rounded-2xl border border-success-200 bg-white p-5 dark:border-success-800 dark:bg-white/[0.03] md:p-6"},Lt={class:"flex items-start justify-between"},Vt={class:"flex items-center justify-center w-12 h-12 bg-success-100 rounded-xl dark:bg-success-500/15"},zt={class:"flex items-end justify-between mt-5"},Et={class:"mt-2 font-bold text-success-600 text-title-sm dark:text-white/90"},Nt={class:"col-span-12 xl:col-span-1"},Ht={class:"rounded-2xl border border-gray-200 bg-white p-5 dark:border-gray-800 dark:bg-white/[0.03] md:p-6"},Gt={class:"flex items-start justify-between"},Wt={class:"flex items-center justify-center w-12 h-12 bg-gray-100 rounded-xl dark:bg-gray-800"},Jt={class:"flex items-end justify-between mt-5"},Kt={class:"mt-2 font-bold text-gray-800 text-title-sm dark:text-white/90"},Xt={__name:"OrdersStatistics",props:{arrowUpIcon:{type:Object,required:!0},arrowDownIcon:{type:Object,required:!0},shoppingCartIcon:{type:Object,required:!0},calendarClockIcon:{type:Object,required:!0},calendarDaysIcon:{type:Object,required:!0},packageCheckIcon:{type:Object,required:!0},statistics:{type:Object,required:!0},onMonthChange:{type:Function,required:!0}},setup(e){return(b,r)=>(s(),o("div",Ot,[t("div",Ct,[r[0]||(r[0]=t("h2",{class:"text-lg font-semibold text-gray-800 dark:text-white/90"},"Статистика заказов",-1)),S(ct,{onMonthChange:e.onMonthChange},null,8,["onMonthChange"])]),t("div",St,[t("div",jt,[t("div",Dt,[t("div",Tt,[(s(),T(U(e.shoppingCartIcon),{class:"text-warning-600 dark:text-warning-400"}))]),t("div",Ut,[t("div",null,[r[1]||(r[1]=t("span",{class:"font-bold text-sm text-gray-500 dark:text-warning-400"},"Новые заказы",-1)),t("h4",Pt,c(e.statistics.current.pending),1)]),r[2]||(r[2]=t("span",{class:"flex items-center gap-1 rounded-full bg-gray-50 py-0.5 pl-2 pr-2.5 text-sm font-medium text-gray-600 dark:bg-gray-500/15 dark:text-gray-500"}," Всего ",-1))])])]),t("div",Mt,[t("div",Bt,[t("div",Qt,[(s(),T(U(e.calendarClockIcon),{class:"text-blue-light-600 dark:text-blue-light-400"}))]),t("div",At,[t("div",null,[r[3]||(r[3]=t("span",{class:"font-bold text-sm text-gray-500 dark:text-blue-light-400"},"На выполнении",-1)),t("h4",Ft,c(e.statistics.current.processing),1)]),r[4]||(r[4]=t("span",{class:"flex items-center gap-1 rounded-full bg-gray-50 py-0.5 pl-2 pr-2.5 text-sm font-medium text-gray-600 dark:bg-gray-500/15 dark:text-gray-500"}," Всего ",-1))])])]),t("div",qt,[t("div",Rt,[t("div",Lt,[t("div",Vt,[(s(),T(U(e.packageCheckIcon),{class:"text-success-600 dark:text-success-400"}))]),r[5]||(r[5]=t("span",{class:"flex items-center gap-1 rounded-full bg-gray-50 py-0.5 pl-2 pr-2.5 text-xs font-medium text-gray-600 dark:bg-gray-500/15 dark:text-gray-500"}," за текущий месяц ",-1))]),t("div",zt,[t("div",null,[r[6]||(r[6]=t("span",{class:"font-bold text-sm text-gray-500 dark:text-success-400"},"Доставлено",-1)),t("h4",Et,c(e.statistics.current.shipped),1)]),t("span",{class:R(["flex items-center gap-1 rounded-full py-0.5 pl-2 pr-2.5 text-sm font-medium",e.statistics.percentages.shipped>0?"bg-success-50 text-success-600 dark:bg-success-500/15 dark:text-success-500":e.statistics.percentages.shipped<0?"bg-error-50 text-error-600 dark:bg-error-500/15 dark:text-error-500":"bg-gray-50 text-gray-600 dark:bg-gray-500/15 dark:text-gray-500"])},[e.statistics.percentages.shipped!==0?(s(),T(U(e.statistics.percentages.shipped>0?e.arrowUpIcon:e.arrowDownIcon),{key:0})):D("",!0),O(" "+c(Math.abs(e.statistics.percentages.shipped))+"% ",1)],2)])])]),t("div",Nt,[t("div",Ht,[t("div",Gt,[t("div",Wt,[(s(),T(U(e.calendarDaysIcon),{class:"text-gray-800 dark:text-white/90"}))]),r[7]||(r[7]=t("span",{class:"flex items-center gap-1 rounded-full bg-gray-50 py-0.5 pl-2 pr-2.5 text-xs font-medium text-gray-600 dark:bg-gray-500/15 dark:text-gray-500"}," за выбранный месяц ",-1))]),t("div",Jt,[t("div",null,[r[8]||(r[8]=t("span",{class:"font-bold text-sm text-gray-500 dark:text-gray-400"},"Сумма выполненых заказов",-1)),t("h4",Kt,c(new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB"}).format(e.statistics.current.total_amount)),1)]),t("span",{class:R(["flex items-center gap-1 rounded-full py-0.5 pl-2 pr-2.5 text-sm font-medium",e.statistics.percentages.total_amount>0?"bg-success-50 text-success-600 dark:bg-success-500/15 dark:text-success-500":e.statistics.percentages.total_amount<0?"bg-error-50 text-error-600 dark:bg-error-500/15 dark:text-error-500":"bg-gray-50 text-gray-600 dark:bg-gray-500/15 dark:text-gray-500"])},[e.statistics.percentages.total_amount!==0?(s(),T(U(e.statistics.percentages.total_amount>0?e.arrowUpIcon:e.arrowDownIcon),{key:0})):D("",!0),O(" "+c(Math.abs(e.statistics.percentages.total_amount))+"% ",1)],2)])])])])]))}},Yt={class:"flex flex-col justify-between gap-5 border-b border-gray-200 px-5 py-4 sm:flex-row sm:items-center dark:border-gray-800"},Zt={class:"text-base font-medium text-gray-800 dark:text-white/90 flex flex-row items-center"},te={class:"flex flex-col md:flex-row gap-3"},ee={class:"shadow-theme-xs inline-flex items-center justify-center gap-2 rounded-lg bg-white px-4 py-3 text-sm font-medium text-gray-700 ring-1 ring-gray-300 transition hover:bg-gray-50 dark:bg-gray-800 dark:text-gray-400 dark:ring-gray-700 dark:hover:bg-white/[0.03]"},se={__name:"OrdersHeader",props:{totalItems:{type:Number,required:!0},packageIcon:{type:Object,required:!0},downloadIcon:{type:Object,required:!0}},setup(e){return(b,r)=>(s(),o("div",Yt,[t("h3",Zt,[(s(),T(U(e.packageIcon),{class:"menu-item-icon-active mr-2"})),O(" Список заказов ("+c(e.totalItems)+") ",1)]),t("div",te,[t("button",ee,[r[0]||(r[0]=O(" Скачать ")),(s(),T(U(e.downloadIcon)))])])]))}},re={class:"relative flex-1 sm:flex-auto sm:w-auto sm:min-w-[490px]"},ae={class:"absolute top-1/2 left-4 -translate-y-1/2 text-gray-500 dark:text-gray-400"},oe=["value"],ne={__name:"OrdersSearch",props:{searchQuery:String,searchIcon:Object},emits:["update:searchQuery"],setup(e,{emit:b}){const r=b,u=()=>{r("update:searchQuery","")};return(x,y)=>(s(),o("div",re,[t("span",ae,[(s(),T(U(e.searchIcon)))]),y[1]||(y[1]=t("label",{for:"searchQuery"},null,-1)),t("input",{id:"searchQuery",type:"text",placeholder:"Поиск по номеру заказа, ФИО, почте или телефону клиента",value:e.searchQuery,onInput:y[0]||(y[0]=w=>r("update:searchQuery",w.target.value)),class:"dark:bg-dark-900 shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800 h-11 w-full rounded-lg border border-gray-300 bg-transparent py-2.5 pr-12 pl-11 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"},null,40,oe),e.searchQuery?(s(),o("button",{key:0,onClick:u,class:"absolute top-1/2 right-2 -translate-y-1/2 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 text-xl leading-none cursor-pointer bg-white dark:bg-gray-900 px-1 z-10"}," ✕ ")):D("",!0)]))}},le={key:0,class:"text-gray-400"},de={key:1,class:"text-gray-800 dark:text-white/90"},ce={key:0,class:"absolute z-10 w-full mt-1 bg-white rounded-lg shadow-sm dark:bg-gray-900"},ie={class:"overflow-y-auto divide-y divide-gray-200 custom-scrollbar max-h-60 dark:divide-gray-800",role:"listbox"},ue=["onClick","aria-selected"],ge={class:"grow"},xe={key:0,class:"w-5 h-5 text-gray-400 dark:text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},pe={__name:"OrdersStatusSelector",props:{statuses:Array,selectedItem:Object,isOpen:Boolean},emits:["toggleDropdown","toggleItem"],setup(e,{emit:b}){const r=e,u=b,x=tt(()=>{r.isOpen&&u("toggleDropdown")}),y=()=>{u("toggleDropdown")},w=f=>{u("toggleItem",f)},a=f=>f.value===null?r.selectedItem===null:r.selectedItem&&r.selectedItem.value===f.value;return(f,l)=>(s(),o("div",{class:"relative sm:min-w-[200px] sm:w-auto",ref_key:"multiSelectRef",ref:x},[t("div",{onClick:y,class:R(["dark:bg-dark-900 h-11 flex items-center w-full appearance-none rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",{"text-gray-800 dark:text-white/90":e.isOpen}])},[e.selectedItem?(s(),o("span",de,c(e.selectedItem.label),1)):(s(),o("span",le," Все статусы ")),(s(),o("svg",{class:R(["ml-auto",{"transform rotate-180":e.isOpen}]),width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},l[0]||(l[0]=[t("path",{d:"M4.79175 7.39551L10.0001 12.6038L15.2084 7.39551",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]),2))],2),S(ht,{"enter-active-class":"transition duration-100 ease-out","enter-from-class":"transform scale-95 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-75 ease-in","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-95 opacity-0"},{default:z(()=>[e.isOpen?(s(),o("div",ce,[t("ul",ie,[(s(!0),o(G,null,W(e.statuses,i=>(s(),o("li",{key:i.id,onClick:h=>w(i),class:R(["relative flex items-center w-full px-3 py-2 border-transparent cursor-pointer first:rounded-t-lg last:rounded-b-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-800",{"bg-gray-50 dark:bg-white/[0.03]":a(i)}]),role:"option","aria-selected":a(i)},[t("span",ge,c(i.label),1),a(i)?(s(),o("svg",xe,l[1]||(l[1]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))):D("",!0)],10,ue))),128))])])):D("",!0)]),_:1})],512))}},he={class:"border-b border-gray-200 px-5 py-4 dark:border-gray-800"},ye={class:"flex flex-col md:flex-row gap-3 sm:justify-between"},me={class:"flex flex-col md:flex-row gap-3"},be={__name:"OrdersFilters",props:{searchQuery:String,statuses:Array,selectedItem:Object,isOpen:Boolean,showFilter:Boolean,searchIcon:Object,settingsIcon:Object},emits:["update:searchQuery","toggleDropdown","toggleItem","update:showFilter"],setup(e,{emit:b}){const r=b;return(u,x)=>(s(),o("div",he,[t("div",ye,[t("div",me,[S(ne,{searchQuery:e.searchQuery,searchIcon:e.searchIcon,"onUpdate:searchQuery":x[0]||(x[0]=y=>r("update:searchQuery",y))},null,8,["searchQuery","searchIcon"]),S(pe,{statuses:e.statuses,selectedItem:e.selectedItem,isOpen:e.isOpen,onToggleDropdown:x[1]||(x[1]=y=>r("toggleDropdown")),onToggleItem:x[2]||(x[2]=y=>r("toggleItem",y))},null,8,["statuses","selectedItem","isOpen"])])])]))}},fe={__name:"OrderDropdown",emits:["updateStatus"],setup(e,{emit:b}){const r=k(!1),u=k(null),x=b,y=()=>{r.value=!r.value},w=()=>{r.value=!1},a=f=>{x("updateStatus",f),w()};return tt(u),(f,l)=>(s(),o("div",{class:"relative",ref_key:"filterRef",ref:u,onClick:w},[t("button",{class:"bg-brand-500 shadow-theme-xs hover:bg-brand-600 inline-flex items-center justify-center gap-2 rounded-lg px-4 py-3 text-sm font-medium text-white transition",onClick:Y(y,["stop"]),type:"button"}," Сменить статус "),yt(t("div",{onClick:l[5]||(l[5]=Y(()=>{},["stop"])),class:"absolute right-0 z-10 mt-2 w-35 rounded-lg border border-gray-200 bg-white p-1 shadow-lg dark:border-gray-700 dark:bg-gray-800"},[t("button",{onClick:l[0]||(l[0]=i=>a("pending")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 rounded"}," Новый "),t("button",{onClick:l[1]||(l[1]=i=>a("processing")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 rounded"}," Выполнение "),t("button",{onClick:l[2]||(l[2]=i=>a("shipped")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 rounded"}," Отправлен "),t("button",{onClick:l[3]||(l[3]=i=>a("cancelled")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 rounded"}," Отменён "),t("button",{onClick:l[4]||(l[4]=i=>a("return")),class:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 rounded"}," Возврат ")],512),[[mt,r.value]])],512))}},q="http://test.dennistp.beget.tech";function H(){const e=k([]),b=k(!1),r=k(null),u=k(1),x=k(50),y=k(0),w=Z(()=>Math.ceil(y.value/x.value)),a=k(""),f=k(null),l=k([{id:"all",value:null,label:"Все статусы"},{id:"pending",value:"pending",label:"Новый"},{id:"processing",value:"processing",label:"Выполняется"},{id:"shipped",value:"shipped",label:"Отправлен"},{id:"return",value:"return",label:"Возврат"},{id:"cancelled",value:"cancelled",label:"Отменён"}]),i=k({sale:{true:!0,false:!0},published:{true:!0,false:!0}}),h=Z(()=>{const g=w.value,n=u.value,p=2,_=[],$=[];for(let M=Math.max(2,n-p);M<=Math.min(g-1,n+p);M++)_.push(M);return n-p>2?$.push(1,"..."):$.push(1),$.push(..._),n+p<g-1?$.push("...",g):g>1&&$.push(g),$}),B=new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB"}),j=async()=>{b.value=!0,r.value=null;const g=new URLSearchParams({page:u.value.toString(),per_page:x.value.toString()});a.value.trim()&&g.append("search",a.value.trim()),f.value&&f.value.value!==null&&g.append("status",f.value.value);const n=`${q}/api/orders?${g.toString()}`;try{const p=await fetch(n,{headers:{Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!p.ok)throw new Error(`HTTP error! status: ${p.status}`);const _=await p.json();e.value=_.orders.data,y.value=_.orders.total}catch(p){r.value=p.message,console.error("Ошибка загрузки заказов:",p)}finally{b.value=!1}},v=()=>{u.value>1&&(u.value--,j())},d=()=>{u.value<w.value&&(u.value++,j())},I=g=>{u.value=g,j()},L=async g=>{try{const n=await fetch(`${q}/api/orders/${g}`,{headers:{Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);return(await n.json()).order}catch(n){throw console.error("Ошибка загрузки заказа:",n),n}},E=async(g,n)=>{try{const p=new FormData;Object.keys(n).forEach($=>{var M;typeof n[$]=="boolean"?p.append($,n[$]?"1":"0"):p.append($,((M=n[$])==null?void 0:M.toString())||"")}),p.append("_method","PUT");const _=await fetch(`${q}/api/orders/${g}`,{method:"POST",headers:{Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`},body:p});if(_.ok)return{success:!0};if(_.status===422)return{success:!1,errors:(await _.json()).errors};throw new Error(`HTTP error! status: ${_.status}`)}catch(p){return console.error("Ошибка обновления заказа:",p),{success:!1}}},Q=()=>{u.value=1};let P=null;return V(a,g=>{P&&clearTimeout(P),P=setTimeout(()=>{Q(),j()},500)}),V(()=>i.value,()=>{Q(),j()},{deep:!0}),V(f,()=>{Q(),j()}),{orders:e,loading:b,error:r,page:u,itemsPerPage:x,totalItems:y,totalPages:w,searchQuery:a,selectedStatus:f,statuses:l,filters:i,visiblePages:h,formatter:B,fetchOrders:j,fetchOrderStatistics:async g=>{try{const n=new URLSearchParams;g&&n.append("month",g);const p=`${q}/api/orders/statistics${n.toString()?"?"+n.toString():""}`,_=await fetch(p,{headers:{Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!_.ok)throw new Error(`HTTP error! status: ${_.status}`);return(await _.json()).statistics}catch(n){throw console.error("Ошибка загрузки статистики заказов:",n),n}},fetchOrderById:async g=>{try{const n=await fetch(`${q}/api/orders/${g}`,{headers:{Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);return{success:!0,data:(await n.json()).order}}catch(n){return console.error("Ошибка загрузки заказа:",n),{success:!1,errors:n.message}}},handlePrevPage:v,handleNextPage:d,handleGoToPage:I,getOrder:L,updateOrder:E,resetPage:Q}}const ke={class:"relative bg-white dark:bg-gray-800 rounded-xl shadow-lg max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto custom-scrollbar"},ve={class:"p-6"},we={class:"flex justify-between items-center mb-4"},_e={class:"text-lg font-semibold text-gray-900 dark:text-white"},$e={key:0,class:"flex items-center space-x-4"},Ie={key:0,class:"px-2.5 py-0.5 rounded-full font-bold text-md bg-warning-50 text-warning-600 dark:bg-warning-500/15 dark:text-orange-400"},Oe={key:1,class:"px-2.5 py-0.5 rounded-full font-bold text-md bg-blue-light-50 text-blue-light-500 dark:bg-blue-light-500/15 dark:text-blue-light-500"},Ce={key:2,class:"px-2.5 py-0.5 rounded-full font-bold text-md bg-success-50 text-success-600 dark:bg-success-500/15 dark:text-success-500"},Se={key:3,class:"px-2.5 py-0.5 rounded-full font-bold text-md bg-error-50 text-error-600 dark:bg-error-500/15 dark:text-error-500"},je={key:4,class:"px-2.5 py-0.5 rounded-full font-bold text-md bg-gray-100 text-gray-700 dark:bg-white/5 dark:text-white/80"},De={key:0,class:"flex justify-center items-center h-64"},Te={key:1,class:"text-center text-red-500"},Ue={key:2,class:"space-y-6"},Pe={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Me={class:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg"},Be={class:"text-sm text-gray-600 dark:text-gray-400"},Qe={class:"font-medium"},Ae={class:"text-sm text-gray-600 dark:text-gray-400"},Fe={class:"font-medium"},qe={class:"text-sm text-gray-600 dark:text-gray-400"},Re={key:0,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-warning-50 text-warning-600 dark:bg-warning-500/15 dark:text-orange-400"},Le={key:1,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-blue-light-50 text-blue-light-500 dark:bg-blue-light-500/15 dark:text-blue-light-500"},Ve={key:2,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-success-50 text-success-600 dark:bg-success-500/15 dark:text-success-500"},ze={key:3,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-error-50 text-error-600 dark:bg-error-500/15 dark:text-error-500"},Ee={key:4,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-gray-100 text-gray-700 dark:bg-white/5 dark:text-white/80"},Ne={class:"text-sm text-gray-600 dark:text-gray-400"},He={class:"font-medium text-error-600 dark:text-error-400"},Ge={class:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg"},We={class:"text-sm text-gray-600 dark:text-gray-400"},Je={class:"font-medium"},Ke={class:"text-sm text-gray-600 dark:text-gray-400"},Xe={class:"font-medium"},Ye={class:"text-sm text-gray-600 dark:text-gray-400"},Ze={class:"font-medium"},ts={class:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg"},es={class:"space-y-4"},ss={class:"flex items-center space-x-4"},rs={class:"font-medium text-gray-900 dark:text-white"},as={class:"font-medium text-gray-900 dark:text-white"},os={class:"text-sm text-gray-600 dark:text-gray-400"},ns={key:0},ls={key:1},ds={class:"text-right"},cs={class:"font-medium text-gray-900 dark:text-white"},is={class:"text-sm text-gray-600 dark:text-gray-400"},us={key:0,class:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg"},gs={class:"space-y-4"},xs={class:"text-sm text-gray-600 dark:text-gray-400"},ps={class:"flex justify-end gap-3 pt-4"},hs={__name:"OrderModal",props:{isVisible:{type:Boolean,default:!1},orderId:{type:String,default:""}},emits:["close","updateStatus","statusUpdated"],setup(e,{emit:b}){const r=e,u=b,{formatter:x,fetchOrderById:y,updateOrder:w}=H(),a=k(null),f=k(!1),l=k(null),i=v=>new Date(v).toLocaleString("ru-RU"),h=()=>{u("close"),a.value=null,l.value=null},B=async v=>{if(!a.value)return;const d=await w(a.value.id,{status:v});d.success?(a.value.status=v,u("statusUpdated",a.value.id,v)):console.error("Ошибка обновления статуса:",d.errors)},j=async()=>{if(r.orderId)try{f.value=!0;const v=await y(r.orderId);v.success?a.value=v.data:l.value=v.errors||"Ошибка загрузки заказа"}catch(v){l.value="Ошибка загрузки заказа",console.error(v)}finally{f.value=!1}};return V(()=>r.isVisible,async v=>{v&&r.orderId?await j():(a.value=null,l.value=null)}),(v,d)=>e.isVisible?(s(),T(ot,{key:0,onClose:h},{body:z(()=>[t("div",ke,[t("div",ve,[t("div",we,[t("h3",_e," Детали заказа #"+c(a.value?a.value.order:""),1),a.value?(s(),o("div",$e,[a.value.status==="pending"?(s(),o("span",Ie," Новый ")):a.value.status==="processing"?(s(),o("span",Oe," Выполнение ")):a.value.status==="shipped"?(s(),o("span",Ce," Отправлен ")):a.value.status==="return"?(s(),o("span",Se," Возврат ")):a.value.status==="cancelled"?(s(),o("span",je," Отменён ")):D("",!0),S(fe,{onUpdateStatus:B})])):D("",!0)]),f.value?(s(),o("div",De,d[0]||(d[0]=[t("div",{class:"animate-spin rounded-full h-16 w-16 border-b-2 border-brand-500"},null,-1)]))):l.value?(s(),o("div",Te," Ошибка загрузки заказа: "+c(l.value),1)):a.value?(s(),o("div",Ue,[t("div",Pe,[t("div",Me,[d[5]||(d[5]=t("h3",{class:"font-medium text-gray-900 dark:text-white mb-2"},"Информация о заказе",-1)),t("p",Be,[d[1]||(d[1]=O("Номер заказа: ")),t("span",Qe,c(a.value.order),1)]),t("p",Ae,[d[2]||(d[2]=O("Дата создания: ")),t("span",Fe,c(i(a.value.created_at)),1)]),t("p",qe,[d[3]||(d[3]=O("Статус: ")),a.value.status==="pending"?(s(),o("span",Re,"Новый")):a.value.status==="processing"?(s(),o("span",Le,"Выполнение")):a.value.status==="shipped"?(s(),o("span",Ve,"Отправлен")):a.value.status==="return"?(s(),o("span",ze,"Возврат")):a.value.status==="cancelled"?(s(),o("span",Ee,"Отменён")):D("",!0)]),t("p",Ne,[d[4]||(d[4]=O("Общая сумма: ")),t("span",He,c(m(x).format(a.value.total_amount)),1)])]),t("div",Ge,[d[9]||(d[9]=t("h3",{class:"font-medium text-gray-900 dark:text-white mb-2"},"Информация о клиенте",-1)),t("p",We,[d[6]||(d[6]=O("Имя: ")),t("span",Je,c(a.value.name),1)]),t("p",Ke,[d[7]||(d[7]=O("Email: ")),t("span",Xe,c(a.value.email),1)]),t("p",Ye,[d[8]||(d[8]=O("Телефон: ")),t("span",Ze,c(a.value.phone),1)])])]),t("div",ts,[d[10]||(d[10]=t("h3",{class:"font-medium text-gray-900 dark:text-white mb-4"},"Товары в заказе",-1)),t("div",es,[(s(!0),o(G,null,W(a.value.items,I=>(s(),o("div",{key:I.id,class:"flex items-center justify-between border-t border-gray-200 dark:border-gray-700 pt-4"},[t("div",ss,[t("p",rs,c(I.product.article),1),t("div",null,[t("p",as,c(I.product.name),1),t("p",os,[O("Количество: "+c(I.quantity)+" ",1),I.product_unit==="кв.м"?(s(),o("span",ns,"м²")):(s(),o("span",ls,c(I.product_unit),1))])])]),t("div",ds,[t("p",cs,c(m(x).format(I.price)),1),t("p",is,"Итого: "+c(m(x).format(I.price*I.quantity)),1)])]))),128))])]),a.value.comment?(s(),o("div",us,[d[11]||(d[11]=t("h3",{class:"font-medium text-gray-900 dark:text-white mb-4"},"Комментарий к заказу",-1)),t("div",gs,[t("p",xs,c(a.value.comment),1)])])):D("",!0)])):D("",!0),t("div",ps,[S(at,{variant:"outline",onClick:h},{default:z(()=>d[12]||(d[12]=[O("Закрыть")])),_:1})])])])]),_:1})):D("",!0)}},ys={class:"p-4 border-t border-gray-100 dark:border-gray-800 sm:p-6"},ms={class:"space-y-5"},bs={class:"overflow-hidden rounded-xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]"},fs={class:"max-w-full overflow-x-auto custom-scrollbar"},ks={key:0,class:"flex justify-center items-center h-screen"},vs={key:1,class:"flex flex-col justify-center items-center h-screen font-bold text-error-700 text-theme-xl dark:text-error-500"},ws={key:2,class:"flex flex-col justify-center items-center h-screen menu-item-icon-active text-center font-bold text-theme-xl m-5"},_s={key:3,class:"min-w-full"},$s={class:"divide-y divide-gray-200 dark:divide-gray-700"},Is={class:"px-5 py-4 sm:px-6"},Os=["onClick"],Cs={class:"px-5 py-4 sm:px-6"},Ss={class:"text-gray-500 text-left text-theme-sm dark:text-gray-400"},js={class:"text-gray-500 text-left text-theme-sm dark:text-gray-400"},Ds={class:"px-5 py-4 sm:px-6"},Ts={"data-v-67f048e0":"",class:"block font-medium text-gray-800 text-theme-sm dark:text-white/90"},Us={"data-v-67f048e0":"",class:"block text-gray-500 text-theme-xs dark:text-gray-400"},Ps={class:"px-5 py-4 sm:px-6"},Ms={class:"text-gray-500 text-left text-theme-sm dark:text-gray-400"},Bs={class:"px-5 py-4 sm:px-6"},Qs={class:"text-gray-500 text-left text-theme-sm dark:text-gray-400"},As={class:"px-5 py-4 sm:px-6"},Fs={class:"font-medium text-left text-gray-800 text-theme-sm dark:text-white/90"},qs={class:"px-5 py-4 sm:px-6 text-center"},Rs={key:0,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-warning-50 text-warning-600 dark:bg-warning-500/15 dark:text-orange-400"},Ls={key:1,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-blue-light-50 text-blue-light-500 dark:bg-blue-light-500/15 dark:text-blue-light-500"},Vs={key:2,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-success-50 text-success-600 dark:bg-success-500/15 dark:text-success-500"},zs={key:3,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-error-50 text-error-600 dark:bg-error-500/15 dark:text-error-500"},Es={key:4,class:"px-2.5 py-0.5 rounded-full font-bold text-xs bg-gray-100 text-gray-700 dark:bg-white/5 dark:text-white/80"},Ns={__name:"OrdersTable",props:{loading:Boolean,error:String,orders:Array,formatter:Object},emits:["fetchOrders","edit","updateStatus"],setup(e,{emit:b}){const r=b,u=k(!1),x=k(""),y=()=>{r("fetchOrders")},w=l=>{x.value=l,u.value=!0},a=()=>{u.value=!1,x.value=""},f=(l,i)=>{r("updateStatus",{id:l},i)};return(l,i)=>(s(),o("div",ys,[t("div",ms,[t("div",bs,[t("div",fs,[e.loading?(s(),o("div",ks,i[0]||(i[0]=[t("div",{class:"animate-spin rounded-full h-16 w-16 border-b-2 border-brand-500"},null,-1)]))):e.error?(s(),o("div",vs,[i[1]||(i[1]=O(" Ошибка при загрузке")),i[2]||(i[2]=t("br",null,null,-1)),t("button",{class:"inline-flex items-center justify-center font-medium gap-2 rounded-lg transition px-4 py-3 text-sm bg-brand-500 text-white shadow-theme-xs hover:bg-brand-600 disabled:bg-brand-300 mt-2",onClick:y}," Попробовать снова ")])):e.orders.length===0?(s(),o("div",ws," Заказы не найдены ")):(s(),o("table",_s,[i[3]||(i[3]=t("thead",null,[t("tr",{class:"border-gray-100 border-y bg-gray-50 dark:border-gray-800 dark:bg-gray-900"},[t("th",{class:"cursor-pointer px-5 py-3 text-left w-2/12 sm:px-6"},[t("div",{class:"flex items-center gap-3"},[t("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"№ Заказа")])]),t("th",{class:"cursor-pointer px-5 py-3 text-left w-1/12 sm:px-6"},[t("div",{class:"flex items-left gap-3"},[t("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Дата")])]),t("th",{class:"px-5 py-3 text-left w-3/12 sm:px-6"},[t("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Клиент")]),t("th",{class:"px-5 py-3 text-left w-2/12 sm:px-6"},[t("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Телефон")]),t("th",{class:"px-5 py-3 text-left w-1/12 sm:px-6"},[t("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Товары")]),t("th",{class:"px-5 py-3 text-left w-1/12 sm:px-6"},[t("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Сумма")]),t("th",{class:"px-5 py-3 text-center w-2/12 sm:px-6"},[t("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Статус заказа")])])],-1)),t("tbody",$s,[(s(!0),o(G,null,W(e.orders,h=>(s(),o("tr",{key:h.id,class:"border-t border-gray-100 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800"},[t("td",Is,[t("button",{onClick:B=>w(h.order),class:"font-medium text-left text-gray-800 text-theme-sm dark:text-white/90 hover:text-brand-500 dark:hover:text-brand-400"},c(h.order),9,Os)]),t("td",Cs,[t("p",Ss,c(new Date(h.created_at).toLocaleDateString("ru-RU")),1),t("p",js,c(new Date(h.created_at).toLocaleTimeString("ru-RU")),1)]),t("td",Ds,[t("span",Ts,c(h.name),1),t("span",Us,c(h.email),1)]),t("td",Ps,[t("p",Ms,c(h.phone),1)]),t("td",Bs,[t("p",Qs,c(h.items?h.items.length:0)+" товаров ",1)]),t("td",As,[t("p",Fs,c(e.formatter.format(h.total_amount)),1)]),t("td",qs,[h.status==="pending"?(s(),o("span",Rs," Новый ")):h.status==="processing"?(s(),o("span",Ls," Выполнение ")):h.status==="shipped"?(s(),o("span",Vs," Отправлен ")):h.status==="return"?(s(),o("span",zs," Возврат ")):h.status==="cancelled"?(s(),o("span",Es," Отменён ")):D("",!0)])]))),128))])]))])])]),S(hs,{"is-visible":u.value,"order-id":x.value,onClose:a,onStatusUpdated:f},null,8,["is-visible","order-id"])]))}},Hs={class:"space-y-5 sm:space-y-6"},Gs={class:"rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]"},sr={__name:"Orders",setup(e){const b=k("Заказы"),r=it,u=ut,x=gt,y=xt,w=It,a=dt,f=kt,l=vt,{orders:i,loading:h,error:B,page:j,totalItems:v,totalPages:d,searchQuery:I,selectedStatus:L,statuses:E,formatter:Q,fetchOrders:P,fetchOrderStatistics:J}=H(),K=k(!1),g=k(!1),n=k(""),p=k({current:{pending:0,processing:0,shipped:0,total_amount:0},previous:{pending:0,processing:0,shipped:0,total_amount:0},percentages:{pending:0,processing:0,shipped:0,total_amount:0}}),_=()=>{g.value=!g.value},$=C=>{L.value=C.value===null?null:C,g.value=!1},M=C=>{j.value=C,P()},et=async(C,A)=>{const{updateOrder:F}=H(),X=await F(C.id,{status:A});X.success?(P(),N()):console.error("Ошибка обновления статуса:",X.errors)},st=C=>{n.value=C,N()},N=async()=>{try{const C=await J(n.value);p.value=C}catch(C){console.error("Ошибка загрузки статистики:",C)}};return bt(()=>{P(),N()}),(C,A)=>(s(),T(nt,null,{default:z(()=>[S(lt,{pageTitle:b.value},null,8,["pageTitle"]),t("div",Hs,[S(Xt,{arrowDownIcon:m(r),arrowUpIcon:m(u),shoppingCartIcon:m(a),calendarClockIcon:m(x),calendarDaysIcon:m(y),packageCheckIcon:m(w),statistics:p.value,onMonthChange:st},null,8,["arrowDownIcon","arrowUpIcon","shoppingCartIcon","calendarClockIcon","calendarDaysIcon","packageCheckIcon","statistics"]),t("div",Gs,[S(se,{totalItems:m(v),packageIcon:m(a),downloadIcon:m(f)},null,8,["totalItems","packageIcon","downloadIcon"]),S(be,{searchQuery:m(I),statuses:m(E),selectedItem:m(L),isOpen:g.value,searchIcon:m(l),"onUpdate:searchQuery":A[0]||(A[0]=F=>I.value=F),onToggleDropdown:_,onToggleItem:$,"onUpdate:showFilter":A[1]||(A[1]=F=>K.value=F)},null,8,["searchQuery","statuses","selectedItem","isOpen","searchIcon"]),S(Ns,{loading:m(h),error:m(B),orders:m(i),formatter:m(Q),onFetchOrders:m(P),onUpdateStatus:et},null,8,["loading","error","orders","formatter","onFetchOrders"]),S(ft,{currentPage:m(j),totalPages:m(d),onPageChange:M,class:"px-6"},null,8,["currentPage","totalPages"])])])]),_:1}))}};export{sr as default};
