import{o as s,b as i,d as e,p as Ce,k as U,q as V,s as L,t as P,m as p,l as B,f as j,n as T,F as Z,x as G,T as $e,g as se,e as Q,y as Ie,r as $,u,z as Y,i as Se,j as Pe,h as Le}from"./index-BuW7JYBp.js";import{b as le,c as O,M as ae,a as Be,_ as Ue,P as je}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-CY-WmIWY.js";import{_ as A,a as ne,u as Ne}from"./useCategories-DAHfbZvO.js";import{u as de}from"./useClickOutside-Zof125W1.js";import{_ as Fe,P as Ve,E as Te}from"./DeleteConfirmationModal-DP8PLwn2.js";import{_ as De}from"./Pagination-Cq_T9NUZ.js";import{D as Oe}from"./DownloadIcon-BBMjOxd3.js";import{S as Ee}from"./SearchIcon-BuZNpVZe.js";import{u as Me,a as He}from"./useProductAlerts-rGeCqv-v.js";import"./useAuth-QmaXdZ5k.js";const Re={},_e={class:"stroke-current fill-white dark:fill-gray-800",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Ae(t,b){return s(),i("svg",_e,b[0]||(b[0]=[e("path",{d:"M2.29004 5.90393H17.7067",stroke:"","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),e("path",{d:"M17.7075 14.0961H2.29085",stroke:"","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),e("path",{d:"M12.0826 3.33331C13.5024 3.33331 14.6534 4.48431 14.6534 5.90414C14.6534 7.32398 13.5024 8.47498 12.0826 8.47498C10.6627 8.47498 9.51172 7.32398 9.51172 5.90415C9.51172 4.48432 10.6627 3.33331 12.0826 3.33331Z",fill:"",stroke:"","stroke-width":"1.5"},null,-1),e("path",{d:"M7.91745 11.525C6.49762 11.525 5.34662 12.676 5.34662 14.0959C5.34661 15.5157 6.49762 16.6667 7.91745 16.6667C9.33728 16.6667 10.4883 15.5157 10.4883 14.0959C10.4883 12.676 9.33728 11.525 7.91745 11.525Z",fill:"",stroke:"","stroke-width":"1.5"},null,-1)]))}const Qe=le(Re,[["render",Ae]]),Ze={},Ge={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-upload-icon lucide-upload"};function ze(t,b){return s(),i("svg",Ge,b[0]||(b[0]=[e("path",{d:"M12 3v12"},null,-1),e("path",{d:"m17 8-5-5-5 5"},null,-1),e("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"},null,-1)]))}const qe=le(Ze,[["render",ze]]),Je={class:"flex flex-col justify-between gap-5 border-b border-gray-200 px-5 py-4 sm:flex-row sm:items-center dark:border-gray-800"},Ke={class:"text-base font-medium text-gray-800 dark:text-white/90 flex flex-row items-center"},We={class:"inline-flex items-center shadow-theme-xs"},Xe={__name:"GoodsHeader",props:{totalItems:{type:Number,required:!0},packageIcon:{type:Object,required:!0},downloadIcon:{type:Object,required:!0},uploadIcon:{type:Object,required:!0},editIcon:{type:Object,required:!0},plusIcon:{type:Object,required:!0}},emits:["bulkUpload","bulkEdit"],setup(t){const b="http://test.dennistp.beget.tech",g=async()=>{try{const n=await fetch(`${b}/api/export/products`,{method:"GET",headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!n.ok)throw new Error("Ошибка при скачивании файла");const o=await n.blob(),a=window.URL.createObjectURL(o),m=document.createElement("a");m.href=a,m.download="products_export.xlsx",document.body.appendChild(m),m.click(),window.URL.revokeObjectURL(a),document.body.removeChild(m)}catch(n){console.error("Download error:",n),alert("Произошла ошибка при скачивании файла")}};return(n,o)=>{const a=Ce("router-link");return s(),i("div",Je,[e("h3",Ke,[(s(),U(V(t.packageIcon),{class:"menu-item-icon-active mr-2"})),L(" Список товаров ("+P(t.totalItems)+") ",1)]),e("div",We,[e("button",{onClick:o[0]||(o[0]=m=>n.$emit("bulkEdit")),class:"inline-flex items-center gap-2 px-4 py-3 -ml-px text-sm font-medium bg-transparent text-gray-700 ring-1 ring-inset ring-gray-300 first:rounded-l-lg last:rounded-r-lg hover:bg-gray-50 dark:text-gray-400 dark:ring-gray-700 dark:hover:bg-white/[0.03]"},[(s(),U(V(t.editIcon))),o[2]||(o[2]=L(" Редактировать "))]),e("button",{onClick:g,class:"inline-flex items-center gap-2 px-4 py-3 -ml-px text-sm font-medium bg-transparent text-gray-700 ring-1 ring-inset ring-gray-300 first:rounded-l-lg last:rounded-r-lg hover:bg-gray-50 dark:text-gray-400 dark:ring-gray-700 dark:hover:bg-white/[0.03]"},[o[3]||(o[3]=L(" Скачать ")),(s(),U(V(t.uploadIcon),{width:"18",height:"18"}))]),e("button",{onClick:o[1]||(o[1]=m=>n.$emit("bulkUpload")),class:"inline-flex items-center gap-2 px-4 py-3 -ml-px text-sm font-medium bg-transparent text-gray-700 ring-1 ring-inset ring-gray-300 first:rounded-l-lg last:rounded-r-lg hover:bg-gray-50 dark:text-gray-400 dark:ring-gray-700 dark:hover:bg-white/[0.03]"},[o[4]||(o[4]=L(" Загрузить ")),(s(),U(V(t.downloadIcon)))]),p(a,{to:"/products/create",class:"inline-flex items-center gap-2 px-4 py-3 text-sm font-medium text-white transition bg-brand-500 ring-1 ring-inset ring-brand-500 first:rounded-l-lg last:rounded-r-lg hover:bg-brand-600"},{default:B(()=>[(s(),U(V(t.plusIcon),{width:"20",height:"20"})),o[5]||(o[5]=L(" Добавить "))]),_:1})])])}}},Ye={class:"relative flex-1 sm:flex-auto sm:w-auto sm:min-w-[300px]"},et={class:"absolute top-1/2 left-4 -translate-y-1/2 text-gray-500 dark:text-gray-400"},tt=["value"],ot={__name:"GoodsSearch",props:{searchQuery:String,searchIcon:Object},emits:["update:searchQuery"],setup(t,{emit:b}){const g=b,n=()=>{g("update:searchQuery","")};return(o,a)=>(s(),i("div",Ye,[e("span",et,[(s(),U(V(t.searchIcon)))]),a[1]||(a[1]=e("label",{for:"searchQuery"},null,-1)),e("input",{id:"searchQuery",type:"text",placeholder:"Поиск товара",value:t.searchQuery,onInput:a[0]||(a[0]=m=>g("update:searchQuery",m.target.value)),class:"dark:bg-dark-900 shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800 h-11 w-full rounded-lg border border-gray-300 bg-transparent py-2.5 pr-12 pl-11 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"},null,40,tt),t.searchQuery?(s(),i("button",{key:0,onClick:n,class:"absolute top-1/2 right-2 -translate-y-1/2 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 text-xl leading-none cursor-pointer bg-white dark:bg-gray-900 px-1 z-10"}," ✕ ")):j("",!0)]))}},rt={key:0,class:"text-gray-400"},st={key:1,class:"text-gray-800 dark:text-white/90"},lt={key:0,class:"absolute z-10 w-full mt-1 bg-white rounded-lg shadow-sm dark:bg-gray-900"},at={class:"overflow-y-auto divide-y divide-gray-200 custom-scrollbar max-h-60 dark:divide-gray-800",role:"listbox"},nt=["onClick","aria-selected"],dt={class:"grow"},it={key:0,class:"w-5 h-5 text-gray-400 dark:text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},ct={__name:"GoodsCategorySelector",props:{categories:Array,selectedItem:Object,isOpen:Boolean},emits:["toggleDropdown","toggleItem"],setup(t,{emit:b}){const g=t,n=b,o=de(()=>{g.isOpen&&n("toggleDropdown")}),a=()=>{n("toggleDropdown")},m=x=>{n("toggleItem",x)},I=x=>x.value===null?g.selectedItem===null:g.selectedItem&&g.selectedItem.value===x.value;return(x,d)=>(s(),i("div",{class:"relative sm:min-w-[200px] sm:w-auto",ref_key:"multiSelectRef",ref:o},[e("div",{onClick:a,class:T(["dark:bg-dark-900 h-11 flex items-center w-full appearance-none rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800",{"text-gray-800 dark:text-white/90":t.isOpen}])},[t.selectedItem?(s(),i("span",st,P(t.selectedItem.label),1)):(s(),i("span",rt," Категория ")),(s(),i("svg",{class:T(["ml-auto",{"transform rotate-180":t.isOpen}]),width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},d[0]||(d[0]=[e("path",{d:"M4.79175 7.39551L10.0001 12.6038L15.2084 7.39551",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]),2))],2),p($e,{"enter-active-class":"transition duration-100 ease-out","enter-from-class":"transform scale-95 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-75 ease-in","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-95 opacity-0"},{default:B(()=>[t.isOpen?(s(),i("div",lt,[e("ul",at,[(s(!0),i(Z,null,G(t.categories,l=>(s(),i("li",{key:l.id,onClick:C=>m(l),class:T(["relative flex items-center w-full px-3 py-2 border-transparent cursor-pointer first:rounded-t-lg last:rounded-b-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-800",{"bg-gray-50 dark:bg-white/[0.03]":I(l)}]),role:"option","aria-selected":I(l)},[e("span",dt,P(l.label),1),I(l)?(s(),i("svg",it,d[1]||(d[1]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))):j("",!0)],10,nt))),128))])])):j("",!0)]),_:1})],512))}},ut={class:"mb-5"},gt={class:"mb-5"},xt={class:"mb-5"},ht={__name:"GoodsFilterDropdown",props:{showFilter:Boolean,checkboxSale:Boolean,checkboxNoSale:Boolean,checkboxPublished:Boolean,checkboxNoPublished:Boolean,settingsIcon:Object},emits:["update:showFilter","update:checkboxSale","update:checkboxNoSale","update:checkboxPublished","update:checkboxNoPublished"],setup(t,{emit:b}){const g=t,n=b,o=de(()=>{n("update:showFilter",!1)}),a=()=>{n("update:showFilter",!g.showFilter)},m=()=>{n("update:showFilter",!1)};return(I,x)=>(s(),i("div",{class:"relative",ref_key:"filterRef",ref:o,onClick:m},[e("button",{class:"shadow-theme-xs flex h-11 w-full items-center justify-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400",onClick:se(a,["stop"]),type:"button"},[(s(),U(V(t.settingsIcon))),x[5]||(x[5]=L(" Фильтр "))]),Q(e("div",{onClick:x[4]||(x[4]=se(()=>{},["stop"])),class:"absolute right-0 z-10 mt-2 w-45 rounded-lg border border-gray-200 bg-white p-4 shadow-lg dark:border-gray-700 dark:bg-gray-800"},[e("div",ut,[p(A,{id:"checkboxLabelSale",label:"Распродажа",checked:t.checkboxSale,"onUpdate:checked":x[0]||(x[0]=d=>n("update:checkboxSale",d))},null,8,["checked"])]),e("div",gt,[p(A,{id:"checkboxLabelNoSale",label:"Не распродажа",checked:t.checkboxNoSale,"onUpdate:checked":x[1]||(x[1]=d=>n("update:checkboxNoSale",d))},null,8,["checked"])]),e("div",xt,[p(A,{id:"checkboxLabelPublished",label:"Опубликован",checked:t.checkboxPublished,"onUpdate:checked":x[2]||(x[2]=d=>n("update:checkboxPublished",d))},null,8,["checked"])]),e("div",null,[p(A,{id:"checkboxLabelNoPublished",label:"Не опубликован",checked:t.checkboxNoPublished,"onUpdate:checked":x[3]||(x[3]=d=>n("update:checkboxNoPublished",d))},null,8,["checked"])])],512),[[Ie,t.showFilter]])],512))}},bt={class:"border-b border-gray-200 px-5 py-4 dark:border-gray-800"},pt={class:"flex flex-col md:flex-row gap-3 sm:justify-between"},mt={class:"flex flex-col md:flex-row gap-3"},ft={__name:"GoodsFilters",props:{searchQuery:String,categories:Array,selectedItem:Object,isOpen:Boolean,showFilter:Boolean,checkboxSale:Boolean,checkboxNoSale:Boolean,checkboxPublished:Boolean,checkboxNoPublished:Boolean,searchIcon:Object,settingsIcon:Object},emits:["update:searchQuery","toggleDropdown","toggleItem","update:showFilter","update:checkboxSale","update:checkboxNoSale","update:checkboxPublished","update:checkboxNoPublished"],setup(t,{emit:b}){const g=b;return(n,o)=>(s(),i("div",bt,[e("div",pt,[e("div",mt,[p(ot,{searchQuery:t.searchQuery,searchIcon:t.searchIcon,"onUpdate:searchQuery":o[0]||(o[0]=a=>g("update:searchQuery",a))},null,8,["searchQuery","searchIcon"]),p(ct,{categories:t.categories,selectedItem:t.selectedItem,isOpen:t.isOpen,onToggleDropdown:o[1]||(o[1]=a=>g("toggleDropdown")),onToggleItem:o[2]||(o[2]=a=>g("toggleItem",a))},null,8,["categories","selectedItem","isOpen"])]),p(ht,{showFilter:t.showFilter,checkboxSale:t.checkboxSale,checkboxNoSale:t.checkboxNoSale,checkboxPublished:t.checkboxPublished,checkboxNoPublished:t.checkboxNoPublished,settingsIcon:t.settingsIcon,"onUpdate:showFilter":o[3]||(o[3]=a=>g("update:showFilter",a)),"onUpdate:checkboxSale":o[4]||(o[4]=a=>g("update:checkboxSale",a)),"onUpdate:checkboxNoSale":o[5]||(o[5]=a=>g("update:checkboxNoSale",a)),"onUpdate:checkboxPublished":o[6]||(o[6]=a=>g("update:checkboxPublished",a)),"onUpdate:checkboxNoPublished":o[7]||(o[7]=a=>g("update:checkboxNoPublished",a))},null,8,["showFilter","checkboxSale","checkboxNoSale","checkboxPublished","checkboxNoPublished","settingsIcon"])])]))}},yt={class:"p-4 border-t border-gray-100 dark:border-gray-800 sm:p-6"},kt={class:"space-y-5"},wt={class:"overflow-hidden rounded-xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]"},vt={class:"max-w-full overflow-x-auto custom-scrollbar"},Ct={key:0,class:"flex justify-center items-center h-screen"},$t={key:1,class:"flex flex-col justify-center items-center h-screen font-bold text-error-700 text-theme-xl dark:text-error-500"},It={key:2,class:"flex flex-col justify-center items-center h-screen menu-item-icon-active text-center font-bold text-theme-xl m-5"},St={key:3,class:"min-w-full"},Pt={class:"border-gray-100 border-y bg-gray-50 dark:border-gray-800 dark:bg-gray-900"},Lt={class:"flex items-center gap-3"},Bt={class:"flex flex-col gap-0.5"},Ut={class:"flex items-center gap-3"},jt={class:"flex flex-col gap-0.5"},Nt={class:"divide-y divide-gray-200 dark:divide-gray-700"},Ft={class:"px-5 py-4 sm:px-6"},Vt={class:"font-medium text-center text-gray-800 text-theme-sm dark:text-white/90"},Tt={class:"px-5 py-4 sm:px-2"},Dt=["href"],Ot={class:"text-gray-500 text-theme-sm dark:text-gray-400"},Et={class:"px-5 py-4 sm:px-6"},Mt={class:"text-gray-500 text-center text-theme-sm dark:text-gray-400"},Ht={class:"px-5 py-4 sm:px-1 text-center"},Rt={class:"rounded-full px-2 py-0.5 text-theme-xs font-medium bg-blue-light-50 text-blue-light-500 dark:bg-blue-light-500/15 dark:text-blue-light-500"},_t={class:"px-5 py-4 sm:px-6"},At={class:"font-medium text-center text-gray-800 text-theme-sm dark:text-white/90"},Qt={class:"px-5 py-4 sm:px-6"},Zt={key:0,class:"text-gray-500 text-center text-theme-sm dark:text-gray-400"},Gt={key:1,class:"text-gray-500 text-center text-theme-sm dark:text-gray-400"},zt={key:2,class:"text-gray-500 text-center text-theme-sm dark:text-gray-400"},qt={class:"px-5 py-4 sm:px-6 text-center"},Jt={key:0,class:"rounded-full px-2 py-0.5 text-theme-xs font-medium bg-success-50 text-success-700 dark:bg-success-500/15 dark:text-success-500"},Kt={key:1,class:"rounded-full px-2 py-0.5 text-theme-xs font-medium bg-gray-100 text-gray-700 dark:bg-white/5 dark:text-white/80"},Wt={class:"px-5 py-4 sm:px-6 text-center"},Xt={key:0,class:"rounded-full px-2 py-0.5 text-theme-xs font-medium bg-error-50 text-error-700 dark:bg-error-500/15 dark:text-error-500"},Yt={key:1,class:"rounded-full px-2 py-0.5 text-theme-xs font-medium bg-gray-100 text-gray-700 dark:bg-white/5 dark:text-white/80"},eo={class:"px-5 py-4 sm:px-2 text-center"},to=["onClick"],oo=["onClick"],ro={__name:"GoodsTable",props:{loading:Boolean,error:String,products:Array,formatter:Object,sort:Object},emits:["sortBy","fetchProducts","edit","delete"],setup(t,{emit:b}){const g="http://test.dennistp.beget.tech",n=b,o=(v,r=50)=>v.length<=r?v:v.substring(0,r)+"...",a=$(!1),m=$(null),I=$([]),x=(v,r,D)=>{I.value=[{type:v,title:r,message:D,show:!0}],setTimeout(()=>I.value=[],3e3)},d=v=>{n("sortBy",v)},l=()=>{n("fetchProducts")},C=v=>{n("edit",v)},z=v=>new Promise(r=>{n("delete",v,r)}),S=v=>{m.value=v,a.value=!0},q=async()=>{a.value=!1,await z(m.value)?(x("success","Успешно","Товар успешно удалён"),n("fetchProducts")):x("error","Ошибка","Не удалось удалить товар")};return(v,r)=>{var D,E;return s(),i("div",yt,[e("div",kt,[e("div",wt,[e("div",vt,[t.loading?(s(),i("div",Ct,r[3]||(r[3]=[e("div",{class:"animate-spin rounded-full h-16 w-16 border-b-2 border-brand-500"},null,-1)]))):t.error?(s(),i("div",$t,[r[4]||(r[4]=L(" Ошибка при загрузке")),r[5]||(r[5]=e("br",null,null,-1)),e("button",{class:"inline-flex items-center justify-center font-medium gap-2 rounded-lg transition px-4 py-3 text-sm bg-brand-500 text-white shadow-theme-xs hover:bg-brand-600 disabled:bg-brand-300 mt-2",onClick:l}," Попробовать снова ")])):t.products.length===0?(s(),i("div",It," Товары не найдены ")):(s(),i("table",St,[e("thead",null,[e("tr",Pt,[e("th",{class:"cursor-pointer px-5 py-3 text-center w-1/11 sm:px-6",onClick:r[0]||(r[0]=y=>d("article"))},[e("div",Lt,[r[8]||(r[8]=e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Артикул",-1)),e("span",Bt,[(s(),i("svg",{class:T([t.sort.key==="article"&&t.sort.asc?"text-gray-500 dark:text-gray-400":"text-gray-300 dark:text-gray-400/50","text-gray-500 dark:text-gray-400"]),width:"8",height:"5",viewBox:"0 0 8 5",fill:"none",xmlns:"http://www.w3.org/2000/svg"},r[6]||(r[6]=[e("path",{d:"M4.40962 0.585167C4.21057 0.300808 3.78943 0.300807 3.59038 0.585166L1.05071 4.21327C0.81874 4.54466 1.05582 5 1.46033 5H6.53967C6.94418 5 7.18126 4.54466 6.94929 4.21327L4.40962 0.585167Z",fill:"currentColor"},null,-1)]),2)),(s(),i("svg",{class:T([t.sort.key==="article"&&!t.sort.asc?"text-gray-500 dark:text-gray-400":"text-gray-300 dark:text-gray-400/50","text-gray-300 dark:text-gray-400/50"]),width:"8",height:"5",viewBox:"0 0 8 5",fill:"none",xmlns:"http://www.w3.org/2000/svg"},r[7]||(r[7]=[e("path",{d:"M4.40962 4.41483C4.21057 4.69919 3.78943 4.69919 3.59038 4.41483L1.05071 0.786732C0.81874 0.455343 1.05582 0 1.46033 0H6.53967C6.94418 0 7.18126 0.455342 6.94929 0.786731L4.40962 4.41483Z",fill:"currentColor"},null,-1)]),2))])])]),e("th",{class:"cursor-pointer px-5 py-3 text-center w-2/11 sm:px-6",onClick:r[1]||(r[1]=y=>d("name"))},[e("div",Ut,[r[11]||(r[11]=e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"}," Наименование ",-1)),e("span",jt,[(s(),i("svg",{class:T([t.sort.key==="name"&&t.sort.asc?"text-gray-500 dark:text-gray-400":"text-gray-300 dark:text-gray-400/50","text-gray-500 dark:text-gray-400"]),width:"8",height:"5",viewBox:"0 0 8 5",fill:"none",xmlns:"http://www.w3.org/2000/svg"},r[9]||(r[9]=[e("path",{d:"M4.40962 0.585167C4.21057 0.300808 3.78943 0.300807 3.59038 0.585166L1.05071 4.21327C0.81874 4.54466 1.05582 5 1.46033 5H6.53967C6.94418 5 7.18126 4.54466 6.94929 4.21327L4.40962 0.585167Z",fill:"currentColor"},null,-1)]),2)),(s(),i("svg",{class:T([t.sort.key==="name"&&!t.sort.asc?"text-gray-500 dark:text-gray-400":"text-gray-300 dark:text-gray-400/50","text-gray-300 dark:text-gray-400/50"]),width:"8",height:"5",viewBox:"0 0 8 5",fill:"none",xmlns:"http://www.w3.org/2000/svg"},r[10]||(r[10]=[e("path",{d:"M4.40962 4.41483C4.21057 4.69919 3.78943 4.69919 3.59038 4.41483L1.05071 0.786732C0.81874 0.455343 1.05582 0 1.46033 0H6.53967C6.94418 0 7.18126 0.455342 6.94929 0.786731L4.40962 4.41483Z",fill:"currentColor"},null,-1)]),2))])])]),r[12]||(r[12]=e("th",{class:"px-5 py-3 text-center w-1/11 sm:px-6"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Код товара")],-1)),r[13]||(r[13]=e("th",{class:"px-5 py-3 text-center w-2/11 sm:px-6"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Категория")],-1)),r[14]||(r[14]=e("th",{class:"px-5 py-3 text-center w-1/11 sm:px-6"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Цена")],-1)),r[15]||(r[15]=e("th",{class:"px-5 py-3 text-center w-1/11 sm:px-6"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"ед.изм")],-1)),r[16]||(r[16]=e("th",{class:"px-5 py-3 text-center w-1/11 sm:px-6"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Статус")],-1)),r[17]||(r[17]=e("th",{class:"px-5 py-3 text-center w-1/11 sm:px-6"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Распродажа")],-1)),r[18]||(r[18]=e("th",{class:"px-5 py-3 text-center w-1/11 sm:px-6"},[e("p",{class:"font-bold text-gray-500 text-theme-xs dark:text-gray-400"},"Действие")],-1))])]),e("tbody",Nt,[(s(!0),i(Z,null,G(t.products,y=>(s(),i("tr",{key:y.id,class:"border-t border-gray-100 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800"},[e("td",Ft,[e("p",Vt,P(y.article),1)]),e("td",Tt,[e("a",{href:`${u(g)}/product/${y.slug}`,target:"_blank"},[e("p",Ot,P(o(y.name)),1)],8,Dt)]),e("td",Et,[e("p",Mt,P(y.product_code),1)]),e("td",Ht,[e("span",Rt,P(y.category.name),1)]),e("td",_t,[e("p",At,P(t.formatter.format(y.price)),1)]),e("td",Qt,[y.unit==="шт"?(s(),i("p",Zt," шт. ")):y.unit==="кв.м"?(s(),i("p",Gt," м² ")):(s(),i("p",zt,P(y.unit),1))]),e("td",qt,[y.is_published===!0?(s(),i("span",Jt,"Опубликован")):j("",!0),y.is_published===!1?(s(),i("span",Kt,"Скрыт")):j("",!0)]),e("td",Wt,[y.is_sale===!0?(s(),i("span",Xt,"Распродажа")):j("",!0),y.is_sale===!1?(s(),i("span",Yt,"Нет")):j("",!0)]),e("td",eo,[e("div",{class:"inline-flex items-center justify-center gap-2 rounded-lg transition shadow-theme-xs bg-white text-gray-700 ring-1 ring-gray-300 hover:bg-success-50 hover:ring-success-300 hover:text-success-700 dark:bg-gray-800 dark:text-gray-400 dark:ring-gray-700 dark:hover:bg-success-500/15 dark:hover:ring-success-500/50 dark:hover:text-success-500 cursor-pointer p-1 mr-3",onClick:J=>C(y)},r[19]||(r[19]=[e("svg",{class:"fill-current",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M15.0911 2.78206C14.2125 1.90338 12.7878 1.90338 11.9092 2.78206L4.57524 10.116C4.26682 10.4244 4.0547 10.8158 3.96468 11.2426L3.31231 14.3352C3.25997 14.5833 3.33653 14.841 3.51583 15.0203C3.69512 15.1996 3.95286 15.2761 4.20096 15.2238L7.29355 14.5714C7.72031 14.4814 8.11172 14.2693 8.42013 13.9609L15.7541 6.62695C16.6327 5.74827 16.6327 4.32365 15.7541 3.44497L15.0911 2.78206ZM12.9698 3.84272C13.2627 3.54982 13.7376 3.54982 14.0305 3.84272L14.6934 4.50563C14.9863 4.79852 14.9863 5.2734 14.6934 5.56629L14.044 6.21573L12.3204 4.49215L12.9698 3.84272ZM11.2597 5.55281L5.6359 11.1766C5.53309 11.2794 5.46238 11.4099 5.43238 11.5522L5.01758 13.5185L6.98394 13.1037C7.1262 13.0737 7.25666 13.003 7.35947 12.9002L12.9833 7.27639L11.2597 5.55281Z",fill:""})],-1)]),8,to),e("div",{class:"inline-flex items-center justify-center gap-2 rounded-lg transition shadow-theme-xs bg-white text-gray-700 ring-1 ring-gray-300 hover:bg-error-50 hover:ring-error-300 hover:text-error-700 dark:bg-gray-800 dark:text-gray-400 dark:ring-gray-700 dark:hover:bg-error-500/15 dark:hover:ring-error-500/50 dark:hover:text-error-500 cursor-pointer p-1",onClick:J=>S(y)},r[20]||(r[20]=[e("svg",{class:"fill-current",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M6.54142 3.7915C6.54142 2.54886 7.54878 1.5415 8.79142 1.5415H11.2081C12.4507 1.5415 13.4581 2.54886 13.4581 3.7915V4.0415H15.6252H16.666C17.0802 4.0415 17.416 4.37729 17.416 4.7915C17.416 5.20572 17.0802 5.5415 16.666 4.7915H16.3752V8.24638V13.2464V16.2082C16.3752 17.4508 15.3678 18.4582 14.1252 18.4582H5.87516C4.63252 18.4582 3.62516 17.4508 3.62516 16.2082V13.2464V8.24638V5.5415H3.3335C2.91928 5.5415 2.5835 5.20572 2.5835 4.7915C2.5835 4.37729 2.91928 4.0415 3.3335 4.0415H4.37516H6.54142V3.7915ZM14.8752 13.2464V8.24638V5.5415H13.4581H12.7081H7.29142H6.54142H5.12516V8.24638V13.2464V16.2082C5.12516 16.6224 5.46095 16.9582 5.87516 16.9582H14.1252C14.5394 16.9582 14.8752 16.6224 14.8752 16.2082V13.2464ZM8.04142 4.0415H11.9581V3.7915C11.9581 3.37729 11.6223 3.0415 11.2081 3.0415H8.79142C8.37721 3.0415 8.04142 3.37729 8.04142 3.7915V4.0415ZM8.3335 7.99984C8.74771 7.99984 9.0835 8.33562 9.0835 8.74984V13.7498C9.0835 14.1641 8.74771 14.4998 8.3335 14.4998C7.91928 14.4998 7.5835 14.1641 7.5835 13.7498V8.74984C7.5835 8.33562 7.91928 7.99984 8.3335 7.99984ZM12.4168 8.74984C12.4168 8.33562 12.081 7.99984 11.6668 7.99984C11.2526 7.99984 10.9168 8.33562 10.9168 8.74984V13.7498C10.9168 14.1641 11.2526 14.4998 11.6668 14.4998C12.081 14.4998 12.4168 14.1641 12.4168 13.7498V8.74984Z",fill:""})],-1)]),8,oo)])]))),128))])]))])])]),p(ne,{alerts:I.value},null,8,["alerts"]),p(Fe,{isVisible:a.value,productName:(D=m.value)==null?void 0:D.name,productArticle:(E=m.value)==null?void 0:E.article,onClose:r[2]||(r[2]=y=>a.value=!1),onConfirm:q},null,8,["isVisible","productName","productArticle"])])}}},so={class:"relative bg-white dark:bg-gray-800 rounded-xl shadow-lg max-w-md w-full mx-4"},lo={class:"p-6"},ao={class:"mt-4"},no=["value"],io={class:"flex justify-end mt-4"},co={class:"mt-4"},uo={class:"mt-4 flex justify-end gap-3"},go={__name:"BulkUploadModal",props:{isVisible:Boolean,isLoading:Boolean,categories:Array},emits:["close","upload","downloadTemplate"],setup(t,{emit:b}){const g=b,n=$(null),o=$(""),a=x=>{n.value=x.target.files[0]},m=()=>{n.value&&g("upload",n.value)},I=()=>{o.value&&g("downloadTemplate",o.value)};return(x,d)=>t.isVisible?(s(),U(ae,{key:0,onClose:d[2]||(d[2]=l=>x.$emit("close"))},{body:B(()=>[e("div",so,[e("div",lo,[d[7]||(d[7]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white text-center"}," Массовая загрузка товаров ",-1)),d[8]||(d[8]=e("p",{class:"mt-2 text-sm text-gray-600 dark:text-gray-400 text-center"}," Выберите категорию и скачайте шаблон, или загрузите Excel файл с товарами ",-1)),e("div",ao,[d[4]||(d[4]=e("label",{for:"selectedCategory",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Категория",-1)),Q(e("select",{id:"selectedCategory","onUpdate:modelValue":d[0]||(d[0]=l=>o.value=l),class:"mt-1 dark:bg-dark-900 h-11 flex items-center w-full appearance-none rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},[d[3]||(d[3]=e("option",{value:""},"Выберите категорию",-1)),(s(!0),i(Z,null,G(t.categories.filter(l=>l.value!==null),l=>(s(),i("option",{key:l.id,value:l.value},P(l.label),9,no))),128))],512),[[Y,o.value]])]),e("div",io,[p(O,{variant:"outline",disabled:!o.value,onClick:I},{default:B(()=>d[5]||(d[5]=[L(" Скачать шаблон ")])),_:1},8,["disabled"])]),e("div",co,[e("input",{type:"file",accept:".xlsx,.xls",onChange:a,class:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-100 file:text-blue-700 hover:file:bg-blue-200 dark:file:bg-gray-700 dark:hover:file:bg-gray-600 dark:file:text-gray-400"},null,32)]),e("div",uo,[p(O,{variant:"outline",disabled:t.isLoading,onClick:d[1]||(d[1]=l=>x.$emit("close"))},{default:B(()=>d[6]||(d[6]=[L("Отмена")])),_:1},8,["disabled"]),p(O,{variant:"primary",disabled:!n.value||t.isLoading,onClick:m},{default:B(()=>[L(P(t.isLoading?"Загрузка...":"Загрузить"),1)]),_:1},8,["disabled"])])])])]),_:1})):j("",!0)}},xo={class:"relative bg-white dark:bg-gray-800 rounded-xl shadow-lg max-w-md w-full mx-4"},ho={class:"p-6"},bo={class:"mt-4"},po={key:0,class:"mt-4"},mo=["value"],fo={class:"flex justify-end mt-4"},yo={class:"mt-4"},ko={class:"mt-4 flex justify-end gap-3"},wo={__name:"BulkEditModal",props:{isVisible:Boolean,isLoading:Boolean,categories:Array},emits:["close","upload","downloadTemplate"],setup(t,{emit:b}){const g=b,n=$(null),o=$(""),a=$(""),m=d=>{n.value=d.target.files[0]},I=()=>{n.value&&g("upload",n.value,o.value)},x=()=>{o.value==="products"?g("downloadTemplate",a.value,"products"):g("downloadTemplate",o.value,o.value)};return(d,l)=>t.isVisible?(s(),U(ae,{key:0,onClose:l[3]||(l[3]=C=>d.$emit("close"))},{body:B(()=>[e("div",xo,[e("div",ho,[l[10]||(l[10]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white text-center"}," Массовое редактирование товаров ",-1)),l[11]||(l[11]=e("p",{class:"mt-2 text-sm text-gray-600 dark:text-gray-400 text-center"}," Выберите тип шаблона и скачайте его, или загрузите Excel файл с обновлениями ",-1)),e("div",bo,[l[5]||(l[5]=e("label",{for:"selectedTemplate",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," Тип шаблона ",-1)),Q(e("select",{id:"selectedTemplate","onUpdate:modelValue":l[0]||(l[0]=C=>o.value=C),class:"mt-1 dark:bg-dark-900 h-11 flex items-center w-full appearance-none rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},l[4]||(l[4]=[e("option",{value:""},"Выберите тип шаблона",-1),e("option",{value:"products"},"Товары",-1),e("option",{value:"prices"},"Цены",-1),e("option",{value:"statuses"},"Статусы",-1),e("option",{value:"sales"},"Распродажи",-1)]),512),[[Y,o.value]])]),o.value==="products"?(s(),i("div",po,[l[7]||(l[7]=e("label",{for:"selectedCategory",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Категория",-1)),Q(e("select",{id:"selectedCategory","onUpdate:modelValue":l[1]||(l[1]=C=>a.value=C),class:"mt-1 dark:bg-dark-900 h-11 flex items-center w-full appearance-none rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},[l[6]||(l[6]=e("option",{value:""},"Выберите категорию",-1)),(s(!0),i(Z,null,G(t.categories.filter(C=>C.value!==null),C=>(s(),i("option",{key:C.id,value:C.value},P(C.label),9,mo))),128))],512),[[Y,a.value]])])):j("",!0),e("div",fo,[p(O,{variant:"outline",disabled:!o.value||o.value==="products"&&!a.value,onClick:x},{default:B(()=>l[8]||(l[8]=[L(" Скачать шаблон ")])),_:1},8,["disabled"])]),l[12]||(l[12]=e("p",{class:"mt-10 text-sm text-gray-600 dark:text-gray-400 text-center"}," Перед загрузкой убедитесь, что выше выбран нужный тип шаблона для редактирования ",-1)),e("div",yo,[e("input",{type:"file",accept:".xlsx,.xls",onChange:m,class:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-100 file:text-blue-700 hover:file:bg-blue-200 dark:file:bg-gray-700 dark:hover:file:bg-gray-600 dark:file:text-gray-400"},null,32)]),e("div",ko,[p(O,{variant:"outline",disabled:t.isLoading,onClick:l[2]||(l[2]=C=>d.$emit("close"))},{default:B(()=>l[9]||(l[9]=[L("Отмена")])),_:1},8,["disabled"]),p(O,{variant:"primary",disabled:!n.value||t.isLoading,onClick:I},{default:B(()=>[L(P(t.isLoading?"Загрузка...":"Загрузить"),1)]),_:1},8,["disabled"])])])])]),_:1})):j("",!0)}},vo={class:"space-y-5 sm:space-y-6"},Co={class:"rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]"},Vo={__name:"Goods",setup(t){const b="http://test.dennistp.beget.tech",g=Le(),n=Pe(),o=$("Товары"),a=je,m=Oe,I=Ve,x=Qe,d=Ee,l=qe,C=Te,{alerts:z,showAlert:S}=Me(),{products:q,loading:v,error:r,sort:D,page:E,totalItems:y,totalPages:J,searchQuery:ee,selectedCategory:te,filters:F,formatter:ie,fetchProducts:M,handleSortBy:ce,deleteProduct:ue}=He(),{categories:K,fetchCategories:ge}=Ne(),oe=$(!1),H=$(!1),R=$(!1),W=$(!1),_=$(!1),X=$(!1),xe=()=>{H.value=!H.value},he=w=>{te.value=w.value===null?null:w,H.value=!1},be=w=>{g.push(`/products/edit/${w.id}`)},pe=w=>{E.value=w,M()},me=async(w,c)=>{const h=await ue(w.id);c(h)},fe=()=>{R.value=!0},ye=()=>{_.value=!0},ke=async w=>{W.value=!0;const c=new FormData;c.append("file",w);try{const k=await(await fetch(`${b}/api/products/bulk-upload`,{method:"POST",body:c,headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}})).json();k.success_count>0&&S("success","Успешно",k.message),k.warnings&&k.warnings.length>0&&k.warnings.forEach(f=>S("warning","Предупреждение",f)),k.errors&&k.errors.length>0&&k.errors.forEach(f=>S("error","Ошибка",f)),(k.success_count>0||k.errors.length>0||k.warnings.length>0)&&M()}catch(h){S("error","Ошибка","Произошла ошибка при загрузке файла"),console.error("Upload error:",h)}finally{W.value=!1,R.value=!1}},re=async w=>{try{const c=await fetch(`${b}/api/export/template/${w}`,{method:"GET",headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!c.ok)throw new Error("Failed to download template");const h=await c.blob(),k=window.URL.createObjectURL(h),f=document.createElement("a");f.href=k,f.download=`template_${w}.xlsx`,document.body.appendChild(f),f.click(),f.remove(),window.URL.revokeObjectURL(k)}catch(c){S("error","Ошибка","Произошла ошибка при скачивании шаблона"),console.error("Download error:",c)}},we=async(w,c)=>{X.value=!0;const h=new FormData;h.append("file",w),h.append("type",c);try{const f=await(await fetch(`${b}/api/products/bulk-edit`,{method:"POST",body:h,headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}})).json();f.success_count>0&&S("success","Успешно",f.message),f.warnings&&f.warnings.length>0&&f.warnings.forEach(N=>S("warning","Предупреждение",N)),f.errors&&f.errors.length>0&&f.errors.forEach(N=>S("error","Ошибка",N)),(f.success_count>0||f.errors.length>0||f.warnings.length>0)&&M()}catch(k){S("error","Ошибка","Произошла ошибка при загрузке файла"),console.error("Upload error:",k)}finally{X.value=!1,_.value=!1}},ve=async(w,c)=>{if(c==="products")await re(w);else try{const h=await fetch(`${b}/api/export/edit-template/${c}`,{method:"GET",headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(!h.ok)throw new Error("Failed to download template");const k=await h.blob(),f=window.URL.createObjectURL(k),N=document.createElement("a");N.href=f,N.download=`edit_template_${c}.xlsx`,document.body.appendChild(N),N.click(),N.remove(),window.URL.revokeObjectURL(f)}catch(h){S("error","Ошибка","Произошла ошибка при скачивании шаблона"),console.error("Download error:",h)}};return Se(()=>{ge(),M(),n.query.success==="created"?S("success","Успешно","Товар создан"):n.query.success==="updated"&&S("success","Успешно","Товар обновлен")}),(w,c)=>(s(),U(Be,null,{default:B(()=>[p(ne,{alerts:u(z)},null,8,["alerts"]),p(Ue,{pageTitle:o.value},null,8,["pageTitle"]),e("div",vo,[e("div",Co,[p(Xe,{totalItems:u(y),packageIcon:u(a),downloadIcon:u(m),uploadIcon:u(l),plusIcon:u(I),editIcon:u(C),onBulkUpload:fe,onBulkEdit:ye},null,8,["totalItems","packageIcon","downloadIcon","uploadIcon","plusIcon","editIcon"]),p(ft,{searchQuery:u(ee),categories:u(K),selectedItem:u(te),isOpen:H.value,showFilter:oe.value,checkboxSale:u(F).sale.true,checkboxNoSale:u(F).sale.false,checkboxPublished:u(F).published.true,checkboxNoPublished:u(F).published.false,searchIcon:u(d),settingsIcon:u(x),"onUpdate:searchQuery":c[0]||(c[0]=h=>ee.value=h),onToggleDropdown:xe,onToggleItem:he,"onUpdate:showFilter":c[1]||(c[1]=h=>oe.value=h),"onUpdate:checkboxSale":c[2]||(c[2]=h=>u(F).sale.true=h),"onUpdate:checkboxNoSale":c[3]||(c[3]=h=>u(F).sale.false=h),"onUpdate:checkboxPublished":c[4]||(c[4]=h=>u(F).published.true=h),"onUpdate:checkboxNoPublished":c[5]||(c[5]=h=>u(F).published.false=h)},null,8,["searchQuery","categories","selectedItem","isOpen","showFilter","checkboxSale","checkboxNoSale","checkboxPublished","checkboxNoPublished","searchIcon","settingsIcon"]),p(ro,{loading:u(v),error:u(r),products:u(q),formatter:u(ie),sort:u(D),onSortBy:u(ce),onFetchProducts:u(M),onEdit:be,onDelete:me},null,8,["loading","error","products","formatter","sort","onSortBy","onFetchProducts"]),p(De,{currentPage:u(E),totalPages:u(J),onPageChange:pe,class:"px-6"},null,8,["currentPage","totalPages"])])]),p(go,{isVisible:R.value,isLoading:W.value,categories:u(K),onClose:c[6]||(c[6]=h=>R.value=!1),onUpload:ke,onDownloadTemplate:re},null,8,["isVisible","isLoading","categories"]),p(wo,{isVisible:_.value,isLoading:X.value,categories:u(K),onClose:c[7]||(c[7]=h=>_.value=!1),onUpload:we,onDownloadTemplate:ve},null,8,["isVisible","isLoading","categories"])]),_:1}))}};export{Vo as default};
