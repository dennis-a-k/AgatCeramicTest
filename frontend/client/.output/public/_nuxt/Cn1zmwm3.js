import{_ as q}from"./J-T6rV--.js";import{_ as A,z as D,J as L,r as g,f as I,j as U,y as C,o as a,w as u,a as e,c,u as b,b as f,e as O,d,D as P,K as m,L as p,F as T,m as $,t as r,A as M,v as R,M as E}from"#entry";import{u as F}from"./D8KdIBb5.js";const j={class:"checkout-area pt-100px pb-100px"},J={class:"container"},z={key:1},H={key:0,class:"col-md-12"},K={class:"empty-text-contant text-center"},W={class:"row"},G={class:"col-lg-6"},Q={class:"billing-info-wrap"},X={class:"row"},Y={class:"col-lg-12"},Z={class:"billing-info mb-4"},tt={class:"col-lg-12"},et={class:"billing-info mb-4"},st={class:"col-lg-6 col-md-6"},ot={class:"billing-info mb-4"},lt={class:"col-lg-6 col-md-6"},nt={class:"billing-info mb-4"},it={class:"additional-info-wrap"},at={class:"additional-info"},rt={class:"col-lg-6 mt-md-30px mt-lm-30px"},dt={class:"your-order-area"},ut={class:"your-order-wrap gray-bg-4"},ct={class:"your-order-product-info"},mt={class:"your-order-middle"},pt={class:"col-7"},_t={class:"order-middle-left"},vt={class:"col-2 text-end"},ft={class:"col-3 text-end"},gt={class:"order-price"},bt={class:"your-order-total"},yt={class:"row Place-order mt-25"},ht={class:"col-md-6 mb-3 mb-md-0"},xt={class:"col-md-6"},wt=["disabled"],kt={class:"your-order-foot mt-3"},Ut={class:"text-end"},Ct={__name:"index",setup(St){const n=D(),y=R(),{$toast:h}=L(),_=g(!1),x=g(!0);I(()=>{setTimeout(()=>{x.value=!1},500)});const o=g({name:"",email:"",phone:"",address:"",comment:""}),S=l=>{let t=l.target.value.replace(/\D/g,"");t.startsWith("7")&&(t=t.substring(1)),t.length>10&&(t=t.substring(0,10));let i="+7";t.length>0&&(i+=" ("+t.substring(0,3)),t.length>=4&&(i+=") "+t.substring(3,6)),t.length>=7&&(i+="-"+t.substring(6,8)),t.length>=9&&(i+="-"+t.substring(8,10)),o.value.phone=i},V=new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB"}),w=l=>V.format(l),B=async()=>{_.value=!0;try{const l={customer:o.value,items:n.items,total:n.total},t=await $fetch(`${y.public.apiBase}/api/checkout`,{method:"POST",body:l});n.clearCart(),o.value={name:"",email:"",phone:"",address:"",comment:""},h.success("Заказ успешно оформлен! Мы свяжемся с вами в ближайшее время."),await E("/order/"+t.order)}catch(l){console.error("Error submitting order:",l),h.error("Произошла ошибка при оформлении заказа. Попробуйте еще раз.")}finally{_.value=!1}},k=U(()=>n.items.length===0?null:{"@context":"https://schema.org","@type":"ItemList",name:"Оформление заказа",itemListElement:n.items.map((l,t)=>({"@type":"Product",position:t+1,name:l.title,image:l.image,offers:{"@type":"Offer",price:l.price,priceCurrency:"RUB",availability:"https://schema.org/InStock"}}))});return F(U(()=>({title:"Оформление заказа - AgatCeramic",meta:[{name:"description",content:"Оформите заказ в интернет-магазине AgatCeramic"},{name:"keywords",content:"оформление заказа, заказ, AgatCeramic"},{name:"robots",content:"noindex, nofollow"}],link:[{rel:"canonical",href:`${y.public.siteUrl}/checkout`}],script:k.value?[{type:"application/ld+json",children:JSON.stringify(k.value)}]:[]}))),(l,t)=>{const i=q,v=O,N=M;return a(),C(N,null,{default:u(()=>[e("main",j,[e("div",J,[x.value?(a(),C(i,{key:0,text:"Загрузка страницы оформления..."})):(a(),c("div",z,[b(n).items.length===0?(a(),c("div",H,[e("div",K,[t[6]||(t[6]=e("i",{class:"pe-7s-cart"},null,-1)),t[7]||(t[7]=e("h3",null,"Ваша корзина пуста",-1)),f(v,{to:"/",class:"empty-cart-btn"},{default:u(()=>[...t[5]||(t[5]=[e("i",{class:"fa fa-arrow-left"},null,-1),d(" Перети к покупкам ",-1)])]),_:1})])])):(a(),c("form",{key:1,onSubmit:P(B,["prevent"])},[e("div",W,[e("div",G,[e("div",Q,[t[13]||(t[13]=e("h3",null,"Детали заказа",-1)),e("div",X,[e("div",Y,[e("div",Z,[t[8]||(t[8]=e("label",{for:"name"},"ФИО",-1)),m(e("input",{type:"text",id:"name","onUpdate:modelValue":t[0]||(t[0]=s=>o.value.name=s),required:""},null,512),[[p,o.value.name]])])]),e("div",tt,[e("div",et,[t[9]||(t[9]=e("label",{for:"address"},"Адрес доставки",-1)),m(e("input",{type:"text",id:"address","onUpdate:modelValue":t[1]||(t[1]=s=>o.value.address=s),required:""},null,512),[[p,o.value.address]])])]),e("div",st,[e("div",ot,[t[10]||(t[10]=e("label",{for:"phone"},"Телефон",-1)),m(e("input",{type:"tel",id:"phone","onUpdate:modelValue":t[2]||(t[2]=s=>o.value.phone=s),onInput:S,placeholder:"+7 (___) ___-__-__",required:""},null,544),[[p,o.value.phone]])])]),e("div",lt,[e("div",nt,[t[11]||(t[11]=e("label",{for:"email"},"Электронная почта",-1)),m(e("input",{type:"email",id:"email","onUpdate:modelValue":t[3]||(t[3]=s=>o.value.email=s),required:""},null,512),[[p,o.value.email]])])])]),e("div",it,[e("div",at,[t[12]||(t[12]=e("label",{for:"comment"},"Комментарий к заказу",-1)),m(e("textarea",{id:"comment","onUpdate:modelValue":t[4]||(t[4]=s=>o.value.comment=s)},null,512),[[p,o.value.comment]])])])])]),e("div",rt,[e("div",dt,[t[21]||(t[21]=e("h3",null,"Ваш заказ",-1)),e("div",ut,[e("div",ct,[t[15]||(t[15]=e("div",{class:"your-order-top"},[e("ul",null,[e("li",null,"Товар"),e("li",null,"Стоимость")])],-1)),e("div",mt,[(a(!0),c(T,null,$(b(n).items,s=>(a(),c("div",{key:s.id,class:"row align-items-center lh-1 mb-3"},[e("div",pt,[e("span",_t,r(s.title)+r(s.weight_kg?`, ${s.weight_kg} кг`:""),1)]),e("div",vt," × "+r(s.quantity)+" "+r(s.unit==="шт"?"шт.":s.unit==="кв.м"?"м²":s.unit),1),e("div",ft,[e("span",gt,r(w(s.price*s.quantity)),1)])]))),128))]),e("div",bt,[e("ul",null,[t[14]||(t[14]=e("li",{class:"order-total"},"Итого",-1)),e("li",null,r(w(b(n).total)),1)])])])]),e("div",yt,[e("div",ht,[f(v,{to:"/cart",class:"btn-change"},{default:u(()=>[...t[16]||(t[16]=[d("Изменить",-1)])]),_:1})]),e("div",xt,[e("button",{type:"submit",class:"btn-order",style:{width:"100%"},disabled:_.value},r(_.value?"Оформление...":"Заказать"),9,wt)])]),e("div",kt,[e("p",Ut,[t[19]||(t[19]=d(" Нажимая кнопку «Заказать», я даю ",-1)),f(v,{to:"/personal-data",target:"_blank"},{default:u(()=>[...t[17]||(t[17]=[d("согласие",-1)])]),_:1}),t[20]||(t[20]=d(" на обработку персональных данных, в соответствии с ",-1)),f(v,{to:"/policy",target:"_blank"},{default:u(()=>[...t[18]||(t[18]=[d(" Политикой",-1)])]),_:1})])])])])])],32))]))])])]),_:1})}}},qt=A(Ct,[["__scopeId","data-v-dae4b6f6"]]);export{qt as default};
