import{_ as z,a as $,b as N,c as q}from"./C_dKmHoP.js";import{_ as I}from"./J-T6rV--.js";import{_ as R}from"./6CSHncr3.js";import{B as V,r as h,j as f,_ as L,f as D,l as j,c as x,o as d,a as i,b,u as s,y as S,d as U,s as H,F as M,m as G,w as J,A as K,v as Q}from"#entry";import{u as W}from"./BvfAwmOK.js";import{u as X}from"./e-3Jczw9.js";import"./BROWsude.js";const T={categories:{nameField:"name"},brands:{nameField:"name"},colors:{nameField:"name"},patterns:{nameField:"name"},weights:{nameField:"value"},subcategories:{nameField:"name"},glues:{nameField:"name"},mixture_types:{nameField:"name"},seams:{nameField:"name"},textures:{nameField:"name"},countries:{nameField:"name"},sizes:{nameField:"name"},materials:{nameField:"name"},waterproofs:{nameField:"name"},collections:{nameField:"name"},volumes:{nameField:"value"},product_weights:{nameField:"value"},installation_types:{nameField:"name"},shapes:{nameField:"name"},applications:{nameField:"name"},drying_times:{nameField:"name"},package_weights:{nameField:"value"},min_temps:{nameField:"value"},max_temps:{nameField:"value"},consumptions:{nameField:"name"}},v=Object.keys(T),B={category:"categories",brand:"brands",color:"colors",pattern:"patterns",weight:"weights",subcategory:"subcategories",glue:"glues",mixture_type:"mixture_types",seam:"seams",texture:"textures",country:"countries",size:"sizes",material:"materials",waterproof:"waterproofs",collection:"collections",volume:"volumes",product_weight:"product_weights",installation_type:"installation_types",shape:"shapes",application:"applications",drying_time:"drying_times",package_weight:"package_weights",min_temp:"min_temps",max_temp:"max_temp",consumption:"consumptions"},Y=(u,e)=>{let m;return(..._)=>{clearTimeout(m),m=setTimeout(()=>u(..._),e)}},Z=V("sale",()=>{const u=h(Object.fromEntries(v.map(t=>[t,[]]))),e=h(Object.fromEntries(v.map(t=>[t,[]]))),m=h(""),_=h(""),g=h("default"),p=h(1),w=f(()=>{const t={...e.value,min_price:m.value,max_price:_.value,sort:g.value,page:p.value};return t.categories&&t.categories.length>0&&(t.category_ids=t.categories,delete t.categories),Object.keys(t).forEach(n=>{const a=t[n];(a===""||a===null||a===void 0||Array.isArray(a)&&a.length===0)&&delete t[n]}),t}),k=f(()=>{const t=[];return v.forEach(n=>{e.value[n].forEach(a=>{const c=u.value[n].find(E=>E.id===a);if(c){const E=T[n];t.push({type:n,id:a,name:c[E.nameField]})}})}),t}),r=t=>{Object.assign(u.value,t)},F=t=>{v.forEach(n=>{e.value[n]=t[n]||[]}),p.value=1},y=Y(F,300),o=t=>{p.value=t},l=t=>{g.value=t,p.value=1},C=(t,n)=>{const a=B[t]||t;e.value[a]&&(e.value[a]=e.value[a].filter(c=>c!==n)),F(e.value)},O=(t,n)=>{const a=B[t]||t;if(e.value[a]){const c=e.value[a].indexOf(n);c===-1?e.value[a].push(n):e.value[a].splice(c,1)}y(e.value)},P=()=>{v.forEach(t=>{e.value[t]=[]}),g.value="default",p.value=1,Object.keys(u.value).forEach(t=>{u.value[t]=[]})},A=Object.fromEntries(v.map(t=>[`selected${t.charAt(0).toUpperCase()+t.slice(1)}`,f(()=>e.value[t])]));return{filters:u,selected:e,minPrice:m,maxPrice:_,sortOption:g,currentPage:p,...A,queryParams:w,selectedFilters:k,setFilters:r,handleFilterChange:F,debouncedHandleFilterChange:y,changePage:o,handleSortChange:l,removeFilter:C,selectFilter:O,resetFilters:P}}),ee={class:"shop-category-area pt-100px pb-100px"},te={class:"container"},se={class:"row"},ae={class:"col-lg-9 order-lg-last col-md-12 order-md-first"},ne={class:"shop-top-bar d-flex justify-content-between mb-3"},ie={key:1,class:"error text-center mt-5"},oe={key:2,class:"text-center mt-2"},re={key:3,class:"shop-bottom-area"},le={class:"row"},ce={class:"col"},me={class:"tab-content"},ue={class:"tab-pane fade show active",id:"shop-grid"},pe={class:"row mb-n-30px"},de={__name:"index",setup(u){const e=Z();D(()=>{e.resetFilters()});const m=Q(),{data:_,pending:g,error:p,execute:w}=W("sale-products",()=>$fetch(`${m.public.apiBase}/api/sale/products`,{query:e.queryParams}),{immediate:!1}),k=()=>w();j(()=>e.queryParams,()=>k(),{immediate:!0});const r=f(()=>_.value?.products||null);j(_,o=>{o&&o.filters&&e.setFilters(o.filters)},{immediate:!0});const F=f(()=>p.value&&!g.value),y=f(()=>r.value?.data?{"@context":"https://schema.org","@type":"ItemList",name:"Распродажа",description:"Товары со скидками и специальными предложениями",url:`${m.public.siteUrl}/sale`,numberOfItems:r.value.data.length,itemListElement:r.value.data.map((o,l)=>({"@type":"Product",position:l+1,name:o.name,description:o.description,image:o.image,offers:{"@type":"Offer",price:o.price,priceCurrency:"RUB",availability:o.in_stock?"https://schema.org/InStock":"https://schema.org/OutOfStock"}}))}:null);return X(f(()=>({title:"Распродажа - AgatCeramic",meta:[{name:"description",content:"Купить товары на распродаже в интернет-магазине AgatCeramic"},{name:"keywords",content:"распродажа, скидки, керамическая плитка, сантехника"}],link:[{rel:"canonical",href:`${m.public.siteUrl}/sale`}],script:y.value?[{type:"application/ld+json",children:JSON.stringify(y.value)}]:[]}))),(o,l)=>{const C=z,O=$,P=I,A=R,t=N,n=q,a=K;return d(),x("main",ee,[i("div",te,[b(C,{selectedFilters:s(e).selectedFilters,onRemoveFilter:s(e).removeFilter},null,8,["selectedFilters","onRemoveFilter"]),i("div",se,[i("div",ae,[i("div",ne,[l[0]||(l[0]=i("div",{class:"category-text"},[i("h1",{class:"h3 m-0"},"Распродажа"),i("p",null,"Товары со скидками и специальными предложениями")],-1)),b(O,{"onUpdate:sortOption":s(e).handleSortChange},null,8,["onUpdate:sortOption"])]),s(g)?(d(),S(P,{key:0,text:"Загрузка товаров..."})):F.value?(d(),x("div",ie,[...l[1]||(l[1]=[i("h2",null,[U("Произошла ошибка при загрузке товаров."),i("br"),U("Попробуйте перезагрузить страницу.")],-1)])])):!r.value||!r.value.data||r.value.data.length===0?(d(),x("div",oe,[...l[2]||(l[2]=[i("h2",null,"Список товаров пуст",-1)])])):(d(),x("div",re,[i("div",le,[i("div",ce,[i("div",me,[i("div",ue,[i("div",pe,[(d(!0),x(M,null,G(r.value.data,c=>(d(),S(A,{key:c.id,product:c},null,8,["product"]))),128))])])])])]),r.value.last_page>1?(d(),S(t,{key:0,"current-page":r.value.current_page,"total-pages":r.value.last_page,onChangePage:s(e).changePage},null,8,["current-page","total-pages","onChangePage"])):H("",!0)]))]),b(a,null,{default:J(()=>[b(n,{store:s(e),showCategoriesFilter:!0,categories:s(e).filters.categories,subcategories:s(e).filters.subcategories,patterns:s(e).filters.patterns,weights:s(e).filters.weights,colors:s(e).filters.colors,glues:s(e).filters.glues,mixture_types:s(e).filters.mixture_types,seams:s(e).filters.seams,textures:s(e).filters.textures,countries:s(e).filters.countries,sizes:s(e).filters.sizes,materials:s(e).filters.materials,waterproofs:s(e).filters.waterproofs,collections:s(e).filters.collections,volumes:s(e).filters.volumes,product_weights:s(e).filters.product_weights,installation_types:s(e).filters.installation_types,shapes:s(e).filters.shapes,applications:s(e).filters.applications,drying_times:s(e).filters.drying_times,package_weights:s(e).filters.package_weights,min_temps:s(e).filters.min_temps,max_temps:s(e).filters.max_temps,consumptions:s(e).filters.consumptions,brands:s(e).filters.brands,initialFilters:s(e).filters},null,8,["store","categories","subcategories","patterns","weights","colors","glues","mixture_types","seams","textures","countries","sizes","materials","waterproofs","collections","volumes","product_weights","installation_types","shapes","applications","drying_times","package_weights","min_temps","max_temps","consumptions","brands","initialFilters"])]),_:1})])])])}}},xe=L(de,[["__scopeId","data-v-6176c8b8"]]);export{xe as default};
