import{_ as I,a as B,b as N,c as q}from"./DNCqsGop.js";import{_ as R}from"./D7avEDMr.js";import{_ as V}from"./Bqof-9AT.js";import{D,r as h,d as f,_ as L,z as H,o as J,s as M,w as U,A as G,e as x,f as _,j as i,g as k,u as s,x as E,y as $,m as K,F as Q,k as W,i as X,C as Y}from"#entry";import{u as Z}from"./Duy6kUCN.js";const T={categories:{nameField:"name"},brands:{nameField:"name"},colors:{nameField:"name"},patterns:{nameField:"name"},weights:{nameField:"value"},subcategories:{nameField:"name"},glues:{nameField:"name"},mixture_types:{nameField:"name"},seams:{nameField:"name"},textures:{nameField:"name"},countries:{nameField:"name"},sizes:{nameField:"name"},materials:{nameField:"name"},waterproofs:{nameField:"name"},collections:{nameField:"name"},volumes:{nameField:"value"},product_weights:{nameField:"value"},installation_types:{nameField:"name"},shapes:{nameField:"name"},applications:{nameField:"name"},drying_times:{nameField:"name"},package_weights:{nameField:"value"},min_temps:{nameField:"value"},max_temps:{nameField:"value"},consumptions:{nameField:"name"}},v=Object.keys(T),z={category:"categories",brand:"brands",color:"colors",pattern:"patterns",weight:"weights",subcategory:"subcategories",glue:"glues",mixture_type:"mixture_types",seam:"seams",texture:"textures",country:"countries",size:"sizes",material:"materials",waterproof:"waterproofs",collection:"collections",volume:"volumes",product_weight:"product_weights",installation_type:"installation_types",shape:"shapes",application:"applications",drying_time:"drying_times",package_weight:"package_weights",min_temp:"min_temps",max_temp:"max_temp",consumption:"consumptions"},ee=(d,e)=>{let m;return(...g)=>{clearTimeout(m),m=setTimeout(()=>d(...g),e)}},te=D("sale",()=>{const d=h(Object.fromEntries(v.map(t=>[t,[]]))),e=h(Object.fromEntries(v.map(t=>[t,[]]))),m=h(""),g=h(""),l=h("default"),p=h(1),b=f(()=>{const t={...e.value,min_price:m.value,max_price:g.value,sort:l.value,page:p.value};return t.categories&&t.categories.length>0&&(t.category_ids=t.categories,delete t.categories),Object.keys(t).forEach(o=>{const a=t[o];(a===""||a===null||a===void 0||Array.isArray(a)&&a.length===0)&&delete t[o]}),t}),C=f(()=>{const t=[];return v.forEach(o=>{e.value[o].forEach(a=>{const u=d.value[o].find(F=>F.id===a);if(u){const F=T[o];t.push({type:o,id:a,name:u[F.nameField]})}})}),t}),P=t=>{Object.assign(d.value,t)},y=t=>{v.forEach(o=>{e.value[o]=t[o]||[]}),p.value=1},r=ee(y,300),O=t=>{p.value=t},w=t=>{l.value=t,p.value=1},n=(t,o)=>{const a=z[t]||t;e.value[a]&&(e.value[a]=e.value[a].filter(u=>u!==o)),y(e.value)},c=(t,o)=>{const a=z[t]||t;if(e.value[a]){const u=e.value[a].indexOf(o);u===-1?e.value[a].push(o):e.value[a].splice(u,1)}r(e.value)},S=()=>{v.forEach(t=>{e.value[t]=[]}),l.value="default",p.value=1,Object.keys(d.value).forEach(t=>{d.value[t]=[]})},A=Object.fromEntries(v.map(t=>[`selected${t.charAt(0).toUpperCase()+t.slice(1)}`,f(()=>e.value[t])]));return{filters:d,selected:e,minPrice:m,maxPrice:g,sortOption:l,currentPage:p,...A,queryParams:b,selectedFilters:C,setFilters:P,handleFilterChange:y,debouncedHandleFilterChange:r,changePage:O,handleSortChange:w,removeFilter:n,selectFilter:c,resetFilters:S}}),se={class:"shop-category-area pt-100px pb-100px"},ae={class:"container"},oe={class:"row"},ne={class:"col-lg-9 order-lg-last col-md-12 order-md-first"},ie={class:"shop-top-bar d-flex justify-content-between mb-3 row"},re={key:1,class:"error text-center mt-5"},le={key:2,class:"text-center mt-2"},ce={key:3,class:"shop-bottom-area"},me={class:"row"},pe={class:"col"},ue={class:"tab-content"},de={class:"tab-pane fade show active",id:"shop-grid"},ge={class:"row mb-n-30px"},_e={__name:"index",setup(d){const e=te(),m=H();J(async()=>{e.resetFilters();try{await m.fetchSiteInfo()}catch(n){console.error("Failed to load site info:",n)}});const g=M(),l=g.public.siteUrl||"https://agatceramic.ru",{data:p,pending:b,error:C,execute:P}=Z("sale-products",()=>$fetch(`${g.public.apiBase}/api/sale/products`,{query:e.queryParams}),{immediate:!1}),y=()=>P();U(()=>e.queryParams,()=>y(),{immediate:!0});const r=f(()=>p.value?.products||null);U(p,n=>{n&&n.filters&&e.setFilters(n.filters)},{immediate:!0});const O=f(()=>C.value&&!b.value),w=f(()=>r.value?.data?{"@context":"https://schema.org","@type":"ItemList",name:"Распродажа",description:"Товары со скидками и специальными предложениями",url:`${g.public.siteUrl}/sale`,numberOfItems:r.value.data.length,itemListElement:r.value.data.map((n,c)=>({"@type":"Product",position:c+1,name:n.name,description:n.description,image:n.image,offers:{"@type":"Offer",price:n.price,priceCurrency:"RUB",availability:n.in_stock?"https://schema.org/InStock":"https://schema.org/OutOfStock"}}))}:null);return G(f(()=>({title:"Распродажа - AgatCeramic",meta:[{name:"description",content:"Успейте купить товар со скидкой в Москве и Московской области. Ограниченные коллекции, остатки премиальных серий и выгодные акции – только сейчас!"},{name:"keywords",content:"распродажа, скидки, керамическая плитка, сантехника"},{property:"og:image",content:`${l}/images/stock/logo.png`},{property:"og:title",content:"AgatCeramic - Интернет-магазин плитки, керамогранита и сантехники"},{property:"og:description",content:"Успейте купить товар со скидкой в Москве и Московской области. Ограниченные коллекции, остатки премиальных серий и выгодные акции – только сейчас!"},{property:"og:url",content:`${l}/sale`},{name:"twitter:image",content:`${l}/images/stock/logo.png`}],link:[{rel:"canonical",href:`${l}/sale`}],script:[...w.value?[{type:"application/ld+json",children:JSON.stringify(w.value)}]:[],{type:"application/ld+json",children:JSON.stringify({"@context":"https://schema.org","@type":"Organization",name:"AgatCeramic",url:l,logo:`${l}/images/stock/logo.png`,description:"Интернет-магазин плитки, керамогранита и сантехники",email:m.getEmail,contactPoint:{"@type":"ContactPoint",telephone:m.getFormattedPhone,contactType:"customer service"}})}]}))),(n,c)=>{const S=I,A=B,t=R,o=V,a=N,u=q,F=Y;return _(),x("main",se,[i("div",ae,[k(S,{selectedFilters:s(e).selectedFilters,onRemoveFilter:s(e).removeFilter},null,8,["selectedFilters","onRemoveFilter"]),i("div",oe,[i("div",ne,[i("div",ie,[c[0]||(c[0]=i("div",{class:"category-text col-sm-12 col-md-6 mb-3 mb-md-0"},[i("h1",{class:"h3 m-0"},"Распродажа"),i("p",null,"Товары со скидками и специальными предложениями")],-1)),k(A,{"onUpdate:sortOption":s(e).handleSortChange},null,8,["onUpdate:sortOption"])]),s(b)?(_(),E(t,{key:0,text:"Загрузка товаров..."})):O.value?(_(),x("div",re,[...c[1]||(c[1]=[i("h2",null,[$("Произошла ошибка при загрузке товаров."),i("br"),$("Попробуйте перезагрузить страницу.")],-1)])])):!r.value||!r.value.data||r.value.data.length===0?(_(),x("div",le,[...c[2]||(c[2]=[i("h2",null,"Список товаров пуст",-1)])])):(_(),x("div",ce,[i("div",me,[i("div",pe,[i("div",ue,[i("div",de,[i("div",ge,[(_(!0),x(Q,null,W(r.value.data,j=>(_(),E(o,{key:j.id,product:j},null,8,["product"]))),128))])])])])]),r.value.last_page>1?(_(),E(a,{key:0,"current-page":r.value.current_page,"total-pages":r.value.last_page,onChangePage:s(e).changePage},null,8,["current-page","total-pages","onChangePage"])):K("",!0)]))]),k(F,null,{default:X(()=>[k(u,{store:s(e),showCategoriesFilter:!0,categories:s(e).filters.categories,subcategories:s(e).filters.subcategories,patterns:s(e).filters.patterns,weights:s(e).filters.weights,colors:s(e).filters.colors,glues:s(e).filters.glues,mixture_types:s(e).filters.mixture_types,seams:s(e).filters.seams,textures:s(e).filters.textures,countries:s(e).filters.countries,sizes:s(e).filters.sizes,materials:s(e).filters.materials,waterproofs:s(e).filters.waterproofs,collections:s(e).filters.collections,volumes:s(e).filters.volumes,product_weights:s(e).filters.product_weights,installation_types:s(e).filters.installation_types,shapes:s(e).filters.shapes,applications:s(e).filters.applications,drying_times:s(e).filters.drying_times,package_weights:s(e).filters.package_weights,min_temps:s(e).filters.min_temps,max_temps:s(e).filters.max_temps,consumptions:s(e).filters.consumptions,brands:s(e).filters.brands,initialFilters:s(e).filters},null,8,["store","categories","subcategories","patterns","weights","colors","glues","mixture_types","seams","textures","countries","sizes","materials","waterproofs","collections","volumes","product_weights","installation_types","shapes","applications","drying_times","package_weights","min_temps","max_temps","consumptions","brands","initialFilters"])]),_:1})])])])}}},xe=L(_e,[["__scopeId","data-v-9a00b130"]]);export{xe as default};
