import{_ as q,a as D,b as I,c as V}from"./C_dKmHoP.js";import{_ as L}from"./J-T6rV--.js";import{_ as H}from"./6CSHncr3.js";import{B as M,r as y,j as v,_ as G,C as J,f as K,l as U,c as h,o as p,a as l,b as C,u as s,y as $,s as S,t as B,d as T,F as Q,m as W,w as X,A as Y,v as Z}from"#entry";import{u as ee}from"./BvfAwmOK.js";import{u as te}from"./e-3Jczw9.js";import"./BROWsude.js";const N={categories:{nameField:"name"},brands:{nameField:"name"},colors:{nameField:"name"},patterns:{nameField:"name"},weights:{nameField:"value"},subcategories:{nameField:"name"},glues:{nameField:"name"},mixture_types:{nameField:"name"},seams:{nameField:"name"},textures:{nameField:"name"},countries:{nameField:"name"},sizes:{nameField:"name"},materials:{nameField:"name"},waterproofs:{nameField:"name"},collections:{nameField:"name"},volumes:{nameField:"value"},product_weights:{nameField:"value"},installation_types:{nameField:"name"},shapes:{nameField:"name"},applications:{nameField:"name"},drying_times:{nameField:"name"},package_weights:{nameField:"value"},min_temps:{nameField:"value"},max_temps:{nameField:"value"},consumptions:{nameField:"name"}},F=Object.keys(N),z={category:"categories",brand:"brands",color:"colors",pattern:"patterns",weight:"weights",subcategory:"subcategories",glue:"glues",mixture_type:"mixture_types",seam:"seams",texture:"textures",country:"countries",size:"sizes",material:"materials",waterproof:"waterproofs",collection:"collections",volume:"volumes",product_weight:"product_weights",installation_type:"installation_types",shape:"shapes",application:"applications",drying_time:"drying_times",package_weight:"package_weights",min_temp:"min_temps",max_temp:"max_temps",consumption:"consumptions"},se=(_,n)=>{let m;return(...e)=>{clearTimeout(m),m=setTimeout(()=>_(...e),n)}},ae=M("category",()=>{const _=y(Object.fromEntries(F.map(t=>[t,[]]))),n=y(Object.fromEntries(F.map(t=>[t,[]]))),m=y(""),e=y(""),g=y("default"),u=y(1),w=v(()=>{const t={...n.value,min_price:m.value,max_price:e.value,sort:g.value,page:u.value};return t.categories&&t.categories.length>0&&(t.category_ids=t.categories,delete t.categories),Object.keys(t).forEach(o=>{const a=t[o];(a===""||a===null||a===void 0||Array.isArray(a)&&a.length===0)&&delete t[o]}),t}),O=v(()=>{const t=[];return F.forEach(o=>{n.value[o].forEach(a=>{const d=_.value[o].find(b=>b.id===a);if(d){const b=N[o];t.push({type:o,id:a,name:d[b.nameField]})}})}),t}),P=t=>{Object.assign(_.value,t)},x=t=>{F.forEach(o=>{n.value[o]=t[o]||[]}),u.value=1},i=se(x,300),c=t=>{u.value=t},A=t=>{g.value=t,u.value=1},k=(t,o)=>{const a=z[t]||t;n.value[a]&&(n.value[a]=n.value[a].filter(d=>d!==o)),x(n.value)},r=(t,o)=>{const a=z[t]||t;if(n.value[a]){const d=n.value[a].indexOf(o);d===-1?n.value[a].push(o):n.value[a].splice(d,1)}i(n.value)},f=()=>{F.forEach(t=>{n.value[t]=[]}),g.value="default",u.value=1,Object.keys(_.value).forEach(t=>{_.value[t]=[]})},E=Object.fromEntries(F.map(t=>[`selected${t.charAt(0).toUpperCase()+t.slice(1)}`,v(()=>n.value[t])]));return{filters:_,selected:n,minPrice:m,maxPrice:e,sortOption:g,currentPage:u,...E,queryParams:w,selectedFilters:O,setFilters:P,handleFilterChange:x,debouncedHandleFilterChange:i,changePage:c,handleSortChange:A,removeFilter:k,selectFilter:r,resetFilters:f}}),ne={class:"shop-category-area pt-100px pb-100px"},oe={class:"container"},ie={class:"row"},re={class:"col-lg-9 order-lg-last col-md-12 order-md-first"},le={class:"shop-top-bar d-flex justify-content-between mb-3"},ce={class:"category-text"},me={key:0,class:"h3 m-0"},ue={key:1},pe={key:1,class:"error text-center mt-5"},de={key:2,class:"text-center mt-2"},_e={key:3,class:"shop-bottom-area"},ge={class:"row"},fe={class:"col"},ve={class:"tab-content"},he={class:"tab-pane fade show active",id:"shop-grid"},ye={class:"row mb-n-30px"},Fe={__name:"[slug]",setup(_){const m=J().params.slug,e=ae();K(()=>{e.resetFilters()});const g=Z(),{data:u,pending:w,error:O,execute:P}=ee(`category-products-${m}`,()=>$fetch(`${g.public.apiBase}/api/category/${m}/products`,{query:e.queryParams}),{immediate:!1}),x=()=>P();U(()=>e.queryParams,()=>x(),{immediate:!0});const i=v(()=>u.value?.category||null),c=v(()=>u.value?.products||null);U(u,r=>{r&&r.filters&&e.setFilters(r.filters)},{immediate:!0});const A=v(()=>O.value&&!w.value),k=v(()=>c.value?.data?{"@context":"https://schema.org","@type":"ItemList",name:i.value?.name||"Категория товаров",description:i.value?.description||"",url:`${g.public.siteUrl}/category/${m}`,numberOfItems:c.value.data.length,itemListElement:c.value.data.map((r,f)=>({"@type":"Product",position:f+1,name:r.name,description:r.description,image:r.image,offers:{"@type":"Offer",price:r.price,priceCurrency:"RUB",availability:r.in_stock?"https://schema.org/InStock":"https://schema.org/OutOfStock"}}))}:null);return te(v(()=>({title:i.value?.name?`${i.value.name} - AgatCeramic`:"Категория товаров - AgatCeramic",meta:[{name:"description",content:i.value?.description||"Купить товары категории в интернет-магазине AgatCeramic"},{name:"keywords",content:i.value?.name?`${i.value.name}, керамическая плитка, сантехника`:"керамическая плитка, сантехника"}],link:[{rel:"canonical",href:`${g.public.siteUrl}/category/${m}`}],script:k.value?[{type:"application/ld+json",children:JSON.stringify(k.value)}]:[]}))),(r,f)=>{const E=q,t=D,o=L,a=H,d=I,b=V,R=Y;return p(),h("main",ne,[l("div",oe,[C(E,{selectedFilters:s(e).selectedFilters,onRemoveFilter:s(e).removeFilter},null,8,["selectedFilters","onRemoveFilter"]),l("div",ie,[l("div",re,[l("div",le,[l("div",ce,[i.value?(p(),h("h1",me,B(i.value.name),1)):S("",!0),i.value?(p(),h("p",ue,B(i.value.description),1)):S("",!0)]),C(t,{"onUpdate:sortOption":s(e).handleSortChange},null,8,["onUpdate:sortOption"])]),s(w)?(p(),$(o,{key:0,text:"Загрузка товаров..."})):A.value?(p(),h("div",pe,[...f[0]||(f[0]=[l("h2",null,[T("Произошла ошибка при загрузке товаров."),l("br"),T("Попробуйте перезагрузить страницу.")],-1)])])):!c.value||!c.value.data||c.value.data.length===0?(p(),h("div",de,[...f[1]||(f[1]=[l("h2",null,"Список товаров пуст",-1)])])):(p(),h("div",_e,[l("div",ge,[l("div",fe,[l("div",ve,[l("div",he,[l("div",ye,[(p(!0),h(Q,null,W(c.value.data,j=>(p(),$(a,{key:j.id,product:j},null,8,["product"]))),128))])])])])]),c.value.last_page>1?(p(),$(d,{key:0,"current-page":c.value.current_page,"total-pages":c.value.last_page,onChangePage:s(e).changePage},null,8,["current-page","total-pages","onChangePage"])):S("",!0)]))]),C(R,null,{default:X(()=>[C(b,{store:s(e),categories:s(e).filters.categories,subcategories:s(e).filters.subcategories,patterns:s(e).filters.patterns,weights:s(e).filters.weights,colors:s(e).filters.colors,glues:s(e).filters.glues,mixture_types:s(e).filters.mixture_types,seams:s(e).filters.seams,textures:s(e).filters.textures,countries:s(e).filters.countries,sizes:s(e).filters.sizes,materials:s(e).filters.materials,waterproofs:s(e).filters.waterproofs,collections:s(e).filters.collections,volumes:s(e).filters.volumes,product_weights:s(e).filters.product_weights,installation_types:s(e).filters.installation_types,shapes:s(e).filters.shapes,applications:s(e).filters.applications,drying_times:s(e).filters.drying_times,package_weights:s(e).filters.package_weights,min_temps:s(e).filters.min_temps,max_temps:s(e).filters.max_temps,consumptions:s(e).filters.consumptions,brands:s(e).filters.brands,initialFilters:s(e).filters},null,8,["store","categories","subcategories","patterns","weights","colors","glues","mixture_types","seams","textures","countries","sizes","materials","waterproofs","collections","volumes","product_weights","installation_types","shapes","applications","drying_times","package_weights","min_temps","max_temps","consumptions","brands","initialFilters"])]),_:1})])])])}}},Ae=G(Fe,[["__scopeId","data-v-573f3f64"]]);export{Ae as default};
